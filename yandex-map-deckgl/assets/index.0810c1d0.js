function Aw(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}const Cw=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerpolicy&&(s.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?s.credentials="include":r.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}};Cw();var It={exports:{}},Z={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ro=Symbol.for("react.element"),Lw=Symbol.for("react.portal"),Mw=Symbol.for("react.fragment"),Iw=Symbol.for("react.strict_mode"),Rw=Symbol.for("react.profiler"),Ow=Symbol.for("react.provider"),kw=Symbol.for("react.context"),Nw=Symbol.for("react.forward_ref"),Fw=Symbol.for("react.suspense"),Dw=Symbol.for("react.memo"),zw=Symbol.for("react.lazy"),$d=Symbol.iterator;function Uw(t){return t===null||typeof t!="object"?null:(t=$d&&t[$d]||t["@@iterator"],typeof t=="function"?t:null)}var w0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E0=Object.assign,x0={};function Ir(t,e,n){this.props=t,this.context=e,this.refs=x0,this.updater=n||w0}Ir.prototype.isReactComponent={};Ir.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Ir.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function T0(){}T0.prototype=Ir.prototype;function Kf(t,e,n){this.props=t,this.context=e,this.refs=x0,this.updater=n||w0}var qf=Kf.prototype=new T0;qf.constructor=Kf;E0(qf,Ir.prototype);qf.isPureReactComponent=!0;var Kd=Array.isArray,S0=Object.prototype.hasOwnProperty,Qf={current:null},P0={key:!0,ref:!0,__self:!0,__source:!0};function b0(t,e,n){var i,r={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)S0.call(e,i)&&!P0.hasOwnProperty(i)&&(r[i]=e[i]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];r.children=l}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)r[i]===void 0&&(r[i]=a[i]);return{$$typeof:ro,type:t,key:s,ref:o,props:r,_owner:Qf.current}}function Bw(t,e){return{$$typeof:ro,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Jf(t){return typeof t=="object"&&t!==null&&t.$$typeof===ro}function Vw(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var qd=/\/+/g;function mc(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Vw(""+t.key):e.toString(36)}function pa(t,e,n,i,r){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case ro:case Lw:o=!0}}if(o)return o=t,r=r(o),t=i===""?"."+mc(o,0):i,Kd(r)?(n="",t!=null&&(n=t.replace(qd,"$&/")+"/"),pa(r,e,n,"",function(c){return c})):r!=null&&(Jf(r)&&(r=Bw(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(qd,"$&/")+"/")+t)),e.push(r)),1;if(o=0,i=i===""?".":i+":",Kd(t))for(var a=0;a<t.length;a++){s=t[a];var l=i+mc(s,a);o+=pa(s,e,n,l,r)}else if(l=Uw(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=i+mc(s,a++),o+=pa(s,e,n,l,r);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Oo(t,e,n){if(t==null)return t;var i=[],r=0;return pa(t,i,"","",function(s){return e.call(n,s,r++)}),i}function jw(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var He={current:null},ma={transition:null},Gw={ReactCurrentDispatcher:He,ReactCurrentBatchConfig:ma,ReactCurrentOwner:Qf};Z.Children={map:Oo,forEach:function(t,e,n){Oo(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Oo(t,function(){e++}),e},toArray:function(t){return Oo(t,function(e){return e})||[]},only:function(t){if(!Jf(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Z.Component=Ir;Z.Fragment=Mw;Z.Profiler=Rw;Z.PureComponent=Kf;Z.StrictMode=Iw;Z.Suspense=Fw;Z.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Gw;Z.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=E0({},t.props),r=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Qf.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)S0.call(e,l)&&!P0.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=n;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];i.children=a}return{$$typeof:ro,type:t.type,key:r,ref:s,props:i,_owner:o}};Z.createContext=function(t){return t={$$typeof:kw,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Ow,_context:t},t.Consumer=t};Z.createElement=b0;Z.createFactory=function(t){var e=b0.bind(null,t);return e.type=t,e};Z.createRef=function(){return{current:null}};Z.forwardRef=function(t){return{$$typeof:Nw,render:t}};Z.isValidElement=Jf;Z.lazy=function(t){return{$$typeof:zw,_payload:{_status:-1,_result:t},_init:jw}};Z.memo=function(t,e){return{$$typeof:Dw,type:t,compare:e===void 0?null:e}};Z.startTransition=function(t){var e=ma.transition;ma.transition={};try{t()}finally{ma.transition=e}};Z.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Z.useCallback=function(t,e){return He.current.useCallback(t,e)};Z.useContext=function(t){return He.current.useContext(t)};Z.useDebugValue=function(){};Z.useDeferredValue=function(t){return He.current.useDeferredValue(t)};Z.useEffect=function(t,e){return He.current.useEffect(t,e)};Z.useId=function(){return He.current.useId()};Z.useImperativeHandle=function(t,e,n){return He.current.useImperativeHandle(t,e,n)};Z.useInsertionEffect=function(t,e){return He.current.useInsertionEffect(t,e)};Z.useLayoutEffect=function(t,e){return He.current.useLayoutEffect(t,e)};Z.useMemo=function(t,e){return He.current.useMemo(t,e)};Z.useReducer=function(t,e,n){return He.current.useReducer(t,e,n)};Z.useRef=function(t){return He.current.useRef(t)};Z.useState=function(t){return He.current.useState(t)};Z.useSyncExternalStore=function(t,e,n){return He.current.useSyncExternalStore(t,e,n)};Z.useTransition=function(){return He.current.useTransition()};Z.version="18.2.0";It.exports=Z;var Ww=It.exports,Su={},A0={exports:{}},ht={},C0={exports:{}},L0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(F,V){var G=F.length;F.push(V);e:for(;0<G;){var ae=G-1>>>1,se=F[ae];if(0<r(se,V))F[ae]=V,F[G]=se,G=ae;else break e}}function n(F){return F.length===0?null:F[0]}function i(F){if(F.length===0)return null;var V=F[0],G=F.pop();if(G!==V){F[0]=G;e:for(var ae=0,se=F.length,ki=se>>>1;ae<ki;){var At=2*(ae+1)-1,Ur=F[At],sn=At+1,me=F[sn];if(0>r(Ur,G))sn<se&&0>r(me,Ur)?(F[ae]=me,F[sn]=G,ae=sn):(F[ae]=Ur,F[At]=G,ae=At);else if(sn<se&&0>r(me,G))F[ae]=me,F[sn]=G,ae=sn;else break e}}return V}function r(F,V){var G=F.sortIndex-V.sortIndex;return G!==0?G:F.id-V.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,f=null,h=3,g=!1,p=!1,w=!1,x=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,m=typeof setImmediate!="undefined"?setImmediate:null;typeof navigator!="undefined"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _(F){for(var V=n(c);V!==null;){if(V.callback===null)i(c);else if(V.startTime<=F)i(c),V.sortIndex=V.expirationTime,e(l,V);else break;V=n(c)}}function T(F){if(w=!1,_(F),!p)if(n(l)!==null)p=!0,ri(P);else{var V=n(c);V!==null&&An(T,V.startTime-F)}}function P(F,V){p=!1,w&&(w=!1,y(M),M=-1),g=!0;var G=h;try{for(_(V),f=n(l);f!==null&&(!(f.expirationTime>V)||F&&!z());){var ae=f.callback;if(typeof ae=="function"){f.callback=null,h=f.priorityLevel;var se=ae(f.expirationTime<=V);V=t.unstable_now(),typeof se=="function"?f.callback=se:f===n(l)&&i(l),_(V)}else i(l);f=n(l)}if(f!==null)var ki=!0;else{var At=n(c);At!==null&&An(T,At.startTime-V),ki=!1}return ki}finally{f=null,h=G,g=!1}}var A=!1,C=null,M=-1,R=5,O=-1;function z(){return!(t.unstable_now()-O<R)}function j(){if(C!==null){var F=t.unstable_now();O=F;var V=!0;try{V=C(!0,F)}finally{V?B():(A=!1,C=null)}}else A=!1}var B;if(typeof m=="function")B=function(){m(j)};else if(typeof MessageChannel!="undefined"){var H=new MessageChannel,Ye=H.port2;H.port1.onmessage=j,B=function(){Ye.postMessage(null)}}else B=function(){x(j,0)};function ri(F){C=F,A||(A=!0,B())}function An(F,V){M=x(function(){F(t.unstable_now())},V)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(F){F.callback=null},t.unstable_continueExecution=function(){p||g||(p=!0,ri(P))},t.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<F?Math.floor(1e3/F):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(F){switch(h){case 1:case 2:case 3:var V=3;break;default:V=h}var G=h;h=V;try{return F()}finally{h=G}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(F,V){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var G=h;h=F;try{return V()}finally{h=G}},t.unstable_scheduleCallback=function(F,V,G){var ae=t.unstable_now();switch(typeof G=="object"&&G!==null?(G=G.delay,G=typeof G=="number"&&0<G?ae+G:ae):G=ae,F){case 1:var se=-1;break;case 2:se=250;break;case 5:se=1073741823;break;case 4:se=1e4;break;default:se=5e3}return se=G+se,F={id:u++,callback:V,priorityLevel:F,startTime:G,expirationTime:se,sortIndex:-1},G>ae?(F.sortIndex=G,e(c,F),n(l)===null&&F===n(c)&&(w?(y(M),M=-1):w=!0,An(T,G-ae))):(F.sortIndex=se,e(l,F),p||g||(p=!0,ri(P))),F},t.unstable_shouldYield=z,t.unstable_wrapCallback=function(F){var V=h;return function(){var G=h;h=V;try{return F.apply(this,arguments)}finally{h=G}}}})(L0);C0.exports=L0;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var M0=It.exports,ut=C0.exports;function I(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var I0=new Set,Is={};function Mi(t,e){mr(t,e),mr(t+"Capture",e)}function mr(t,e){for(Is[t]=e,t=0;t<e.length;t++)I0.add(e[t])}var vn=!(typeof window=="undefined"||typeof window.document=="undefined"||typeof window.document.createElement=="undefined"),Pu=Object.prototype.hasOwnProperty,Hw=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Qd={},Jd={};function Xw(t){return Pu.call(Jd,t)?!0:Pu.call(Qd,t)?!1:Hw.test(t)?Jd[t]=!0:(Qd[t]=!0,!1)}function Yw(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Zw(t,e,n,i){if(e===null||typeof e=="undefined"||Yw(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Xe(t,e,n,i,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Ie={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Ie[t]=new Xe(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Ie[e]=new Xe(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Ie[t]=new Xe(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Ie[t]=new Xe(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Ie[t]=new Xe(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Ie[t]=new Xe(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Ie[t]=new Xe(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Ie[t]=new Xe(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Ie[t]=new Xe(t,5,!1,t.toLowerCase(),null,!1,!1)});var eh=/[\-:]([a-z])/g;function th(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(eh,th);Ie[e]=new Xe(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(eh,th);Ie[e]=new Xe(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(eh,th);Ie[e]=new Xe(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Ie[t]=new Xe(t,1,!1,t.toLowerCase(),null,!1,!1)});Ie.xlinkHref=new Xe("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Ie[t]=new Xe(t,1,!1,t.toLowerCase(),null,!0,!0)});function nh(t,e,n,i){var r=Ie.hasOwnProperty(e)?Ie[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Zw(e,n,r,i)&&(n=null),i||r===null?Xw(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,i=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var Sn=M0.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ko=Symbol.for("react.element"),Hi=Symbol.for("react.portal"),Xi=Symbol.for("react.fragment"),ih=Symbol.for("react.strict_mode"),bu=Symbol.for("react.profiler"),R0=Symbol.for("react.provider"),O0=Symbol.for("react.context"),rh=Symbol.for("react.forward_ref"),Au=Symbol.for("react.suspense"),Cu=Symbol.for("react.suspense_list"),sh=Symbol.for("react.memo"),Nn=Symbol.for("react.lazy"),k0=Symbol.for("react.offscreen"),eg=Symbol.iterator;function Yr(t){return t===null||typeof t!="object"?null:(t=eg&&t[eg]||t["@@iterator"],typeof t=="function"?t:null)}var fe=Object.assign,vc;function cs(t){if(vc===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);vc=e&&e[1]||""}return`
`+vc+t}var yc=!1;function _c(t,e){if(!t||yc)return"";yc=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var i=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){i=c}t.call(e.prototype)}else{try{throw Error()}catch(c){i=c}t()}}catch(c){if(c&&i&&typeof c.stack=="string"){for(var r=c.stack.split(`
`),s=i.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var l=`
`+r[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{yc=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?cs(t):""}function $w(t){switch(t.tag){case 5:return cs(t.type);case 16:return cs("Lazy");case 13:return cs("Suspense");case 19:return cs("SuspenseList");case 0:case 2:case 15:return t=_c(t.type,!1),t;case 11:return t=_c(t.type.render,!1),t;case 1:return t=_c(t.type,!0),t;default:return""}}function Lu(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Xi:return"Fragment";case Hi:return"Portal";case bu:return"Profiler";case ih:return"StrictMode";case Au:return"Suspense";case Cu:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case O0:return(t.displayName||"Context")+".Consumer";case R0:return(t._context.displayName||"Context")+".Provider";case rh:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case sh:return e=t.displayName||null,e!==null?e:Lu(t.type)||"Memo";case Nn:e=t._payload,t=t._init;try{return Lu(t(e))}catch{}}return null}function Kw(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Lu(e);case 8:return e===ih?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Qn(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function N0(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function qw(t){var e=N0(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n!="undefined"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function No(t){t._valueTracker||(t._valueTracker=qw(t))}function F0(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=N0(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function Ba(t){if(t=t||(typeof document!="undefined"?document:void 0),typeof t=="undefined")return null;try{return t.activeElement||t.body}catch{return t.body}}function Mu(t,e){var n=e.checked;return fe({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n!=null?n:t._wrapperState.initialChecked})}function tg(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=Qn(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function D0(t,e){e=e.checked,e!=null&&nh(t,"checked",e,!1)}function Iu(t,e){D0(t,e);var n=Qn(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Ru(t,e.type,n):e.hasOwnProperty("defaultValue")&&Ru(t,e.type,Qn(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function ng(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Ru(t,e,n){(e!=="number"||Ba(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var us=Array.isArray;function ar(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+Qn(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,i&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function Ou(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(I(91));return fe({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function ig(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(I(92));if(us(n)){if(1<n.length)throw Error(I(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Qn(n)}}function z0(t,e){var n=Qn(e.value),i=Qn(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function rg(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function U0(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ku(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?U0(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Fo,B0=function(t){return typeof MSApp!="undefined"&&MSApp.execUnsafeLocalFunction?function(e,n,i,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Fo=Fo||document.createElement("div"),Fo.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Fo.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Rs(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var ms={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Qw=["Webkit","ms","Moz","O"];Object.keys(ms).forEach(function(t){Qw.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),ms[e]=ms[t]})});function V0(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||ms.hasOwnProperty(t)&&ms[t]?(""+e).trim():e+"px"}function j0(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,r=V0(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,r):t[n]=r}}var Jw=fe({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Nu(t,e){if(e){if(Jw[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(I(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(I(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(I(61))}if(e.style!=null&&typeof e.style!="object")throw Error(I(62))}}function Fu(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Du=null;function oh(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var zu=null,lr=null,cr=null;function sg(t){if(t=ao(t)){if(typeof zu!="function")throw Error(I(280));var e=t.stateNode;e&&(e=Ol(e),zu(t.stateNode,t.type,e))}}function G0(t){lr?cr?cr.push(t):cr=[t]:lr=t}function W0(){if(lr){var t=lr,e=cr;if(cr=lr=null,sg(t),e)for(t=0;t<e.length;t++)sg(e[t])}}function H0(t,e){return t(e)}function X0(){}var wc=!1;function Y0(t,e,n){if(wc)return t(e,n);wc=!0;try{return H0(t,e,n)}finally{wc=!1,(lr!==null||cr!==null)&&(X0(),W0())}}function Os(t,e){var n=t.stateNode;if(n===null)return null;var i=Ol(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(I(231,e,typeof n));return n}var Uu=!1;if(vn)try{var Zr={};Object.defineProperty(Zr,"passive",{get:function(){Uu=!0}}),window.addEventListener("test",Zr,Zr),window.removeEventListener("test",Zr,Zr)}catch{Uu=!1}function eE(t,e,n,i,r,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(u){this.onError(u)}}var vs=!1,Va=null,ja=!1,Bu=null,tE={onError:function(t){vs=!0,Va=t}};function nE(t,e,n,i,r,s,o,a,l){vs=!1,Va=null,eE.apply(tE,arguments)}function iE(t,e,n,i,r,s,o,a,l){if(nE.apply(this,arguments),vs){if(vs){var c=Va;vs=!1,Va=null}else throw Error(I(198));ja||(ja=!0,Bu=c)}}function Ii(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,(e.flags&4098)!==0&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Z0(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function og(t){if(Ii(t)!==t)throw Error(I(188))}function rE(t){var e=t.alternate;if(!e){if(e=Ii(t),e===null)throw Error(I(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return og(r),t;if(s===i)return og(r),e;s=s.sibling}throw Error(I(188))}if(n.return!==i.return)n=r,i=s;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,i=s;break}if(a===i){o=!0,i=r,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,i=r;break}if(a===i){o=!0,i=s,n=r;break}a=a.sibling}if(!o)throw Error(I(189))}}if(n.alternate!==i)throw Error(I(190))}if(n.tag!==3)throw Error(I(188));return n.stateNode.current===n?t:e}function $0(t){return t=rE(t),t!==null?K0(t):null}function K0(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=K0(t);if(e!==null)return e;t=t.sibling}return null}var q0=ut.unstable_scheduleCallback,ag=ut.unstable_cancelCallback,sE=ut.unstable_shouldYield,oE=ut.unstable_requestPaint,ge=ut.unstable_now,aE=ut.unstable_getCurrentPriorityLevel,ah=ut.unstable_ImmediatePriority,Q0=ut.unstable_UserBlockingPriority,Ga=ut.unstable_NormalPriority,lE=ut.unstable_LowPriority,J0=ut.unstable_IdlePriority,Ll=null,Qt=null;function cE(t){if(Qt&&typeof Qt.onCommitFiberRoot=="function")try{Qt.onCommitFiberRoot(Ll,t,void 0,(t.current.flags&128)===128)}catch{}}var Dt=Math.clz32?Math.clz32:hE,uE=Math.log,fE=Math.LN2;function hE(t){return t>>>=0,t===0?32:31-(uE(t)/fE|0)|0}var Do=64,zo=4194304;function fs(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Wa(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~r;a!==0?i=fs(a):(s&=o,s!==0&&(i=fs(s)))}else o=n&~r,o!==0?i=fs(o):s!==0&&(i=fs(s));if(i===0)return 0;if(e!==0&&e!==i&&(e&r)===0&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if((i&4)!==0&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-Dt(e),r=1<<n,i|=t[n],e&=~r;return i}function dE(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function gE(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-Dt(s),a=1<<o,l=r[o];l===-1?((a&n)===0||(a&i)!==0)&&(r[o]=dE(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function Vu(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function ev(){var t=Do;return Do<<=1,(Do&4194240)===0&&(Do=64),t}function Ec(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function so(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Dt(e),t[e]=n}function pE(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-Dt(n),s=1<<r;e[r]=0,i[r]=-1,t[r]=-1,n&=~s}}function lh(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-Dt(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}var q=0;function tv(t){return t&=-t,1<t?4<t?(t&268435455)!==0?16:536870912:4:1}var nv,ch,iv,rv,sv,ju=!1,Uo=[],Gn=null,Wn=null,Hn=null,ks=new Map,Ns=new Map,Dn=[],mE="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function lg(t,e){switch(t){case"focusin":case"focusout":Gn=null;break;case"dragenter":case"dragleave":Wn=null;break;case"mouseover":case"mouseout":Hn=null;break;case"pointerover":case"pointerout":ks.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ns.delete(e.pointerId)}}function $r(t,e,n,i,r,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=ao(e),e!==null&&ch(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function vE(t,e,n,i,r){switch(e){case"focusin":return Gn=$r(Gn,t,e,n,i,r),!0;case"dragenter":return Wn=$r(Wn,t,e,n,i,r),!0;case"mouseover":return Hn=$r(Hn,t,e,n,i,r),!0;case"pointerover":var s=r.pointerId;return ks.set(s,$r(ks.get(s)||null,t,e,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,Ns.set(s,$r(Ns.get(s)||null,t,e,n,i,r)),!0}return!1}function ov(t){var e=gi(t.target);if(e!==null){var n=Ii(e);if(n!==null){if(e=n.tag,e===13){if(e=Z0(n),e!==null){t.blockedOn=e,sv(t.priority,function(){iv(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function va(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Gu(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);Du=i,n.target.dispatchEvent(i),Du=null}else return e=ao(n),e!==null&&ch(e),t.blockedOn=n,!1;e.shift()}return!0}function cg(t,e,n){va(t)&&n.delete(e)}function yE(){ju=!1,Gn!==null&&va(Gn)&&(Gn=null),Wn!==null&&va(Wn)&&(Wn=null),Hn!==null&&va(Hn)&&(Hn=null),ks.forEach(cg),Ns.forEach(cg)}function Kr(t,e){t.blockedOn===e&&(t.blockedOn=null,ju||(ju=!0,ut.unstable_scheduleCallback(ut.unstable_NormalPriority,yE)))}function Fs(t){function e(r){return Kr(r,t)}if(0<Uo.length){Kr(Uo[0],t);for(var n=1;n<Uo.length;n++){var i=Uo[n];i.blockedOn===t&&(i.blockedOn=null)}}for(Gn!==null&&Kr(Gn,t),Wn!==null&&Kr(Wn,t),Hn!==null&&Kr(Hn,t),ks.forEach(e),Ns.forEach(e),n=0;n<Dn.length;n++)i=Dn[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<Dn.length&&(n=Dn[0],n.blockedOn===null);)ov(n),n.blockedOn===null&&Dn.shift()}var ur=Sn.ReactCurrentBatchConfig,Ha=!0;function _E(t,e,n,i){var r=q,s=ur.transition;ur.transition=null;try{q=1,uh(t,e,n,i)}finally{q=r,ur.transition=s}}function wE(t,e,n,i){var r=q,s=ur.transition;ur.transition=null;try{q=4,uh(t,e,n,i)}finally{q=r,ur.transition=s}}function uh(t,e,n,i){if(Ha){var r=Gu(t,e,n,i);if(r===null)Ic(t,e,i,Xa,n),lg(t,i);else if(vE(r,t,e,n,i))i.stopPropagation();else if(lg(t,i),e&4&&-1<mE.indexOf(t)){for(;r!==null;){var s=ao(r);if(s!==null&&nv(s),s=Gu(t,e,n,i),s===null&&Ic(t,e,i,Xa,n),s===r)break;r=s}r!==null&&i.stopPropagation()}else Ic(t,e,i,null,n)}}var Xa=null;function Gu(t,e,n,i){if(Xa=null,t=oh(i),t=gi(t),t!==null)if(e=Ii(t),e===null)t=null;else if(n=e.tag,n===13){if(t=Z0(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Xa=t,null}function av(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(aE()){case ah:return 1;case Q0:return 4;case Ga:case lE:return 16;case J0:return 536870912;default:return 16}default:return 16}}var Un=null,fh=null,ya=null;function lv(){if(ya)return ya;var t,e=fh,n=e.length,i,r="value"in Un?Un.value:Un.textContent,s=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(i=1;i<=o&&e[n-i]===r[s-i];i++);return ya=r.slice(t,1<i?1-i:void 0)}function _a(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Bo(){return!0}function ug(){return!1}function dt(t){function e(n,i,r,s,o){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Bo:ug,this.isPropagationStopped=ug,this}return fe(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Bo)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Bo)},persist:function(){},isPersistent:Bo}),e}var Rr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},hh=dt(Rr),oo=fe({},Rr,{view:0,detail:0}),EE=dt(oo),xc,Tc,qr,Ml=fe({},oo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:dh,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==qr&&(qr&&t.type==="mousemove"?(xc=t.screenX-qr.screenX,Tc=t.screenY-qr.screenY):Tc=xc=0,qr=t),xc)},movementY:function(t){return"movementY"in t?t.movementY:Tc}}),fg=dt(Ml),xE=fe({},Ml,{dataTransfer:0}),TE=dt(xE),SE=fe({},oo,{relatedTarget:0}),Sc=dt(SE),PE=fe({},Rr,{animationName:0,elapsedTime:0,pseudoElement:0}),bE=dt(PE),AE=fe({},Rr,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),CE=dt(AE),LE=fe({},Rr,{data:0}),hg=dt(LE),ME={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},IE={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},RE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function OE(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=RE[t])?!!e[t]:!1}function dh(){return OE}var kE=fe({},oo,{key:function(t){if(t.key){var e=ME[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=_a(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?IE[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:dh,charCode:function(t){return t.type==="keypress"?_a(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?_a(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),NE=dt(kE),FE=fe({},Ml,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),dg=dt(FE),DE=fe({},oo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:dh}),zE=dt(DE),UE=fe({},Rr,{propertyName:0,elapsedTime:0,pseudoElement:0}),BE=dt(UE),VE=fe({},Ml,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),jE=dt(VE),GE=[9,13,27,32],gh=vn&&"CompositionEvent"in window,ys=null;vn&&"documentMode"in document&&(ys=document.documentMode);var WE=vn&&"TextEvent"in window&&!ys,cv=vn&&(!gh||ys&&8<ys&&11>=ys),gg=String.fromCharCode(32),pg=!1;function uv(t,e){switch(t){case"keyup":return GE.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function fv(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Yi=!1;function HE(t,e){switch(t){case"compositionend":return fv(e);case"keypress":return e.which!==32?null:(pg=!0,gg);case"textInput":return t=e.data,t===gg&&pg?null:t;default:return null}}function XE(t,e){if(Yi)return t==="compositionend"||!gh&&uv(t,e)?(t=lv(),ya=fh=Un=null,Yi=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return cv&&e.locale!=="ko"?null:e.data;default:return null}}var YE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function mg(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!YE[t.type]:e==="textarea"}function hv(t,e,n,i){G0(i),e=Ya(e,"onChange"),0<e.length&&(n=new hh("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var _s=null,Ds=null;function ZE(t){Tv(t,0)}function Il(t){var e=Ki(t);if(F0(e))return t}function $E(t,e){if(t==="change")return e}var dv=!1;if(vn){var Pc;if(vn){var bc="oninput"in document;if(!bc){var vg=document.createElement("div");vg.setAttribute("oninput","return;"),bc=typeof vg.oninput=="function"}Pc=bc}else Pc=!1;dv=Pc&&(!document.documentMode||9<document.documentMode)}function yg(){_s&&(_s.detachEvent("onpropertychange",gv),Ds=_s=null)}function gv(t){if(t.propertyName==="value"&&Il(Ds)){var e=[];hv(e,Ds,t,oh(t)),Y0(ZE,e)}}function KE(t,e,n){t==="focusin"?(yg(),_s=e,Ds=n,_s.attachEvent("onpropertychange",gv)):t==="focusout"&&yg()}function qE(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Il(Ds)}function QE(t,e){if(t==="click")return Il(e)}function JE(t,e){if(t==="input"||t==="change")return Il(e)}function ex(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Bt=typeof Object.is=="function"?Object.is:ex;function zs(t,e){if(Bt(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!Pu.call(e,r)||!Bt(t[r],e[r]))return!1}return!0}function _g(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function wg(t,e){var n=_g(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=_g(n)}}function pv(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?pv(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function mv(){for(var t=window,e=Ba();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Ba(t.document)}return e}function ph(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function tx(t){var e=mv(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&pv(n.ownerDocument.documentElement,n)){if(i!==null&&ph(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!t.extend&&s>i&&(r=i,i=s,s=r),r=wg(n,s);var o=wg(n,i);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var nx=vn&&"documentMode"in document&&11>=document.documentMode,Zi=null,Wu=null,ws=null,Hu=!1;function Eg(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Hu||Zi==null||Zi!==Ba(i)||(i=Zi,"selectionStart"in i&&ph(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),ws&&zs(ws,i)||(ws=i,i=Ya(Wu,"onSelect"),0<i.length&&(e=new hh("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=Zi)))}function Vo(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var $i={animationend:Vo("Animation","AnimationEnd"),animationiteration:Vo("Animation","AnimationIteration"),animationstart:Vo("Animation","AnimationStart"),transitionend:Vo("Transition","TransitionEnd")},Ac={},vv={};vn&&(vv=document.createElement("div").style,"AnimationEvent"in window||(delete $i.animationend.animation,delete $i.animationiteration.animation,delete $i.animationstart.animation),"TransitionEvent"in window||delete $i.transitionend.transition);function Rl(t){if(Ac[t])return Ac[t];if(!$i[t])return t;var e=$i[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in vv)return Ac[t]=e[n];return t}var yv=Rl("animationend"),_v=Rl("animationiteration"),wv=Rl("animationstart"),Ev=Rl("transitionend"),xv=new Map,xg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ti(t,e){xv.set(t,e),Mi(e,[t])}for(var Cc=0;Cc<xg.length;Cc++){var Lc=xg[Cc],ix=Lc.toLowerCase(),rx=Lc[0].toUpperCase()+Lc.slice(1);ti(ix,"on"+rx)}ti(yv,"onAnimationEnd");ti(_v,"onAnimationIteration");ti(wv,"onAnimationStart");ti("dblclick","onDoubleClick");ti("focusin","onFocus");ti("focusout","onBlur");ti(Ev,"onTransitionEnd");mr("onMouseEnter",["mouseout","mouseover"]);mr("onMouseLeave",["mouseout","mouseover"]);mr("onPointerEnter",["pointerout","pointerover"]);mr("onPointerLeave",["pointerout","pointerover"]);Mi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Mi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Mi("onBeforeInput",["compositionend","keypress","textInput","paste"]);Mi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Mi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Mi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var hs="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),sx=new Set("cancel close invalid load scroll toggle".split(" ").concat(hs));function Tg(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,iE(i,e,void 0,t),t.currentTarget=null}function Tv(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&r.isPropagationStopped())break e;Tg(r,a,c),s=l}else for(o=0;o<i.length;o++){if(a=i[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&r.isPropagationStopped())break e;Tg(r,a,c),s=l}}}if(ja)throw t=Bu,ja=!1,Bu=null,t}function ie(t,e){var n=e[Ku];n===void 0&&(n=e[Ku]=new Set);var i=t+"__bubble";n.has(i)||(Sv(e,t,2,!1),n.add(i))}function Mc(t,e,n){var i=0;e&&(i|=4),Sv(n,t,i,e)}var jo="_reactListening"+Math.random().toString(36).slice(2);function Us(t){if(!t[jo]){t[jo]=!0,I0.forEach(function(n){n!=="selectionchange"&&(sx.has(n)||Mc(n,!1,t),Mc(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[jo]||(e[jo]=!0,Mc("selectionchange",!1,e))}}function Sv(t,e,n,i){switch(av(e)){case 1:var r=_E;break;case 4:r=wE;break;default:r=uh}n=r.bind(null,e,n,t),r=void 0,!Uu||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function Ic(t,e,n,i,r){var s=i;if((e&1)===0&&(e&2)===0&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=i.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;o=o.return}for(;a!==null;){if(o=gi(a),o===null)return;if(l=o.tag,l===5||l===6){i=s=o;continue e}a=a.parentNode}}i=i.return}Y0(function(){var c=s,u=oh(n),f=[];e:{var h=xv.get(t);if(h!==void 0){var g=hh,p=t;switch(t){case"keypress":if(_a(n)===0)break e;case"keydown":case"keyup":g=NE;break;case"focusin":p="focus",g=Sc;break;case"focusout":p="blur",g=Sc;break;case"beforeblur":case"afterblur":g=Sc;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":g=fg;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":g=TE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":g=zE;break;case yv:case _v:case wv:g=bE;break;case Ev:g=BE;break;case"scroll":g=EE;break;case"wheel":g=jE;break;case"copy":case"cut":case"paste":g=CE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":g=dg}var w=(e&4)!==0,x=!w&&t==="scroll",y=w?h!==null?h+"Capture":null:h;w=[];for(var m=c,_;m!==null;){_=m;var T=_.stateNode;if(_.tag===5&&T!==null&&(_=T,y!==null&&(T=Os(m,y),T!=null&&w.push(Bs(m,T,_)))),x)break;m=m.return}0<w.length&&(h=new g(h,p,null,n,u),f.push({event:h,listeners:w}))}}if((e&7)===0){e:{if(h=t==="mouseover"||t==="pointerover",g=t==="mouseout"||t==="pointerout",h&&n!==Du&&(p=n.relatedTarget||n.fromElement)&&(gi(p)||p[yn]))break e;if((g||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,g?(p=n.relatedTarget||n.toElement,g=c,p=p?gi(p):null,p!==null&&(x=Ii(p),p!==x||p.tag!==5&&p.tag!==6)&&(p=null)):(g=null,p=c),g!==p)){if(w=fg,T="onMouseLeave",y="onMouseEnter",m="mouse",(t==="pointerout"||t==="pointerover")&&(w=dg,T="onPointerLeave",y="onPointerEnter",m="pointer"),x=g==null?h:Ki(g),_=p==null?h:Ki(p),h=new w(T,m+"leave",g,n,u),h.target=x,h.relatedTarget=_,T=null,gi(u)===c&&(w=new w(y,m+"enter",p,n,u),w.target=_,w.relatedTarget=x,T=w),x=T,g&&p)t:{for(w=g,y=p,m=0,_=w;_;_=Fi(_))m++;for(_=0,T=y;T;T=Fi(T))_++;for(;0<m-_;)w=Fi(w),m--;for(;0<_-m;)y=Fi(y),_--;for(;m--;){if(w===y||y!==null&&w===y.alternate)break t;w=Fi(w),y=Fi(y)}w=null}else w=null;g!==null&&Sg(f,h,g,w,!1),p!==null&&x!==null&&Sg(f,x,p,w,!0)}}e:{if(h=c?Ki(c):window,g=h.nodeName&&h.nodeName.toLowerCase(),g==="select"||g==="input"&&h.type==="file")var P=$E;else if(mg(h))if(dv)P=JE;else{P=qE;var A=KE}else(g=h.nodeName)&&g.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(P=QE);if(P&&(P=P(t,c))){hv(f,P,n,u);break e}A&&A(t,h,c),t==="focusout"&&(A=h._wrapperState)&&A.controlled&&h.type==="number"&&Ru(h,"number",h.value)}switch(A=c?Ki(c):window,t){case"focusin":(mg(A)||A.contentEditable==="true")&&(Zi=A,Wu=c,ws=null);break;case"focusout":ws=Wu=Zi=null;break;case"mousedown":Hu=!0;break;case"contextmenu":case"mouseup":case"dragend":Hu=!1,Eg(f,n,u);break;case"selectionchange":if(nx)break;case"keydown":case"keyup":Eg(f,n,u)}var C;if(gh)e:{switch(t){case"compositionstart":var M="onCompositionStart";break e;case"compositionend":M="onCompositionEnd";break e;case"compositionupdate":M="onCompositionUpdate";break e}M=void 0}else Yi?uv(t,n)&&(M="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(M="onCompositionStart");M&&(cv&&n.locale!=="ko"&&(Yi||M!=="onCompositionStart"?M==="onCompositionEnd"&&Yi&&(C=lv()):(Un=u,fh="value"in Un?Un.value:Un.textContent,Yi=!0)),A=Ya(c,M),0<A.length&&(M=new hg(M,t,null,n,u),f.push({event:M,listeners:A}),C?M.data=C:(C=fv(n),C!==null&&(M.data=C)))),(C=WE?HE(t,n):XE(t,n))&&(c=Ya(c,"onBeforeInput"),0<c.length&&(u=new hg("onBeforeInput","beforeinput",null,n,u),f.push({event:u,listeners:c}),u.data=C))}Tv(f,e)})}function Bs(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Ya(t,e){for(var n=e+"Capture",i=[];t!==null;){var r=t,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=Os(t,n),s!=null&&i.unshift(Bs(t,s,r)),s=Os(t,e),s!=null&&i.push(Bs(t,s,r))),t=t.return}return i}function Fi(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Sg(t,e,n,i,r){for(var s=e._reactName,o=[];n!==null&&n!==i;){var a=n,l=a.alternate,c=a.stateNode;if(l!==null&&l===i)break;a.tag===5&&c!==null&&(a=c,r?(l=Os(n,s),l!=null&&o.unshift(Bs(n,l,a))):r||(l=Os(n,s),l!=null&&o.push(Bs(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var ox=/\r\n?/g,ax=/\u0000|\uFFFD/g;function Pg(t){return(typeof t=="string"?t:""+t).replace(ox,`
`).replace(ax,"")}function Go(t,e,n){if(e=Pg(e),Pg(t)!==e&&n)throw Error(I(425))}function Za(){}var Xu=null,Yu=null;function Zu(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var $u=typeof setTimeout=="function"?setTimeout:void 0,lx=typeof clearTimeout=="function"?clearTimeout:void 0,bg=typeof Promise=="function"?Promise:void 0,cx=typeof queueMicrotask=="function"?queueMicrotask:typeof bg!="undefined"?function(t){return bg.resolve(null).then(t).catch(ux)}:$u;function ux(t){setTimeout(function(){throw t})}function Rc(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(i===0){t.removeChild(r),Fs(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=r}while(n);Fs(e)}function Xn(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Ag(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Or=Math.random().toString(36).slice(2),Kt="__reactFiber$"+Or,Vs="__reactProps$"+Or,yn="__reactContainer$"+Or,Ku="__reactEvents$"+Or,fx="__reactListeners$"+Or,hx="__reactHandles$"+Or;function gi(t){var e=t[Kt];if(e)return e;for(var n=t.parentNode;n;){if(e=n[yn]||n[Kt]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Ag(t);t!==null;){if(n=t[Kt])return n;t=Ag(t)}return e}t=n,n=t.parentNode}return null}function ao(t){return t=t[Kt]||t[yn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Ki(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(I(33))}function Ol(t){return t[Vs]||null}var qu=[],qi=-1;function ni(t){return{current:t}}function re(t){0>qi||(t.current=qu[qi],qu[qi]=null,qi--)}function te(t,e){qi++,qu[qi]=t.current,t.current=e}var Jn={},ze=ni(Jn),Qe=ni(!1),xi=Jn;function vr(t,e){var n=t.type.contextTypes;if(!n)return Jn;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in n)r[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function Je(t){return t=t.childContextTypes,t!=null}function $a(){re(Qe),re(ze)}function Cg(t,e,n){if(ze.current!==Jn)throw Error(I(168));te(ze,e),te(Qe,n)}function Pv(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(I(108,Kw(t)||"Unknown",r));return fe({},n,i)}function Ka(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Jn,xi=ze.current,te(ze,t),te(Qe,Qe.current),!0}function Lg(t,e,n){var i=t.stateNode;if(!i)throw Error(I(169));n?(t=Pv(t,e,xi),i.__reactInternalMemoizedMergedChildContext=t,re(Qe),re(ze),te(ze,t)):re(Qe),te(Qe,n)}var fn=null,kl=!1,Oc=!1;function bv(t){fn===null?fn=[t]:fn.push(t)}function dx(t){kl=!0,bv(t)}function ii(){if(!Oc&&fn!==null){Oc=!0;var t=0,e=q;try{var n=fn;for(q=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}fn=null,kl=!1}catch(r){throw fn!==null&&(fn=fn.slice(t+1)),q0(ah,ii),r}finally{q=e,Oc=!1}}return null}var Qi=[],Ji=0,qa=null,Qa=0,yt=[],_t=0,Ti=null,dn=1,gn="";function fi(t,e){Qi[Ji++]=Qa,Qi[Ji++]=qa,qa=t,Qa=e}function Av(t,e,n){yt[_t++]=dn,yt[_t++]=gn,yt[_t++]=Ti,Ti=t;var i=dn;t=gn;var r=32-Dt(i)-1;i&=~(1<<r),n+=1;var s=32-Dt(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,dn=1<<32-Dt(e)+r|n<<r|i,gn=s+t}else dn=1<<s|n<<r|i,gn=t}function mh(t){t.return!==null&&(fi(t,1),Av(t,1,0))}function vh(t){for(;t===qa;)qa=Qi[--Ji],Qi[Ji]=null,Qa=Qi[--Ji],Qi[Ji]=null;for(;t===Ti;)Ti=yt[--_t],yt[_t]=null,gn=yt[--_t],yt[_t]=null,dn=yt[--_t],yt[_t]=null}var lt=null,at=null,oe=!1,Ot=null;function Cv(t,e){var n=wt(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Mg(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,lt=t,at=Xn(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,lt=t,at=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Ti!==null?{id:dn,overflow:gn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=wt(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,lt=t,at=null,!0):!1;default:return!1}}function Qu(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Ju(t){if(oe){var e=at;if(e){var n=e;if(!Mg(t,e)){if(Qu(t))throw Error(I(418));e=Xn(n.nextSibling);var i=lt;e&&Mg(t,e)?Cv(i,n):(t.flags=t.flags&-4097|2,oe=!1,lt=t)}}else{if(Qu(t))throw Error(I(418));t.flags=t.flags&-4097|2,oe=!1,lt=t}}}function Ig(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;lt=t}function Wo(t){if(t!==lt)return!1;if(!oe)return Ig(t),oe=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Zu(t.type,t.memoizedProps)),e&&(e=at)){if(Qu(t))throw Lv(),Error(I(418));for(;e;)Cv(t,e),e=Xn(e.nextSibling)}if(Ig(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(I(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){at=Xn(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}at=null}}else at=lt?Xn(t.stateNode.nextSibling):null;return!0}function Lv(){for(var t=at;t;)t=Xn(t.nextSibling)}function yr(){at=lt=null,oe=!1}function yh(t){Ot===null?Ot=[t]:Ot.push(t)}var gx=Sn.ReactCurrentBatchConfig;function Mt(t,e){if(t&&t.defaultProps){e=fe({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var Ja=ni(null),el=null,er=null,_h=null;function wh(){_h=er=el=null}function Eh(t){var e=Ja.current;re(Ja),t._currentValue=e}function ef(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function fr(t,e){el=t,_h=er=null,t=t.dependencies,t!==null&&t.firstContext!==null&&((t.lanes&e)!==0&&(Ke=!0),t.firstContext=null)}function Tt(t){var e=t._currentValue;if(_h!==t)if(t={context:t,memoizedValue:e,next:null},er===null){if(el===null)throw Error(I(308));er=t,el.dependencies={lanes:0,firstContext:t}}else er=er.next=t;return e}var pi=null;function xh(t){pi===null?pi=[t]:pi.push(t)}function Mv(t,e,n,i){var r=e.interleaved;return r===null?(n.next=n,xh(e)):(n.next=r.next,r.next=n),e.interleaved=n,_n(t,i)}function _n(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Fn=!1;function Th(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Iv(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function pn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Yn(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,(K&2)!==0){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,_n(t,n)}return r=i.interleaved,r===null?(e.next=e,xh(i)):(e.next=r.next,r.next=e),i.interleaved=e,_n(t,n)}function wa(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,lh(t,n)}}function Rg(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?r=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?r=s=e:s=s.next=e}else r=s=e;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function tl(t,e,n,i){var r=t.updateQueue;Fn=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var f=r.baseState;o=0,u=c=l=null,a=s;do{var h=a.lane,g=a.eventTime;if((i&h)===h){u!==null&&(u=u.next={eventTime:g,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=t,w=a;switch(h=e,g=n,w.tag){case 1:if(p=w.payload,typeof p=="function"){f=p.call(g,f,h);break e}f=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=w.payload,h=typeof p=="function"?p.call(g,f,h):p,h==null)break e;f=fe({},f,h);break e;case 2:Fn=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=r.effects,h===null?r.effects=[a]:h.push(a))}else g={eventTime:g,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=g,l=f):u=u.next=g,o|=h;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;h=a,a=h.next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}while(1);if(u===null&&(l=f),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);Pi|=o,t.lanes=o,t.memoizedState=f}}function Og(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],r=i.callback;if(r!==null){if(i.callback=null,i=n,typeof r!="function")throw Error(I(191,r));r.call(i)}}}var Rv=new M0.Component().refs;function tf(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:fe({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Nl={isMounted:function(t){return(t=t._reactInternals)?Ii(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=Ge(),r=$n(t),s=pn(i,r);s.payload=e,n!=null&&(s.callback=n),e=Yn(t,s,r),e!==null&&(zt(e,t,r,i),wa(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=Ge(),r=$n(t),s=pn(i,r);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=Yn(t,s,r),e!==null&&(zt(e,t,r,i),wa(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Ge(),i=$n(t),r=pn(n,i);r.tag=2,e!=null&&(r.callback=e),e=Yn(t,r,i),e!==null&&(zt(e,t,i,n),wa(e,t,i))}};function kg(t,e,n,i,r,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!zs(n,i)||!zs(r,s):!0}function Ov(t,e,n){var i=!1,r=Jn,s=e.contextType;return typeof s=="object"&&s!==null?s=Tt(s):(r=Je(e)?xi:ze.current,i=e.contextTypes,s=(i=i!=null)?vr(t,r):Jn),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Nl,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=s),e}function Ng(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&Nl.enqueueReplaceState(e,e.state,null)}function nf(t,e,n,i){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs=Rv,Th(t);var s=e.contextType;typeof s=="object"&&s!==null?r.context=Tt(s):(s=Je(e)?xi:ze.current,r.context=vr(t,s)),r.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(tf(t,e,s,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&Nl.enqueueReplaceState(r,r.state,null),tl(t,n,r,i),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function Qr(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(I(309));var i=n.stateNode}if(!i)throw Error(I(147,t));var r=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;a===Rv&&(a=r.refs={}),o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(I(284));if(!n._owner)throw Error(I(290,t))}return t}function Ho(t,e){throw t=Object.prototype.toString.call(e),Error(I(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Fg(t){var e=t._init;return e(t._payload)}function kv(t){function e(y,m){if(t){var _=y.deletions;_===null?(y.deletions=[m],y.flags|=16):_.push(m)}}function n(y,m){if(!t)return null;for(;m!==null;)e(y,m),m=m.sibling;return null}function i(y,m){for(y=new Map;m!==null;)m.key!==null?y.set(m.key,m):y.set(m.index,m),m=m.sibling;return y}function r(y,m){return y=Kn(y,m),y.index=0,y.sibling=null,y}function s(y,m,_){return y.index=_,t?(_=y.alternate,_!==null?(_=_.index,_<m?(y.flags|=2,m):_):(y.flags|=2,m)):(y.flags|=1048576,m)}function o(y){return t&&y.alternate===null&&(y.flags|=2),y}function a(y,m,_,T){return m===null||m.tag!==6?(m=Bc(_,y.mode,T),m.return=y,m):(m=r(m,_),m.return=y,m)}function l(y,m,_,T){var P=_.type;return P===Xi?u(y,m,_.props.children,T,_.key):m!==null&&(m.elementType===P||typeof P=="object"&&P!==null&&P.$$typeof===Nn&&Fg(P)===m.type)?(T=r(m,_.props),T.ref=Qr(y,m,_),T.return=y,T):(T=ba(_.type,_.key,_.props,null,y.mode,T),T.ref=Qr(y,m,_),T.return=y,T)}function c(y,m,_,T){return m===null||m.tag!==4||m.stateNode.containerInfo!==_.containerInfo||m.stateNode.implementation!==_.implementation?(m=Vc(_,y.mode,T),m.return=y,m):(m=r(m,_.children||[]),m.return=y,m)}function u(y,m,_,T,P){return m===null||m.tag!==7?(m=_i(_,y.mode,T,P),m.return=y,m):(m=r(m,_),m.return=y,m)}function f(y,m,_){if(typeof m=="string"&&m!==""||typeof m=="number")return m=Bc(""+m,y.mode,_),m.return=y,m;if(typeof m=="object"&&m!==null){switch(m.$$typeof){case ko:return _=ba(m.type,m.key,m.props,null,y.mode,_),_.ref=Qr(y,null,m),_.return=y,_;case Hi:return m=Vc(m,y.mode,_),m.return=y,m;case Nn:var T=m._init;return f(y,T(m._payload),_)}if(us(m)||Yr(m))return m=_i(m,y.mode,_,null),m.return=y,m;Ho(y,m)}return null}function h(y,m,_,T){var P=m!==null?m.key:null;if(typeof _=="string"&&_!==""||typeof _=="number")return P!==null?null:a(y,m,""+_,T);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case ko:return _.key===P?l(y,m,_,T):null;case Hi:return _.key===P?c(y,m,_,T):null;case Nn:return P=_._init,h(y,m,P(_._payload),T)}if(us(_)||Yr(_))return P!==null?null:u(y,m,_,T,null);Ho(y,_)}return null}function g(y,m,_,T,P){if(typeof T=="string"&&T!==""||typeof T=="number")return y=y.get(_)||null,a(m,y,""+T,P);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case ko:return y=y.get(T.key===null?_:T.key)||null,l(m,y,T,P);case Hi:return y=y.get(T.key===null?_:T.key)||null,c(m,y,T,P);case Nn:var A=T._init;return g(y,m,_,A(T._payload),P)}if(us(T)||Yr(T))return y=y.get(_)||null,u(m,y,T,P,null);Ho(m,T)}return null}function p(y,m,_,T){for(var P=null,A=null,C=m,M=m=0,R=null;C!==null&&M<_.length;M++){C.index>M?(R=C,C=null):R=C.sibling;var O=h(y,C,_[M],T);if(O===null){C===null&&(C=R);break}t&&C&&O.alternate===null&&e(y,C),m=s(O,m,M),A===null?P=O:A.sibling=O,A=O,C=R}if(M===_.length)return n(y,C),oe&&fi(y,M),P;if(C===null){for(;M<_.length;M++)C=f(y,_[M],T),C!==null&&(m=s(C,m,M),A===null?P=C:A.sibling=C,A=C);return oe&&fi(y,M),P}for(C=i(y,C);M<_.length;M++)R=g(C,y,M,_[M],T),R!==null&&(t&&R.alternate!==null&&C.delete(R.key===null?M:R.key),m=s(R,m,M),A===null?P=R:A.sibling=R,A=R);return t&&C.forEach(function(z){return e(y,z)}),oe&&fi(y,M),P}function w(y,m,_,T){var P=Yr(_);if(typeof P!="function")throw Error(I(150));if(_=P.call(_),_==null)throw Error(I(151));for(var A=P=null,C=m,M=m=0,R=null,O=_.next();C!==null&&!O.done;M++,O=_.next()){C.index>M?(R=C,C=null):R=C.sibling;var z=h(y,C,O.value,T);if(z===null){C===null&&(C=R);break}t&&C&&z.alternate===null&&e(y,C),m=s(z,m,M),A===null?P=z:A.sibling=z,A=z,C=R}if(O.done)return n(y,C),oe&&fi(y,M),P;if(C===null){for(;!O.done;M++,O=_.next())O=f(y,O.value,T),O!==null&&(m=s(O,m,M),A===null?P=O:A.sibling=O,A=O);return oe&&fi(y,M),P}for(C=i(y,C);!O.done;M++,O=_.next())O=g(C,y,M,O.value,T),O!==null&&(t&&O.alternate!==null&&C.delete(O.key===null?M:O.key),m=s(O,m,M),A===null?P=O:A.sibling=O,A=O);return t&&C.forEach(function(j){return e(y,j)}),oe&&fi(y,M),P}function x(y,m,_,T){if(typeof _=="object"&&_!==null&&_.type===Xi&&_.key===null&&(_=_.props.children),typeof _=="object"&&_!==null){switch(_.$$typeof){case ko:e:{for(var P=_.key,A=m;A!==null;){if(A.key===P){if(P=_.type,P===Xi){if(A.tag===7){n(y,A.sibling),m=r(A,_.props.children),m.return=y,y=m;break e}}else if(A.elementType===P||typeof P=="object"&&P!==null&&P.$$typeof===Nn&&Fg(P)===A.type){n(y,A.sibling),m=r(A,_.props),m.ref=Qr(y,A,_),m.return=y,y=m;break e}n(y,A);break}else e(y,A);A=A.sibling}_.type===Xi?(m=_i(_.props.children,y.mode,T,_.key),m.return=y,y=m):(T=ba(_.type,_.key,_.props,null,y.mode,T),T.ref=Qr(y,m,_),T.return=y,y=T)}return o(y);case Hi:e:{for(A=_.key;m!==null;){if(m.key===A)if(m.tag===4&&m.stateNode.containerInfo===_.containerInfo&&m.stateNode.implementation===_.implementation){n(y,m.sibling),m=r(m,_.children||[]),m.return=y,y=m;break e}else{n(y,m);break}else e(y,m);m=m.sibling}m=Vc(_,y.mode,T),m.return=y,y=m}return o(y);case Nn:return A=_._init,x(y,m,A(_._payload),T)}if(us(_))return p(y,m,_,T);if(Yr(_))return w(y,m,_,T);Ho(y,_)}return typeof _=="string"&&_!==""||typeof _=="number"?(_=""+_,m!==null&&m.tag===6?(n(y,m.sibling),m=r(m,_),m.return=y,y=m):(n(y,m),m=Bc(_,y.mode,T),m.return=y,y=m),o(y)):n(y,m)}return x}var _r=kv(!0),Nv=kv(!1),lo={},Jt=ni(lo),js=ni(lo),Gs=ni(lo);function mi(t){if(t===lo)throw Error(I(174));return t}function Sh(t,e){switch(te(Gs,e),te(js,t),te(Jt,lo),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:ku(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=ku(e,t)}re(Jt),te(Jt,e)}function wr(){re(Jt),re(js),re(Gs)}function Fv(t){mi(Gs.current);var e=mi(Jt.current),n=ku(e,t.type);e!==n&&(te(js,t),te(Jt,n))}function Ph(t){js.current===t&&(re(Jt),re(js))}var le=ni(0);function nl(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if((e.flags&128)!==0)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var kc=[];function bh(){for(var t=0;t<kc.length;t++)kc[t]._workInProgressVersionPrimary=null;kc.length=0}var Ea=Sn.ReactCurrentDispatcher,Nc=Sn.ReactCurrentBatchConfig,Si=0,ue=null,Ee=null,Se=null,il=!1,Es=!1,Ws=0,px=0;function Re(){throw Error(I(321))}function Ah(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Bt(t[n],e[n]))return!1;return!0}function Ch(t,e,n,i,r,s){if(Si=s,ue=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Ea.current=t===null||t.memoizedState===null?_x:wx,t=n(i,r),Es){s=0;do{if(Es=!1,Ws=0,25<=s)throw Error(I(301));s+=1,Se=Ee=null,e.updateQueue=null,Ea.current=Ex,t=n(i,r)}while(Es)}if(Ea.current=rl,e=Ee!==null&&Ee.next!==null,Si=0,Se=Ee=ue=null,il=!1,e)throw Error(I(300));return t}function Lh(){var t=Ws!==0;return Ws=0,t}function $t(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Se===null?ue.memoizedState=Se=t:Se=Se.next=t,Se}function St(){if(Ee===null){var t=ue.alternate;t=t!==null?t.memoizedState:null}else t=Ee.next;var e=Se===null?ue.memoizedState:Se.next;if(e!==null)Se=e,Ee=t;else{if(t===null)throw Error(I(310));Ee=t,t={memoizedState:Ee.memoizedState,baseState:Ee.baseState,baseQueue:Ee.baseQueue,queue:Ee.queue,next:null},Se===null?ue.memoizedState=Se=t:Se=Se.next=t}return Se}function Hs(t,e){return typeof e=="function"?e(t):e}function Fc(t){var e=St(),n=e.queue;if(n===null)throw Error(I(311));n.lastRenderedReducer=t;var i=Ee,r=i.baseQueue,s=n.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}i.baseQueue=r=s,n.pending=null}if(r!==null){s=r.next,i=i.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((Si&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:t(i,c.action);else{var f={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=f,o=i):l=l.next=f,ue.lanes|=u,Pi|=u}c=c.next}while(c!==null&&c!==s);l===null?o=i:l.next=a,Bt(i,e.memoizedState)||(Ke=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=l,n.lastRenderedState=i}if(t=n.interleaved,t!==null){r=t;do s=r.lane,ue.lanes|=s,Pi|=s,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Dc(t){var e=St(),n=e.queue;if(n===null)throw Error(I(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,s=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do s=t(s,o.action),o=o.next;while(o!==r);Bt(s,e.memoizedState)||(Ke=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,i]}function Dv(){}function zv(t,e){var n=ue,i=St(),r=e(),s=!Bt(i.memoizedState,r);if(s&&(i.memoizedState=r,Ke=!0),i=i.queue,Mh(Vv.bind(null,n,i,t),[t]),i.getSnapshot!==e||s||Se!==null&&Se.memoizedState.tag&1){if(n.flags|=2048,Xs(9,Bv.bind(null,n,i,r,e),void 0,null),be===null)throw Error(I(349));(Si&30)!==0||Uv(n,e,r)}return r}function Uv(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=ue.updateQueue,e===null?(e={lastEffect:null,stores:null},ue.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function Bv(t,e,n,i){e.value=n,e.getSnapshot=i,jv(e)&&Gv(t)}function Vv(t,e,n){return n(function(){jv(e)&&Gv(t)})}function jv(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Bt(t,n)}catch{return!0}}function Gv(t){var e=_n(t,1);e!==null&&zt(e,t,1,-1)}function Dg(t){var e=$t();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Hs,lastRenderedState:t},e.queue=t,t=t.dispatch=yx.bind(null,ue,t),[e.memoizedState,t]}function Xs(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=ue.updateQueue,e===null?(e={lastEffect:null,stores:null},ue.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function Wv(){return St().memoizedState}function xa(t,e,n,i){var r=$t();ue.flags|=t,r.memoizedState=Xs(1|e,n,void 0,i===void 0?null:i)}function Fl(t,e,n,i){var r=St();i=i===void 0?null:i;var s=void 0;if(Ee!==null){var o=Ee.memoizedState;if(s=o.destroy,i!==null&&Ah(i,o.deps)){r.memoizedState=Xs(e,n,s,i);return}}ue.flags|=t,r.memoizedState=Xs(1|e,n,s,i)}function zg(t,e){return xa(8390656,8,t,e)}function Mh(t,e){return Fl(2048,8,t,e)}function Hv(t,e){return Fl(4,2,t,e)}function Xv(t,e){return Fl(4,4,t,e)}function Yv(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Zv(t,e,n){return n=n!=null?n.concat([t]):null,Fl(4,4,Yv.bind(null,e,t),n)}function Ih(){}function $v(t,e){var n=St();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Ah(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function Kv(t,e){var n=St();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&Ah(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function qv(t,e,n){return(Si&21)===0?(t.baseState&&(t.baseState=!1,Ke=!0),t.memoizedState=n):(Bt(n,e)||(n=ev(),ue.lanes|=n,Pi|=n,t.baseState=!0),e)}function mx(t,e){var n=q;q=n!==0&&4>n?n:4,t(!0);var i=Nc.transition;Nc.transition={};try{t(!1),e()}finally{q=n,Nc.transition=i}}function Qv(){return St().memoizedState}function vx(t,e,n){var i=$n(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},Jv(t))ey(e,n);else if(n=Mv(t,e,n,i),n!==null){var r=Ge();zt(n,t,i,r),ty(n,e,i)}}function yx(t,e,n){var i=$n(t),r={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(Jv(t))ey(e,r);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(r.hasEagerState=!0,r.eagerState=a,Bt(a,o)){var l=e.interleaved;l===null?(r.next=r,xh(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}n=Mv(t,e,r,i),n!==null&&(r=Ge(),zt(n,t,i,r),ty(n,e,i))}}function Jv(t){var e=t.alternate;return t===ue||e!==null&&e===ue}function ey(t,e){Es=il=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function ty(t,e,n){if((n&4194240)!==0){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,lh(t,n)}}var rl={readContext:Tt,useCallback:Re,useContext:Re,useEffect:Re,useImperativeHandle:Re,useInsertionEffect:Re,useLayoutEffect:Re,useMemo:Re,useReducer:Re,useRef:Re,useState:Re,useDebugValue:Re,useDeferredValue:Re,useTransition:Re,useMutableSource:Re,useSyncExternalStore:Re,useId:Re,unstable_isNewReconciler:!1},_x={readContext:Tt,useCallback:function(t,e){return $t().memoizedState=[t,e===void 0?null:e],t},useContext:Tt,useEffect:zg,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,xa(4194308,4,Yv.bind(null,e,t),n)},useLayoutEffect:function(t,e){return xa(4194308,4,t,e)},useInsertionEffect:function(t,e){return xa(4,2,t,e)},useMemo:function(t,e){var n=$t();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=$t();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=vx.bind(null,ue,t),[i.memoizedState,t]},useRef:function(t){var e=$t();return t={current:t},e.memoizedState=t},useState:Dg,useDebugValue:Ih,useDeferredValue:function(t){return $t().memoizedState=t},useTransition:function(){var t=Dg(!1),e=t[0];return t=mx.bind(null,t[1]),$t().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=ue,r=$t();if(oe){if(n===void 0)throw Error(I(407));n=n()}else{if(n=e(),be===null)throw Error(I(349));(Si&30)!==0||Uv(i,e,n)}r.memoizedState=n;var s={value:n,getSnapshot:e};return r.queue=s,zg(Vv.bind(null,i,s,t),[t]),i.flags|=2048,Xs(9,Bv.bind(null,i,s,n,e),void 0,null),n},useId:function(){var t=$t(),e=be.identifierPrefix;if(oe){var n=gn,i=dn;n=(i&~(1<<32-Dt(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=Ws++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=px++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},wx={readContext:Tt,useCallback:$v,useContext:Tt,useEffect:Mh,useImperativeHandle:Zv,useInsertionEffect:Hv,useLayoutEffect:Xv,useMemo:Kv,useReducer:Fc,useRef:Wv,useState:function(){return Fc(Hs)},useDebugValue:Ih,useDeferredValue:function(t){var e=St();return qv(e,Ee.memoizedState,t)},useTransition:function(){var t=Fc(Hs)[0],e=St().memoizedState;return[t,e]},useMutableSource:Dv,useSyncExternalStore:zv,useId:Qv,unstable_isNewReconciler:!1},Ex={readContext:Tt,useCallback:$v,useContext:Tt,useEffect:Mh,useImperativeHandle:Zv,useInsertionEffect:Hv,useLayoutEffect:Xv,useMemo:Kv,useReducer:Dc,useRef:Wv,useState:function(){return Dc(Hs)},useDebugValue:Ih,useDeferredValue:function(t){var e=St();return Ee===null?e.memoizedState=t:qv(e,Ee.memoizedState,t)},useTransition:function(){var t=Dc(Hs)[0],e=St().memoizedState;return[t,e]},useMutableSource:Dv,useSyncExternalStore:zv,useId:Qv,unstable_isNewReconciler:!1};function Er(t,e){try{var n="",i=e;do n+=$w(i),i=i.return;while(i);var r=n}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:r,digest:null}}function zc(t,e,n){return{value:t,source:null,stack:n!=null?n:null,digest:e!=null?e:null}}function rf(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var xx=typeof WeakMap=="function"?WeakMap:Map;function ny(t,e,n){n=pn(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){ol||(ol=!0,gf=i),rf(t,e)},n}function iy(t,e,n){n=pn(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;n.payload=function(){return i(r)},n.callback=function(){rf(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){rf(t,e),typeof i!="function"&&(Zn===null?Zn=new Set([this]):Zn.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function Ug(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new xx;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(n)||(r.add(n),t=Fx.bind(null,t,e,n),e.then(t,t))}function Bg(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Vg(t,e,n,i,r){return(t.mode&1)===0?(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=pn(-1,1),e.tag=2,Yn(n,e,1))),n.lanes|=1),t):(t.flags|=65536,t.lanes=r,t)}var Tx=Sn.ReactCurrentOwner,Ke=!1;function Ve(t,e,n,i){e.child=t===null?Nv(e,null,n,i):_r(e,t.child,n,i)}function jg(t,e,n,i,r){n=n.render;var s=e.ref;return fr(e,r),i=Ch(t,e,n,i,s,r),n=Lh(),t!==null&&!Ke?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,wn(t,e,r)):(oe&&n&&mh(e),e.flags|=1,Ve(t,e,i,r),e.child)}function Gg(t,e,n,i,r){if(t===null){var s=n.type;return typeof s=="function"&&!Uh(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,ry(t,e,s,i,r)):(t=ba(n.type,null,i,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,(t.lanes&r)===0){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:zs,n(o,i)&&t.ref===e.ref)return wn(t,e,r)}return e.flags|=1,t=Kn(s,i),t.ref=e.ref,t.return=e,e.child=t}function ry(t,e,n,i,r){if(t!==null){var s=t.memoizedProps;if(zs(s,i)&&t.ref===e.ref)if(Ke=!1,e.pendingProps=i=s,(t.lanes&r)!==0)(t.flags&131072)!==0&&(Ke=!0);else return e.lanes=t.lanes,wn(t,e,r)}return sf(t,e,n,i,r)}function sy(t,e,n){var i=e.pendingProps,r=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if((e.mode&1)===0)e.memoizedState={baseLanes:0,cachePool:null,transitions:null},te(nr,rt),rt|=n;else{if((n&1073741824)===0)return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,te(nr,rt),rt|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:n,te(nr,rt),rt|=i}else s!==null?(i=s.baseLanes|n,e.memoizedState=null):i=n,te(nr,rt),rt|=i;return Ve(t,e,r,n),e.child}function oy(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function sf(t,e,n,i,r){var s=Je(n)?xi:ze.current;return s=vr(e,s),fr(e,r),n=Ch(t,e,n,i,s,r),i=Lh(),t!==null&&!Ke?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,wn(t,e,r)):(oe&&i&&mh(e),e.flags|=1,Ve(t,e,n,r),e.child)}function Wg(t,e,n,i,r){if(Je(n)){var s=!0;Ka(e)}else s=!1;if(fr(e,r),e.stateNode===null)Ta(t,e),Ov(e,n,i),nf(e,n,i,r),i=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=n.contextType;typeof c=="object"&&c!==null?c=Tt(c):(c=Je(n)?xi:ze.current,c=vr(e,c));var u=n.getDerivedStateFromProps,f=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||l!==c)&&Ng(e,o,i,c),Fn=!1;var h=e.memoizedState;o.state=h,tl(e,i,o,r),l=e.memoizedState,a!==i||h!==l||Qe.current||Fn?(typeof u=="function"&&(tf(e,n,u,i),l=e.memoizedState),(a=Fn||kg(e,n,a,i,h,l,c))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),o.props=i,o.state=l,o.context=c,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,Iv(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:Mt(e.type,a),o.props=c,f=e.pendingProps,h=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=Tt(l):(l=Je(n)?xi:ze.current,l=vr(e,l));var g=n.getDerivedStateFromProps;(u=typeof g=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||h!==l)&&Ng(e,o,i,l),Fn=!1,h=e.memoizedState,o.state=h,tl(e,i,o,r);var p=e.memoizedState;a!==f||h!==p||Qe.current||Fn?(typeof g=="function"&&(tf(e,n,g,i),p=e.memoizedState),(c=Fn||kg(e,n,c,i,h,p,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,p,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,p,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=p),o.props=i,o.state=p,o.context=l,i=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),i=!1)}return of(t,e,n,i,s,r)}function of(t,e,n,i,r,s){oy(t,e);var o=(e.flags&128)!==0;if(!i&&!o)return r&&Lg(e,n,!1),wn(t,e,s);i=e.stateNode,Tx.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=_r(e,t.child,null,s),e.child=_r(e,null,a,s)):Ve(t,e,a,s),e.memoizedState=i.state,r&&Lg(e,n,!0),e.child}function ay(t){var e=t.stateNode;e.pendingContext?Cg(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Cg(t,e.context,!1),Sh(t,e.containerInfo)}function Hg(t,e,n,i,r){return yr(),yh(r),e.flags|=256,Ve(t,e,n,i),e.child}var af={dehydrated:null,treeContext:null,retryLane:0};function lf(t){return{baseLanes:t,cachePool:null,transitions:null}}function ly(t,e,n){var i=e.pendingProps,r=le.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),te(le,r&1),t===null)return Ju(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?((e.mode&1)===0?e.lanes=1:t.data==="$!"?e.lanes=8:e.lanes=1073741824,null):(o=i.children,t=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},(i&1)===0&&s!==null?(s.childLanes=0,s.pendingProps=o):s=Ul(o,i,0,null),t=_i(t,i,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=lf(n),e.memoizedState=af,t):Rh(e,o));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return Sx(t,e,o,i,a,r,n);if(s){s=i.fallback,o=e.mode,r=t.child,a=r.sibling;var l={mode:"hidden",children:i.children};return(o&1)===0&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=Kn(r,l),i.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=Kn(a,s):(s=_i(s,o,n,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=t.child.memoizedState,o=o===null?lf(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=af,i}return s=t.child,t=s.sibling,i=Kn(s,{mode:"visible",children:i.children}),(e.mode&1)===0&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function Rh(t,e){return e=Ul({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Xo(t,e,n,i){return i!==null&&yh(i),_r(e,t.child,null,n),t=Rh(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function Sx(t,e,n,i,r,s,o){if(n)return e.flags&256?(e.flags&=-257,i=zc(Error(I(422))),Xo(t,e,o,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=Ul({mode:"visible",children:i.children},r,0,null),s=_i(s,r,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,(e.mode&1)!==0&&_r(e,t.child,null,o),e.child.memoizedState=lf(o),e.memoizedState=af,s);if((e.mode&1)===0)return Xo(t,e,o,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(I(419)),i=zc(s,i,void 0),Xo(t,e,o,i)}if(a=(o&t.childLanes)!==0,Ke||a){if(i=be,i!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=(r&(i.suspendedLanes|o))!==0?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,_n(t,r),zt(i,t,r,-1))}return zh(),i=zc(Error(I(421))),Xo(t,e,o,i)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=Dx.bind(null,t),r._reactRetry=e,null):(t=s.treeContext,at=Xn(r.nextSibling),lt=e,oe=!0,Ot=null,t!==null&&(yt[_t++]=dn,yt[_t++]=gn,yt[_t++]=Ti,dn=t.id,gn=t.overflow,Ti=e),e=Rh(e,i.children),e.flags|=4096,e)}function Xg(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),ef(t.return,e,n)}function Uc(t,e,n,i,r){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=r)}function cy(t,e,n){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(Ve(t,e,i.children,n),i=le.current,(i&2)!==0)i=i&1|2,e.flags|=128;else{if(t!==null&&(t.flags&128)!==0)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Xg(t,n,e);else if(t.tag===19)Xg(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(te(le,i),(e.mode&1)===0)e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&nl(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),Uc(e,!1,r,n,s);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&nl(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}Uc(e,!0,n,null,s);break;case"together":Uc(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Ta(t,e){(e.mode&1)===0&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function wn(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Pi|=e.lanes,(n&e.childLanes)===0)return null;if(t!==null&&e.child!==t.child)throw Error(I(153));if(e.child!==null){for(t=e.child,n=Kn(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Kn(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function Px(t,e,n){switch(e.tag){case 3:ay(e),yr();break;case 5:Fv(e);break;case 1:Je(e.type)&&Ka(e);break;case 4:Sh(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;te(Ja,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(te(le,le.current&1),e.flags|=128,null):(n&e.child.childLanes)!==0?ly(t,e,n):(te(le,le.current&1),t=wn(t,e,n),t!==null?t.sibling:null);te(le,le.current&1);break;case 19:if(i=(n&e.childLanes)!==0,(t.flags&128)!==0){if(i)return cy(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),te(le,le.current),i)break;return null;case 22:case 23:return e.lanes=0,sy(t,e,n)}return wn(t,e,n)}var uy,cf,fy,hy;uy=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};cf=function(){};fy=function(t,e,n,i){var r=t.memoizedProps;if(r!==i){t=e.stateNode,mi(Jt.current);var s=null;switch(n){case"input":r=Mu(t,r),i=Mu(t,i),s=[];break;case"select":r=fe({},r,{value:void 0}),i=fe({},i,{value:void 0}),s=[];break;case"textarea":r=Ou(t,r),i=Ou(t,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=Za)}Nu(n,i);var o;n=null;for(c in r)if(!i.hasOwnProperty(c)&&r.hasOwnProperty(c)&&r[c]!=null)if(c==="style"){var a=r[c];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Is.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in i){var l=i[c];if(a=r!=null?r[c]:void 0,i.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(s||(s=[]),s.push(c,n)),n=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Is.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&ie("scroll",t),s||a===l||(s=[])):(s=s||[]).push(c,l))}n&&(s=s||[]).push("style",n);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};hy=function(t,e,n,i){n!==i&&(e.flags|=4)};function Jr(t,e){if(!oe)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function Oe(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function bx(t,e,n){var i=e.pendingProps;switch(vh(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Oe(e),null;case 1:return Je(e.type)&&$a(),Oe(e),null;case 3:return i=e.stateNode,wr(),re(Qe),re(ze),bh(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(Wo(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&(e.flags&256)===0||(e.flags|=1024,Ot!==null&&(vf(Ot),Ot=null))),cf(t,e),Oe(e),null;case 5:Ph(e);var r=mi(Gs.current);if(n=e.type,t!==null&&e.stateNode!=null)fy(t,e,n,i,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(I(166));return Oe(e),null}if(t=mi(Jt.current),Wo(e)){i=e.stateNode,n=e.type;var s=e.memoizedProps;switch(i[Kt]=e,i[Vs]=s,t=(e.mode&1)!==0,n){case"dialog":ie("cancel",i),ie("close",i);break;case"iframe":case"object":case"embed":ie("load",i);break;case"video":case"audio":for(r=0;r<hs.length;r++)ie(hs[r],i);break;case"source":ie("error",i);break;case"img":case"image":case"link":ie("error",i),ie("load",i);break;case"details":ie("toggle",i);break;case"input":tg(i,s),ie("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},ie("invalid",i);break;case"textarea":ig(i,s),ie("invalid",i)}Nu(n,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&Go(i.textContent,a,t),r=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Go(i.textContent,a,t),r=["children",""+a]):Is.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&ie("scroll",i)}switch(n){case"input":No(i),ng(i,s,!0);break;case"textarea":No(i),rg(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=Za)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=U0(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(n,{is:i.is}):(t=o.createElement(n),n==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,n),t[Kt]=e,t[Vs]=i,uy(t,e,!1,!1),e.stateNode=t;e:{switch(o=Fu(n,i),n){case"dialog":ie("cancel",t),ie("close",t),r=i;break;case"iframe":case"object":case"embed":ie("load",t),r=i;break;case"video":case"audio":for(r=0;r<hs.length;r++)ie(hs[r],t);r=i;break;case"source":ie("error",t),r=i;break;case"img":case"image":case"link":ie("error",t),ie("load",t),r=i;break;case"details":ie("toggle",t),r=i;break;case"input":tg(t,i),r=Mu(t,i),ie("invalid",t);break;case"option":r=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},r=fe({},i,{value:void 0}),ie("invalid",t);break;case"textarea":ig(t,i),r=Ou(t,i),ie("invalid",t);break;default:r=i}Nu(n,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?j0(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&B0(t,l)):s==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&Rs(t,l):typeof l=="number"&&Rs(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Is.hasOwnProperty(s)?l!=null&&s==="onScroll"&&ie("scroll",t):l!=null&&nh(t,s,l,o))}switch(n){case"input":No(t),ng(t,i,!1);break;case"textarea":No(t),rg(t);break;case"option":i.value!=null&&t.setAttribute("value",""+Qn(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?ar(t,!!i.multiple,s,!1):i.defaultValue!=null&&ar(t,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=Za)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Oe(e),null;case 6:if(t&&e.stateNode!=null)hy(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(I(166));if(n=mi(Gs.current),mi(Jt.current),Wo(e)){if(i=e.stateNode,n=e.memoizedProps,i[Kt]=e,(s=i.nodeValue!==n)&&(t=lt,t!==null))switch(t.tag){case 3:Go(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Go(i.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[Kt]=e,e.stateNode=i}return Oe(e),null;case 13:if(re(le),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(oe&&at!==null&&(e.mode&1)!==0&&(e.flags&128)===0)Lv(),yr(),e.flags|=98560,s=!1;else if(s=Wo(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(I(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(I(317));s[Kt]=e}else yr(),(e.flags&128)===0&&(e.memoizedState=null),e.flags|=4;Oe(e),s=!1}else Ot!==null&&(vf(Ot),Ot=null),s=!0;if(!s)return e.flags&65536?e:null}return(e.flags&128)!==0?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,(e.mode&1)!==0&&(t===null||(le.current&1)!==0?xe===0&&(xe=3):zh())),e.updateQueue!==null&&(e.flags|=4),Oe(e),null);case 4:return wr(),cf(t,e),t===null&&Us(e.stateNode.containerInfo),Oe(e),null;case 10:return Eh(e.type._context),Oe(e),null;case 17:return Je(e.type)&&$a(),Oe(e),null;case 19:if(re(le),s=e.memoizedState,s===null)return Oe(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)Jr(s,!1);else{if(xe!==0||t!==null&&(t.flags&128)!==0)for(t=e.child;t!==null;){if(o=nl(t),o!==null){for(e.flags|=128,Jr(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)s=n,t=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return te(le,le.current&1|2),e.child}t=t.sibling}s.tail!==null&&ge()>xr&&(e.flags|=128,i=!0,Jr(s,!1),e.lanes=4194304)}else{if(!i)if(t=nl(o),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Jr(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!oe)return Oe(e),null}else 2*ge()-s.renderingStartTime>xr&&n!==1073741824&&(e.flags|=128,i=!0,Jr(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=ge(),e.sibling=null,n=le.current,te(le,i?n&1|2:n&1),e):(Oe(e),null);case 22:case 23:return Dh(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&(e.mode&1)!==0?(rt&1073741824)!==0&&(Oe(e),e.subtreeFlags&6&&(e.flags|=8192)):Oe(e),null;case 24:return null;case 25:return null}throw Error(I(156,e.tag))}function Ax(t,e){switch(vh(e),e.tag){case 1:return Je(e.type)&&$a(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return wr(),re(Qe),re(ze),bh(),t=e.flags,(t&65536)!==0&&(t&128)===0?(e.flags=t&-65537|128,e):null;case 5:return Ph(e),null;case 13:if(re(le),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(I(340));yr()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return re(le),null;case 4:return wr(),null;case 10:return Eh(e.type._context),null;case 22:case 23:return Dh(),null;case 24:return null;default:return null}}var Yo=!1,Fe=!1,Cx=typeof WeakSet=="function"?WeakSet:Set,D=null;function tr(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){de(t,e,i)}else n.current=null}function uf(t,e,n){try{n()}catch(i){de(t,e,i)}}var Yg=!1;function Lx(t,e){if(Xu=Ha,t=mv(),ph(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,c=0,u=0,f=t,h=null;t:for(;;){for(var g;f!==n||r!==0&&f.nodeType!==3||(a=o+r),f!==s||i!==0&&f.nodeType!==3||(l=o+i),f.nodeType===3&&(o+=f.nodeValue.length),(g=f.firstChild)!==null;)h=f,f=g;for(;;){if(f===t)break t;if(h===n&&++c===r&&(a=o),h===s&&++u===i&&(l=o),(g=f.nextSibling)!==null)break;f=h,h=f.parentNode}f=g}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(Yu={focusedElem:t,selectionRange:n},Ha=!1,D=e;D!==null;)if(e=D,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,D=t;else for(;D!==null;){e=D;try{var p=e.alternate;if((e.flags&1024)!==0)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var w=p.memoizedProps,x=p.memoizedState,y=e.stateNode,m=y.getSnapshotBeforeUpdate(e.elementType===e.type?w:Mt(e.type,w),x);y.__reactInternalSnapshotBeforeUpdate=m}break;case 3:var _=e.stateNode.containerInfo;_.nodeType===1?_.textContent="":_.nodeType===9&&_.documentElement&&_.removeChild(_.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(I(163))}}catch(T){de(e,e.return,T)}if(t=e.sibling,t!==null){t.return=e.return,D=t;break}D=e.return}return p=Yg,Yg=!1,p}function xs(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&t)===t){var s=r.destroy;r.destroy=void 0,s!==void 0&&uf(e,n,s)}r=r.next}while(r!==i)}}function Dl(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function ff(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function dy(t){var e=t.alternate;e!==null&&(t.alternate=null,dy(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Kt],delete e[Vs],delete e[Ku],delete e[fx],delete e[hx])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function gy(t){return t.tag===5||t.tag===3||t.tag===4}function Zg(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||gy(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function hf(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Za));else if(i!==4&&(t=t.child,t!==null))for(hf(t,e,n),t=t.sibling;t!==null;)hf(t,e,n),t=t.sibling}function df(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(df(t,e,n),t=t.sibling;t!==null;)df(t,e,n),t=t.sibling}var Le=null,Rt=!1;function Ln(t,e,n){for(n=n.child;n!==null;)py(t,e,n),n=n.sibling}function py(t,e,n){if(Qt&&typeof Qt.onCommitFiberUnmount=="function")try{Qt.onCommitFiberUnmount(Ll,n)}catch{}switch(n.tag){case 5:Fe||tr(n,e);case 6:var i=Le,r=Rt;Le=null,Ln(t,e,n),Le=i,Rt=r,Le!==null&&(Rt?(t=Le,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Le.removeChild(n.stateNode));break;case 18:Le!==null&&(Rt?(t=Le,n=n.stateNode,t.nodeType===8?Rc(t.parentNode,n):t.nodeType===1&&Rc(t,n),Fs(t)):Rc(Le,n.stateNode));break;case 4:i=Le,r=Rt,Le=n.stateNode.containerInfo,Rt=!0,Ln(t,e,n),Le=i,Rt=r;break;case 0:case 11:case 14:case 15:if(!Fe&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&((s&2)!==0||(s&4)!==0)&&uf(n,e,o),r=r.next}while(r!==i)}Ln(t,e,n);break;case 1:if(!Fe&&(tr(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){de(n,e,a)}Ln(t,e,n);break;case 21:Ln(t,e,n);break;case 22:n.mode&1?(Fe=(i=Fe)||n.memoizedState!==null,Ln(t,e,n),Fe=i):Ln(t,e,n);break;default:Ln(t,e,n)}}function $g(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new Cx),e.forEach(function(i){var r=zx.bind(null,t,i);n.has(i)||(n.add(i),i.then(r,r))})}}function Lt(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Le=a.stateNode,Rt=!1;break e;case 3:Le=a.stateNode.containerInfo,Rt=!0;break e;case 4:Le=a.stateNode.containerInfo,Rt=!0;break e}a=a.return}if(Le===null)throw Error(I(160));py(s,o,r),Le=null,Rt=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(c){de(r,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)my(e,t),e=e.sibling}function my(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Lt(e,t),Ht(t),i&4){try{xs(3,t,t.return),Dl(3,t)}catch(w){de(t,t.return,w)}try{xs(5,t,t.return)}catch(w){de(t,t.return,w)}}break;case 1:Lt(e,t),Ht(t),i&512&&n!==null&&tr(n,n.return);break;case 5:if(Lt(e,t),Ht(t),i&512&&n!==null&&tr(n,n.return),t.flags&32){var r=t.stateNode;try{Rs(r,"")}catch(w){de(t,t.return,w)}}if(i&4&&(r=t.stateNode,r!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&D0(r,s),Fu(a,o);var c=Fu(a,s);for(o=0;o<l.length;o+=2){var u=l[o],f=l[o+1];u==="style"?j0(r,f):u==="dangerouslySetInnerHTML"?B0(r,f):u==="children"?Rs(r,f):nh(r,u,f,c)}switch(a){case"input":Iu(r,s);break;case"textarea":z0(r,s);break;case"select":var h=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var g=s.value;g!=null?ar(r,!!s.multiple,g,!1):h!==!!s.multiple&&(s.defaultValue!=null?ar(r,!!s.multiple,s.defaultValue,!0):ar(r,!!s.multiple,s.multiple?[]:"",!1))}r[Vs]=s}catch(w){de(t,t.return,w)}}break;case 6:if(Lt(e,t),Ht(t),i&4){if(t.stateNode===null)throw Error(I(162));r=t.stateNode,s=t.memoizedProps;try{r.nodeValue=s}catch(w){de(t,t.return,w)}}break;case 3:if(Lt(e,t),Ht(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{Fs(e.containerInfo)}catch(w){de(t,t.return,w)}break;case 4:Lt(e,t),Ht(t);break;case 13:Lt(e,t),Ht(t),r=t.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(Nh=ge())),i&4&&$g(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(Fe=(c=Fe)||u,Lt(e,t),Fe=c):Lt(e,t),Ht(t),i&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!u&&(t.mode&1)!==0)for(D=t,u=t.child;u!==null;){for(f=D=u;D!==null;){switch(h=D,g=h.child,h.tag){case 0:case 11:case 14:case 15:xs(4,h,h.return);break;case 1:tr(h,h.return);var p=h.stateNode;if(typeof p.componentWillUnmount=="function"){i=h,n=h.return;try{e=i,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(w){de(i,n,w)}}break;case 5:tr(h,h.return);break;case 22:if(h.memoizedState!==null){qg(f);continue}}g!==null?(g.return=h,D=g):qg(f)}u=u.sibling}e:for(u=null,f=t;;){if(f.tag===5){if(u===null){u=f;try{r=f.stateNode,c?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=f.stateNode,l=f.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=V0("display",o))}catch(w){de(t,t.return,w)}}}else if(f.tag===6){if(u===null)try{f.stateNode.nodeValue=c?"":f.memoizedProps}catch(w){de(t,t.return,w)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===t)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===t)break e;for(;f.sibling===null;){if(f.return===null||f.return===t)break e;u===f&&(u=null),f=f.return}u===f&&(u=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:Lt(e,t),Ht(t),i&4&&$g(t);break;case 21:break;default:Lt(e,t),Ht(t)}}function Ht(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(gy(n)){var i=n;break e}n=n.return}throw Error(I(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(Rs(r,""),i.flags&=-33);var s=Zg(t);df(t,s,r);break;case 3:case 4:var o=i.stateNode.containerInfo,a=Zg(t);hf(t,a,o);break;default:throw Error(I(161))}}catch(l){de(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Mx(t,e,n){D=t,vy(t)}function vy(t,e,n){for(var i=(t.mode&1)!==0;D!==null;){var r=D,s=r.child;if(r.tag===22&&i){var o=r.memoizedState!==null||Yo;if(!o){var a=r.alternate,l=a!==null&&a.memoizedState!==null||Fe;a=Yo;var c=Fe;if(Yo=o,(Fe=l)&&!c)for(D=r;D!==null;)o=D,l=o.child,o.tag===22&&o.memoizedState!==null?Qg(r):l!==null?(l.return=o,D=l):Qg(r);for(;s!==null;)D=s,vy(s),s=s.sibling;D=r,Yo=a,Fe=c}Kg(t)}else(r.subtreeFlags&8772)!==0&&s!==null?(s.return=r,D=s):Kg(t)}}function Kg(t){for(;D!==null;){var e=D;if((e.flags&8772)!==0){var n=e.alternate;try{if((e.flags&8772)!==0)switch(e.tag){case 0:case 11:case 15:Fe||Dl(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!Fe)if(n===null)i.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:Mt(e.type,n.memoizedProps);i.componentDidUpdate(r,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Og(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Og(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var f=u.dehydrated;f!==null&&Fs(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(I(163))}Fe||e.flags&512&&ff(e)}catch(h){de(e,e.return,h)}}if(e===t){D=null;break}if(n=e.sibling,n!==null){n.return=e.return,D=n;break}D=e.return}}function qg(t){for(;D!==null;){var e=D;if(e===t){D=null;break}var n=e.sibling;if(n!==null){n.return=e.return,D=n;break}D=e.return}}function Qg(t){for(;D!==null;){var e=D;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Dl(4,e)}catch(l){de(e,n,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(l){de(e,r,l)}}var s=e.return;try{ff(e)}catch(l){de(e,s,l)}break;case 5:var o=e.return;try{ff(e)}catch(l){de(e,o,l)}}}catch(l){de(e,e.return,l)}if(e===t){D=null;break}var a=e.sibling;if(a!==null){a.return=e.return,D=a;break}D=e.return}}var Ix=Math.ceil,sl=Sn.ReactCurrentDispatcher,Oh=Sn.ReactCurrentOwner,Et=Sn.ReactCurrentBatchConfig,K=0,be=null,ye=null,Me=0,rt=0,nr=ni(0),xe=0,Ys=null,Pi=0,zl=0,kh=0,Ts=null,$e=null,Nh=0,xr=1/0,un=null,ol=!1,gf=null,Zn=null,Zo=!1,Bn=null,al=0,Ss=0,pf=null,Sa=-1,Pa=0;function Ge(){return(K&6)!==0?ge():Sa!==-1?Sa:Sa=ge()}function $n(t){return(t.mode&1)===0?1:(K&2)!==0&&Me!==0?Me&-Me:gx.transition!==null?(Pa===0&&(Pa=ev()),Pa):(t=q,t!==0||(t=window.event,t=t===void 0?16:av(t.type)),t)}function zt(t,e,n,i){if(50<Ss)throw Ss=0,pf=null,Error(I(185));so(t,n,i),((K&2)===0||t!==be)&&(t===be&&((K&2)===0&&(zl|=n),xe===4&&zn(t,Me)),et(t,i),n===1&&K===0&&(e.mode&1)===0&&(xr=ge()+500,kl&&ii()))}function et(t,e){var n=t.callbackNode;gE(t,e);var i=Wa(t,t===be?Me:0);if(i===0)n!==null&&ag(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&ag(n),e===1)t.tag===0?dx(Jg.bind(null,t)):bv(Jg.bind(null,t)),cx(function(){(K&6)===0&&ii()}),n=null;else{switch(tv(i)){case 1:n=ah;break;case 4:n=Q0;break;case 16:n=Ga;break;case 536870912:n=J0;break;default:n=Ga}n=Py(n,yy.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function yy(t,e){if(Sa=-1,Pa=0,(K&6)!==0)throw Error(I(327));var n=t.callbackNode;if(hr()&&t.callbackNode!==n)return null;var i=Wa(t,t===be?Me:0);if(i===0)return null;if((i&30)!==0||(i&t.expiredLanes)!==0||e)e=ll(t,i);else{e=i;var r=K;K|=2;var s=wy();(be!==t||Me!==e)&&(un=null,xr=ge()+500,yi(t,e));do try{kx();break}catch(a){_y(t,a)}while(1);wh(),sl.current=s,K=r,ye!==null?e=0:(be=null,Me=0,e=xe)}if(e!==0){if(e===2&&(r=Vu(t),r!==0&&(i=r,e=mf(t,r))),e===1)throw n=Ys,yi(t,0),zn(t,i),et(t,ge()),n;if(e===6)zn(t,i);else{if(r=t.current.alternate,(i&30)===0&&!Rx(r)&&(e=ll(t,i),e===2&&(s=Vu(t),s!==0&&(i=s,e=mf(t,s))),e===1))throw n=Ys,yi(t,0),zn(t,i),et(t,ge()),n;switch(t.finishedWork=r,t.finishedLanes=i,e){case 0:case 1:throw Error(I(345));case 2:hi(t,$e,un);break;case 3:if(zn(t,i),(i&130023424)===i&&(e=Nh+500-ge(),10<e)){if(Wa(t,0)!==0)break;if(r=t.suspendedLanes,(r&i)!==i){Ge(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=$u(hi.bind(null,t,$e,un),e);break}hi(t,$e,un);break;case 4:if(zn(t,i),(i&4194240)===i)break;for(e=t.eventTimes,r=-1;0<i;){var o=31-Dt(i);s=1<<o,o=e[o],o>r&&(r=o),i&=~s}if(i=r,i=ge()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Ix(i/1960))-i,10<i){t.timeoutHandle=$u(hi.bind(null,t,$e,un),i);break}hi(t,$e,un);break;case 5:hi(t,$e,un);break;default:throw Error(I(329))}}}return et(t,ge()),t.callbackNode===n?yy.bind(null,t):null}function mf(t,e){var n=Ts;return t.current.memoizedState.isDehydrated&&(yi(t,e).flags|=256),t=ll(t,e),t!==2&&(e=$e,$e=n,e!==null&&vf(e)),t}function vf(t){$e===null?$e=t:$e.push.apply($e,t)}function Rx(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!Bt(s(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function zn(t,e){for(e&=~kh,e&=~zl,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Dt(e),i=1<<n;t[n]=-1,e&=~i}}function Jg(t){if((K&6)!==0)throw Error(I(327));hr();var e=Wa(t,0);if((e&1)===0)return et(t,ge()),null;var n=ll(t,e);if(t.tag!==0&&n===2){var i=Vu(t);i!==0&&(e=i,n=mf(t,i))}if(n===1)throw n=Ys,yi(t,0),zn(t,e),et(t,ge()),n;if(n===6)throw Error(I(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,hi(t,$e,un),et(t,ge()),null}function Fh(t,e){var n=K;K|=1;try{return t(e)}finally{K=n,K===0&&(xr=ge()+500,kl&&ii())}}function bi(t){Bn!==null&&Bn.tag===0&&(K&6)===0&&hr();var e=K;K|=1;var n=Et.transition,i=q;try{if(Et.transition=null,q=1,t)return t()}finally{q=i,Et.transition=n,K=e,(K&6)===0&&ii()}}function Dh(){rt=nr.current,re(nr)}function yi(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,lx(n)),ye!==null)for(n=ye.return;n!==null;){var i=n;switch(vh(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&$a();break;case 3:wr(),re(Qe),re(ze),bh();break;case 5:Ph(i);break;case 4:wr();break;case 13:re(le);break;case 19:re(le);break;case 10:Eh(i.type._context);break;case 22:case 23:Dh()}n=n.return}if(be=t,ye=t=Kn(t.current,null),Me=rt=e,xe=0,Ys=null,kh=zl=Pi=0,$e=Ts=null,pi!==null){for(e=0;e<pi.length;e++)if(n=pi[e],i=n.interleaved,i!==null){n.interleaved=null;var r=i.next,s=n.pending;if(s!==null){var o=s.next;s.next=r,i.next=o}n.pending=i}pi=null}return t}function _y(t,e){do{var n=ye;try{if(wh(),Ea.current=rl,il){for(var i=ue.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}il=!1}if(Si=0,Se=Ee=ue=null,Es=!1,Ws=0,Oh.current=null,n===null||n.return===null){xe=1,Ys=e,ye=null;break}e:{var s=t,o=n.return,a=n,l=e;if(e=Me,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,f=u.tag;if((u.mode&1)===0&&(f===0||f===11||f===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var g=Bg(o);if(g!==null){g.flags&=-257,Vg(g,o,a,s,e),g.mode&1&&Ug(s,c,e),e=g,l=c;var p=e.updateQueue;if(p===null){var w=new Set;w.add(l),e.updateQueue=w}else p.add(l);break e}else{if((e&1)===0){Ug(s,c,e),zh();break e}l=Error(I(426))}}else if(oe&&a.mode&1){var x=Bg(o);if(x!==null){(x.flags&65536)===0&&(x.flags|=256),Vg(x,o,a,s,e),yh(Er(l,a));break e}}s=l=Er(l,a),xe!==4&&(xe=2),Ts===null?Ts=[s]:Ts.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var y=ny(s,l,e);Rg(s,y);break e;case 1:a=l;var m=s.type,_=s.stateNode;if((s.flags&128)===0&&(typeof m.getDerivedStateFromError=="function"||_!==null&&typeof _.componentDidCatch=="function"&&(Zn===null||!Zn.has(_)))){s.flags|=65536,e&=-e,s.lanes|=e;var T=iy(s,a,e);Rg(s,T);break e}}s=s.return}while(s!==null)}xy(n)}catch(P){e=P,ye===n&&n!==null&&(ye=n=n.return);continue}break}while(1)}function wy(){var t=sl.current;return sl.current=rl,t===null?rl:t}function zh(){(xe===0||xe===3||xe===2)&&(xe=4),be===null||(Pi&268435455)===0&&(zl&268435455)===0||zn(be,Me)}function ll(t,e){var n=K;K|=2;var i=wy();(be!==t||Me!==e)&&(un=null,yi(t,e));do try{Ox();break}catch(r){_y(t,r)}while(1);if(wh(),K=n,sl.current=i,ye!==null)throw Error(I(261));return be=null,Me=0,xe}function Ox(){for(;ye!==null;)Ey(ye)}function kx(){for(;ye!==null&&!sE();)Ey(ye)}function Ey(t){var e=Sy(t.alternate,t,rt);t.memoizedProps=t.pendingProps,e===null?xy(t):ye=e,Oh.current=null}function xy(t){var e=t;do{var n=e.alternate;if(t=e.return,(e.flags&32768)===0){if(n=bx(n,e,rt),n!==null){ye=n;return}}else{if(n=Ax(n,e),n!==null){n.flags&=32767,ye=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{xe=6,ye=null;return}}if(e=e.sibling,e!==null){ye=e;return}ye=e=t}while(e!==null);xe===0&&(xe=5)}function hi(t,e,n){var i=q,r=Et.transition;try{Et.transition=null,q=1,Nx(t,e,n,i)}finally{Et.transition=r,q=i}return null}function Nx(t,e,n,i){do hr();while(Bn!==null);if((K&6)!==0)throw Error(I(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(I(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(pE(t,s),t===be&&(ye=be=null,Me=0),(n.subtreeFlags&2064)===0&&(n.flags&2064)===0||Zo||(Zo=!0,Py(Ga,function(){return hr(),null})),s=(n.flags&15990)!==0,(n.subtreeFlags&15990)!==0||s){s=Et.transition,Et.transition=null;var o=q;q=1;var a=K;K|=4,Oh.current=null,Lx(t,n),my(n,t),tx(Yu),Ha=!!Xu,Yu=Xu=null,t.current=n,Mx(n),oE(),K=a,q=o,Et.transition=s}else t.current=n;if(Zo&&(Zo=!1,Bn=t,al=r),s=t.pendingLanes,s===0&&(Zn=null),cE(n.stateNode),et(t,ge()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],i(r.value,{componentStack:r.stack,digest:r.digest});if(ol)throw ol=!1,t=gf,gf=null,t;return(al&1)!==0&&t.tag!==0&&hr(),s=t.pendingLanes,(s&1)!==0?t===pf?Ss++:(Ss=0,pf=t):Ss=0,ii(),null}function hr(){if(Bn!==null){var t=tv(al),e=Et.transition,n=q;try{if(Et.transition=null,q=16>t?16:t,Bn===null)var i=!1;else{if(t=Bn,Bn=null,al=0,(K&6)!==0)throw Error(I(331));var r=K;for(K|=4,D=t.current;D!==null;){var s=D,o=s.child;if((D.flags&16)!==0){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(D=c;D!==null;){var u=D;switch(u.tag){case 0:case 11:case 15:xs(8,u,s)}var f=u.child;if(f!==null)f.return=u,D=f;else for(;D!==null;){u=D;var h=u.sibling,g=u.return;if(dy(u),u===c){D=null;break}if(h!==null){h.return=g,D=h;break}D=g}}}var p=s.alternate;if(p!==null){var w=p.child;if(w!==null){p.child=null;do{var x=w.sibling;w.sibling=null,w=x}while(w!==null)}}D=s}}if((s.subtreeFlags&2064)!==0&&o!==null)o.return=s,D=o;else e:for(;D!==null;){if(s=D,(s.flags&2048)!==0)switch(s.tag){case 0:case 11:case 15:xs(9,s,s.return)}var y=s.sibling;if(y!==null){y.return=s.return,D=y;break e}D=s.return}}var m=t.current;for(D=m;D!==null;){o=D;var _=o.child;if((o.subtreeFlags&2064)!==0&&_!==null)_.return=o,D=_;else e:for(o=m;D!==null;){if(a=D,(a.flags&2048)!==0)try{switch(a.tag){case 0:case 11:case 15:Dl(9,a)}}catch(P){de(a,a.return,P)}if(a===o){D=null;break e}var T=a.sibling;if(T!==null){T.return=a.return,D=T;break e}D=a.return}}if(K=r,ii(),Qt&&typeof Qt.onPostCommitFiberRoot=="function")try{Qt.onPostCommitFiberRoot(Ll,t)}catch{}i=!0}return i}finally{q=n,Et.transition=e}}return!1}function ep(t,e,n){e=Er(n,e),e=ny(t,e,1),t=Yn(t,e,1),e=Ge(),t!==null&&(so(t,1,e),et(t,e))}function de(t,e,n){if(t.tag===3)ep(t,t,n);else for(;e!==null;){if(e.tag===3){ep(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Zn===null||!Zn.has(i))){t=Er(n,t),t=iy(e,t,1),e=Yn(e,t,1),t=Ge(),e!==null&&(so(e,1,t),et(e,t));break}}e=e.return}}function Fx(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=Ge(),t.pingedLanes|=t.suspendedLanes&n,be===t&&(Me&n)===n&&(xe===4||xe===3&&(Me&130023424)===Me&&500>ge()-Nh?yi(t,0):kh|=n),et(t,e)}function Ty(t,e){e===0&&((t.mode&1)===0?e=1:(e=zo,zo<<=1,(zo&130023424)===0&&(zo=4194304)));var n=Ge();t=_n(t,e),t!==null&&(so(t,e,n),et(t,n))}function Dx(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Ty(t,n)}function zx(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(I(314))}i!==null&&i.delete(e),Ty(t,n)}var Sy;Sy=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Qe.current)Ke=!0;else{if((t.lanes&n)===0&&(e.flags&128)===0)return Ke=!1,Px(t,e,n);Ke=(t.flags&131072)!==0}else Ke=!1,oe&&(e.flags&1048576)!==0&&Av(e,Qa,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Ta(t,e),t=e.pendingProps;var r=vr(e,ze.current);fr(e,n),r=Ch(null,e,i,t,r,n);var s=Lh();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Je(i)?(s=!0,Ka(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Th(e),r.updater=Nl,e.stateNode=r,r._reactInternals=e,nf(e,i,t,n),e=of(null,e,i,!0,s,n)):(e.tag=0,oe&&s&&mh(e),Ve(null,e,r,n),e=e.child),e;case 16:i=e.elementType;e:{switch(Ta(t,e),t=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=Bx(i),t=Mt(i,t),r){case 0:e=sf(null,e,i,t,n);break e;case 1:e=Wg(null,e,i,t,n);break e;case 11:e=jg(null,e,i,t,n);break e;case 14:e=Gg(null,e,i,Mt(i.type,t),n);break e}throw Error(I(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Mt(i,r),sf(t,e,i,r,n);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Mt(i,r),Wg(t,e,i,r,n);case 3:e:{if(ay(e),t===null)throw Error(I(387));i=e.pendingProps,s=e.memoizedState,r=s.element,Iv(t,e),tl(e,i,null,n);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=Er(Error(I(423)),e),e=Hg(t,e,i,n,r);break e}else if(i!==r){r=Er(Error(I(424)),e),e=Hg(t,e,i,n,r);break e}else for(at=Xn(e.stateNode.containerInfo.firstChild),lt=e,oe=!0,Ot=null,n=Nv(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(yr(),i===r){e=wn(t,e,n);break e}Ve(t,e,i,n)}e=e.child}return e;case 5:return Fv(e),t===null&&Ju(e),i=e.type,r=e.pendingProps,s=t!==null?t.memoizedProps:null,o=r.children,Zu(i,r)?o=null:s!==null&&Zu(i,s)&&(e.flags|=32),oy(t,e),Ve(t,e,o,n),e.child;case 6:return t===null&&Ju(e),null;case 13:return ly(t,e,n);case 4:return Sh(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=_r(e,null,i,n):Ve(t,e,i,n),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Mt(i,r),jg(t,e,i,r,n);case 7:return Ve(t,e,e.pendingProps,n),e.child;case 8:return Ve(t,e,e.pendingProps.children,n),e.child;case 12:return Ve(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,te(Ja,i._currentValue),i._currentValue=o,s!==null)if(Bt(s.value,o)){if(s.children===r.children&&!Qe.current){e=wn(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===i){if(s.tag===1){l=pn(-1,n&-n),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),ef(s.return,n,e),a.lanes|=n;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(I(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),ef(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Ve(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,fr(e,n),r=Tt(r),i=i(r),e.flags|=1,Ve(t,e,i,n),e.child;case 14:return i=e.type,r=Mt(i,e.pendingProps),r=Mt(i.type,r),Gg(t,e,i,r,n);case 15:return ry(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Mt(i,r),Ta(t,e),e.tag=1,Je(i)?(t=!0,Ka(e)):t=!1,fr(e,n),Ov(e,i,r),nf(e,i,r,n),of(null,e,i,!0,t,n);case 19:return cy(t,e,n);case 22:return sy(t,e,n)}throw Error(I(156,e.tag))};function Py(t,e){return q0(t,e)}function Ux(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function wt(t,e,n,i){return new Ux(t,e,n,i)}function Uh(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Bx(t){if(typeof t=="function")return Uh(t)?1:0;if(t!=null){if(t=t.$$typeof,t===rh)return 11;if(t===sh)return 14}return 2}function Kn(t,e){var n=t.alternate;return n===null?(n=wt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function ba(t,e,n,i,r,s){var o=2;if(i=t,typeof t=="function")Uh(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Xi:return _i(n.children,r,s,e);case ih:o=8,r|=8;break;case bu:return t=wt(12,n,e,r|2),t.elementType=bu,t.lanes=s,t;case Au:return t=wt(13,n,e,r),t.elementType=Au,t.lanes=s,t;case Cu:return t=wt(19,n,e,r),t.elementType=Cu,t.lanes=s,t;case k0:return Ul(n,r,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case R0:o=10;break e;case O0:o=9;break e;case rh:o=11;break e;case sh:o=14;break e;case Nn:o=16,i=null;break e}throw Error(I(130,t==null?t:typeof t,""))}return e=wt(o,n,e,r),e.elementType=t,e.type=i,e.lanes=s,e}function _i(t,e,n,i){return t=wt(7,t,i,e),t.lanes=n,t}function Ul(t,e,n,i){return t=wt(22,t,i,e),t.elementType=k0,t.lanes=n,t.stateNode={isHidden:!1},t}function Bc(t,e,n){return t=wt(6,t,null,e),t.lanes=n,t}function Vc(t,e,n){return e=wt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Vx(t,e,n,i,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ec(0),this.expirationTimes=Ec(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ec(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Bh(t,e,n,i,r,s,o,a,l){return t=new Vx(t,e,n,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=wt(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Th(s),t}function jx(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Hi,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function by(t){if(!t)return Jn;t=t._reactInternals;e:{if(Ii(t)!==t||t.tag!==1)throw Error(I(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Je(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(I(171))}if(t.tag===1){var n=t.type;if(Je(n))return Pv(t,n,e)}return e}function Ay(t,e,n,i,r,s,o,a,l){return t=Bh(n,i,!0,t,r,s,o,a,l),t.context=by(null),n=t.current,i=Ge(),r=$n(n),s=pn(i,r),s.callback=e!=null?e:null,Yn(n,s,r),t.current.lanes=r,so(t,r,i),et(t,i),t}function Bl(t,e,n,i){var r=e.current,s=Ge(),o=$n(r);return n=by(n),e.context===null?e.context=n:e.pendingContext=n,e=pn(s,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=Yn(r,e,o),t!==null&&(zt(t,r,o,s),wa(t,r,o)),o}function cl(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function tp(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Vh(t,e){tp(t,e),(t=t.alternate)&&tp(t,e)}function Gx(){return null}var Cy=typeof reportError=="function"?reportError:function(t){console.error(t)};function jh(t){this._internalRoot=t}Vl.prototype.render=jh.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(I(409));Bl(t,e,null,null)};Vl.prototype.unmount=jh.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;bi(function(){Bl(null,t,null,null)}),e[yn]=null}};function Vl(t){this._internalRoot=t}Vl.prototype.unstable_scheduleHydration=function(t){if(t){var e=rv();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Dn.length&&e!==0&&e<Dn[n].priority;n++);Dn.splice(n,0,t),n===0&&ov(t)}};function Gh(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function jl(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function np(){}function Wx(t,e,n,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var c=cl(o);s.call(c)}}var o=Ay(e,i,t,0,null,!1,!1,"",np);return t._reactRootContainer=o,t[yn]=o.current,Us(t.nodeType===8?t.parentNode:t),bi(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof i=="function"){var a=i;i=function(){var c=cl(l);a.call(c)}}var l=Bh(t,0,!1,null,null,!1,!1,"",np);return t._reactRootContainer=l,t[yn]=l.current,Us(t.nodeType===8?t.parentNode:t),bi(function(){Bl(e,l,n,i)}),l}function Gl(t,e,n,i,r){var s=n._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var l=cl(o);a.call(l)}}Bl(e,o,t,r)}else o=Wx(n,e,t,r,i);return cl(o)}nv=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=fs(e.pendingLanes);n!==0&&(lh(e,n|1),et(e,ge()),(K&6)===0&&(xr=ge()+500,ii()))}break;case 13:bi(function(){var i=_n(t,1);if(i!==null){var r=Ge();zt(i,t,1,r)}}),Vh(t,1)}};ch=function(t){if(t.tag===13){var e=_n(t,134217728);if(e!==null){var n=Ge();zt(e,t,134217728,n)}Vh(t,134217728)}};iv=function(t){if(t.tag===13){var e=$n(t),n=_n(t,e);if(n!==null){var i=Ge();zt(n,t,e,i)}Vh(t,e)}};rv=function(){return q};sv=function(t,e){var n=q;try{return q=t,e()}finally{q=n}};zu=function(t,e,n){switch(e){case"input":if(Iu(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=Ol(i);if(!r)throw Error(I(90));F0(i),Iu(i,r)}}}break;case"textarea":z0(t,n);break;case"select":e=n.value,e!=null&&ar(t,!!n.multiple,e,!1)}};H0=Fh;X0=bi;var Hx={usingClientEntryPoint:!1,Events:[ao,Ki,Ol,G0,W0,Fh]},es={findFiberByHostInstance:gi,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},Xx={bundleType:es.bundleType,version:es.version,rendererPackageName:es.rendererPackageName,rendererConfig:es.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Sn.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=$0(t),t===null?null:t.stateNode},findFiberByHostInstance:es.findFiberByHostInstance||Gx,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__!="undefined"){var $o=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!$o.isDisabled&&$o.supportsFiber)try{Ll=$o.inject(Xx),Qt=$o}catch{}}ht.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Hx;ht.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Gh(e))throw Error(I(200));return jx(t,e,null,n)};ht.createRoot=function(t,e){if(!Gh(t))throw Error(I(299));var n=!1,i="",r=Cy;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=Bh(t,1,!1,null,null,n,!1,i,r),t[yn]=e.current,Us(t.nodeType===8?t.parentNode:t),new jh(e)};ht.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(I(188)):(t=Object.keys(t).join(","),Error(I(268,t)));return t=$0(e),t=t===null?null:t.stateNode,t};ht.flushSync=function(t){return bi(t)};ht.hydrate=function(t,e,n){if(!jl(e))throw Error(I(200));return Gl(null,t,e,!0,n)};ht.hydrateRoot=function(t,e,n){if(!Gh(t))throw Error(I(405));var i=n!=null&&n.hydratedSources||null,r=!1,s="",o=Cy;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=Ay(e,null,t,1,n!=null?n:null,r,!1,s,o),t[yn]=e.current,Us(t),i)for(t=0;t<i.length;t++)n=i[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new Vl(e)};ht.render=function(t,e,n){if(!jl(e))throw Error(I(200));return Gl(null,t,e,!1,n)};ht.unmountComponentAtNode=function(t){if(!jl(t))throw Error(I(40));return t._reactRootContainer?(bi(function(){Gl(null,null,t,!1,function(){t._reactRootContainer=null,t[yn]=null})}),!0):!1};ht.unstable_batchedUpdates=Fh;ht.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!jl(n))throw Error(I(200));if(t==null||t._reactInternals===void 0)throw Error(I(38));return Gl(t,e,n,!1,i)};ht.version="18.2.0-next-9e3b772b8-20220608";function Ly(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__=="undefined"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Ly)}catch(t){console.error(t)}}Ly(),A0.exports=ht;var ip=A0.exports;Su.createRoot=ip.createRoot,Su.hydrateRoot=ip.hydrateRoot;function ul(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const Wh=Boolean(typeof process!="object"||String(process)!=="[object process]"||process.browser),rp=typeof process!="undefined"&&process.version&&/v([0-9]*)/.exec(process.version);rp&&parseFloat(rp[1]);const Yx="3.2.12";function En(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Aa=typeof process!="object"||String(process)!=="[object process]"||process.browser,Zx=typeof window!="undefined"&&typeof window.orientation!="undefined",sp=typeof process!="undefined"&&process.version&&/v([0-9]*)/.exec(process.version);sp&&parseFloat(sp[1]);function d(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class $x{constructor(e,n){d(this,"name",void 0),d(this,"workerThread",void 0),d(this,"isRunning",!0),d(this,"result",void 0),d(this,"_resolve",()=>{}),d(this,"_reject",()=>{}),this.name=e,this.workerThread=n,this.result=new Promise((i,r)=>{this._resolve=i,this._reject=r})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){En(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){En(this.isRunning),this.isRunning=!1,this._reject(e)}}class jc{}const Gc=new Map;function Kx(t){En(t.source&&!t.url||!t.source&&t.url);let e=Gc.get(t.source||t.url);return e||(t.url&&(e=qx(t.url),Gc.set(t.url,e)),t.source&&(e=My(t.source),Gc.set(t.source,e))),En(e),e}function qx(t){if(!t.startsWith("http"))return t;const e=Qx(t);return My(e)}function My(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function Qx(t){return`try {
  importScripts('`.concat(t,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function Iy(t,e=!0,n){const i=n||new Set;if(t){if(op(t))i.add(t);else if(op(t.buffer))i.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const r in t)Iy(t[r],e,i)}}return n===void 0?Array.from(i):[]}function op(t){return t?t instanceof ArrayBuffer||typeof MessagePort!="undefined"&&t instanceof MessagePort||typeof ImageBitmap!="undefined"&&t instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&t instanceof OffscreenCanvas:!1}const Wc=()=>{};class yf{static isSupported(){return typeof Worker!="undefined"&&Aa||typeof jc!="undefined"&&!Aa}constructor(e){d(this,"name",void 0),d(this,"source",void 0),d(this,"url",void 0),d(this,"terminated",!1),d(this,"worker",void 0),d(this,"onMessage",void 0),d(this,"onError",void 0),d(this,"_loadableURL","");const{name:n,source:i,url:r}=e;En(i||r),this.name=n,this.source=i,this.url=r,this.onMessage=Wc,this.onError=s=>console.log(s),this.worker=Aa?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Wc,this.onError=Wc,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,n){n=n||Iy(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(n+="".concat(e.message," in ")),e.lineno&&(n+=":".concat(e.lineno,":").concat(e.colno)),new Error(n)}_createBrowserWorker(){this._loadableURL=Kx({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new jc(i,{eval:!1})}else if(this.source)e=new jc(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class Jx{static isSupported(){return yf.isSupported()}constructor(e){d(this,"name","unnamed"),d(this,"source",void 0),d(this,"url",void 0),d(this,"maxConcurrency",1),d(this,"maxMobileConcurrency",1),d(this,"onDebug",()=>{}),d(this,"reuseWorkers",!0),d(this,"props",{}),d(this,"jobQueue",[]),d(this,"idleQueue",[]),d(this,"count",0),d(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,n=(r,s,o)=>r.done(o),i=(r,s)=>r.error(s)){const r=new Promise(s=>(this.jobQueue.push({name:e,onMessage:n,onError:i,onStart:s}),this));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const i=new $x(n.name,e);e.onMessage=r=>n.onMessage(i,r.type,r.payload),e.onError=r=>n.onError(i,r),n.onStart(i);try{await i.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new yf({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return Zx?this.maxMobileConcurrency:this.maxConcurrency}}const eT={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class hn{static isSupported(){return yf.isSupported()}static getWorkerFarm(e={}){return hn._workerFarm=hn._workerFarm||new hn({}),hn._workerFarm.setProps(e),hn._workerFarm}constructor(e){d(this,"props",void 0),d(this,"workerPools",new Map),this.props={...eT},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:i,url:r}=e;let s=this.workerPools.get(n);return s||(s=new Jx({name:n,source:i,url:r}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}d(hn,"_workerFarm",void 0);const tT="latest";function nT(t,e={}){const n=e[t.id]||{},i="".concat(t.id,"-worker.js");let r=n.workerUrl;if(!r&&t.id==="compression"&&(r=e.workerUrl),e._workerType==="test"&&(r="modules/".concat(t.module,"/dist/").concat(i)),!r){let s=t.version;s==="latest"&&(s=tT);const o=s?"@".concat(s):"";r="https://unpkg.com/@loaders.gl/".concat(t.module).concat(o,"/dist/").concat(i)}return En(r),r}function iT(t,e=Yx){En(t,"no worker provided");const n=t.version;return!(!e||!n)}function rT(t,e){return!hn.isSupported()||!Aa&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function sT(t,e,n,i,r){const s=t.id,o=nT(t,n),l=hn.getWorkerFarm(n).getWorkerPool({name:s,url:o});n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{}));const c=await l.startJob("process-on-worker",oT.bind(null,r));return c.postMessage("process",{input:e,options:n,context:i}),await(await c.result).result}async function oT(t,e,n,i){switch(n){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:r,input:s,options:o}=i;try{const a=await t(s,o);e.postMessage("done",{id:r,result:a})}catch(a){const l=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:r,error:l})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}function Ry(t){return t&&typeof t=="object"&&t.isBuffer}function aT(t){return Ry(t)?new Uint8Array(t.buffer,t.byteOffset,t.length).slice().buffer:t}function Oy(t){if(Ry(t))return aT(t);if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function lT(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const i=new Uint8Array(t),r=new Uint8Array(e);for(let s=0;s<i.length;++s)if(i[s]!==r[s])return!1;return!0}function cT(...t){const e=t.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),n=e.reduce((s,o)=>s+o.byteLength,0),i=new Uint8Array(n);let r=0;for(const s of e)i.set(s,r),r+=s.byteLength;return i.buffer}async function uT(t){const e=[];for await(const n of t)e.push(n);return cT(...e)}function ap(){let t;if(typeof window!="undefined"&&window.performance)t=window.performance.now();else if(typeof process!="undefined"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class lp{constructor(e,n){d(this,"name",void 0),d(this,"type",void 0),d(this,"sampleSize",1),d(this,"time",void 0),d(this,"count",void 0),d(this,"samples",void 0),d(this,"lastTiming",void 0),d(this,"lastSampleTime",void 0),d(this,"lastSampleCount",void 0),d(this,"_count",0),d(this,"_time",0),d(this,"_samples",0),d(this,"_startTime",0),d(this,"_timerPending",!1),this.name=e,this.type=n,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=ap(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(ap()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Hh{constructor(e){d(this,"id",void 0),d(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const n in this.stats)e(this.stats[n])}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){if(!e||!e.name)return null;const{name:n,type:i}=e;return this.stats[n]||(e instanceof lp?this.stats[n]=e:this.stats[n]=new lp(n,i)),this.stats[n]}}let fT="";const cp={};function hT(t){for(const e in cp)if(t.startsWith(e)){const n=cp[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t="".concat(fT).concat(t)),t}function dT(t){const e=t&&t.lastIndexOf("/");return e>=0?t.substr(e+1):""}const gT=t=>typeof t=="boolean",Ps=t=>typeof t=="function",co=t=>t!==null&&typeof t=="object",up=t=>co(t)&&t.constructor==={}.constructor,pT=t=>t&&typeof t[Symbol.iterator]=="function",mT=t=>t&&typeof t[Symbol.asyncIterator]=="function",kr=t=>typeof Response!="undefined"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Nr=t=>typeof Blob!="undefined"&&t instanceof Blob,vT=t=>t&&typeof t=="object"&&t.isBuffer,yT=t=>typeof ReadableStream!="undefined"&&t instanceof ReadableStream||co(t)&&Ps(t.tee)&&Ps(t.cancel)&&Ps(t.getReader),_T=t=>co(t)&&Ps(t.read)&&Ps(t.pipe)&&gT(t.readable),ky=t=>yT(t)||_T(t),wT=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,ET=/^([-\w.]+\/[-\w.+]+)/;function xT(t){const e=ET.exec(t);return e?e[1]:t}function fp(t){const e=wT.exec(t);return e?e[1]:""}const TT=/\?.*/;function Wl(t){if(kr(t)){const e=Hc(t.url||""),n=t.headers.get("content-type")||"";return{url:e,type:xT(n)||fp(e)}}return Nr(t)?{url:Hc(t.name||""),type:t.type||""}:typeof t=="string"?{url:Hc(t),type:fp(t)}:{url:"",type:""}}function ST(t){return kr(t)?t.headers["content-length"]||-1:Nr(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}function Hc(t){return t.replace(TT,"")}async function Ny(t){if(kr(t))return t;const e={},n=ST(t);n>=0&&(e["content-length"]=String(n));const{url:i,type:r}=Wl(t);r&&(e["content-type"]=r);const s=await AT(t);s&&(e["x-first-bytes"]=s),typeof t=="string"&&(t=new TextEncoder().encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:i}),o}async function PT(t){if(!t.ok){const e=await bT(t);throw new Error(e)}}async function bT(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const n=t.headers.get("Content-Type");let i=t.statusText;n.includes("application/json")&&(i+=" ".concat(await t.text())),e+=i,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function AT(t){if(typeof t=="string")return"data:,".concat(t.slice(0,5));if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(i=>{const r=new FileReader;r.onload=s=>{var o;return i(s==null||(o=s.target)===null||o===void 0?void 0:o.result)},r.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5),i=CT(n);return"data:base64,".concat(i)}return null}function CT(t){let e="";const n=new Uint8Array(t);for(let i=0;i<n.byteLength;i++)e+=String.fromCharCode(n[i]);return btoa(e)}async function hp(t,e){if(typeof t=="string"){t=hT(t);let n=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(n=e.fetch),await fetch(t,n)}return await Ny(t)}function Fy(t){if(typeof window!="undefined"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process!="undefined"&&typeof process.versions=="object"&&Boolean(process.versions.electron))return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function Pn(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||Fy()}const Ca={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,global:typeof global!="undefined"&&global,document:typeof document!="undefined"&&document,process:typeof process=="object"&&process},Ko=Ca.window||Ca.self||Ca.global,ts=Ca.process||{},Dy=typeof __VERSION__!="undefined"?__VERSION__:"untranspiled source";Pn();const Xc=globalThis;function zy(t){if(!t&&!Pn())return"Node";if(Fy(t))return"Electron";const n=t||(typeof navigator!="undefined"?navigator:{}).userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";const i=n.indexOf("MSIE ")!==-1,r=n.indexOf("Trident/")!==-1;return i||r?"IE":Xc.chrome?"Chrome":Xc.safari?"Safari":Xc.mozInnerScreenX?"Firefox":"Unknown"}function LT(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class MT{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";d(this,"storage",void 0),d(this,"id",void 0),d(this,"config",{}),this.storage=LT(i),this.id=e,this.config={},Object.assign(this.config,n),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){return this.config={},this.updateConfiguration(e)}updateConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}return this}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function IT(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function RT(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function Yc(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const r=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));const s=t.width*n,o=t.height*n,a=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(r,");"),"background-size:".concat(s,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),a]}let fl;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(fl||(fl={}));function dp(t){return typeof t=="string"?fl[t.toUpperCase()]||fl.WHITE:t}function OT(t,e,n){return!Pn&&typeof t=="string"&&(e&&(e=dp(e),t="\x1B[".concat(e,"m").concat(t,"\x1B[39m")),n&&(e=dp(n),t="\x1B[".concat(n+10,"m").concat(t,"\x1B[49m"))),t}function kT(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n);for(const r of i)typeof t[r]=="function"&&(e.find(s=>r===s)||(t[r]=t[r].bind(t)))}function hl(t,e){if(!t)throw new Error(e||"Assertion failed")}function Di(){let t;if(Pn&&"performance"in Ko){var e,n;t=Ko==null||(e=Ko.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in ts){var i;const r=ts==null||(i=ts.hrtime)===null||i===void 0?void 0:i.call(ts);t=r[0]*1e3+r[1]/1e6}else t=Date.now();return t}const zi={debug:Pn&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},NT={enabled:!0,level:0};function vt(){}const gp={},pp={once:!0};class uo{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};d(this,"id",void 0),d(this,"VERSION",Dy),d(this,"_startTs",Di()),d(this,"_deltaTs",Di()),d(this,"_storage",void 0),d(this,"userData",{}),d(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this._storage=new MT("__probe-".concat(this.id,"__"),NT),this.userData={},this.timeStamp("".concat(this.id," started")),kT(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Di()-this._startTs).toPrecision(10))}getDelta(){return Number((Di()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.updateConfiguration({enabled:e}),this}setLevel(e){return this._storage.updateConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.updateConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){hl(e,n)}warn(e){return this._getLogFunction(0,e,zi.warn,arguments,pp)}error(e){return this._getLogFunction(0,e,zi.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,zi.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,zi.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){for(var i=arguments.length,r=new Array(i>2?i-2:0),s=2;s<i;s++)r[s-2]=arguments[s];return this._getLogFunction(e,n,zi.debug||zi.info,arguments,pp)}table(e,n,i){return n?this._getLogFunction(e,n,console.table||vt,i&&[i],{tag:UT(n)}):vt}image(e){let{logLevel:n,priority:i,image:r,message:s="",scale:o=1}=e;return this._shouldLog(n||i)?Pn?zT({image:r,message:s,scale:o}):DT({image:r,message:s,scale:o}):vt}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||vt)}group(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const r=mp({logLevel:e,message:n,opts:i}),{collapsed:s}=i;return r.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||vt)}withGroup(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=Uy(e)}_getLogFunction(e,n,i,r,s){if(this._shouldLog(e)){s=mp({logLevel:e,message:n,args:r,opts:s}),i=i||s.method,hl(i),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=Di();const o=s.tag||s.message;if(s.once)if(!gp[o])gp[o]=Di();else return vt;return n=FT(this.id,s.message,s),i.bind(console,n,...s.args)}return vt}}d(uo,"VERSION",Dy);function Uy(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return hl(Number.isFinite(e)&&e>=0),e}function mp(t){const{logLevel:e,message:n}=t;t.logLevel=Uy(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const r=typeof t.message;return hl(r==="string"||r==="object"),Object.assign(t,{args:i},t.opts)}function FT(t,e,n){if(typeof e=="string"){const i=n.time?RT(IT(n.total)):"";e=n.time?"".concat(t,": ").concat(i,"  ").concat(e):"".concat(t,": ").concat(e),e=OT(e,n.color,n.background)}return e}function DT(t){let{image:e,message:n="",scale:i=1}=t;return(void 0)({image:e,message:n,scale:i}),vt}function zT(t){let{image:e,message:n="",scale:i=1}=t;if(typeof e=="string"){const s=new Image;return s.onload=()=>{const o=Yc(s,n,i);console.log(...o)},s.src=e,vt}const r=e.nodeName||"";if(r.toLowerCase()==="img")return console.log(...Yc(e,n,i)),vt;if(r.toLowerCase()==="canvas"){const s=new Image;return s.onload=()=>console.log(...Yc(s,n,i)),s.src=e.toDataURL(),vt}return vt}function UT(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const vp=new uo({id:"loaders.gl"});class BT{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class VT{constructor(){d(this,"console",void 0),this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const By={fetch:null,mimeType:void 0,nothrow:!1,log:new VT,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Wh,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},jT={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Vy(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const jy=()=>{const t=Vy();return t.globalOptions=t.globalOptions||{...By},t.globalOptions};function GT(t,e,n,i){return n=n||[],n=Array.isArray(n)?n:[n],WT(t,n),XT(e,t,i)}function Gy(t,e){const n=jy(),i=t||n;return typeof i.fetch=="function"?i.fetch:co(i.fetch)?r=>hp(r,i):e!=null&&e.fetch?e==null?void 0:e.fetch:hp}function WT(t,e){yp(t,null,By,jT,e);for(const n of e){const i=t&&t[n.id]||{},r=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};yp(i,n.id,r,s,e)}}function yp(t,e,n,i,r){const s=e||"Top level",o=e?"".concat(e,"."):"";for(const a in t){const l=!e&&co(t[a]),c=a==="baseUri"&&!e,u=a==="workerUrl"&&e;if(!(a in n)&&!c&&!u){if(a in i)vp.warn("".concat(s," loader option '").concat(o).concat(a,"' no longer supported, use '").concat(i[a],"'"))();else if(!l){const f=HT(a,r);vp.warn("".concat(s," loader option '").concat(o).concat(a,"' not recognized. ").concat(f))()}}}}function HT(t,e){const n=t.toLowerCase();let i="";for(const r of e)for(const s in r.options){if(t===s)return"Did you mean '".concat(r.id,".").concat(s,"'?");const o=s.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(i=i||"Did you mean '".concat(r.id,".").concat(s,"'?"))}return i}function XT(t,e,n){const r={...t.options||{}};return YT(r,n),r.log===null&&(r.log=new BT),_p(r,jy()),_p(r,e),r}function _p(t,e){for(const n in e)if(n in e){const i=e[n];up(i)&&up(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function YT(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function Xh(t){var e;return t?(Array.isArray(t)&&(t=t[0]),Array.isArray((e=t)===null||e===void 0?void 0:e.extensions)):!1}function Yh(t){var e,n;ul(t,"null loader"),ul(Xh(t),"invalid loader");let i;return Array.isArray(t)&&(i=t[1],t=t[0],t={...t,options:{...t.options,...i}}),((e=t)!==null&&e!==void 0&&e.parseTextSync||(n=t)!==null&&n!==void 0&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const Wy=()=>{const t=Vy();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function ZT(t){const e=Wy();t=Array.isArray(t)?t:[t];for(const n of t){const i=Yh(n);e.find(r=>i===r)||e.unshift(i)}}function $T(){return Wy()}const KT=new uo({id:"loaders.gl"}),qT=/\.([^.]+)$/;async function QT(t,e=[],n,i){if(!Hy(t))return null;let r=wp(t,e,{...n,nothrow:!0},i);if(r)return r;if(Nr(t)&&(t=await t.slice(0,10).arrayBuffer(),r=wp(t,e,n,i)),!r&&!(n!=null&&n.nothrow))throw new Error(Xy(t));return r}function wp(t,e=[],n,i){if(!Hy(t))return null;if(e&&!Array.isArray(e))return Yh(e);let r=[];e&&(r=r.concat(e)),n!=null&&n.ignoreRegisteredLoaders||r.push(...$T()),eS(r);const s=JT(t,r,n,i);if(!s&&!(n!=null&&n.nothrow))throw new Error(Xy(t));return s}function JT(t,e,n,i){const{url:r,type:s}=Wl(t),o=r||(i==null?void 0:i.url);let a=null,l="";if(n!=null&&n.mimeType&&(a=Zc(e,n==null?void 0:n.mimeType),l="match forced by supplied MIME type ".concat(n==null?void 0:n.mimeType)),a=a||tS(e,o),l=l||(a?"matched url ".concat(o):""),a=a||Zc(e,s),l=l||(a?"matched MIME type ".concat(s):""),a=a||iS(e,t),l=l||(a?"matched initial data ".concat(Yy(t)):""),a=a||Zc(e,n==null?void 0:n.fallbackMimeType),l=l||(a?"matched fallback MIME type ".concat(s):""),l){var c;KT.log(1,"selectLoader selected ".concat((c=a)===null||c===void 0?void 0:c.name,": ").concat(l,"."))}return a}function Hy(t){return!(t instanceof Response&&t.status===204)}function Xy(t){const{url:e,type:n}=Wl(t);let i="No valid loader found (";i+=e?"".concat(dT(e),", "):"no url provided, ",i+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const r=t?Yy(t):"";return i+=r?' first bytes: "'.concat(r,'"'):"first bytes: not available",i+=")",i}function eS(t){for(const e of t)Yh(e)}function tS(t,e){const n=e&&qT.exec(e),i=n&&n[1];return i?nS(t,i):null}function nS(t,e){e=e.toLowerCase();for(const n of t)for(const i of n.extensions)if(i.toLowerCase()===e)return n;return null}function Zc(t,e){for(const n of t)if(n.mimeTypes&&n.mimeTypes.includes(e)||e==="application/x.".concat(n.id))return n;return null}function iS(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(rS(e,n))return n}else if(ArrayBuffer.isView(e)){if(Ep(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&Ep(e,0,n))return n;return null}function rS(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>t.startsWith(i))}function Ep(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(r=>sS(t,e,n,r))}function sS(t,e,n,i){if(i instanceof ArrayBuffer)return lT(i,t,i.byteLength);switch(typeof i){case"function":return i(t,n);case"string":const r=_f(t,e,i.length);return i===r;default:return!1}}function Yy(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?_f(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?_f(t,0,e):""}function _f(t,e,n){if(t.byteLength<e+n)return"";const i=new DataView(t);let r="";for(let s=0;s<n;s++)r+=String.fromCharCode(i.getUint8(e+s));return r}const oS=256*1024;function*aS(t,e){const n=(e==null?void 0:e.chunkSize)||oS;let i=0;const r=new TextEncoder;for(;i<t.length;){const s=Math.min(t.length-i,n),o=t.slice(i,i+s);i+=s,yield r.encode(o)}}const lS=256*1024;function*cS(t,e={}){const{chunkSize:n=lS}=e;let i=0;for(;i<t.byteLength;){const r=Math.min(t.byteLength-i,n),s=new ArrayBuffer(r),o=new Uint8Array(t,i,r);new Uint8Array(s).set(o),i+=r,yield s}}const uS=1024*1024;async function*fS(t,e){const n=(e==null?void 0:e.chunkSize)||uS;let i=0;for(;i<t.size;){const r=i+n,s=await t.slice(i,r).arrayBuffer();i=r,yield s}}function xp(t,e){return Wh?hS(t,e):dS(t)}async function*hS(t,e){const n=t.getReader();let i;try{for(;;){const r=i||n.read();e!=null&&e._streamReadAhead&&(i=n.read());const{done:s,value:o}=await r;if(s)return;yield Oy(o)}}catch{n.releaseLock()}}async function*dS(t,e){for await(const n of t)yield Oy(n)}function gS(t,e){if(typeof t=="string")return aS(t,e);if(t instanceof ArrayBuffer)return cS(t,e);if(Nr(t))return fS(t,e);if(ky(t))return xp(t,e);if(kr(t))return xp(t.body,e);throw new Error("makeIterator")}const Zy="Cannot convert supplied data type";function pS(t,e,n){if(e.text&&typeof t=="string")return t;if(vT(t)&&(t=t.buffer),t instanceof ArrayBuffer){const i=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let i=t.buffer;const r=t.byteLength||t.length;return(t.byteOffset!==0||r!==i.byteLength)&&(i=i.slice(t.byteOffset,t.byteOffset+r)),i}throw new Error(Zy)}async function mS(t,e,n){const i=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||i)return pS(t,e);if(Nr(t)&&(t=await Ny(t)),kr(t)){const r=t;return await PT(r),e.binary?await r.arrayBuffer():await r.text()}if(ky(t)&&(t=gS(t,n)),pT(t)||mT(t))return uT(t);throw new Error(Zy)}function vS(t,e,n=null){if(n)return n;const i={fetch:Gy(e,t),...t};return Array.isArray(i.loaders)||(i.loaders=null),i}function yS(t,e){if(!e&&t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...i]:i}return n&&n.length?n:null}async function Zh(t,e,n,i){En(!i||typeof i=="object"),e&&!Array.isArray(e)&&!Xh(e)&&(i=void 0,n=e,e=void 0),t=await t,n=n||{};const{url:r}=Wl(t),o=yS(e,i),a=await QT(t,o,n);return a?(n=GT(n,a,o,r),i=vS({url:r,parse:Zh,loaders:o},n,i),await _S(a,t,n,i)):null}async function _S(t,e,n,i){if(iT(t),kr(e)){const r=e,{ok:s,redirected:o,status:a,statusText:l,type:c,url:u}=r,f=Object.fromEntries(r.headers.entries());i.response={headers:f,ok:s,redirected:o,status:a,statusText:l,type:c,url:u}}if(e=await mS(e,t,n),t.parseTextSync&&typeof e=="string")return n.dataType="text",t.parseTextSync(e,n,i,t);if(rT(t,n))return await sT(t,e,n,i,Zh);if(t.parseText&&typeof e=="string")return await t.parseText(e,n,i,t);if(t.parse)return await t.parse(e,n,i,t);throw En(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}async function dl(t,e,n,i){!Array.isArray(e)&&!Xh(e)&&(n=e,e=void 0);const r=Gy(n);let s=t;return typeof t=="string"&&(s=await r(t)),Nr(t)&&(s=await r(t)),await Zh(s,e,n)}const wS="3.2.12",{_parseImageNode:ES}=globalThis,wf=typeof Image!="undefined",Ef=typeof ImageBitmap!="undefined",xS=Boolean(ES),xf=Wh?!0:xS;function TS(t){switch(t){case"auto":return Ef||wf||xf;case"imagebitmap":return Ef;case"image":return wf;case"data":return xf;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function SS(){if(Ef)return"imagebitmap";if(wf)return"image";if(xf)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function PS(t){const e=AS(t);if(!e)throw new Error("Not an image");return e}function bS(t){switch(PS(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function AS(t){return typeof ImageBitmap!="undefined"&&t instanceof ImageBitmap?"imagebitmap":typeof Image!="undefined"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const CS=/^data:image\/svg\+xml/,LS=/\.svg((\?|#).*)?$/;function $h(t){return t&&(CS.test(t)||LS.test(t))}function MS(t,e){if($h(e)){let i=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(s){throw new Error(s.message)}return"data:image/svg+xml;base64,".concat(btoa(i))}return $y(t,e)}function $y(t,e){if($h(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function Ky(t,e,n){const i=MS(t,n),r=self.URL||self.webkitURL,s=typeof i!="string"&&r.createObjectURL(i);try{return await IS(s||i,e)}finally{s&&r.revokeObjectURL(s)}}async function IS(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((i,r)=>{try{n.onload=()=>i(n),n.onerror=s=>r(new Error("Could not load image ".concat(t,": ").concat(s)))}catch(s){r(s)}})}const RS={};let Tp=!0;async function OS(t,e,n){let i;$h(n)?i=await Ky(t,e,n):i=$y(t,n);const r=e&&e.imagebitmap;return await kS(i,r)}async function kS(t,e=null){if((NS(e)||!Tp)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),Tp=!1}return await createImageBitmap(t)}function NS(t){for(const e in t||RS)return!1;return!0}const qt=!1,bs=!0;function qy(t){const e=fo(t);return FS(e)||US(e)||DS(e)||zS(e)}function FS(t){const e=fo(t);return e.byteLength>=24&&e.getUint32(0,qt)===2303741511?{mimeType:"image/png",width:e.getUint32(16,qt),height:e.getUint32(20,qt)}:null}function DS(t){const e=fo(t);return e.byteLength>=10&&e.getUint32(0,qt)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,bs),height:e.getUint16(8,bs)}:null}function zS(t){const e=fo(t);return e.byteLength>=14&&e.getUint16(0,qt)===16973&&e.getUint32(2,bs)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,bs),height:e.getUint32(22,bs)}:null}function US(t){const e=fo(t);if(!(e.byteLength>=3&&e.getUint16(0,qt)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:r}=BS();let s=2;for(;s+9<e.byteLength;){const o=e.getUint16(s,qt);if(r.has(o))return{mimeType:"image/jpeg",height:e.getUint16(s+5,qt),width:e.getUint16(s+7,qt)};if(!i.has(o))return null;s+=2,s+=e.getUint16(s,qt)}return null}function BS(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function fo(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function VS(t,e){const{mimeType:n}=qy(t)||{},i=globalThis._parseImageNode;return ul(i),await i(t,n)}async function jS(t,e,n){e=e||{};const r=(e.image||{}).type||"auto",{url:s}=n||{},o=GS(r);let a;switch(o){case"imagebitmap":a=await OS(t,e,s);break;case"image":a=await Ky(t,e,s);break;case"data":a=await VS(t);break;default:ul(!1)}return r==="data"&&(a=bS(a)),a}function GS(t){switch(t){case"auto":case"data":return SS();default:return TS(t),t}}const WS=["png","jpg","jpeg","gif","webp","bmp","ico","svg"],HS=["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],XS={image:{type:"auto",decode:!0}},Qy={id:"image",module:"images",name:"Images",version:wS,mimeTypes:HS,extensions:WS,parse:jS,tests:[t=>Boolean(qy(new DataView(t)))],options:XS};var W=new uo({id:"deck"});let Tf={};function YS(t){Tf=t}function Ne(t,e,n,i){W.level>0&&Tf[t]&&Tf[t].call(null,e,n,i)}function ZS(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}var $S={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:ZS,parseTextSync:JSON.parse};const As="8.8.20",La=globalThis.deck&&globalThis.deck.VERSION;if(La&&La!==As)throw new Error("deck.gl - multiple versions detected: ".concat(La," vs ").concat(As));La||(W.log(1,"deck.gl ".concat(As))(),globalThis.deck={...globalThis.deck,VERSION:As,version:As,log:W,_registerLoggers:YS},ZT([$S,[Qy,{imagebitmap:{premultiplyAlpha:"none"}}]]));var KS=globalThis.deck;const U=new uo({id:"luma.gl"});function je(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const qS="Invalid WebGLRenderingContext",QS="Requires WebGL2";function Hl(t){return typeof WebGLRenderingContext!="undefined"&&t instanceof WebGLRenderingContext||typeof WebGL2RenderingContext!="undefined"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&Number.isFinite(t._version))}function Y(t){return typeof WebGL2RenderingContext!="undefined"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&t._version===2)}function JS(t){return Y(t)?t:null}function Xl(t){return je(Hl(t),qS),t}function De(t){return je(Y(t),QS),t}const ds={};function eP(t){globalThis.console&&globalThis.console.error&&globalThis.console.error(t)}function tP(t){globalThis.console&&globalThis.console.log&&globalThis.console.log(t)}function nP(t,e){ds[t]=!0,e!==void 0&&eP(e)}function iP(t){const e=t.getError;t.getError=function(){let i;do i=e.apply(t),i!==0&&(ds[i]=!0);while(i!==0);for(i in ds)if(ds[i])return delete ds[i],parseInt(i,10);return 0}}const ho=function t(e){const n=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let i=0;i<this.attribs.length;i++){const r=new t.VertexAttrib(n);this.attribs[i]=r}this.maxAttrib=0};ho.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};ho.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const Ri=function(e){const n=this;this.gl=e,iP(e);const i=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(s){return s===n.VERTEX_ARRAY_BINDING_OES?n.currentVertexArrayObject===n.defaultVertexArrayObject?null:n.currentVertexArrayObject:i.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(s){const o=n.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,s);const a=o.attribs[s];return a.enabled=!0,i.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(s){const o=n.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,s);const a=o.attribs[s];return a.enabled=!1,i.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(s,o){switch(s){case 34962:n.currentArrayBuffer=o;break;case 34963:n.currentVertexArrayObject.elementArrayBuffer=o;break}return i.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(s,o){const l=n.currentVertexArrayObject.attribs[s];switch(o){case 34975:return l.buffer;case 34338:return l.enabled;case 34339:return l.size;case 34340:return l.stride;case 34341:return l.type;case 34922:return l.normalized;default:return i.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(s,o,a,l,c,u){const f=n.currentVertexArrayObject;f.maxAttrib=Math.max(f.maxAttrib,s);const h=f.attribs[s];return h.buffer=n.currentArrayBuffer,h.size=o,h.type=a,h.normalized=l,h.stride=c,h.offset=u,h.recache(),i.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{tP("OESVertexArrayObject emulation library context restored"),n.reset_()},!0),this.reset_()};Ri.prototype.VERTEX_ARRAY_BINDING_OES=34229;Ri.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let i=0;i<this.vertexArrayObjects.length;++i)this.vertexArrayObjects.isAlive=!1;const n=this.gl;this.maxVertexAttribs=n.getParameter(34921),this.defaultVertexArrayObject=new ho(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};Ri.prototype.createVertexArrayOES=function(){const e=new ho(this);return this.vertexArrayObjects.push(e),e};Ri.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};Ri.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof ho&&e.hasBeenBound&&e.ext===this)};Ri.prototype.bindVertexArrayOES=function(e){const n=this.gl;if(e&&!e.isAlive){nP(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const i=this.original,r=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const s=this.currentVertexArrayObject;if(r===s)return;(!r||s.elementArrayBuffer!==r.elementArrayBuffer)&&i.bindBuffer.call(n,34963,s.elementArrayBuffer);let o=this.currentArrayBuffer;const a=Math.max(r?r.maxAttrib:0,s.maxAttrib);for(let l=0;l<=a;l++){const c=s.attribs[l],u=r?r.attribs[l]:null;if((!r||c.enabled!==u.enabled)&&(c.enabled?i.enableVertexAttribArray.call(n,l):i.disableVertexAttribArray.call(n,l)),c.enabled){let f=!1;(!r||c.buffer!==u.buffer)&&(o!==c.buffer&&(i.bindBuffer.call(n,34962,c.buffer),o=c.buffer),f=!0),(f||c.cached!==u.cached)&&i.vertexAttribPointer.call(n,l,c.size,c.type,c.normalized,c.stride,c.offset)}}this.currentArrayBuffer!==o&&i.bindBuffer.call(n,34962,this.currentArrayBuffer)};function rP(t){if(typeof t.createVertexArray=="function")return;const e=t.getSupportedExtensions;t.getSupportedExtensions=function(){const r=e.call(this)||[];return r.indexOf("OES_vertex_array_object")<0&&r.push("OES_vertex_array_object"),r};const n=t.getExtension;t.getExtension=function(r){const s=n.call(this,r);return s||(r!=="OES_vertex_array_object"?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new Ri(this)),this.__OESVertexArrayObject))}}const Sp="OES_element_index",Pp="WEBGL_draw_buffers",sP="EXT_disjoint_timer_query",oP="EXT_disjoint_timer_query_webgl2",aP="EXT_texture_filter_anisotropic",bp="WEBGL_debug_renderer_info",lP=35723,cP=4352,uP=36795,fP=34047,hP=37445,dP=37446,J=t=>Y(t)?void 0:0,gP={[3074]:t=>Y(t)?void 0:36064,[lP]:t=>Y(t)?void 0:cP,[35977]:J,[32937]:J,[uP]:(t,e)=>{const n=Y(t)?t.getExtension(oP):t.getExtension(sP);return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0},[hP]:(t,e)=>{const n=t.getExtension(bp);return e(n&&n.UNMASKED_VENDOR_WEBGL||7936)},[dP]:(t,e)=>{const n=t.getExtension(bp);return e(n&&n.UNMASKED_RENDERER_WEBGL||7937)},[fP]:(t,e)=>{const n=t.luma.extensions[aP];return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},[32883]:J,[35071]:J,[37447]:J,[36063]:(t,e)=>{if(!Y(t)){const n=t.getExtension(Pp);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},[35379]:J,[35374]:J,[35377]:J,[34852]:t=>{if(!Y(t)){const e=t.getExtension(Pp);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},[36203]:t=>t.getExtension(Sp)?2147483647:65535,[33001]:t=>t.getExtension(Sp)?16777216:65535,[33e3]:t=>16777216,[37157]:J,[35373]:J,[35657]:J,[36183]:J,[37137]:J,[34045]:J,[35978]:J,[35979]:J,[35968]:J,[35376]:J,[35375]:J,[35659]:J,[37154]:J,[35371]:J,[35658]:J,[35076]:J,[35077]:J,[35380]:J};function pP(t,e,n){const i=gP[n],r=typeof i=="function"?i(t,e,n):i;return r!==void 0?r:e(n)}const mP="OES_vertex_array_object",Jy="ANGLE_instanced_arrays",vP="WEBGL_draw_buffers",yP="EXT_disjoint_timer_query",_P="EXT_texture_filter_anisotropic",wP="VertexArray requires WebGL2 or OES_vertex_array_object extension";function EP(t,e){return{webgl2:Y(t),ext:t.getExtension(e)}}const e_={[mP]:{meta:{suffix:"OES"},createVertexArray:()=>{je(!1,wP)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[Jy]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){je(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[vP]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{je(!1)}},[yP]:{meta:{suffix:"EXT"},createQuery:()=>{je(!1)},deleteQuery:()=>{je(!1)},beginQuery:()=>{je(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},$c={readBuffer:(t,e,n)=>{Y(t)&&e(n)},getVertexAttrib:(t,e,n,i)=>{const{webgl2:r,ext:s}=EP(t,Jy);let o;switch(i){case 35069:o=r?void 0:!1;break;case 35070:o=!r&&!s?0:void 0;break}return o!==void 0?o:e(n,i)},getProgramParameter:(t,e,n,i)=>{if(!Y(t))switch(i){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(n,i)},getInternalformatParameter:(t,e,n,i,r)=>{if(!Y(t))switch(r){case 32937:return new Int32Array([0])}return t.getInternalformatParameter(n,i,r)},getTexParameter(t,e,n,i){switch(i){case 34046:const{extensions:r}=t.luma,s=r[_P];i=s&&s.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(n,i)},getParameter:pP,hint(t,e,n,i){return e(n,i)}};function xP(t){t.luma=t.luma||{};const{luma:e}=t;return e.polyfilled||(rP(t),TP(t),PP(t,e_),SP(t,{target:e,target2:t}),e.polyfilled=!0),t}globalThis.polyfillContext=xP;function TP(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const n of e)t.luma[n]=t.getExtension(n)}function SP(t,e){let{target:n,target2:i}=e;Object.keys($c).forEach(r=>{if(typeof $c[r]=="function"){const s=t[r]?t[r].bind(t):()=>{},o=$c[r].bind(null,t,s);n[r]=o,i[r]=o}})}function PP(t,e){for(const n of Object.getOwnPropertyNames(e))n!=="overrides"&&bP(t,{extension:n,target:t.luma,target2:t})}function bP(t,e){let{extension:n,target:i,target2:r}=e;const s=e_[n];je(s);const{meta:o={}}=s,{suffix:a=""}=o,l=t.getExtension(n);for(const c of Object.keys(s)){const u="".concat(c).concat(a);let f=null;c==="meta"||typeof t[c]=="function"||(l&&typeof l[u]=="function"?f=function(){return l[u](...arguments)}:typeof s[c]=="function"&&(f=s[c].bind(i))),f&&(i[c]=f,r[c]=f)}}const Kh={[3042]:!1,[32773]:new Float32Array([0,0,0,0]),[32777]:32774,[34877]:32774,[32969]:1,[32968]:0,[32971]:1,[32970]:0,[3106]:new Float32Array([0,0,0,0]),[3107]:[!0,!0,!0,!0],[2884]:!1,[2885]:1029,[2929]:!1,[2931]:1,[2932]:513,[2928]:new Float32Array([0,1]),[2930]:!0,[3024]:!0,[36006]:null,[2886]:2305,[33170]:4352,[2849]:1,[32823]:!1,[32824]:0,[10752]:0,[32938]:1,[32939]:!1,[3089]:!1,[3088]:new Int32Array([0,0,1024,1024]),[2960]:!1,[2961]:0,[2968]:4294967295,[36005]:4294967295,[2962]:519,[2967]:0,[2963]:4294967295,[34816]:519,[36003]:0,[36004]:4294967295,[2964]:7680,[2965]:7680,[2966]:7680,[34817]:7680,[34818]:7680,[34819]:7680,[2978]:[0,0,1024,1024],[3333]:4,[3317]:4,[37440]:!1,[37441]:!1,[37443]:37444,[35723]:4352,[36010]:null,[35977]:!1,[3330]:0,[3332]:0,[3331]:0,[3314]:0,[32878]:0,[3316]:0,[3315]:0,[32877]:0},Mn=(t,e,n)=>e?t.enable(n):t.disable(n),Ap=(t,e,n)=>t.hint(n,e),tt=(t,e,n)=>t.pixelStorei(n,e),AP=(t,e)=>{const n=Y(t)?36009:36160;return t.bindFramebuffer(n,e)},CP=(t,e)=>t.bindFramebuffer(36008,e);function ns(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const LP={[3042]:Mn,[32773]:(t,e)=>t.blendColor(...e),[32777]:"blendEquation",[34877]:"blendEquation",[32969]:"blendFunc",[32968]:"blendFunc",[32971]:"blendFunc",[32970]:"blendFunc",[3106]:(t,e)=>t.clearColor(...e),[3107]:(t,e)=>t.colorMask(...e),[2884]:Mn,[2885]:(t,e)=>t.cullFace(e),[2929]:Mn,[2931]:(t,e)=>t.clearDepth(e),[2932]:(t,e)=>t.depthFunc(e),[2928]:(t,e)=>t.depthRange(...e),[2930]:(t,e)=>t.depthMask(e),[3024]:Mn,[35723]:Ap,[36006]:AP,[2886]:(t,e)=>t.frontFace(e),[33170]:Ap,[2849]:(t,e)=>t.lineWidth(e),[32823]:Mn,[32824]:"polygonOffset",[10752]:"polygonOffset",[35977]:Mn,[32938]:"sampleCoverage",[32939]:"sampleCoverage",[3089]:Mn,[3088]:(t,e)=>t.scissor(...e),[2960]:Mn,[2961]:(t,e)=>t.clearStencil(e),[2968]:(t,e)=>t.stencilMaskSeparate(1028,e),[36005]:(t,e)=>t.stencilMaskSeparate(1029,e),[2962]:"stencilFuncFront",[2967]:"stencilFuncFront",[2963]:"stencilFuncFront",[34816]:"stencilFuncBack",[36003]:"stencilFuncBack",[36004]:"stencilFuncBack",[2964]:"stencilOpFront",[2965]:"stencilOpFront",[2966]:"stencilOpFront",[34817]:"stencilOpBack",[34818]:"stencilOpBack",[34819]:"stencilOpBack",[2978]:(t,e)=>t.viewport(...e),[3333]:tt,[3317]:tt,[37440]:tt,[37441]:tt,[37443]:tt,[3330]:tt,[3332]:tt,[3331]:tt,[36010]:CP,[3314]:tt,[32878]:tt,[3316]:tt,[3315]:tt,[32877]:tt,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=ns(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=ns(e)&&e.length===2?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=ns(e)?e:[e,e];const[n,i]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,i)},stencilFunc:(t,e)=>{e=ns(e)&&e.length===3?[...e,...e]:e;const[n,i,r,s,o,a]=e;t.stencilFuncSeparate(1028,n,i,r),t.stencilFuncSeparate(1029,s,o,a)},stencilOp:(t,e)=>{e=ns(e)&&e.length===3?[...e,...e]:e;const[n,i,r,s,o,a]=e;t.stencilOpSeparate(1028,n,i,r),t.stencilOpSeparate(1029,s,o,a)},viewport:(t,e)=>t.viewport(...e)};function he(t,e,n){return e[t]!==void 0?e[t]:n[t]}const MP={blendEquation:(t,e,n)=>t.blendEquationSeparate(he(32777,e,n),he(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(he(32969,e,n),he(32968,e,n),he(32971,e,n),he(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(he(32824,e,n),he(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(he(32938,e,n),he(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,he(2962,e,n),he(2967,e,n),he(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,he(34816,e,n),he(36003,e,n),he(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,he(2964,e,n),he(2965,e,n),he(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,he(34817,e,n),he(34818,e,n),he(34819,e,n))},Cp={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({[36006]:n,[36010]:n});case 36009:return t({[36006]:n});case 36008:return t({[36010]:n});default:return null}},blendColor:(t,e,n,i,r)=>t({[32773]:new Float32Array([e,n,i,r])}),blendEquation:(t,e)=>t({[32777]:e,[34877]:e}),blendEquationSeparate:(t,e,n)=>t({[32777]:e,[34877]:n}),blendFunc:(t,e,n)=>t({[32969]:e,[32968]:n,[32971]:e,[32970]:n}),blendFuncSeparate:(t,e,n,i,r)=>t({[32969]:e,[32968]:n,[32971]:i,[32970]:r}),clearColor:(t,e,n,i,r)=>t({[3106]:new Float32Array([e,n,i,r])}),clearDepth:(t,e)=>t({[2931]:e}),clearStencil:(t,e)=>t({[2961]:e}),colorMask:(t,e,n,i,r)=>t({[3107]:[e,n,i,r]}),cullFace:(t,e)=>t({[2885]:e}),depthFunc:(t,e)=>t({[2932]:e}),depthRange:(t,e,n)=>t({[2928]:new Float32Array([e,n])}),depthMask:(t,e)=>t({[2930]:e}),frontFace:(t,e)=>t({[2886]:e}),lineWidth:(t,e)=>t({[2849]:e}),polygonOffset:(t,e,n)=>t({[32824]:e,[10752]:n}),sampleCoverage:(t,e,n)=>t({[32938]:e,[32939]:n}),scissor:(t,e,n,i,r)=>t({[3088]:new Int32Array([e,n,i,r])}),stencilMask:(t,e)=>t({[2968]:e,[36005]:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,i)=>t({[2962]:e,[2967]:n,[2963]:i,[34816]:e,[36003]:n,[36004]:i}),stencilFuncSeparate:(t,e,n,i,r)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:i,[e===1028?2963:36004]:r}),stencilOp:(t,e,n,i)=>t({[2964]:e,[2965]:n,[2966]:i,[34817]:e,[34818]:n,[34819]:i}),stencilOpSeparate:(t,e,n,i,r)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:i,[e===1028?2966:34819]:r}),viewport:(t,e,n,i,r)=>t({[2978]:[e,n,i,r]})},Xt=(t,e)=>t.isEnabled(e),Lp={[3042]:Xt,[2884]:Xt,[2929]:Xt,[3024]:Xt,[32823]:Xt,[32926]:Xt,[32928]:Xt,[3089]:Xt,[2960]:Xt,[35977]:Xt};function t_(t){for(const e in t)return!1;return!0}function IP(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&i&&t.length===e.length){for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}return!1}function Mp(t,e){const n=t[e].bind(t);t[e]=function(){const r=arguments.length<=0?void 0:arguments[0];return r in t.state.cache?t.state.enable?t.state.cache[r]:n(...arguments):n(...arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function RP(t,e,n){const i=t[e].bind(t);t[e]=function(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];const{valueChanged:l,oldValue:c}=n(t.state._updateCache,...o);return l&&i(...o),c},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function OP(t){const e=t.useProgram.bind(t);t.useProgram=function(i){t.state.program!==i&&(e(i),t.state.program=i)}}class kP{constructor(e){let{copyState:n=!1,log:i=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=n?FP(e):Object.assign({},Kh),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){je(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];xn(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,i;const r=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const s in e){je(s!==void 0);const o=e[s],a=this.cache[s];IP(o,a)||(n=!0,i=a,r&&!(s in r)&&(r[s]=a),this.cache[s]=o)}return{valueChanged:n,oldValue:i}}}function n_(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:n=!0,copyState:i}=e;if(je(i!==void 0),!t.state){const{polyfillContext:r}=globalThis;r&&r(t),t.state=new kP(t,{copyState:i}),OP(t);for(const s in Cp){const o=Cp[s];RP(t,s,o)}Mp(t,"getParameter"),Mp(t,"isEnabled")}return t.state.enable=n,t}function NP(t){t.state||n_(t,{copyState:!1}),t.state.push()}function Ip(t){je(t.state),t.state.pop()}function xn(t,e){if(je(Hl(t),"setParameters requires a WebGL context"),t_(e))return;const n={};for(const r in e){const s=Number(r),o=LP[r];o&&(typeof o=="string"?n[o]=!0:o(t,e[r],s))}const i=t.state&&t.state.cache;if(i)for(const r in n){const s=MP[r];s(t,e,i)}}function FP(t,e){if(e=e||Kh,typeof e=="number"){const r=e,s=Lp[r];return s?s(t,r):t.getParameter(r)}const n=Array.isArray(e)?e:Object.keys(e),i={};for(const r of n){const s=Lp[r];i[r]=s?s(t,Number(r)):t.getParameter(Number(r))}return i}function DP(t){xn(t,Kh)}function xt(t,e,n){if(t_(e))return n(t);const{nocatch:i=!0}=e;NP(t),xn(t,e);let r;if(i)r=n(t),Ip(t);else try{r=n(t)}finally{Ip(t)}return r}function Tr(t){const{luma:e}=t;if(t.canvas&&e){const{clientWidth:n}=e.canvasSizeInfo;return n?t.drawingBufferWidth/n:1}return 1}function Kc(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const i=Tr(t),r=t.drawingBufferWidth,s=t.drawingBufferHeight;return UP(e,i,r,s,n)}function zP(t){const e=typeof window=="undefined"?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}function UP(t,e,n,i,r){const s=Rp(t[0],e,n);let o=Op(t[1],e,i,r),a=Rp(t[0]+1,e,n);const l=a===n-1?a:a-1;a=Op(t[1]+1,e,i,r);let c;return r?(a=a===0?a:a+1,c=o,o=a):c=a===i-1?a:a-1,{x:s,y:o,width:Math.max(l-s+1,1),height:Math.max(c-o+1,1)}}function Rp(t,e,n){return Math.min(Math.round(t*e),n-1)}function Op(t,e,n,i){return i?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const qh=Pn(),BP=qh&&typeof document!="undefined",i_={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function r_(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};je(qh,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),t=Object.assign({},i_,t);const{width:e,height:n}=t;function i(a){if(t.throwOnError)throw new Error(a);return console.error(a),null}t.onError=i;let r;const{canvas:s}=t,o=WP({canvas:s,width:e,height:n,onError:i});return r=GP(o,t),r?(r=Qh(r,t),HP(r),r):null}function Qh(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||XP(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},i_,e);const{manageState:n,debug:i}=e;return n&&n_(t,{copyState:!1,log:function(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return U.log(1,...s)()}}),qh&&i&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,e),U.level=Math.max(U.level,1)):U.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function VP(t){const e=t.getParameter(7936),n=t.getParameter(7937),i=t.getExtension("WEBGL_debug_renderer_info"),r=i&&t.getParameter(i.UNMASKED_VENDOR_WEBGL||7936),s=i&&t.getParameter(i.UNMASKED_RENDERER_WEBGL||7937);return{vendor:r||e,renderer:s||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}function jP(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.canvas){const i=zP(e.useDevicePixels);YP(t,i,e);return}const n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in e&&"height"in e&&n.resize(e.width,e.height)}function GP(t,e){const{onError:n}=e;let i=null;const r=l=>i=l.statusMessage||i;t.addEventListener("webglcontextcreationerror",r,!1);const{webgl1:s=!0,webgl2:o=!0}=e;let a=null;return o&&(a=a||t.getContext("webgl2",e),a=a||t.getContext("experimental-webgl2",e)),s&&(a=a||t.getContext("webgl",e),a=a||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",r,!1),a?(e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1),a):n("Failed to create ".concat(o&&!s?"WebGL2":"WebGL"," context: ").concat(i||"Unknown error"))}function WP(t){let{canvas:e,width:n=800,height:i=600,onError:r}=t,s;return typeof e=="string"?(BP&&document.readyState==="complete"||r("createGLContext called on canvas '".concat(e,"' before page was loaded")),s=document.getElementById(e)):e?s=e:(s=document.createElement("canvas"),s.id="lumagl-canvas",s.style.width=Number.isFinite(n)?"".concat(n,"px"):"100%",s.style.height=Number.isFinite(i)?"".concat(i,"px"):"100%",document.body.insertBefore(s,document.body.firstChild)),s}function HP(t){const e=Y(t)?"WebGL2":"WebGL1",n=VP(t),i=n?"(".concat(n.vendor,",").concat(n.renderer,")"):"",r=t.debug?" debug":"";U.info(1,"".concat(e).concat(r," context ").concat(i))()}function XP(t){return typeof WebGL2RenderingContext!="undefined"&&t instanceof WebGL2RenderingContext?2:1}function YP(t,e,n){let i="width"in n?n.width:t.canvas.clientWidth,r="height"in n?n.height:t.canvas.clientHeight;(!i||!r)&&(U.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=t.canvas.width||1,r=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const s=t.luma.canvasSizeInfo;if(s.clientWidth!==i||s.clientHeight!==r||s.devicePixelRatio!==e){let o=e;const a=Math.floor(i*o),l=Math.floor(r*o);t.canvas.width=a,t.canvas.height=l,(t.drawingBufferWidth!==a||t.drawingBufferHeight!==l)&&(U.warn("Device pixel ratio clamped")(),o=Math.min(t.drawingBufferWidth/i,t.drawingBufferHeight/r),t.canvas.width=Math.floor(i*o),t.canvas.height=Math.floor(r*o)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:i,clientHeight:r,devicePixelRatio:e})}}const Cs="8.5.17",ZP="set luma.log.level=1 (or higher) to trace rendering";class $P{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new Hh({id:e})),this.stats.get(e)}}const vi=new $P;if(globalThis.luma&&globalThis.luma.VERSION!==Cs)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(Cs));globalThis.luma||(Pn()&&U.log(1,"luma.gl ".concat(Cs," - ").concat(ZP))(),globalThis.luma=globalThis.luma||{VERSION:Cs,version:Cs,log:U,stats:vi,globals:{modules:{},nodeIO:{}}});function KP(t){return typeof window!="undefined"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function qP(t){return typeof window!="undefined"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}function k(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function qc(t,e){if(typeof e!="string")return e;const n=Number(e);if(!isNaN(n))return n;e=e.replace(/^.*\./,"");const i=t[e];return k(i!==void 0,"Accessing undefined constant GL.".concat(e)),i}function qn(t,e){e=Number(e);for(const n in t)if(t[n]===e)return"GL.".concat(n);return String(e)}const Qc={};function en(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";Qc[t]=Qc[t]||1;const e=Qc[t]++;return"".concat(t,"-").concat(e)}function kp(t){return k(typeof t=="number","Input must be a number"),t&&(t&t-1)===0}function Sr(t){let e=!0;for(const n in t){e=!1;break}return e}function s_(t,e,n,i){const r="See luma.gl ".concat(n," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),s=Object.getPrototypeOf(t);i.forEach(o=>{s.methodName||(s[o]=()=>{throw U.removed("Calling removed method ".concat(e,".").concat(o,": "),r)(),new Error(o)})})}const Ui="Resource subclass must define virtual methods";class bn{get[Symbol.toStringTag](){return"Resource"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Xl(e);const{id:i,userData:r={}}=n;this.gl=e,this.gl2=e,this.id=i||en(this[Symbol.toStringTag]),this.userData=r,this._bound=!1,this._handle=n.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,n&&e&&n.filter(Boolean).forEach(i=>i.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let n;return this._bound?n=e():(this._bindHandle(this.handle),this._bound=!0,n=e(),this._bound=!1,this._bindHandle(null)),n}unbind(){this.bind(null)}getParameter(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=qc(this.gl,e),k(e);const r=(this.constructor.PARAMETERS||{})[e];if(r){const s=Y(this.gl);if(!((!("webgl2"in r)||s)&&(!("extension"in r)||this.gl.getExtension(r.extension)))){const a=r.webgl1,l="webgl2"in r?r.webgl2:r.webgl1;return s?l:a}}return this._getParameter(e,n)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:n,keys:i}=e,r=this.constructor.PARAMETERS||{},s=Y(this.gl),o={},a=n||Object.keys(r);for(const l of a){const c=r[l];if(c&&(!("webgl2"in c)||s)&&(!("extension"in c)||this.gl.getExtension(c.extension))){const f=i?qn(this.gl,l):l;o[f]=this.getParameter(l,e),i&&c.type==="GLenum"&&(o[f]=qn(this.gl,o[f]))}}return o}setParameter(e,n){e=qc(this.gl,e),k(e);const r=(this.constructor.PARAMETERS||{})[e];if(r){const s=Y(this.gl);if(!((!("webgl2"in r)||s)&&(!("extension"in r)||this.gl.getExtension(r.extension))))throw new Error("Parameter not available on this platform");r.type==="GLenum"&&(n=qc(n))}return this._setParameter(e,n),this}setParameters(e){for(const n in e)this.setParameter(n,e[n]);return this}stubRemovedMethods(e,n,i){return s_(this,e,n,i)}initialize(e){}_createHandle(){throw new Error(Ui)}_deleteHandle(){throw new Error(Ui)}_bindHandle(e){throw new Error(Ui)}_getOptsFromHandle(){throw new Error(Ui)}_getParameter(e,n){throw new Error(Ui)}_setParameter(e,n){throw new Error(Ui)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],n=vi.get("Resource Counts");n.get("Resources Created").incrementCount(),n.get("".concat(e,"s Created")).incrementCount(),n.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];vi.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,n),this._trackAllocatedMemoryForContext(e,n,this.gl.canvas&&this.gl.canvas.id)}_trackAllocatedMemoryForContext(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const r=vi.get("Memory Usage".concat(i));r.get("GPU Memory").addCount(e),r.get("".concat(n," Memory")).addCount(e),this.byteLength=e}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id)}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const i=vi.get("Memory Usage".concat(n));i.get("GPU Memory").subtractCount(this.byteLength),i.get("".concat(e," Memory")).subtractCount(this.byteLength),this.byteLength=0}}const QP="Failed to deduce GL constant from typed array";function Sf(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(QP)}}function Zs(t){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function JP(t){let{data:e,width:n,height:i,bytesPerPixel:r=4,temp:s}=t;const o=n*r;s=s||new Uint8Array(o);for(let a=0;a<i/2;++a){const l=a*o,c=(i-a-1)*o;s.set(e.subarray(l,l+o)),e.copyWithin(l,c,c+o),e.set(s,c)}}function eb(t){let{data:e,width:n,height:i}=t;const r=Math.round(n/2),s=Math.round(i/2),o=new Uint8Array(r*s*4);for(let a=0;a<s;a++)for(let l=0;l<r;l++)for(let c=0;c<4;c++)o[(a*r+l)*4+c]=e[(a*2*n+l*2)*4+c];return{data:o,width:r,height:s}}function Pf(t,e,n){const{removedProps:i={},deprecatedProps:r={},replacedProps:s={}}=n;for(const a in i)if(a in e){const c=i[a]?"".concat(t,".").concat(i[a]):"N/A";U.removed("".concat(t,".").concat(a),c)()}for(const a in r)if(a in e){const l=r[a];U.deprecated("".concat(t,".").concat(a),"".concat(t,".").concat(l))()}let o=null;for(const a in s)if(a in e){const l=s[a];U.deprecated("".concat(t,".").concat(a),"".concat(t,".").concat(l))(),o=o||Object.assign({},e),o[l]=e[a],delete o[a]}return o||e}const tb={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},nb={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class ot{static getBytesPerElement(e){return Zs(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return k(e.size),Zs(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return new ot(tb,...n)}constructor(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];n.forEach(r=>this._assign(r)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return ot.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return ot.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=Pf("Accessor",e,nb),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const Np=10,o_={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},ib={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:o_},rb={removedProps:o_};class Q extends bn{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=n.target||(this.gl.webgl2?36662:34962),this.initialize(n),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/ot.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/ot.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=Pf("Buffer",e,ib),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=Pf("Buffer",e,rb),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new ot(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:n,offset:i=0,srcOffset:r=0}=e,s=e.byteLength||e.length;k(n);const o=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(o,this.handle),r!==0||s!==void 0?(De(this.gl),this.gl.bufferSubData(this.target,i,n,r,s)):this.gl.bufferSubData(o,i,n),this.gl.bindBuffer(o,null),this.debugData=null,this._inferType(n),this}copyData(e){let{sourceBuffer:n,readOffset:i=0,writeOffset:r=0,size:s}=e;const{gl:o}=this;return De(o),o.bindBuffer(36662,n.handle),o.bindBuffer(36663,this.handle),o.copyBufferSubData(36662,36663,i,r,s),o.bindBuffer(36662,null),o.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:n=0,dstOffset:i=0,length:r=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};De(this.gl);const s=Zs(this.accessor.type||5126,{clamped:!1}),o=this._getAvailableElementCount(n),a=i;let l,c;e?(c=e.length,l=c-a):(l=Math.min(o,r||o),c=a+l);const u=Math.min(o,l);return r=r||u,k(r<=u),e=e||new s(c),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,e,i,r),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index,offset:i=0,size:r}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?r!==void 0?this.gl.bindBufferRange(e,n,this.handle,i,r):(k(i===0),this.gl.bindBufferBase(e,n,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,n,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(Np,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+n;k(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const r=this._getTarget();this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,i,this.usage),this.gl.bufferSubData(r,n,e),this.gl.bindBuffer(r,null),this.debugData=e.slice(0,Np),this.bytesUsed=i,this._trackAllocatedMemory(i);const s=Sf(e);return k(s),this.setAccessor(new ot(this.accessor,{type:s})),this}_setByteLength(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;k(e>=0),this._trackDeallocatedMemory();let i=e;e===0&&(i=new Float32Array(0));const r=this._getTarget();return this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,i,n),this.gl.bindBuffer(r,null),this.usage=n,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const n=Zs(this.accessor.type||5126,{clamped:!1}),i=e/n.BYTES_PER_ELEMENT;return this.getElementCount()-i}_inferType(e){this.accessor.type||this.setAccessor(new ot(this.accessor,{type:Sf(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const n=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),n}get type(){return U.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return U.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return U.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return U.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new ot(this.accessor,e),this}}const Jh={[6407]:{dataFormat:6407,types:[5121,33635]},[6408]:{dataFormat:6408,types:[5121,32819,32820]},[6406]:{dataFormat:6406,types:[5121]},[6409]:{dataFormat:6409,types:[5121]},[6410]:{dataFormat:6410,types:[5121]},[33326]:{dataFormat:6403,types:[5126],gl2:!0},[33328]:{dataFormat:33319,types:[5126],gl2:!0},[34837]:{dataFormat:6407,types:[5126],gl2:!0},[34836]:{dataFormat:6408,types:[5126],gl2:!0}},a_={[6403]:1,[36244]:1,[33319]:2,[33320]:2,[6407]:3,[36248]:3,[6408]:4,[36249]:4,[6402]:1,[34041]:1,[6406]:1,[6409]:1,[6410]:2},l_={[5126]:4,[5125]:4,[5124]:4,[5123]:2,[5122]:2,[5131]:2,[5120]:1,[5121]:1};function sb(t,e){const n=Jh[e];if(!n)return!1;if(n.gl1===void 0&&n.gl2===void 0)return!0;const i=Y(t)&&n.gl2||n.gl1;return typeof i=="string"?t.getExtension(i):i}function ob(t,e){const n=Jh[e];switch(n&&n.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}const ab=[9729,9728],Fp=globalThis.WebGLBuffer||function(){};class Ai extends bn{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:i,linearFiltering:r}=n;let s=!0;return i&&(s=s&&sb(e,i),s=s&&(!r||ob(e,i))),s}constructor(e,n){const{id:i=en("texture"),handle:r,target:s}=n;super(e,{id:i,handle:r}),this.target=s,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.data;if(n instanceof Promise)return n.then(m=>this.initialize(Object.assign({},e,{pixels:m,data:m}))),this;const i=typeof HTMLVideoElement!="undefined"&&n instanceof HTMLVideoElement;if(i&&n.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,n.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:r=null,format:s=6408,border:o=0,recreate:a=!1,parameters:l={},pixelStore:c={},textureUnit:u=void 0}=e;n||(n=r);let{width:f,height:h,dataFormat:g,type:p,compressed:w=!1,mipmaps:x=!0}=e;const{depth:y=0}=e;return{width:f,height:h,compressed:w,dataFormat:g,type:p}=this._deduceParameters({format:s,type:p,dataFormat:g,compressed:w,data:n,width:f,height:h}),this.width=f,this.height=h,this.depth=y,this.format=s,this.type=p,this.dataFormat=g,this.border=o,this.textureUnit=u,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),x&&this._isNPOT()&&(U.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),x=!1,this._updateForNPOT(l)),this.mipmaps=x,this.setImageData({data:n,width:f,height:h,depth:y,format:s,type:p,dataFormat:g,border:o,mipmaps:x,parameters:c,compressed:w}),x&&this.generateMipmap(),this.setParameters(l),a&&(this.data=n),i&&(this._video={video:n,parameters:l,lastTime:n.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?n.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:n,lastTime:i}=this._video;if(i===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:n}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:n,width:i,mipmaps:r=!1}=e;return i!==this.width||n!==this.height?this.initialize({width:i,height:n,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:r}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(U.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),xt(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:n=this.target,pixels:i=null,level:r=0,format:s=this.format,border:o=this.border,offset:a=0,parameters:l={}}=e;let{data:c=null,type:u=this.type,width:f=this.width,height:h=this.height,dataFormat:g=this.dataFormat,compressed:p=!1}=e;c||(c=i),{type:u,dataFormat:g,compressed:p,width:f,height:h}=this._deduceParameters({format:s,type:u,dataFormat:g,compressed:p,data:c,width:f,height:h});const{gl:w}=this;w.bindTexture(this.target,this.handle);let x=null;({data:c,dataType:x}=this._getDataType({data:c,compressed:p}));let y,m=0;if(xt(this.gl,l,()=>{switch(x){case"null":w.texImage2D(n,r,s,f,h,o,g,u,c);break;case"typed-array":w.texImage2D(n,r,s,f,h,o,g,u,c,a);break;case"buffer":y=De(w),y.bindBuffer(35052,c.handle||c),y.texImage2D(n,r,s,f,h,o,g,u,a),y.bindBuffer(35052,null);break;case"browser-object":Y(w)?w.texImage2D(n,r,s,f,h,o,g,u,c):w.texImage2D(n,r,s,g,u,c);break;case"compressed":for(const[_,T]of c.entries())w.compressedTexImage2D(n,_,T.format,T.width,T.height,o,T.data),m+=T.levelSize;break;default:k(!1,"Unknown image data type")}}),x==="compressed")this._trackAllocatedMemory(m,"Texture");else if(c&&c.byteLength)this._trackAllocatedMemory(c.byteLength,"Texture");else{const _=a_[this.dataFormat]||4,T=l_[this.type]||1;this._trackAllocatedMemory(this.width*this.height*_*T,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:n=this.target,pixels:i=null,data:r=null,x:s=0,y:o=0,width:a=this.width,height:l=this.height,level:c=0,format:u=this.format,type:f=this.type,dataFormat:h=this.dataFormat,compressed:g=!1,offset:p=0,border:w=this.border,parameters:x={}}=e;if({type:f,dataFormat:h,compressed:g,width:a,height:l}=this._deduceParameters({format:u,type:f,dataFormat:h,compressed:g,data:r,width:a,height:l}),k(this.depth===0,"texSubImage not supported for 3D textures"),r||(r=i),r&&r.data){const y=r;r=y.data,a=y.shape[0],l=y.shape[1]}r instanceof Q&&(r=r.handle),this.gl.bindTexture(this.target,this.handle),xt(this.gl,x,()=>{if(g)this.gl.compressedTexSubImage2D(n,c,s,o,a,l,u,r);else if(r===null)this.gl.texSubImage2D(n,c,s,o,a,l,h,f,null);else if(ArrayBuffer.isView(r))this.gl.texSubImage2D(n,c,s,o,a,l,h,f,r,p);else if(r instanceof Fp){const y=De(this.gl);y.bindBuffer(35052,r),y.texSubImage2D(n,c,s,o,a,l,h,f,p),y.bindBuffer(35052,null)}else Y(this.gl)?De(this.gl).texSubImage2D(n,c,s,o,a,l,h,f,r):this.gl.texSubImage2D(n,c,s,o,h,f,r)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return U.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,null),e}_getDataType(e){let{data:n,compressed:i=!1}=e;return i?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof Q?{data:n.handle,dataType:"buffer"}:n instanceof Fp?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(e){const{format:n,data:i}=e;let{width:r,height:s,dataFormat:o,type:a,compressed:l}=e;const c=Jh[n];return o=o||c&&c.dataFormat,a=a||c&&c.types[0],l=l||c&&c.compressed,{width:r,height:s}=this._deduceImageSize(i,r,s),{dataFormat:o,type:a,compressed:l,width:r,height:s,format:n,data:i}}_deduceImageSize(e,n,i){let r;return typeof ImageData!="undefined"&&e instanceof ImageData?r={width:e.width,height:e.height}:typeof HTMLImageElement!="undefined"&&e instanceof HTMLImageElement?r={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement!="undefined"&&e instanceof HTMLCanvasElement?r={width:e.width,height:e.height}:typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap?r={width:e.width,height:e.height}:typeof HTMLVideoElement!="undefined"&&e instanceof HTMLVideoElement?r={width:e.videoWidth,height:e.videoHeight}:e?r={width:n,height:i}:r={width:n>=0?n:1,height:i>=0?i:1},k(r,"Could not deduced texture size"),k(n===void 0||r.width===n,"Deduced texture width does not match supplied width"),k(i===void 0||r.height===i,"Deduced texture height does not match supplied height"),r}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const n=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),n}}_setParameter(e,n){switch(this.gl.bindTexture(this.target,this.handle),n=this._getNPOTParam(e,n),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,n);break;case 4096:case 4097:k(!1);break;default:this.gl.texParameteri(this.target,e,n);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return Y(this.gl)||!this.width||!this.height?!1:!kp(this.width)||!kp(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,n){if(this._isNPOT())switch(e){case 10241:ab.indexOf(n)===-1&&(n=9729);break;case 10242:case 10243:n!==33071&&(n=33071);break}return n}}let lb="";function cb(t,e){return k(typeof t=="string"),t=lb+t,new Promise((n,i)=>{try{const r=new Image;r.onload=()=>n(r),r.onerror=()=>i(new Error("Could not load image ".concat(t,"."))),r.crossOrigin=e&&e.crossOrigin||"anonymous",r.src=t}catch(r){i(r)}})}class We extends Ai{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,n){return Ai.isSupported(e,n)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Xl(e),(n instanceof Promise||typeof n=="string")&&(n={data:n}),typeof n.data=="string"&&(n=Object.assign({},n,{data:cb(n.data)})),super(e,Object.assign({},n,{target:3553})),this.initialize(n),Object.seal(this)}}const bf=[34069,34070,34071,34072,34073,34074];class c_ extends Ai{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Xl(e),super(e,Object.assign({},n,{target:34067})),this.initialize(n),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:n=!0,parameters:i={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,n&&this.generateMipmap(e),this.setParameters(i)}),this}subImage(e){let{face:n,data:i,x:r=0,y:s=0,mipmapLevel:o=0}=e;return this._subImage({target:n,data:i,x:r,y:s,mipmapLevel:o})}async setCubeMapImageData(e){let{width:n,height:i,pixels:r,data:s,border:o=0,format:a=6408,type:l=5121}=e;const{gl:c}=this,u=r||s,f=await Promise.all(bf.map(h=>{const g=u[h];return Promise.all(Array.isArray(g)?g:[g])}));this.bind(),bf.forEach((h,g)=>{f[g].length>1&&this.opts.mipmaps!==!1&&U.warn("".concat(this.id," has mipmap and multiple LODs."))(),f[g].forEach((p,w)=>{n&&i?c.texImage2D(h,w,a,n,i,o,a,l,p):c.texImage2D(h,w,a,a,l,p)})}),this.unbind()}setImageDataForFace(e){const{face:n,width:i,height:r,pixels:s,data:o,border:a=0,format:l=6408,type:c=5121}=e,{gl:u}=this,f=s||o;return this.bind(),f instanceof Promise?f.then(h=>this.setImageDataForFace(Object.assign({},e,{face:n,data:h,pixels:h}))):this.width||this.height?u.texImage2D(n,0,l,i,r,a,l,c,f):u.texImage2D(n,0,l,l,c,f),this}}c_.FACES=bf;class ub extends Ai{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return Y(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};De(e),n=Object.assign({depth:1},n,{target:32879,unpackFlipY:!1}),super(e,n),this.initialize(n),Object.seal(this)}setImageData(e){let{level:n=0,dataFormat:i=6408,width:r,height:s,depth:o=1,border:a=0,format:l,type:c=5121,offset:u=0,data:f,parameters:h={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),xt(this.gl,h,()=>{ArrayBuffer.isView(f)&&this.gl.texImage3D(this.target,n,i,r,s,o,a,l,c,f),f instanceof Q&&(this.gl.bindBuffer(35052,f.handle),this.gl.texImage3D(this.target,n,i,r,s,o,a,l,c,u))}),f&&f.byteLength)this._trackAllocatedMemory(f.byteLength,"Texture");else{const g=a_[this.dataFormat]||4,p=l_[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*g*p,"Texture")}return this.loaded=!0,this}}const li="EXT_color_buffer_float";var Dp={[33189]:{bpp:2},[33190]:{gl2:!0,bpp:3},[36012]:{gl2:!0,bpp:4},[36168]:{bpp:1},[34041]:{bpp:4},[35056]:{gl2:!0,bpp:4},[36013]:{gl2:!0,bpp:5},[32854]:{bpp:2},[36194]:{bpp:2},[32855]:{bpp:2},[33321]:{gl2:!0,bpp:1},[33330]:{gl2:!0,bpp:1},[33329]:{gl2:!0,bpp:1},[33332]:{gl2:!0,bpp:2},[33331]:{gl2:!0,bpp:2},[33334]:{gl2:!0,bpp:4},[33333]:{gl2:!0,bpp:4},[33323]:{gl2:!0,bpp:2},[33336]:{gl2:!0,bpp:2},[33335]:{gl2:!0,bpp:2},[33338]:{gl2:!0,bpp:4},[33337]:{gl2:!0,bpp:4},[33340]:{gl2:!0,bpp:8},[33339]:{gl2:!0,bpp:8},[32849]:{gl2:!0,bpp:3},[32856]:{gl2:!0,bpp:4},[32857]:{gl2:!0,bpp:4},[36220]:{gl2:!0,bpp:4},[36238]:{gl2:!0,bpp:4},[36975]:{gl2:!0,bpp:4},[36214]:{gl2:!0,bpp:8},[36232]:{gl2:!0,bpp:8},[36226]:{gl2:!0,bpp:16},[36208]:{gl2:!0,bpp:16},[33325]:{gl2:li,bpp:2},[33327]:{gl2:li,bpp:4},[34842]:{gl2:li,bpp:8},[33326]:{gl2:li,bpp:4},[33328]:{gl2:li,bpp:8},[34836]:{gl2:li,bpp:16},[35898]:{gl2:li,bpp:4}};function fb(t,e,n){const i=n[e];if(!i)return!1;const r=Y(t)&&i.gl2||i.gl1;return typeof r=="string"?t.getExtension(r):r}class ir extends bn{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!n||fb(e,n,Dp)}static getSamplesForFormat(e,n){let{format:i}=n;return e.getInternalformatParameter(36161,i,32937)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.initialize(n),Object.seal(this)}initialize(e){let{format:n,width:i=1,height:r=1,samples:s=0}=e;return k(n,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),s!==0&&Y(this.gl)?this.gl.renderbufferStorageMultisample(36161,s,n,i,r):this.gl.renderbufferStorage(36161,n,i,r),this.format=n,this.width=i,this.height=r,this.samples=s,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*Dp[this.format].bpp),this}resize(e){let{width:n,height:i}=e;return n!==this.width||i!==this.height?this.initialize({width:n,height:i,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const hb=256,db=1024,gb=16384,zp=6144,Up=6145,Bp=6146,Vp=34041,u_="clear: bad arguments";function ed(t){let{framebuffer:e=null,color:n=null,depth:i=null,stencil:r=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s={};e&&(s.framebuffer=e);let o=0;n&&(o|=gb,n!==!0&&(s.clearColor=n)),i&&(o|=hb,i!==!0&&(s.clearDepth=i)),r&&(o|=db,i!==!0&&(s.clearStencil=i)),k(o!==0,u_),xt(t,s,()=>{t.clear(o)})}function pb(t){let{framebuffer:e=null,buffer:n=zp,drawBuffer:i=0,value:r=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};De(t),xt(t,{framebuffer:e},()=>{switch(n){case zp:switch(r.constructor){case Int32Array:t.clearBufferiv(n,i,r);break;case Uint32Array:t.clearBufferuiv(n,i,r);break;case Float32Array:default:t.clearBufferfv(n,i,r)}break;case Up:t.clearBufferfv(Up,0,[r]);break;case Bp:t.clearBufferiv(Bp,0,[r]);break;case Vp:const[s,o]=r;t.clearBufferfi(Vp,0,s,o);break;default:k(!1,u_)}})}function mb(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return k(!1),0}}function Yl(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:n=0,sourceY:i=0,sourceFormat:r=6408}=e;let{sourceAttachment:s=36064,target:o=null,sourceWidth:a,sourceHeight:l,sourceType:c}=e;const{framebuffer:u,deleteFramebuffer:f}=f_(t);k(u);const{gl:h,handle:g,attachments:p}=u;a=a||u.width,l=l||u.height,s===36064&&g===null&&(s=1028),k(p[s]),c=c||p[s].type,o=yb(o,c,r,a,l),c=c||Sf(o);const w=h.bindFramebuffer(36160,g);return h.readPixels(n,i,a,l,r,c,o),h.bindFramebuffer(36160,w||null),f&&u.delete(),o}function jp(t){let{sourceAttachment:e=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=Yl(t,{sourceAttachment:e}),{width:r,height:s}=t;for(;s>n;)({data:i,width:r,height:s}=eb({data:i,width:r,height:s}));JP({data:i,width:r,height:s});const o=document.createElement("canvas");o.width=r,o.height=s;const a=o.getContext("2d"),l=a.createImageData(r,s);return l.data.set(i),a.putImageData(l,0,0),o.toDataURL()}function vb(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{sourceX:i=0,sourceY:r=0,targetMipmaplevel:s=0,targetInternalFormat:o=6408}=n;let{targetX:a,targetY:l,targetZ:c,width:u,height:f}=n;const{framebuffer:h,deleteFramebuffer:g}=f_(t);k(h);const{gl:p,handle:w}=h,x=typeof a!="undefined"||typeof l!="undefined"||typeof c!="undefined";a=a||0,l=l||0,c=c||0;const y=p.bindFramebuffer(36160,w);k(e);let m=null;if(e instanceof Ai&&(m=e,u=Number.isFinite(u)?u:m.width,f=Number.isFinite(f)?f:m.height,m.bind(0),e=m.target),!x)p.copyTexImage2D(e,s,o,i,r,u,f,0);else switch(e){case 3553:case 34067:p.copyTexSubImage2D(e,s,a,l,i,r,u,f);break;case 35866:case 32879:De(p).copyTexSubImage3D(e,s,a,l,c,i,r,u,f);break}return m&&m.unbind(),p.bindFramebuffer(36160,y||null),g&&h.delete(),m}function f_(t){return t instanceof _e?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:Ab(t),deleteFramebuffer:!0}}function yb(t,e,n,i,r){if(t)return t;e=e||5121;const s=Zs(e,{clamped:!1}),o=mb(n);return new s(i*r*o)}const ee={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function _b(t){const e=new We(t,{format:6408,type:5126,dataFormat:6408}),n=new _e(t,{id:"test-framebuffer",check:!1,attachments:{[36064]:e}}),i=n.getStatus();return e.delete(),n.delete(),i===36053}var h_={[ee.WEBGL2]:[!1,!0],[ee.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[ee.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[ee.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[ee.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[ee.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[ee.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[ee.FLOAT_BLEND]:["EXT_float_blend"],[ee.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[ee.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[ee.TEXTURE_FLOAT]:["OES_texture_float",!0],[ee.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[ee.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[ee.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[ee.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[ee.COLOR_ATTACHMENT_RGBA32F]:[_b,"EXT_color_buffer_float"],[ee.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[ee.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[ee.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[ee.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[ee.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[ee.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]};const wb=2;function d_(t,e){return td(t,e)}function td(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>g_(t,n))}function Eb(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(const e in h_)t.luma.caps[e]===void 0&&(t.luma.caps[e]=g_(t,e));return t.luma.caps}function g_(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},t.luma.caps[e]===void 0&&(t.luma.caps[e]=xb(t,e)),t.luma.caps[e]||U.log(wb,"Feature: ".concat(e," not supported"))(),t.luma.caps[e]}function xb(t,e){const n=h_[e];k(n,e);let i;const r=Y(t)&&n[1]||n[0];if(typeof r=="function")i=r(t);else if(Array.isArray(r)){i=!0;for(const s of r)i=i&&Boolean(t.getExtension(s))}else typeof r=="string"?i=Boolean(t.getExtension(r)):typeof r=="boolean"?i=r:k(!1);return i}const Gp="Multiple render targets not supported";class _e extends bn{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:i,colorBufferHalfFloat:r}=n;let s=!0;return i&&(s=Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),r&&(s=s&&Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),s}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new _e(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=De(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=De(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(n),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:n=1,height:i=1,attachments:r=null,color:s=!0,depth:o=!0,stencil:a=!1,check:l=!0,readBuffer:c=void 0,drawBuffers:u=void 0}=e;if(k(n>=0&&i>=0,"Width and height need to be integers"),this.width=n,this.height=i,r)for(const f in r){const h=r[f];(Array.isArray(h)?h[0]:h).resize({width:n,height:i})}else r=this._createDefaultAttachments(s,o,a,n,i);this.update({clearAttachments:!0,attachments:r,readBuffer:c,drawBuffers:u}),r&&l&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:n={},readBuffer:i,drawBuffers:r,clearAttachments:s=!1,resizeAttachments:o=!0}=e;this.attach(n,{clearAttachments:s,resizeAttachments:o});const{gl:a}=this,l=a.bindFramebuffer(36160,this.handle);return i&&this._setReadBuffer(i),r&&this._setDrawBuffers(r),a.bindFramebuffer(36160,l||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:n,height:i}=e;if(this.handle===null)return k(n===void 0&&i===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),i===void 0&&(i=this.gl.drawingBufferHeight),n!==this.width&&i!==this.height&&U.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(n,"x").concat(i))();for(const r in this.attachments)this.attachments[r].resize({width:n,height:i});return this.width=n,this.height=i,this}attach(e){let{clearAttachments:n=!1,resizeAttachments:i=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r={};n&&Object.keys(this.attachments).forEach(o=>{r[o]=null}),Object.assign(r,e);const s=this.gl.bindFramebuffer(36160,this.handle);for(const o in r){k(o!==void 0,"Misspelled framebuffer binding point?");const a=Number(o),l=r[a];let c=l;if(!c)this._unattach(a);else if(c instanceof ir)this._attachRenderbuffer({attachment:a,renderbuffer:c});else if(Array.isArray(l)){const[u,f=0,h=0]=l;c=u,this._attachTexture({attachment:a,texture:u,layer:f,level:h})}else this._attachTexture({attachment:a,texture:c,layer:0,level:0});i&&c&&c.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,s||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(o=>!this.attachments[o]).forEach(o=>{delete this.attachments[o]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(Sb(e));return this}getStatus(){const{gl:e}=this,n=e.bindFramebuffer(36160,this.handle),i=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,n||null),i}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:n,depth:i,stencil:r,drawBuffers:s=[]}=e,o=this.gl.bindFramebuffer(36160,this.handle);return(n||i||r)&&ed(this.gl,{color:n,depth:i,stencil:r}),s.forEach((a,l)=>{pb(this.gl,{drawBuffer:l,value:a})}),this.gl.bindFramebuffer(36160,o||null),this}readPixels(){return U.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return U.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return U.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return U.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return U.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return U.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:n=[],x:i=0,y:r=0,width:s,height:o}=e;const a=De(this.gl),l=a.bindFramebuffer(36008,this.handle);return i===0&&r===0&&s===void 0&&o===void 0?a.invalidateFramebuffer(36008,n):a.invalidateFramebuffer(36008,n,i,r,s,o),a.bindFramebuffer(36008,l),this}getAttachmentParameter(e,n,i){let r=this._getAttachmentParameterFallback(n);return r===null&&(this.gl.bindFramebuffer(36160,this.handle),r=this.gl.getFramebufferAttachmentParameter(36160,e,n),this.gl.bindFramebuffer(36160,null)),i&&r>1e3&&(r=qn(this.gl,r)),r}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const r={};for(const s of i){const o=n?qn(this.gl,s):s;r[o]=this.getAttachmentParameter(e,s,n)}return r}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const n=Object.keys(this.attachments),i={};for(const r of n){const s=Number(r),o=e?qn(this.gl,s):s;i[o]=this.getAttachmentParameters(s,e)}return i}show(){return typeof window!="undefined"&&window.open(jp(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>U.level||typeof window=="undefined")return this;n=n||"Framebuffer ".concat(this.id);const i=jp(this,{targetMaxHeight:100});return U.image({logLevel:e,message:n,image:i},n)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,n,i,r,s){let o=null;return e&&(o=o||{},o[36064]=new We(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:r,height:s,mipmaps:!1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.ownResources.push(o[36064])),n&&i?(o=o||{},o[33306]=new ir(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:r,height:111}),this.ownResources.push(o[33306])):n?(o=o||{},o[36096]=new ir(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:r,height:s}),this.ownResources.push(o[36096])):i&&k(!1),o}_unattach(e){const n=this.attachments[e];!n||(n instanceof ir?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:n=36064,renderbuffer:i}=e;const{gl:r}=this;r.framebufferRenderbuffer(36160,n,36161,i.handle),this.attachments[n]=i}_attachTexture(e){let{attachment:n=36064,texture:i,layer:r,level:s}=e;const{gl:o}=this;switch(o.bindTexture(i.target,i.handle),i.target){case 35866:case 32879:De(o).framebufferTextureLayer(36160,n,i.target,s,r);break;case 34067:const l=Tb(r);o.framebufferTexture2D(36160,n,l,i.handle,s);break;case 3553:o.framebufferTexture2D(36160,n,3553,i.handle,s);break;default:k(!1,"Illegal texture type")}o.bindTexture(i.target,null),this.attachments[n]=i}_setReadBuffer(e){const n=JS(this.gl);n?n.readBuffer(e):k(e===36064||e===1029,Gp),this.readBuffer=e}_setDrawBuffers(e){const{gl:n}=this,i=De(n);if(i)i.drawBuffers(e);else{const r=n.getExtension("WEBGL_draw_buffers");r?r.drawBuffersWEBGL(e):k(e.length===1&&(e[0]===36064||e[0]===1029),Gp)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const n=Eb(this.gl);switch(e){case 36052:return n.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return n.WEBGL2?null:8;case 33297:return n.WEBGL2?null:5125;case 33296:return!n.WEBGL2&&!n.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function Tb(t){return t<34069?t+34069:t}function Sb(t){return(_e.STATUS||{})[t]||"Framebuffer error ".concat(t)}const Pb=[36049,36048,33296,33298,33299,33300,33301,33302,33303];_e.ATTACHMENT_PARAMETERS=Pb;function bb(t,e){k(t instanceof We||t instanceof c_||t instanceof ub);const n=t.constructor,{gl:i,width:r,height:s,format:o,type:a,dataFormat:l,border:c,mipmaps:u}=t,f=Object.assign({width:r,height:s,format:o,type:a,dataFormat:l,border:c,mipmaps:u},e);return new n(i,f)}function Ab(t,e){const{gl:n,width:i,height:r,id:s}=t;return new _e(n,Object.assign({},e,{id:"framebuffer-for-".concat(s),width:i,height:r,attachments:{[36064]:t}}))}function Ma(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,i=t.match(n);return i?i[1]:e}const Cb=35632,Lb=35633;function Mb(t){switch(t){case Cb:return"fragment";case Lb:return"vertex";default:return"unknown type"}}function Ib(t,e,n,i){const r=t.split(/\r?\n/),s={},o={},a=i||Ma(e)||"(unnamed)",l="".concat(Mb(n)," shader ").concat(a);for(let u=0;u<r.length;u++){const f=r[u];if(f.length<=1)continue;const h=f.split(":"),g=h[0],p=parseInt(h[2],10);if(isNaN(p))throw new Error("GLSL compilation error in ".concat(l,": ").concat(t));g!=="WARNING"?s[p]=f:o[p]=f}const c=Rb(e);return{shaderName:l,errors:Wp(s,c),warnings:Wp(o,c)}}function Wp(t,e){let n="";for(let i=0;i<e.length;i++){const r=e[i];if(!(!t[i+3]&&!t[i+2]&&!t[i+1])&&(n+="".concat(r,`
`),t[i+1])){const s=t[i+1],o=s.split(":",3),a=o[0],l=parseInt(o[1],10)||0,c=s.substring(o.join(":").length+1).trim();n+=p_("^^^ ".concat(a,": ").concat(c,`

`),l)}}return n}function Rb(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const i=t.split(/\r?\n/),r=String(i.length+e-1).length;return i.map((s,o)=>{const a=String(o+e),l=a.length;return p_(a,r-l)+n+s})}function p_(t,e){let n="";for(let i=0;i<e;++i)n+=" ";return"".concat(n).concat(t)}function m_(t){let e=100;const n=t.match(/[^\s]+/g);if(n.length>=2&&n[0]==="#version"){const i=parseInt(n[1],10);Number.isFinite(i)&&(e=i)}return e}const Ob="Shader: GLSL source code must be a JavaScript string";class $s extends bn{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return k(!1),"unknown"}}constructor(e,n){Xl(e),k(typeof n.source=="string",Ob);const i=Ma(n.source,null)||n.id||en("unnamed ".concat($s.getTypeName(n.shaderType)));super(e,{id:i}),this.shaderType=n.shaderType,this.source=n.source,this.initialize(n)}initialize(e){let{source:n}=e;const i=Ma(n,null);i&&(this.id=en(i)),this._compile(n)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat($s.getTypeName(this.shaderType),":").concat(this.id)}getName(){return Ma(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const i=this.gl.getShaderInfoLog(this.handle),{shaderName:r,errors:s,warnings:o}=Ib(i,this.source,this.shaderType,this.id);throw U.error("GLSL compilation errors in ".concat(r,`
`).concat(s))(),U.warn("GLSL compilation warnings in ".concat(r,`
`).concat(o))(),new Error("GLSL compilation errors in ".concat(r))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class Jc extends $s{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class eu extends $s{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const kb={[5126]:ne.bind(null,"uniform1fv",nt,1,ke),[35664]:ne.bind(null,"uniform2fv",nt,2,ke),[35665]:ne.bind(null,"uniform3fv",nt,3,ke),[35666]:ne.bind(null,"uniform4fv",nt,4,ke),[5124]:ne.bind(null,"uniform1iv",In,1,ke),[35667]:ne.bind(null,"uniform2iv",In,2,ke),[35668]:ne.bind(null,"uniform3iv",In,3,ke),[35669]:ne.bind(null,"uniform4iv",In,4,ke),[35670]:ne.bind(null,"uniform1iv",In,1,ke),[35671]:ne.bind(null,"uniform2iv",In,2,ke),[35672]:ne.bind(null,"uniform3iv",In,3,ke),[35673]:ne.bind(null,"uniform4iv",In,4,ke),[35674]:ne.bind(null,"uniformMatrix2fv",nt,4,cn),[35675]:ne.bind(null,"uniformMatrix3fv",nt,9,cn),[35676]:ne.bind(null,"uniformMatrix4fv",nt,16,cn),[35678]:Ce,[35680]:Ce,[5125]:ne.bind(null,"uniform1uiv",qo,1,ke),[36294]:ne.bind(null,"uniform2uiv",qo,2,ke),[36295]:ne.bind(null,"uniform3uiv",qo,3,ke),[36296]:ne.bind(null,"uniform4uiv",qo,4,ke),[35685]:ne.bind(null,"uniformMatrix2x3fv",nt,6,cn),[35686]:ne.bind(null,"uniformMatrix2x4fv",nt,8,cn),[35687]:ne.bind(null,"uniformMatrix3x2fv",nt,6,cn),[35688]:ne.bind(null,"uniformMatrix3x4fv",nt,12,cn),[35689]:ne.bind(null,"uniformMatrix4x2fv",nt,8,cn),[35690]:ne.bind(null,"uniformMatrix4x3fv",nt,12,cn),[35678]:Ce,[35680]:Ce,[35679]:Ce,[35682]:Ce,[36289]:Ce,[36292]:Ce,[36293]:Ce,[36298]:Ce,[36299]:Ce,[36300]:Ce,[36303]:Ce,[36306]:Ce,[36307]:Ce,[36308]:Ce,[36311]:Ce},Nb={},Fb={},Db={},Hp=[0];function nd(t,e,n,i){e===1&&typeof t=="boolean"&&(t=t?1:0),Number.isFinite(t)&&(Hp[0]=t,t=Hp);const r=t.length;if(r%e&&U.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof n)return t;let s=i[r];s||(s=new n(r),i[r]=s);for(let o=0;o<r;o++)s[o]=t[o];return s}function nt(t,e){return nd(t,e,Float32Array,Nb)}function In(t,e){return nd(t,e,Int32Array,Fb)}function qo(t,e){return nd(t,e,Uint32Array,Db)}function Xp(t,e,n){const i=kb[n.type];if(!i)throw new Error("Unknown GLSL uniform type ".concat(n.type));return i().bind(null,t,e)}function zb(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,n=t.match(e);if(!n||n.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:n[1],length:n[2]||1,isArray:Boolean(n[2])}}function Ub(t,e,n){for(const i in t){const r=t[i];if((!n||Boolean(n[i]))&&!Bb(r))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(i),r),new Error("".concat(e," Bad uniform ").concat(i))}return!0}function Bb(t){return Array.isArray(t)||ArrayBuffer.isView(t)?jb(t):isFinite(t)||t===!0||t===!1||t instanceof Ai||t instanceof ir?!0:t instanceof _e?Boolean(t.texture):!1}function Vb(t,e,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(t[e]){const i=t[e];for(let r=0,s=n.length;r<s;++r)i[r]=n[r]}else t[e]=n.slice();else t[e]=n}function jb(t){if(t.length===0)return!1;const e=Math.min(t.length,16);for(let n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Ce(){let t=null;return(e,n,i)=>{const r=t!==i;return r&&(e.uniform1i(n,i),t=i),r}}function ne(t,e,n,i){let r=null,s=null;return(o,a,l)=>{const c=e(l,n),u=c.length;let f=!1;if(r===null)r=new Float32Array(u),s=u,f=!0;else{k(s===u,"Uniform length cannot change.");for(let h=0;h<u;++h)if(c[h]!==r[h]){f=!0;break}}return f&&(i(o,t,a,c),r.set(c)),f}}function ke(t,e,n,i){t[e](n,i)}function cn(t,e,n,i){t[e](n,!1,i)}const Gb=5120,Wb=5121,Hb=5122,Xb=5123,Yp=0,Qo=1,Yb=2,Zb=3,Jo=4,$b=5,Kb=6,we=5126,qb=35664,Qb=35665,Jb=35666,is=5124,eA=35667,tA=35668,nA=35669,rs=5125,iA=36294,rA=36295,sA=36296,oA=35670,aA=35671,lA=35672,cA=35673,uA=35674,fA=35675,hA=35676,dA=35685,gA=35686,pA=35687,mA=35688,vA=35689,yA=35690,Af={[we]:[we,1,"float"],[qb]:[we,2,"vec2"],[Qb]:[we,3,"vec3"],[Jb]:[we,4,"vec4"],[is]:[is,1,"int"],[eA]:[is,2,"ivec2"],[tA]:[is,3,"ivec3"],[nA]:[is,4,"ivec4"],[rs]:[rs,1,"uint"],[iA]:[rs,2,"uvec2"],[rA]:[rs,3,"uvec3"],[sA]:[rs,4,"uvec4"],[oA]:[we,1,"bool"],[aA]:[we,2,"bvec2"],[lA]:[we,3,"bvec3"],[cA]:[we,4,"bvec4"],[uA]:[we,8,"mat2"],[dA]:[we,8,"mat2x3"],[gA]:[we,8,"mat2x4"],[fA]:[we,12,"mat3"],[pA]:[we,12,"mat3x2"],[mA]:[we,12,"mat3x4"],[hA]:[we,16,"mat4"],[vA]:[we,16,"mat4x2"],[yA]:[we,16,"mat4x3"]};function _A(t){switch(t){case Yp:return Yp;case Qo:return Qo;case Zb:return Qo;case Yb:return Qo;case Jo:return Jo;case $b:return Jo;case Kb:return Jo;default:return k(!1),0}}function Zp(t){const e=Af[t];if(!e)return null;const[n,i]=e;return{type:n,components:i}}function v_(t,e){switch(t){case Gb:case Wb:case Hb:case Xb:t=we;break}for(const n in Af){const[i,r,s]=Af[n];if(i===t&&r===e)return{glType:n,name:s}}return null}class wA{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const n=Number(e);return Number.isFinite(n)?this.attributeInfosByLocation[n]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const n=this.getAttributeInfo(e);return n?n.location:-1}getAttributeAccessor(e){const n=this.getAttributeInfo(e);return n?n.accessor:null}getVaryingInfo(e){const n=Number(e);return Number.isFinite(n)?this.varyingInfos[n]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const n=this.getVaryingInfo();return n?n.location:-1}getVaryingAccessor(e){const n=this.getVaryingInfo();return n?n.accessor:null}_readAttributesFromProgram(e){const{gl:n}=e,i=n.getProgramParameter(e.handle,35721);for(let r=0;r<i;r++){const{name:s,type:o,size:a}=n.getActiveAttrib(e.handle,r),l=n.getAttribLocation(e.handle,s);l>=0&&this._addAttribute(l,s,o,a)}this.attributeInfos.sort((r,s)=>r.location-s.location)}_readVaryingsFromProgram(e){const{gl:n}=e;if(!Y(n))return;const i=n.getProgramParameter(e.handle,35971);for(let r=0;r<i;r++){const{name:s,type:o,size:a}=n.getTransformFeedbackVarying(e.handle,r);this._addVarying(r,s,o,a)}this.varyingInfos.sort((r,s)=>r.location-s.location)}_addAttribute(e,n,i,r){const{type:s,components:o}=Zp(i),a={type:s,size:r*o};this._inferProperties(e,n,a);const l={location:e,name:n,accessor:new ot(a)};this.attributeInfos.push(l),this.attributeInfosByLocation[e]=l,this.attributeInfosByName[l.name]=l}_inferProperties(e,n,i){/instance/i.test(n)&&(i.divisor=1)}_addVarying(e,n,i,r){const{type:s,components:o}=Zp(i),a=new ot({type:s,size:r*o}),l={location:e,name:n,accessor:a};this.varyingInfos.push(l),this.varyingInfosByName[l.name]=l}}const $p=4,EA=35981,xA=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class y_ extends bn{get[Symbol.toStringTag](){return"Program"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Program","v6.0",xA),this._isCached=!1,this.initialize(n),Object.seal(this),this._setId(n.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:n,vs:i,fs:r,varyings:s,bufferMode:o=EA}=e;return this.hash=n||"",this.vs=typeof i=="string"?new Jc(this.gl,{id:"".concat(e.id,"-vs"),source:i}):i,this.fs=typeof r=="string"?new eu(this.gl,{id:"".concat(e.id,"-fs"),source:r}):r,k(this.vs instanceof Jc),k(this.fs instanceof eu),this.uniforms={},this._textureUniforms={},s&&s.length>0&&(De(this.gl),this.varyings=s,this.gl2.transformFeedbackVaryings(this.handle,s,o)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new wA(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:n,drawMode:i=4,vertexCount:r,offset:s=0,start:o,end:a,isIndexed:l=!1,indexType:c=5123,instanceCount:u=0,isInstanced:f=u>0,vertexArray:h=null,transformFeedback:g,framebuffer:p,parameters:w={},uniforms:x,samplers:y}=e;if((x||y)&&(U.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(x||{})),U.priority>=n){const m=p?p.id:"default",_="mode=".concat(qn(this.gl,i)," verts=").concat(r," ")+"instances=".concat(u," indexType=").concat(qn(this.gl,c)," ")+"isInstanced=".concat(f," isIndexed=").concat(l," ")+"Framebuffer=".concat(m);U.log(n,_)()}return k(h),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||r===0||f&&u===0?!1:(h.bindForDraw(r,u,()=>{if(p!==void 0&&(w=Object.assign({},w,{framebuffer:p})),g){const m=_A(i);g.begin(m)}this._bindTextures(),xt(this.gl,w,()=>{l&&f?this.gl2.drawElementsInstanced(i,r,c,s,u):l&&Y(this.gl)&&!isNaN(o)&&!isNaN(a)?this.gl2.drawRangeElements(i,o,a,r,c,s):l?this.gl.drawElements(i,r,c,s):f?this.gl2.drawArraysInstanced(i,s,r,u):this.gl.drawArrays(i,s,r)}),g&&g.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};U.priority>=2&&Ub(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const n in e){const i=e[n],r=this._uniformSetters[n];if(r){let s=i,o=!1;if(s instanceof _e&&(s=s.texture),s instanceof Ai)if(o=this.uniforms[n]!==i,o){r.textureIndex===void 0&&(r.textureIndex=this._textureIndexCounter++);const a=s,{textureIndex:l}=r;a.bind(l),s=l,this._textureUniforms[n]=a}else s=r.textureIndex;else this._textureUniforms[n]&&delete this._textureUniforms[n];(r(s)||o)&&Vb(this.uniforms,n,i)}}return this}_areTexturesRenderable(){let e=!0;for(const n in this._textureUniforms){const i=this._textureUniforms[n];i.update(),e=e&&i.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const n=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(n)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const n=this.gl.getAttachedShaders(e),i={};for(const r of n)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:i.vs=new Jc({handle:r});break;case 35632:i.fs=new eu({handle:r});break}return i}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const n=this._getName();this.id=en(n)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),U.time($p,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),U.timeEnd($p,"linkProgram for ".concat(this._getName()))(),e.debug||U.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let n=0;n<this._uniformCount;n++){const i=this.gl.getActiveUniform(this.handle,n),{name:r}=zb(i.name);let s=e.getUniformLocation(this.handle,r);if(this._uniformSetters[r]=Xp(e,s,i),i.size>1)for(let o=0;o<i.size;o++)s=e.getUniformLocation(this.handle,"".concat(r,"[").concat(o,"]")),this._uniformSetters["".concat(r,"[").concat(o,"]")]=Xp(e,s,i)}this._textureIndexCounter=0}getActiveUniforms(e,n){return this.gl2.getActiveUniforms(this.handle,e,n)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,n){return this.gl2.getActiveUniformBlockParameter(this.handle,e,n)}uniformBlockBinding(e,n){this.gl2.uniformBlockBinding(this.handle,e,n)}}const TA=34918,SA=34919,PA=35007,bA=36795,AA=35976,CA=35887,LA=36202;class gl extends bn{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const i=Y(e),r=td(e,ee.TIMER_QUERY);let s=i||r;for(const o of n)switch(o){case"queries":s=s&&i;break;case"timers":s=s&&r;break;default:k(!1)}return s}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(PA)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?LA:CA)}beginTransformFeedbackQuery(){return this.begin(AA)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,SA);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(bA)}getResult(){return this.gl2.getQueryParameter(this.handle,TA)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((i,r)=>{const s=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):n++>e?(r("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}_createHandle(){return gl.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class __ extends bn{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return Y(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};De(e),super(e,n),this.initialize(n),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,Sr(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const n in e)this.setBuffer(n,e[n])}),this}setBuffer(e,n){const i=this._getVaryingIndex(e),{buffer:r,byteSize:s,byteOffset:o}=this._getBufferParams(n);return i<0?(this.unused[e]=r,U.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[i]=n,this.bindOnUse||this._bindBuffer(i,r,o,s),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let n,i,r;return e instanceof Q?r=e:(r=e.buffer,i=e.byteSize,n=e.byteOffset),(n!==void 0||i!==void 0)&&(n=n||0,i=i||r.byteLength-n),{buffer:r,byteOffset:n,byteSize:i}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const n=Number(e);return Number.isFinite(n)?n:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:n,byteSize:i,byteOffset:r}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,n,r,i)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;const s=n&&n.handle;return!s||r===void 0?this.gl.bindBufferBase(35982,e,s):this.gl.bindBufferRange(35982,e,s,i,r),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let ea=null;function MA(t){return(!ea||ea.byteLength<t)&&(ea=new ArrayBuffer(t)),ea}function IA(t,e){const n=MA(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function RA(t){let{target:e,source:n,start:i=0,count:r=1}=t;const s=n.length,o=r*s;let a=0;for(let l=i;a<s;a++)e[l++]=n[a];for(;a<o;)a<o-a?(e.copyWithin(i+a,i,i+a),a*=2):(e.copyWithin(i+a,i,i+o-a),a=o);return e}const OA="elements must be GL.ELEMENT_ARRAY_BUFFER";class it extends bn{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?Y(e)||zy()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new it(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return it.MAX_ATTRIBUTES=it.MAX_ATTRIBUTES||e.getParameter(34921),it.MAX_ATTRIBUTES}static setConstant(e,n,i){switch(i.constructor){case Float32Array:it._setConstantFloatArray(e,n,i);break;case Int32Array:it._setConstantIntArray(e,n,i);break;case Uint32Array:it._setConstantUintArray(e,n,i);break;default:k(!1)}}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=n.id||n.program&&n.program.id;super(e,Object.assign({},n,{id:i})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=n.isDefaultArray||!1,this.gl2=e,this.initialize(n),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return it.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return k(!e||e.target===34963,OA),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,n,i){if(n.target===34963)return this.setElementBuffer(n,i);const{size:r,type:s,stride:o,offset:a,normalized:l,integer:c,divisor:u}=i,{gl:f,gl2:h}=this;return e=Number(e),this.bind(()=>{f.bindBuffer(34962,n.handle),c?(k(Y(f)),h.vertexAttribIPointer(e,r,s,o,a)):f.vertexAttribPointer(e,r,s,l,o,a),f.enableVertexAttribArray(e),h.vertexAttribDivisor(e,u||0)}),this}enable(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!n&&e===0&&!it.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>n?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,n){const i=this._normalizeConstantArrayValue(n),r=i.byteLength*e,s=i.length*e;let o=!this.buffer;if(this.buffer=this.buffer||new Q(this.gl,r),o=o||this.buffer.reallocate(r),o=o||!this._compareConstantArrayValues(i,this.bufferValue),o){const a=IA(n.constructor,s);RA({target:a,source:i,start:0,count:s}),this.buffer.subData(a),this.bufferValue=n}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,n){if(!e||!n||e.length!==n.length||e.constructor!==n.constructor)return!1;for(let i=0;i<e.length;++i)if(e[i]!==n[i])return!1;return!0}static _setConstantFloatArray(e,n,i){switch(i.length){case 1:e.vertexAttrib1fv(n,i);break;case 2:e.vertexAttrib2fv(n,i);break;case 3:e.vertexAttrib3fv(n,i);break;case 4:e.vertexAttrib4fv(n,i);break;default:k(!1)}}static _setConstantIntArray(e,n,i){switch(k(Y(e)),i.length){case 1:e.vertexAttribI1iv(n,i);break;case 2:e.vertexAttribI2iv(n,i);break;case 3:e.vertexAttribI3iv(n,i);break;case 4:e.vertexAttribI4iv(n,i);break;default:k(!1)}}static _setConstantUintArray(e,n,i){switch(k(Y(e)),i.length){case 1:e.vertexAttribI1uiv(n,i);break;case 2:e.vertexAttribI2uiv(n,i);break;case 3:e.vertexAttribI3uiv(n,i);break;case 4:e.vertexAttribI4uiv(n,i);break;default:k(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,n){let{location:i}=n;return k(Number.isFinite(i)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(i,e);default:return this.gl.getVertexAttrib(i,e)}})}}const kA="VertexArray: attributes must be Buffers or constants (i.e. typed array)",NA=/^(.+)__LOCATION_([0-9]+)$/,FA=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class DA{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=n.id||n.program&&n.program.id;this.id=i,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new it(e),s_(this,"VertexArray","v6.0",FA),this.initialize(n),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const n in e){const i=e[n];this._setAttribute(n,i)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=n,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,n),this}setBuffer(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n.target===34963)return this.setElementBuffer(n,i);const{location:r,accessor:s}=this._resolveLocationAndAccessor(e,n,n.accessor,i);return r>=0&&(this.values[r]=n,this.accessors[r]=s,this.clearDrawParams(),this.vertexArrayObject.setBuffer(r,n,s)),this}setConstant(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:r,accessor:s}=this._resolveLocationAndAccessor(e,n,Object.assign({size:n.length},i));return r>=0&&(n=this.vertexArrayObject._normalizeConstantArrayValue(n),this.values[r]=n,this.accessors[r]=s,this.clearDrawParams(),this.vertexArrayObject.enable(r,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new Q(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof Q&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const n=this.values[e];n instanceof Q&&this.setBuffer(e,n)}}),this}bindForDraw(e,n,i){let r;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,n),r=i()}),r}_resolveLocationAndAccessor(e,n,i,r){const s={location:-1,accessor:null},{location:o,name:a}=this._getAttributeIndex(e);if(!Number.isFinite(o)||o<0)return this.unused[e]=n,U.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),s;const l=this._getAttributeInfo(a||o);if(!l)return s;const c=this.accessors[o]||{},u=ot.resolve(l.accessor,c,i,r),{size:f,type:h}=u;return k(Number.isFinite(f)&&Number.isFinite(h)),{location:o,accessor:u}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const n=Number(e);if(Number.isFinite(n))return{location:n};const i=NA.exec(e),r=i?i[1]:e,s=i?Number(i[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(r)+s,name:r}:{location:-1}}_setAttribute(e,n){if(n instanceof Q)this.setBuffer(e,n);else if(Array.isArray(n)&&n.length&&n[0]instanceof Q){const i=n[0],r=n[1];this.setBuffer(e,i,r)}else if(ArrayBuffer.isView(n)||Array.isArray(n)){const i=n;this.setConstant(e,i)}else if(n.buffer instanceof Q){const i=n;this.setBuffer(e,i.buffer,i)}else throw new Error(kA)}_setConstantAttributes(e,n){const i=Math.max(e|0,n|0);let r=this.values[0];ArrayBuffer.isView(r)&&this._setConstantAttributeZero(r,i);for(let s=1;s<this.vertexArrayObject.MAX_ATTRIBUTES;s++)r=this.values[s],ArrayBuffer.isView(r)&&this._setConstantAttribute(s,r)}_setConstantAttributeZero(e,n){if(it.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const i=this.vertexArrayObject.getConstantBuffer(n,e);this.vertexArrayObject.setBuffer(0,i,this.accessors[0])}_setConstantAttribute(e,n){it.setConstant(this.gl,e,n)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let n=0;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)this._updateDrawParamsForLocation(e,n);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,n){const i=this.values[n],r=this.accessors[n];if(!i)return;const{divisor:s}=r,o=s>0;if(e.isInstanced=e.isInstanced||o,i instanceof Q){const a=i;if(o){const l=a.getVertexCount(r);e.instanceCount=Math.min(e.instanceCount,l)}else{const l=a.getVertexCount(r);e.vertexCount=Math.min(e.vertexCount,l)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return U.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,n)}}function zA(t,e){const{maxElts:n=16,size:i=1}=e;let r="[";for(let o=0;o<t.length&&o<n;++o)o>0&&(r+=",".concat(o%i===0?" ":"")),r+=Ks(t[o],e);const s=t.length>n?"...":"]";return"".concat(r).concat(s)}function Ks(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=1e-16,{isInteger:i=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return zA(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<n)return i?"0":"0.";if(i||Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const r=t.toPrecision(2);return r.indexOf(".0")===r.length-2?r.slice(0,-1):r}function Kp(t){let{header:e="Uniforms",program:n,uniforms:i,undefinedOnly:r=!1}=t;k(n);const s=".*_.*",o=".*Matrix",a=n._uniformSetters,l={},c=Object.keys(a).sort();let u=0;for(const g of c)!g.match(s)&&!g.match(o)&&tu({table:l,header:e,uniforms:i,uniformName:g,undefinedOnly:r})&&u++;for(const g of c)g.match(o)&&tu({table:l,header:e,uniforms:i,uniformName:g,undefinedOnly:r})&&u++;for(const g of c)l[g]||tu({table:l,header:e,uniforms:i,uniformName:g,undefinedOnly:r})&&u++;let f=0;const h={};if(!r)for(const g in i){const p=i[g];l[g]||(f++,h[g]={Type:"NOT USED: ".concat(p),[e]:Ks(p)})}return{table:l,count:u,unusedTable:h,unusedCount:f}}function tu(t){let{table:e,header:n,uniforms:i,uniformName:r,undefinedOnly:s}=t;const o=i[r],a=UA(o);return!s||!a?(e[r]={[n]:a?Ks(o):"N/A","Uniform Type":a?o:"NOT PROVIDED"},!0):!1}function UA(t){return t!=null}function BA(t){let{vertexArray:e,header:n="Attributes"}=t;if(!e.configuration)return{};const i={};e.elements&&(i.ELEMENT_ARRAY_BUFFER=qp(e,e.elements,null,n));const r=e.values;for(const s in r){const o=e._getAttributeInfo(s);if(o){let a="".concat(s,": ").concat(o.name);const l=e.accessors[o.location];l&&(a="".concat(s,": ").concat(VA(o.name,l))),i[a]=qp(e,r[s],l,n)}}return i}function qp(t,e,n,i){const{gl:r}=t;if(!e)return{[i]:"null","Format ":"N/A"};let s="NOT PROVIDED",o=1,a=0,l=0,c,u,f;if(n&&(s=n.type,o=n.size,s=String(s).replace("Array",""),c=s.indexOf("nt")!==-1),e instanceof Q){const h=e,{data:g,changed:p}=h.getDebugData();u=p?"*":"",f=g,l=h.byteLength,a=l/g.BYTES_PER_ELEMENT/o;let w;if(n){const x=n.divisor>0;w="".concat(x?"I ":"P "," ").concat(a," (x").concat(o,"=").concat(l," bytes ").concat(qn(r,s),")")}else c=!0,w="".concat(l," bytes");return{[i]:"".concat(u).concat(Ks(f,{size:o,isInteger:c})),"Format ":w}}return f=e,o=e.length,s=String(e.constructor.name).replace("Array",""),c=s.indexOf("nt")!==-1,{[i]:"".concat(Ks(f,{size:o,isInteger:c})," (constant)"),"Format ":"".concat(o,"x").concat(s," (constant)")}}function VA(t,e){const{type:n,size:i}=e,r=v_(n,i);return r?"".concat(t," (").concat(r.name,")"):t}function jA(t){const e={},n="Accessors for ".concat(t.id);for(const i of t.attributeInfos)if(i){const r=Qp(i);e["in ".concat(r)]={[n]:JSON.stringify(i.accessor)}}for(const i of t.varyingInfos)if(i){const r=Qp(i);e["out ".concat(r)]={[n]:JSON.stringify(i.accessor)}}return e}function Qp(t){const{type:e,size:n}=t.accessor,i=v_(e,n);return i?"".concat(i.name," ").concat(t.name):t.name}const Jp=Pn()&&typeof document!="undefined";let GA=0;class WA{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:n=x=>r_(x),onAddHTML:i=null,onInitialize:r=()=>{},onRender:s=()=>{},onFinalize:o=()=>{},onError:a,gl:l=null,glOptions:c={},debug:u=!1,createFramebuffer:f=!1,autoResizeViewport:h=!0,autoResizeDrawingBuffer:g=!0,stats:p=vi.get("animation-loop-".concat(GA++))}=e;let{useDevicePixels:w=!0}=e;"useDevicePixelRatio"in e&&(U.deprecated("useDevicePixelRatio","useDevicePixels")(),w=e.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:i,onInitialize:r,onRender:s,onFinalize:o,onError:a,gl:l,glOptions:c,debug:u,createFramebuffer:f},this.gl=l,this.needsRedraw=null,this.timeline=null,this.stats=p,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:h,autoResizeDrawingBuffer:g,useDevicePixels:w}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return k(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const n=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=gl.isSupported(this.gl,["timers"])?new gl(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(i=>{this._running&&(this._addCallbackData(i||{}),i!==!1&&this._startLoop())});return this.props.onError&&n.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.getElementById(e);return i?Number(i.value):n}setViewParameters(){return U.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{!this._running||(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=Jp?new Promise((e,n)=>{if(Jp&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):qP(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):KP(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:n,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas!="undefined"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?Qh(this.props.gl,e):this.onCreateContext(e),!Hl(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");DP(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(n);const i=this.props.onAddHTML(n);i&&(n.innerHTML=i)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,n=this.gl.drawingBufferHeight;let i=1;const{canvas:r}=this.gl;return r&&r.clientHeight?i=r.clientWidth/r.clientHeight:e>0&&n>0&&(i=e/n),{width:e,height:n,aspect:i}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&jP(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new _e(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const go="vs",id="fs";function ct(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const nu={number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},array:{validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function HA(t){const e={};for(const n in t){const i=t[n],r=XA(i);e[n]=r}return e}function XA(t){let e=em(t);return e==="object"?t?"type"in t?Object.assign({},t,nu[t.type]):"value"in t?(e=em(t.value),Object.assign({type:e},t,nu[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},nu[e])}function em(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const YA="vs",ZA="fs";class tm{constructor(e){let{name:n,vs:i,fs:r,dependencies:s=[],uniforms:o,getUniforms:a,deprecations:l=[],defines:c={},inject:u={},vertexShader:f,fragmentShader:h}=e;ct(typeof n=="string"),this.name=n,this.vs=i||f,this.fs=r||h,this.getModuleUniforms=a,this.dependencies=s,this.deprecations=this._parseDeprecationDefinitions(l),this.defines=c,this.injections=$A(u),o&&(this.uniforms=HA(o))}getModuleSource(e){let n;switch(e){case YA:n=this.vs||"";break;case ZA:n=this.fs||"";break;default:ct(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(n,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(i=>{i.regex.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp("\\b".concat(n.old,"\\("));break;default:n.regex=new RegExp("".concat(n.type," ").concat(n.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={},i=this.uniforms;for(const r in i){const s=i[r];r in e&&!s.private?(s.validate&&ct(s.validate(e[r],s),"".concat(this.name,": invalid ").concat(r)),n[r]=e[r]):n[r]=s.value}return n}}function $A(t){const e={vs:{},fs:{}};for(const n in t){let i=t[n];const r=n.slice(0,2);typeof i=="string"&&(i={order:0,injection:i}),e[r][n]=i}return e}function KA(t){return qA(E_(t))}function qA(t){const e={},n={};return w_({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((i,r)=>n[r]-n[i]).map(i=>e[i])}function w_(t){let{modules:e,level:n,moduleMap:i,moduleDepth:r}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)i[s.name]=s,(r[s.name]===void 0||r[s.name]<n)&&(r[s.name]=n);for(const s of e)s.dependencies&&w_({modules:s.dependencies,level:n+1,moduleMap:i,moduleDepth:r})}function E_(t,e){return t.map(n=>(n instanceof tm||(ct(typeof n!="string","Shader module use by name is deprecated. Import shader module '".concat(n,"' and use it directly.")),ct(n.name,"shader module has no name"),n=new tm(n),n.dependencies=E_(n.dependencies)),n))}function QA(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window!="undefined"?window.navigator||{}:{},n=t.userAgent||e.userAgent||"",i=n.indexOf("MSIE ")!==-1,r=n.indexOf("Trident/")!==-1;return i||r}const JA=7936,eC=7937,tC=7938,nC=35724,rd={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},di={};Object.keys(rd).forEach(t=>{di[t]=t});function iC(t){return typeof WebGL2RenderingContext!="undefined"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&t._version===2)}function rC(t){const e=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||JA),i=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||eC);return{gpuVendor:sC(n,i),vendor:n,renderer:i,version:t.getParameter(tC),shadingLanguageVersion:t.getParameter(nC)}}function sC(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const iu={};function nm(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=rd[e];if(ct(i,e),!QA(n))return!0;if(e in iu)return iu[e];const r=i[0],s=n.behavior||"enable",o="#extension GL_".concat(r," : ").concat(s,`
void main(void) {}`),a=t.createShader(35633);t.shaderSource(a,o),t.compileShader(a);const l=t.getShaderParameter(a,35713);return t.deleteShader(a),iu[e]=l,l}function oC(t,e){const n=rd[e];ct(n,e);const i=iC(t)&&n[1]||n[0],r=typeof i=="string"?Boolean(t.getExtension(i)):i;return ct(r===!1||r===!0),r}function ta(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>oC(t,n))}function aC(t){switch(rC(t).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function lC(t,e,n){let i=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return ta(t,di.GLSL_FRAG_DEPTH)&&(i+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),ta(t,di.GLSL_DERIVATIVES)&&nm(t,di.GLSL_DERIVATIVES)&&(i+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),ta(t,di.GLSL_FRAG_DATA)&&nm(t,di.GLSL_FRAG_DATA,{behavior:"require"})&&(i+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),ta(t,di.GLSL_TEXTURE_LOD)&&(i+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),i}const cC=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,uC=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,fC={[go]:cC,[id]:uC},Ia="__LUMA_INJECT_DECLARATIONS__",im=/void\s+main\s*\([^)]*\)\s*\{\n?/,rm=/}\n?[^{}]*$/,ru=[];function sm(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=e===go;for(const s in n){const o=n[s];o.sort((l,c)=>l.order-c.order),ru.length=o.length;for(let l=0,c=o.length;l<c;++l)ru[l]=o[l].injection;const a="".concat(ru.join(`
`),`
`);switch(s){case"vs:#decl":r&&(t=t.replace(Ia,a));break;case"vs:#main-start":r&&(t=t.replace(im,l=>l+a));break;case"vs:#main-end":r&&(t=t.replace(rm,l=>a+l));break;case"fs:#decl":r||(t=t.replace(Ia,a));break;case"fs:#main-start":r||(t=t.replace(im,l=>l+a));break;case"fs:#main-end":r||(t=t.replace(rm,l=>a+l));break;default:t=t.replace(s,l=>l+a)}}return t=t.replace(Ia,""),i&&(t=t.replace(/\}\s*$/,s=>s+fC[e])),t}function Cf(t){const e={};return ct(Array.isArray(t)&&t.length>1),t.forEach(n=>{for(const i in n)e[i]=e[i]?"".concat(e[i],`
`).concat(n[i]):n[i]}),e}function Pr(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const x_=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],hC=[...x_,[Pr("attribute"),"in $1"],[Pr("varying"),"out $1"]],dC=[...x_,[Pr("varying"),"in $1"]],T_=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],gC=[...T_,[Pr("in"),"attribute $1"],[Pr("out"),"varying $1"]],pC=[...T_,[Pr("in"),"varying $1"]],Lf="gl_FragColor",Mf=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,mC=/void\s+main\s*\([^)]*\)\s*\{\n?/;function vC(t,e,n){switch(e){case 300:return n?pl(t,hC):yC(t);case 100:return n?pl(t,gC):_C(t);default:throw new Error("unknown GLSL version ".concat(e))}}function pl(t,e){for(const[n,i]of e)t=t.replace(n,i);return t}function yC(t){t=pl(t,dC);const e=t.match(Mf);if(e){const n=e[1];t=t.replace(new RegExp("\\b".concat(Lf,"\\b"),"g"),n)}else{const n="fragmentColor";t=t.replace(mC,i=>"out vec4 ".concat(n,`;
`).concat(i)).replace(new RegExp("\\b".concat(Lf,"\\b"),"g"),n)}return t}function _C(t){t=pl(t,pC);const e=t.match(Mf);if(e){const n=e[1];t=t.replace(Mf,"").replace(new RegExp("\\b".concat(n,"\\b"),"g"),Lf)}return t}const wC=`

`.concat(Ia,`

`),S_={[go]:"vertex",[id]:"fragment"},EC=`precision highp float;

`;function xC(t,e){const{vs:n,fs:i}=e,r=KA(e.modules||[]);return{gl:t,vs:om(t,Object.assign({},e,{source:n,type:go,modules:r})),fs:om(t,Object.assign({},e,{source:i,type:id,modules:r})),getUniforms:TC(r)}}function om(t,e){let{id:n,source:i,type:r,modules:s,defines:o={},hookFunctions:a=[],inject:l={},transpileToGLSL100:c=!1,prologue:u=!0,log:f}=e;ct(typeof i=="string","shader source must be a string");const h=r===go,g=i.split(`
`);let p=100,w="",x=i;g[0].indexOf("#version ")===0?(p=300,w=g[0],x=g.slice(1).join(`
`)):w="#version ".concat(p);const y={};s.forEach(C=>{Object.assign(y,C.getDefines())}),Object.assign(y,o);let m=u?"".concat(w,`
`).concat(PC({id:n,source:i,type:r}),`
`).concat(SC({type:r}),`
`).concat(aC(t),`
`).concat(lC(t),`
`).concat(bC(y),`
`).concat(h?"":EC,`
`):"".concat(w,`
`);const _=CC(a),T={},P={},A={};for(const C in l){const M=typeof l[C]=="string"?{injection:l[C],order:0}:l[C],R=C.match(/^(v|f)s:(#)?([\w-]+)$/);if(R){const O=R[2],z=R[3];O?z==="decl"?P[C]=[M]:A[C]=[M]:T[C]=[M]}else A[C]=[M]}for(const C of s){f&&C.checkDeprecations(x,f),m+=C.getModuleSource(r,p);const R=C.injections[r];for(const O in R){const z=O.match(/^(v|f)s:#([\w-]+)$/);if(z){const B=z[2]==="decl"?P:A;B[O]=B[O]||[],B[O].push(R[O])}else T[O]=T[O]||[],T[O].push(R[O])}}return m+=wC,m=sm(m,r,P),m+=AC(_[r],T),m+=x,m=sm(m,r,A),m=vC(m,c?100:p,h),m}function TC(t){return function(n){const i={};for(const r of t){const s=r.getUniforms(n,i);Object.assign(i,s)}return i}}function SC(t){let{type:e}=t;return`
#define SHADER_TYPE_`.concat(S_[e].toUpperCase(),`
`)}function PC(t){let{id:e,source:n,type:i}=t;return e&&typeof e=="string"&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(S_[i],`

`):""}function bC(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,n="";for(const i in t){e===0&&(n+=`
// APPLICATION DEFINES
`),e++;const r=t[i];(r||Number.isFinite(r))&&(n+="#define ".concat(i.toUpperCase()," ").concat(t[i],`
`))}return e===0&&(n+=`
`),n}function AC(t,e){let n="";for(const i in t){const r=t[i];if(n+="void ".concat(r.signature,` {
`),r.header&&(n+="  ".concat(r.header)),e[i]){const s=e[i];s.sort((o,a)=>o.order-a.order);for(const o of s)n+="  ".concat(o.injection,`
`)}r.footer&&(n+="  ".concat(r.footer)),n+=`}
`}return n}function CC(t){const e={vs:{},fs:{}};return t.forEach(n=>{let i;typeof n!="string"?(i=n,n=i.hook):i={},n=n.trim();const[r,s]=n.split(":"),o=n.replace(/\(.+/,"");e[r][o]=Object.assign(i,{signature:s})}),e}const LC="void main() {gl_FragColor = vec4(0);}",P_=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,MC=`#version 300 es
`.concat(P_);function b_(t,e){e=Array.isArray(e)?e:[e];const n=t.replace(/^\s+/,"").split(/\s+/),[i,r,s]=n;if(!e.includes(i)||!r||!s)return null;const o=s.split(";")[0];return{qualifier:i,type:r,name:o}}function A_(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:n,inputType:i,output:r}=t;if(!n)return e===300?MC:e>300?"#version ".concat(e,`
`).concat(P_):LC;const s=OC(n,i);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(i," ").concat(n,`;
out vec4 `).concat(r,`;
void main() {
  `).concat(r," = ").concat(s,`;
}`):"varying ".concat(i," ").concat(n,`;
void main() {
  gl_FragColor = `).concat(s,`;
}`)}function IC(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return ct(!1),null}}function RC(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return ct(!1),null}}function OC(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return ct(!1),null}}const kC=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,NC={name:"fp32",vs:kC,fs:null};function am(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const FC=1/Math.PI*180,DC=1/180*Math.PI,qe={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function C_(t,{precision:e=qe.precision}={}){return t=zC(t),"".concat(parseFloat(t.toPrecision(e)))}function br(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function na(t,e){return sd(t,n=>n*DC,e)}function Bi(t,e){return sd(t,n=>n*FC,e)}function pe(t,e,n){return sd(t,i=>Math.max(e,Math.min(n,i)))}function wi(t,e,n){return br(t)?t.map((i,r)=>wi(i,e[r],n)):n*e+(1-n)*t}function mn(t,e,n){const i=qe.EPSILON;n&&(qe.EPSILON=n);try{if(t===e)return!0;if(br(t)&&br(e)){if(t.length!==e.length)return!1;for(let r=0;r<t.length;++r)if(!mn(t[r],e[r]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=qe.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{qe.EPSILON=i}}function zC(t){return Math.round(t/qe.EPSILON)*qe.EPSILON}function UC(t){return t.clone?t.clone():new Array(t.length)}function sd(t,e,n){if(br(t)){const i=t;n=n||UC(i);for(let r=0;r<n.length&&r<i.length;++r)n[r]=e(t[r],r,n);return n}return e(t)}function BC(t){function e(){var n=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}class L_ extends BC(Array){clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+n];return this.check()}toArray(e=[],n=0){for(let i=0;i<this.ELEMENTS;++i)e[n+i]=this[i];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:br(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(qe)}formatString(e){let n="";for(let i=0;i<this.ELEMENTS;++i)n+=(i>0?", ":"")+C_(this[i],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!mn(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,i){if(i===void 0)return this.lerp(this,e,n);for(let r=0;r<this.ELEMENTS;++r){const s=e[r];this[r]=s+i*(n[r]-s)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),n[i]);return this.check()}add(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=n[i];return this.check()}subtract(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=n[i];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(qe.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),n);return this.check()}get elements(){return this}}function VC(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function st(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function su(t,e,n=""){if(qe.debug&&!VC(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}class jC extends L_{get x(){return this[0]}set x(e){this[0]=st(e)}get y(){return this[1]}set y(e){this[1]=st(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let i=0;i<this.ELEMENTS;++i){const r=this[i]-e[i];n+=r*r}return st(n)}dot(e){let n=0;for(let i=0;i<this.ELEMENTS;++i)n+=this[i]*e[i];return st(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=n[i];return this.check()}divide(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=n[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return am(e>=0&&e<this.ELEMENTS,"index is out of range"),st(this[e])}setComponent(e,n){return am(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}var Ra=1e-6,Ar=typeof Float32Array!="undefined"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function GC(){var t=new Ar(2);return Ar!=Float32Array&&(t[0]=0,t[1]=0),t}function ml(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function M_(t,e){return t[0]=-e[0],t[1]=-e[1],t}function I_(t,e,n,i){var r=e[0],s=e[1];return t[0]=r+i*(n[0]-r),t[1]=s+i*(n[1]-s),t}function WC(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t}(function(){var t=GC();return function(e,n,i,r,s,o){var a,l;for(n||(n=2),i||(i=0),r?l=Math.min(r*n+i,e.length):l=e.length,a=i;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],s(t,t,o),e[a]=t[0],e[a+1]=t[1];return e}})();function HC(t,e,n){const i=e[0],r=e[1],s=n[3]*i+n[7]*r||1;return t[0]=(n[0]*i+n[4]*r)/s,t[1]=(n[1]*i+n[5]*r)/s,t}function R_(t,e,n){const i=e[0],r=e[1],s=e[2],o=n[3]*i+n[7]*r+n[11]*s||1;return t[0]=(n[0]*i+n[4]*r+n[8]*s)/o,t[1]=(n[1]*i+n[5]*r+n[9]*s)/o,t[2]=(n[2]*i+n[6]*r+n[10]*s)/o,t}function XC(t,e,n){const i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t[2]=e[2],t}function YC(){var t=new Ar(3);return Ar!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function O_(t){var e=t[0],n=t[1],i=t[2];return Math.hypot(e,n,i)}function ZC(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function $C(t){var e=t[0],n=t[1],i=t[2];return e*e+n*n+i*i}function KC(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function qC(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function QC(t,e,n){var i=e[0],r=e[1],s=e[2],o=n[0],a=n[1],l=n[2];return t[0]=r*l-s*a,t[1]=s*o-i*l,t[2]=i*a-r*o,t}function JC(t,e,n,i){var r=e[0],s=e[1],o=e[2];return t[0]=r+i*(n[0]-r),t[1]=s+i*(n[1]-s),t[2]=o+i*(n[2]-o),t}function k_(t,e,n){var i=e[0],r=e[1],s=e[2],o=n[3]*i+n[7]*r+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*i+n[4]*r+n[8]*s+n[12])/o,t[1]=(n[1]*i+n[5]*r+n[9]*s+n[13])/o,t[2]=(n[2]*i+n[6]*r+n[10]*s+n[14])/o,t}function e2(t,e,n){var i=e[0],r=e[1],s=e[2];return t[0]=i*n[0]+r*n[3]+s*n[6],t[1]=i*n[1]+r*n[4]+s*n[7],t[2]=i*n[2]+r*n[5]+s*n[8],t}function t2(t,e,n){var i=n[0],r=n[1],s=n[2],o=n[3],a=e[0],l=e[1],c=e[2],u=r*c-s*l,f=s*a-i*c,h=i*l-r*a,g=r*h-s*f,p=s*u-i*h,w=i*f-r*u,x=o*2;return u*=x,f*=x,h*=x,g*=2,p*=2,w*=2,t[0]=a+u+g,t[1]=l+f+p,t[2]=c+h+w,t}function n2(t,e,n,i){var r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[0],s[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),s[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function i2(t,e,n,i){var r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),s[1]=r[1],s[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function r2(t,e,n,i){var r=[],s=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],s[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),s[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),s[2]=r[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function s2(t,e){var n=t[0],i=t[1],r=t[2],s=e[0],o=e[1],a=e[2],l=Math.sqrt(n*n+i*i+r*r),c=Math.sqrt(s*s+o*o+a*a),u=l*c,f=u&&qC(t,e)/u;return Math.acos(Math.min(Math.max(f,-1),1))}var N_=ZC,o2=O_,ou=$C;(function(){var t=YC();return function(e,n,i,r,s,o){var a,l;for(n||(n=3),i||(i=0),r?l=Math.min(r*n+i,e.length):l=e.length,a=i;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}})();const au=[0,0,0];let ia;class Pt extends jC{static get ZERO(){return ia||(ia=new Pt(0,0,0),Object.freeze(ia)),ia}constructor(e=0,n=0,i=0){super(-0,-0,-0),arguments.length===1&&br(e)?this.copy(e):(qe.debug&&(st(e),st(n),st(i)),this[0]=e,this[1]=n,this[2]=i)}set(e,n,i){return this[0]=e,this[1]=n,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return qe.debug&&(st(e.x),st(e.y),st(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=st(e)}angle(e){return s2(this,e)}cross(e){return QC(this,this,e),this.check()}rotateX({radians:e,origin:n=au}){return n2(this,this,n,e),this.check()}rotateY({radians:e,origin:n=au}){return i2(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=au}){return r2(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return k_(this,this,e),this.check()}transformAsVector(e){return R_(this,this,e),this.check()}transformByMatrix3(e){return e2(this,this,e),this.check()}transformByMatrix2(e){return XC(this,this,e),this.check()}transformByQuaternion(e){return t2(this,this,e),this.check()}}class a2 extends L_{toString(){let e="[";if(qe.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let i=0;i<this.RANK;++i)e+=" ".concat(this[i*this.RANK+n])}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=" ".concat(this[n])}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,i){return this[n*this.RANK+e]=st(i),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let r=0;r<this.RANK;++r)n[r]=this[i+r];return n}setColumn(e,n){const i=e*this.RANK;for(let r=0;r<this.RANK;++r)this[i+r]=n[r];return this}}function l2(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function c2(t,e){if(t===e){var n=e[1],i=e[2],r=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=s,t[11]=e[14],t[12]=r,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function If(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],f=e[9],h=e[10],g=e[11],p=e[12],w=e[13],x=e[14],y=e[15],m=n*a-i*o,_=n*l-r*o,T=n*c-s*o,P=i*l-r*a,A=i*c-s*a,C=r*c-s*l,M=u*w-f*p,R=u*x-h*p,O=u*y-g*p,z=f*x-h*w,j=f*y-g*w,B=h*y-g*x,H=m*B-_*j+T*z+P*O-A*R+C*M;return H?(H=1/H,t[0]=(a*B-l*j+c*z)*H,t[1]=(r*j-i*B-s*z)*H,t[2]=(w*C-x*A+y*P)*H,t[3]=(h*A-f*C-g*P)*H,t[4]=(l*O-o*B-c*R)*H,t[5]=(n*B-r*O+s*R)*H,t[6]=(x*T-p*C-y*_)*H,t[7]=(u*C-h*T+g*_)*H,t[8]=(o*j-a*O+c*M)*H,t[9]=(i*O-n*j-s*M)*H,t[10]=(p*A-w*T+y*m)*H,t[11]=(f*T-u*A-g*m)*H,t[12]=(a*R-o*z-l*M)*H,t[13]=(n*z-i*R+r*M)*H,t[14]=(w*_-p*P-x*m)*H,t[15]=(u*P-f*_+h*m)*H,t):null}function u2(t){var e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],f=t[10],h=t[11],g=t[12],p=t[13],w=t[14],x=t[15],y=e*o-n*s,m=e*a-i*s,_=e*l-r*s,T=n*a-i*o,P=n*l-r*o,A=i*l-r*a,C=c*p-u*g,M=c*w-f*g,R=c*x-h*g,O=u*w-f*p,z=u*x-h*p,j=f*x-h*w;return y*j-m*z+_*O+T*R-P*M+A*C}function Ei(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],f=e[8],h=e[9],g=e[10],p=e[11],w=e[12],x=e[13],y=e[14],m=e[15],_=n[0],T=n[1],P=n[2],A=n[3];return t[0]=_*i+T*a+P*f+A*w,t[1]=_*r+T*l+P*h+A*x,t[2]=_*s+T*c+P*g+A*y,t[3]=_*o+T*u+P*p+A*m,_=n[4],T=n[5],P=n[6],A=n[7],t[4]=_*i+T*a+P*f+A*w,t[5]=_*r+T*l+P*h+A*x,t[6]=_*s+T*c+P*g+A*y,t[7]=_*o+T*u+P*p+A*m,_=n[8],T=n[9],P=n[10],A=n[11],t[8]=_*i+T*a+P*f+A*w,t[9]=_*r+T*l+P*h+A*x,t[10]=_*s+T*c+P*g+A*y,t[11]=_*o+T*u+P*p+A*m,_=n[12],T=n[13],P=n[14],A=n[15],t[12]=_*i+T*a+P*f+A*w,t[13]=_*r+T*l+P*h+A*x,t[14]=_*s+T*c+P*g+A*y,t[15]=_*o+T*u+P*p+A*m,t}function vl(t,e,n){var i=n[0],r=n[1],s=n[2],o,a,l,c,u,f,h,g,p,w,x,y;return e===t?(t[12]=e[0]*i+e[4]*r+e[8]*s+e[12],t[13]=e[1]*i+e[5]*r+e[9]*s+e[13],t[14]=e[2]*i+e[6]*r+e[10]*s+e[14],t[15]=e[3]*i+e[7]*r+e[11]*s+e[15]):(o=e[0],a=e[1],l=e[2],c=e[3],u=e[4],f=e[5],h=e[6],g=e[7],p=e[8],w=e[9],x=e[10],y=e[11],t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=u,t[5]=f,t[6]=h,t[7]=g,t[8]=p,t[9]=w,t[10]=x,t[11]=y,t[12]=o*i+u*r+p*s+e[12],t[13]=a*i+f*r+w*s+e[13],t[14]=l*i+h*r+x*s+e[14],t[15]=c*i+g*r+y*s+e[15]),t}function od(t,e,n){var i=n[0],r=n[1],s=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function f2(t,e,n,i){var r=i[0],s=i[1],o=i[2],a=Math.hypot(r,s,o),l,c,u,f,h,g,p,w,x,y,m,_,T,P,A,C,M,R,O,z,j,B,H,Ye;return a<Ra?null:(a=1/a,r*=a,s*=a,o*=a,l=Math.sin(n),c=Math.cos(n),u=1-c,f=e[0],h=e[1],g=e[2],p=e[3],w=e[4],x=e[5],y=e[6],m=e[7],_=e[8],T=e[9],P=e[10],A=e[11],C=r*r*u+c,M=s*r*u+o*l,R=o*r*u-s*l,O=r*s*u-o*l,z=s*s*u+c,j=o*s*u+r*l,B=r*o*u+s*l,H=s*o*u-r*l,Ye=o*o*u+c,t[0]=f*C+w*M+_*R,t[1]=h*C+x*M+T*R,t[2]=g*C+y*M+P*R,t[3]=p*C+m*M+A*R,t[4]=f*O+w*z+_*j,t[5]=h*O+x*z+T*j,t[6]=g*O+y*z+P*j,t[7]=p*O+m*z+A*j,t[8]=f*B+w*H+_*Ye,t[9]=h*B+x*H+T*Ye,t[10]=g*B+y*H+P*Ye,t[11]=p*B+m*H+A*Ye,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function F_(t,e,n){var i=Math.sin(n),r=Math.cos(n),s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],f=e[10],h=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*r+c*i,t[5]=o*r+u*i,t[6]=a*r+f*i,t[7]=l*r+h*i,t[8]=c*r-s*i,t[9]=u*r-o*i,t[10]=f*r-a*i,t[11]=h*r-l*i,t}function h2(t,e,n){var i=Math.sin(n),r=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],f=e[10],h=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r-c*i,t[1]=o*r-u*i,t[2]=a*r-f*i,t[3]=l*r-h*i,t[8]=s*i+c*r,t[9]=o*i+u*r,t[10]=a*i+f*r,t[11]=l*i+h*r,t}function D_(t,e,n){var i=Math.sin(n),r=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],f=e[6],h=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*r+c*i,t[1]=o*r+u*i,t[2]=a*r+f*i,t[3]=l*r+h*i,t[4]=c*r-s*i,t[5]=u*r-o*i,t[6]=f*r-a*i,t[7]=h*r-l*i,t}function d2(t,e){var n=e[0],i=e[1],r=e[2],s=e[3],o=n+n,a=i+i,l=r+r,c=n*o,u=i*o,f=i*a,h=r*o,g=r*a,p=r*l,w=s*o,x=s*a,y=s*l;return t[0]=1-f-p,t[1]=u+y,t[2]=h-x,t[3]=0,t[4]=u-y,t[5]=1-c-p,t[6]=g+w,t[7]=0,t[8]=h+x,t[9]=g-w,t[10]=1-c-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function g2(t,e,n,i,r,s,o){var a=1/(n-e),l=1/(r-i),c=1/(s-o);return t[0]=s*2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*l,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(r+i)*l,t[10]=(o+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*c,t[15]=0,t}function p2(t,e,n,i,r){var s=1/Math.tan(e/2),o;return t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,r!=null&&r!==1/0?(o=1/(i-r),t[10]=(r+i)*o,t[14]=2*r*i*o):(t[10]=-1,t[14]=-2*i),t}var m2=p2;function v2(t,e,n,i,r,s,o){var a=1/(e-n),l=1/(i-r),c=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*a,t[13]=(r+i)*l,t[14]=(o+s)*c,t[15]=1,t}var y2=v2;function _2(t,e,n,i){var r,s,o,a,l,c,u,f,h,g,p=e[0],w=e[1],x=e[2],y=i[0],m=i[1],_=i[2],T=n[0],P=n[1],A=n[2];return Math.abs(p-T)<Ra&&Math.abs(w-P)<Ra&&Math.abs(x-A)<Ra?l2(t):(u=p-T,f=w-P,h=x-A,g=1/Math.hypot(u,f,h),u*=g,f*=g,h*=g,r=m*h-_*f,s=_*u-y*h,o=y*f-m*u,g=Math.hypot(r,s,o),g?(g=1/g,r*=g,s*=g,o*=g):(r=0,s=0,o=0),a=f*o-h*s,l=h*r-u*o,c=u*s-f*r,g=Math.hypot(a,l,c),g?(g=1/g,a*=g,l*=g,c*=g):(a=0,l=0,c=0),t[0]=r,t[1]=a,t[2]=u,t[3]=0,t[4]=s,t[5]=l,t[6]=f,t[7]=0,t[8]=o,t[9]=c,t[10]=h,t[11]=0,t[12]=-(r*p+s*w+o*x),t[13]=-(a*p+l*w+c*x),t[14]=-(u*p+f*w+h*x),t[15]=1,t)}function w2(){var t=new Ar(4);return Ar!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function z_(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function Fr(t,e,n){var i=e[0],r=e[1],s=e[2],o=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*s+n[12]*o,t[1]=n[1]*i+n[5]*r+n[9]*s+n[13]*o,t[2]=n[2]*i+n[6]*r+n[10]*s+n[14]*o,t[3]=n[3]*i+n[7]*r+n[11]*s+n[15]*o,t}(function(){var t=w2();return function(e,n,i,r,s,o){var a,l;for(n||(n=4),i||(i=0),r?l=Math.min(r*n+i,e.length):l=e.length,a=i;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}})();var Rf;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(Rf||(Rf={}));const E2=45*Math.PI/180,x2=1,lu=.1,cu=500,T2=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Ue extends a2{static get IDENTITY(){return P2()}static get ZERO(){return S2()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Rf}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,i,r,s,o,a,l,c,u,f,h,g,p,w,x){return this[0]=e,this[1]=n,this[2]=i,this[3]=r,this[4]=s,this[5]=o,this[6]=a,this[7]=l,this[8]=c,this[9]=u,this[10]=f,this[11]=h,this[12]=g,this[13]=p,this[14]=w,this[15]=x,this.check()}setRowMajor(e,n,i,r,s,o,a,l,c,u,f,h,g,p,w,x){return this[0]=e,this[1]=s,this[2]=c,this[3]=g,this[4]=n,this[5]=o,this[6]=u,this[7]=p,this[8]=i,this[9]=a,this[10]=f,this[11]=w,this[12]=r,this[13]=l,this[14]=h,this[15]=x,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(T2)}fromObject(e){return this.check()}fromQuaternion(e){return d2(this,e),this.check()}frustum(e){const{left:n,right:i,bottom:r,top:s,near:o=lu,far:a=cu}=e;return a===1/0?b2(this,n,i,r,s,o):g2(this,n,i,r,s,o,a),this.check()}lookAt(e){const{eye:n,center:i=[0,0,0],up:r=[0,1,0]}=e;return _2(this,n,i,r),this.check()}ortho(e){const{left:n,right:i,bottom:r,top:s,near:o=lu,far:a=cu}=e;return y2(this,n,i,r,s,o,a),this.check()}orthographic(e){const{fovy:n=E2,aspect:i=x2,focalDistance:r=1,near:s=lu,far:o=cu}=e;lm(n);const a=n/2,l=r*Math.tan(a),c=l*i;return this.ortho({left:-c,right:c,bottom:-l,top:l,near:s,far:o})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:i=1,near:r=.1,far:s=500}=e;return lm(n),m2(this,n,i,r,s),this.check()}determinant(){return u2(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),r=1/i[0],s=1/i[1],o=1/i[2];return e[0]=this[0]*r,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*r,e[5]=this[5]*s,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*r,e[9]=this[9]*s,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),r=1/i[0],s=1/i[1],o=1/i[2];return e[0]=this[0]*r,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=this[4]*r,e[4]=this[5]*s,e[5]=this[6]*o,e[6]=this[8]*r,e[7]=this[9]*s,e[8]=this[10]*o,e}transpose(){return c2(this,this),this.check()}invert(){return If(this,this),this.check()}multiplyLeft(e){return Ei(this,e,this),this.check()}multiplyRight(e){return Ei(this,this,e),this.check()}rotateX(e){return F_(this,this,e),this.check()}rotateY(e){return h2(this,this,e),this.check()}rotateZ(e){return D_(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return f2(this,this,e,n),this.check()}scale(e){return od(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return vl(this,this,e),this.check()}transform(e,n){return e.length===4?(n=Fr(n||[-0,-0,-0,-0],e,this),su(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:i}=e;let r;switch(i){case 2:r=WC(n||[-0,-0],e,this);break;case 3:r=k_(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return su(r,e.length),r}transformAsVector(e,n){let i;switch(e.length){case 2:i=HC(n||[-0,-0],e,this);break;case 3:i=R_(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return su(i,e.length),i}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,i){return this.identity().translate([e,n,i])}}let ra,sa;function S2(){return ra||(ra=new Ue([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(ra)),ra}function P2(){return sa||(sa=new Ue,Object.freeze(sa)),sa}function lm(t){if(t>Math.PI*2)throw Error("expected radians")}function b2(t,e,n,i,r,s){const o=2*s/(n-e),a=2*s/(r-i),l=(n+e)/(n-e),c=(r+i)/(r-i),u=-1,f=-1,h=-2*s;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=l,t[9]=c,t[10]=u,t[11]=f,t[12]=0,t[13]=0,t[14]=h,t[15]=0,t}const cm=1e-6,A2=6371e3;class Zl{constructor({phi:e=0,theta:n=0,radius:i=1,bearing:r,pitch:s,altitude:o,radiusScale:a=A2}={}){d(this,"phi",void 0),d(this,"theta",void 0),d(this,"radius",void 0),d(this,"radiusScale",void 0),this.phi=e,this.theta=n,this.radius=i||o||1,this.radiusScale=a||1,r!==void 0&&(this.bearing=r),s!==void 0&&(this.pitch=s),this.check()}toString(){return this.formatString(qe)}formatString({printTypes:e=!1}){const n=C_;return"".concat(e?"Spherical":"","[rho:").concat(n(this.radius),",theta:").concat(n(this.theta),",phi:").concat(n(this.phi),"]")}equals(e){return mn(this.radius,e.radius)&&mn(this.theta,e.theta)&&mn(this.phi,e.phi)}exactEquals(e){return this.radius===e.radius&&this.theta===e.theta&&this.phi===e.phi}get bearing(){return 180-Bi(this.phi)}set bearing(e){this.phi=Math.PI-na(e)}get pitch(){return Bi(this.theta)}set pitch(e){this.theta=na(e)}get longitude(){return Bi(this.phi)}get latitude(){return Bi(this.theta)}get lng(){return Bi(this.phi)}get lat(){return Bi(this.theta)}get z(){return(this.radius-1)*this.radiusScale}set(e,n,i){return this.radius=e,this.phi=n,this.theta=i,this.check()}clone(){return new Zl().copy(this)}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this.check()}fromLngLatZ([e,n,i]){return this.radius=1+i/this.radiusScale,this.phi=na(n),this.theta=na(e),this.check()}fromVector3(e){return this.radius=O_(e),this.radius>0&&(this.theta=Math.atan2(e[0],e[1]),this.phi=Math.acos(pe(e[2]/this.radius,-1,1))),this.check()}toVector3(){return new Pt(0,0,this.radius).rotateX({radians:this.theta}).rotateZ({radians:this.phi})}makeSafe(){return this.phi=Math.max(cm,Math.min(Math.PI-cm,this.phi)),this}check(){if(!Number.isFinite(this.phi)||!Number.isFinite(this.theta)||!(this.radius>0))throw new Error("SphericalCoordinates: some fields set to invalid numbers");return this}}var um=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`;const C2={lightSources:{}};function uu(){let{color:t=[0,0,0],intensity:e=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.map(n=>n*e/255)}function L2(t){let{ambientLight:e,pointLights:n=[],directionalLights:i=[]}=t;const r={};return e?r["lighting_uAmbientLight.color"]=uu(e):r["lighting_uAmbientLight.color"]=[0,0,0],n.forEach((s,o)=>{r["lighting_uPointLight[".concat(o,"].color")]=uu(s),r["lighting_uPointLight[".concat(o,"].position")]=s.position,r["lighting_uPointLight[".concat(o,"].attenuation")]=s.attenuation||[1,0,0]}),r.lighting_uPointLightCount=n.length,i.forEach((s,o)=>{r["lighting_uDirectionalLight[".concat(o,"].color")]=uu(s),r["lighting_uDirectionalLight[".concat(o,"].direction")]=s.direction}),r.lighting_uDirectionalLightCount=i.length,r}function U_(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:C2;if("lightSources"in t){const{ambientLight:e,pointLights:n,directionalLights:i}=t.lightSources||{};return e||n&&n.length>0||i&&i.length>0?Object.assign({},L2({ambientLight:e,pointLights:n,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const e={pointLights:[],directionalLights:[]};for(const n of t.lights||[])switch(n.type){case"ambient":e.ambientLight=n;break;case"directional":e.directionalLights.push(n);break;case"point":e.pointLights.push(n);break}return U_({lightSources:e})}return{}}const B_={name:"lights",vs:um,fs:um,getUniforms:U_,defines:{MAX_LIGHTS:3}},M2=new Uint8Array([0,255,255,255]),I2={pickingSelectedColor:null,pickingHighlightColor:M2,pickingActive:!1,pickingAttribute:!1};function R2(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:I2;const e={};if(t.pickingSelectedColor!==void 0)if(!t.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const n=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}if(t.pickingHighlightColor){const n=Array.from(t.pickingHighlightColor,i=>i/255);Number.isFinite(n[3])||(n[3]=1),e.picking_uHighlightColor=n}return t.pickingActive!==void 0&&(e.picking_uActive=Boolean(t.pickingActive),e.picking_uAttribute=Boolean(t.pickingAttribute)),e}const O2=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,k2=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,N2={name:"picking",vs:O2,fs:k2,getUniforms:R2};var V_=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`;const F2={};function D2(t){const{ambient:e=.35,diffuse:n=.6,shininess:i=32,specularColor:r=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:n,lighting_uShininess:i,lighting_uSpecularColor:r.map(s=>s/255)}}function j_(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:F2;if(!("material"in t))return{};const{material:e}=t;return e?D2(e):{lighting_uEnabled:!1}}const ad={name:"gouraud-lighting",dependencies:[B_],vs:V_,defines:{LIGHTING_VERTEX:1},getUniforms:j_},z2={name:"phong-lighting",dependencies:[B_],fs:V_,defines:{LIGHTING_FRAGMENT:1},getUniforms:j_},U2=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,B2={name:"transform",vs:U2,fs:null};class po{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new po(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(n=>n.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==n),this.stateHash++}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:n="",fs:i="",defines:r={},inject:s={},varyings:o=[],bufferMode:a=35981,transpileToGLSL100:l=!1}=e,c=this._getModuleList(e.modules),u=this._getHash(n),f=this._getHash(i),h=c.map(_=>this._getHash(_.name)).sort(),g=o.map(_=>this._getHash(_)),p=Object.keys(r).sort(),w=Object.keys(s).sort(),x=[],y=[];for(const _ of p)x.push(this._getHash(_)),x.push(this._getHash(r[_]));for(const _ of w)y.push(this._getHash(_)),y.push(this._getHash(s[_]));const m="".concat(u,"/").concat(f,"D").concat(x.join("/"),"M").concat(h.join("/"),"I").concat(y.join("/"),"V").concat(g.join("/"),"H").concat(this.stateHash,"B").concat(a).concat(l?"T":"");if(!this._programCache[m]){const _=xC(this.gl,{vs:n,fs:i,modules:c,inject:s,defines:r,hookFunctions:this._hookFunctions,transpileToGLSL100:l});this._programCache[m]=new y_(this.gl,{hash:m,vs:_.vs,fs:_.fs,varyings:o,bufferMode:a}),this._getUniforms[m]=_.getUniforms||(T=>{}),this._useCounts[m]=0}return this._useCounts[m]++,this._programCache[m]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const n=e.hash;this._useCounts[n]--,this._useCounts[n]===0&&(this._programCache[n].delete(),delete this._programCache[n],delete this._getUniforms[n],delete this._useCounts[n])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const n=new Array(this._defaultModules.length+e.length),i={};let r=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const a=this._defaultModules[s],l=a.name;n[r++]=a,i[l]=!0}for(let s=0,o=e.length;s<o;++s){const a=e[s],l=a.name;i[l]||(n[r++]=a,i[l]=!0)}return n.length=r,n}}const V2={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function j2(t,e,n){const i={};let r=e.indices;for(const s in e.attributes){const o=e.attributes[s],a=G2(s,n);if(s==="indices")r=o;else if(o.constant)i[a]=o.value;else{const l=o.value,c={...o};delete c.value,i[a]=[new Q(t,l),c],W2(s,c)}}if(r){const s=r.value||r;k(s instanceof Uint16Array||s instanceof Uint32Array,'attribute array for "indices" must be of integer type');const o={size:1,isIndexed:r.isIndexed===void 0?!0:r.isIndexed};i.indices=[new Q(t,{data:s,target:34963}),o]}return i}function G2(t,e){const{attributeMap:n=V2}=e||{};return n&&n[t]||t}function W2(t,e){let n;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors";break}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}k(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}const Vi=2,H2=1e4,X2="Model needs drawMode and vertexCount",fm=()=>{},Y2={};class bt{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:i=en("model")}=n;k(Hl(e)),this.id=i,this.gl=e,this.id=n.id||en("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(n)}initialize(e){this.props={},this.programManager=e.programManager||po.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:n=null,vs:i,fs:r,modules:s,defines:o,inject:a,varyings:l,bufferMode:c,transpileToGLSL100:u}=e;this.programProps={program:n,vs:i,fs:r,modules:s,defines:o,inject:a,varyings:l,bufferMode:c,transpileToGLSL100:u},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},k(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),X2)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:n,vs:i,fs:r,modules:s,defines:o,inject:a,varyings:l,bufferMode:c,transpileToGLSL100:u}=e;this.programProps={program:n,vs:i,fs:r,modules:s,defines:o,inject:a,varyings:l,bufferMode:c,transpileToGLSL100:u},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return k(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return k(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=j2(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Sr(e))return this;const n={};for(const i in e){const r=e[i];n[i]=r.getValue?r.getValue():r}return this.vertexArray.setAttributes(n),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const n=this.programManager.getUniforms(this.program);return n?n(e):{}}updateModuleSettings(e){const n=this.getModuleUniforms(e||{});return this.setUniforms(n)}clear(e){return ed(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:n=null,framebuffer:i,uniforms:r={},attributes:s={},transformFeedback:o=this.transformFeedback,parameters:a={},vertexArray:l=this.vertexArray}=e;this.setAttributes(s),this.updateModuleSettings(n),this.setUniforms(r);let c;U.priority>=Vi&&(c=this._logDrawCallStart(Vi));const u=this.vertexArray.getDrawParams(),{isIndexed:f=u.isIndexed,indexType:h=u.indexType,indexOffset:g=u.indexOffset,vertexArrayInstanced:p=u.isInstanced}=this.props;p&&!this.isInstanced&&U.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:w,instanceCount:x}=this,{onBeforeRender:y=fm,onAfterRender:m=fm}=this.props;y(),this.program.setUniforms(this.uniforms);const _=this.program.draw(Object.assign(Y2,e,{logPriority:c,uniforms:null,framebuffer:i,parameters:a,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:l,transformFeedback:o,isIndexed:f,indexType:h,isInstanced:w,instanceCount:x,offset:f?g:0}));return m(),U.priority>=Vi&&this._logDrawCallEnd(c,l,i),_}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:n=!0,feedbackBuffers:i,unbindModels:r=[]}=e;let{parameters:s}=e;i&&this._setFeedbackBuffers(i),n&&(s=Object.assign({},s,{[35977]:n})),r.forEach(o=>o.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:s}))}finally{r.forEach(o=>o.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return U.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:n}=this.programProps;if(n)this._managedProgram=!1;else{const{vs:i,fs:r,modules:s,inject:o,defines:a,varyings:l,bufferMode:c,transpileToGLSL100:u}=this.programProps;n=this.programManager.get({vs:i,fs:r,modules:s,inject:o,defines:a,varyings:l,bufferMode:c,transpileToGLSL100:u}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}k(n instanceof y_,"Model needs a program"),this._programDirty=!1,n!==this.program&&(this.program=n,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new DA(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const n=this.geometryBuffers[e][0]||this.geometryBuffers[e];n instanceof Q&&n.delete()}}_setAnimationProps(e){this.animated&&k(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Sr(e))return this;const{gl:n}=this.program;return this.transformFeedback=this.transformFeedback||new __(n,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const n=e>3?0:H2;if(!(Date.now()-this.lastLogTime<n))return this.lastLogTime=Date.now(),U.group(Vi,">>> DRAWING MODEL ".concat(this.id),{collapsed:U.level<=2})(),e}_logDrawCallEnd(e,n,i,r){if(e===void 0)return;const s=BA({vertexArray:n,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:o,unusedTable:a,unusedCount:l}=Kp({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i)}),{table:c,count:u}=Kp({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i),undefinedOnly:!0});u>0&&U.log("MISSING UNIFORMS",Object.keys(c))(),l>0&&U.log("UNUSED UNIFORMS",Object.keys(a))();const f=jA(this.vertexArray.configuration);U.table(e,s)(),U.table(e,o)(),U.table(e+1,f)(),r&&r.log({logLevel:Vi,message:"Rendered to ".concat(r.id)}),U.groupEnd(Vi)()}}class Z2{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}setupResources(e){for(const n of this.bindings)this._setupTransformFeedback(n,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:n}=this;return n.length>0&&(e=Object.assign({},e,{varyings:n})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this.bindings[this.currentIndex],{sourceBuffers:i,transformFeedback:r}=n;return{attributes:Object.assign({},i,e.attributes),transformFeedback:r}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:n}=this.bindings[this.currentIndex],i=e?n[e]:null;return i?i instanceof Q?i:i.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:n}=e,i=this.getBuffer(n);return i?i.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&k(Y(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:n={}}=e,i={};if(this.bindings[this.currentIndex]&&Object.assign(i,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const r in this.feedbackMap){const s=this.feedbackMap[r];r in n&&(i[s]=r)}Object.assign(i,e.feedbackBuffers);for(const r in i){const s=i[r];if(typeof s=="string"){const o=n[s],{byteLength:a,usage:l,accessor:c}=o;i[r]=this._createNewBuffer(r,{byteLength:a,usage:l,accessor:c})}}return i}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const i=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:n,feedbackBuffers:i})}_setupTransformFeedback(e,n){let{model:i}=n;const{program:r}=i;e.transformFeedback=new __(this.gl,{program:r,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:n,feedbackBuffers:i}=this._swapBuffers(this.bindings[this.currentIndex]),r=this._getNextIndex();this.bindings[r]=this._updateBinding(this.bindings[r],{sourceBuffers:n,feedbackBuffers:i})}}_updateBinding(e,n){return e?(Object.assign(e.sourceBuffers,n.sourceBuffers),Object.assign(e.feedbackBuffers,n.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},n.sourceBuffers),feedbackBuffers:Object.assign({},n.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const n=Object.assign({},e.sourceBuffers),i=Object.assign({},e.feedbackBuffers);for(const r in this.feedbackMap){const s=this.feedbackMap[r];n[r]=e.feedbackBuffers[s],i[s]=e.sourceBuffers[r],k(i[s]instanceof Q)}return{sourceBuffers:n,feedbackBuffers:i}}_createNewBuffer(e,n){const i=new Q(this.gl,n);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=i,i}_getNextIndex(){return(this.currentIndex+1)%2}}const $2="transform_uSampler_",yl="transform_uSize_",hm="transform_position";function K2(t){let{vs:e,sourceTextureMap:n,targetTextureVarying:i,targetTexture:r}=t,o=Object.keys(n).length,a=null;const l={};let c=e,u={};if(o>0||i){const f=c.split(`
`),h=f.slice();if(f.forEach((g,p,w)=>{if(o>0){const x=tL(g,n);if(x){const{updatedLine:y,inject:m}=x;h[p]=y,u=Cf([u,m]),Object.assign(l,x.samplerTextureMap),o--}}i&&!a&&(a=eL(g,i))}),i){k(r);const g="".concat(yl).concat(i),p="uniform vec2 ".concat(g,`;
`),w="     vec2 ".concat(hm," = transform_getPos(").concat(g,`);
     gl_Position = vec4(`).concat(hm,`, 0, 1.);
`);u=Cf([u,{"vs:#decl":p,"vs:#main-start":w}])}c=h.join(`
`)}return{vs:c,targetTextureType:a,inject:u,samplerTextureMap:l}}function q2(t){let{sourceTextureMap:e,targetTextureVarying:n,targetTexture:i}=t;const r={};let s,o;n&&({width:s,height:o}=i,r["".concat(yl).concat(n)]=[s,o]);for(const a in e)({width:s,height:o}=e[a]),r["".concat(yl).concat(a)]=[s,o];return r}function Q2(t){return b_(t,["attribute","in"])}function J2(t){const e="".concat($2).concat(t),n="".concat(yl).concat(t),i="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(n,";");return{samplerName:e,sizeName:n,uniformDeclerations:i}}function eL(t,e){const n=b_(t,["varying","out"]);return n&&n.name===e?n.type:null}function tL(t,e){const n={},i=Q2(t);if(!i)return null;const{type:r,name:s}=i;if(s&&e[s]){const o="// ".concat(t," => Replaced by Transform with a sampler"),{samplerName:a,sizeName:l,uniformDeclerations:c}=J2(s),u=IC(r),f="  ".concat(r," ").concat(s," = transform_getInput(").concat(a,", ").concat(l,").").concat(u,`;
`);return n[a]=s,{updatedLine:o,inject:{"vs:#decl":c,"vs:#main-start":f},samplerTextureMap:n}}return null}const nL={[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},iL="transform_output";class rL{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._processVertexShader(e);return Object.assign({},e,n)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,sourceTextures:i,framebuffer:r,targetTexture:s}=this.bindings[this.currentIndex],o=Object.assign({},n,e.attributes),a=Object.assign({},e.uniforms),l=Object.assign({},e.parameters);let c=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){o.transform_elementID=this.elementIDBuffer;for(const f in this.samplerTextureMap){const h=this.samplerTextureMap[f];a[f]=i[h]}this._setSourceTextureParameters();const u=q2({sourceTextureMap:i,targetTextureVarying:this.targetTextureVarying,targetTexture:s});Object.assign(a,u)}return this.hasTargetTexture&&(c=!1,l.viewport=[0,0,r.width,r.height]),{attributes:o,framebuffer:r,uniforms:a,discard:c,parameters:l}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:n}=this.bindings[this.currentIndex],i=Yl(n);if(!e)return i;const r=i.constructor,s=RC(this.targetTextureType),o=new r(i.length*s/4);let a=0;for(let l=0;l<i.length;l+=4)for(let c=0;c<s;c++)o[a++]=i[l+c];return o}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:n,_swapTexture:i}=e;this._swapTexture=i,this.targetTextureVarying=n,this.hasTargetTexture=n,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:n,textureOrReference:i}=e;if(i instanceof We)return i;const r=n[i];return r?(this._targetRefTexName=i,this._createNewTexture(r)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,_sourceTextures:i={},_targetTexture:r}=e,s=this._createTargetTexture({sourceTextures:i,textureOrReference:r});this.hasSourceTextures=this.hasSourceTextures||i&&Object.keys(i).length>0,this._updateBindings({sourceBuffers:n,sourceTextures:i,targetTexture:s}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const n=new Float32Array(e);n.forEach((i,r,s)=>{s[r]=r}),this.elementIDBuffer?this.elementIDBuffer.setData({data:n}):this.elementIDBuffer=new Q(this.gl,{data:n,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:n,targetTexture:i}=this._swapTextures(this.bindings[this.currentIndex]),r=this._getNextIndex();this.bindings[r]=this._updateBinding(this.bindings[r],{sourceTextures:n,targetTexture:i})}}_updateBinding(e,n){const{sourceBuffers:i,sourceTextures:r,targetTexture:s}=n;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,r),Object.assign(e.sourceBuffers,i),s){e.targetTexture=s;const{width:o,height:a}=s,{framebuffer:l}=e;l?(l.update({attachments:{[36064]:s},resizeAttachments:!1}),l.resize({width:o,height:a})):e.framebuffer=new _e(this.gl,{id:"transform-framebuffer",width:o,height:a,attachments:{[36064]:s}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:n}=this.bindings[e];for(const i in n)n[i].setParameters(nL)}_swapTextures(e){if(!this._swapTexture)return null;const n=Object.assign({},e.sourceTextures);n[this._swapTexture]=e.targetTexture;const i=e.sourceTextures[this._swapTexture];return{sourceTextures:n,targetTexture:i}}_createNewTexture(e){const n=bb(e,{parameters:{[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},pixelStore:{[37440]:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=n,n}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:n,targetTexture:i}=this.bindings[this.currentIndex],{vs:r,uniforms:s,targetTextureType:o,inject:a,samplerTextureMap:l}=K2({vs:e.vs,sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:i}),c=Cf([e.inject||{},a]);this.targetTextureType=o,this.samplerTextureMap=l;const u=e._fs||A_({version:m_(r),input:this.targetTextureVarying,inputType:o,output:iL}),f=this.hasSourceTextures||this.targetTextureVarying?[B2].concat(e.modules||[]):e.modules;return{vs:r,fs:u,modules:f,uniforms:s,inject:c}}}class ld{static isSupported(e){return Y(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(n),Object.seal(this)}delete(){const{model:e,bufferTransform:n,textureTransform:i}=this;e&&e.delete(),n&&n.delete(),i&&i.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:n=!0}=e,i=this._updateDrawOptions(e);n&&i.framebuffer&&i.framebuffer.clear({color:!0}),this.model.transform(i)}swap(){let e=!1;const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)e=e||i.swap();k(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n){const r=i.getData(e);if(r)return r}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)i.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:n}=this;this._buildResourceTransforms(n,e),e=this._updateModelProps(e),this.model=new bt(n,Object.assign({},e,{fs:e.fs||A_({version:m_(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of i)n=r.updateModelProps(n);return n}_buildResourceTransforms(e,n){sL(n)&&(this.bufferTransform=new Z2(e,n)),oL(n)&&(this.textureTransform=new rL(e,n)),k(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of i)n=Object.assign(n,r.getDrawOptions(n));return n}}function sL(t){return!!(!Sr(t.feedbackBuffers)||!Sr(t.feedbackMap)||t.varyings&&t.varyings.length>0)}function oL(t){return!!(!Sr(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)}const dm={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class Vt{static get DRAW_MODE(){return dm}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=en("geometry"),drawMode:i=dm.TRIANGLES,attributes:r={},indices:s=null,vertexCount:o=null}=e;this.id=n,this.drawMode=i|0,this.attributes={},this.userData={},this._setAttributes(r,s),this.vertexCount=o||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,n){n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n);for(const i in e){let r=e[i];r=ArrayBuffer.isView(r)?{value:r}:r,k(ArrayBuffer.isView(r.value),"".concat(this._print(i),": must be typed array or object with value as typed array")),(i==="POSITION"||i==="positions")&&!r.size&&(r.size=3),i==="indices"?(k(!this.indices),this.indices=r):this.attributes[i]=r}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,n){if(n)return n.value.length;let i=1/0;for(const r in e){const s=e[r],{value:o,size:a,constant:l}=s;!l&&o&&a>=1&&(i=Math.min(i,o.length/a))}return k(Number.isFinite(i)),i}}const aL=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),lL=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),cL=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),uL=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),fL={POSITION:{size:3,value:new Float32Array(lL)},NORMAL:{size:3,value:new Float32Array(cL)},TEXCOORD_0:{size:2,value:new Float32Array(uL)}};class hL extends Vt{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=en("cube-geometry")}=e;super({...e,id:n,indices:{size:1,value:new Uint16Array(aL)},attributes:{...fL,...e.attributes}})}}let dL=1,gL=1;class G_{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:n=0,duration:i=Number.POSITIVE_INFINITY,rate:r=1,repeat:s=1}=e,o=dL++,a={time:0,delay:n,duration:i,rate:r,repeat:s};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(e){this.channels.delete(e);for(const[n,i]of this.animations)i.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const r of n)this._setChannelTime(r,this.time);const i=this.animations.values();for(const r of i){const{animation:s,channel:o}=r;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const i=gL++;return this.animations.set(i,{animation:e,channel:n}),e.setTime(this.getTime(n)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const i=n-e.delay,r=e.duration*e.repeat;i>=r?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}const W_="#define SMOOTH_EDGE_RADIUS 0.5",pL=`
`.concat(W_,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),mL=`
`.concat(W_,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`);var vL={name:"geometry",vs:pL,fs:mL};const $={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty($,"IDENTITY",{get:()=>(W.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const kt={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},ft={common:0,meters:1,pixels:2},gm={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},mo={DRAW:"draw",MASK:"mask"},yL=Object.keys($).map(t=>"const int COORDINATE_SYSTEM_".concat(t," = ").concat($[t],";")).join(""),_L=Object.keys(kt).map(t=>"const int PROJECTION_MODE_".concat(t," = ").concat(kt[t],";")).join(""),wL=Object.keys(ft).map(t=>"const int UNIT_".concat(t.toUpperCase()," = ").concat(ft[t],";")).join("");var EL="".concat(yL,`
`).concat(_L,`
`).concat(wL,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0; // meters
const float GLOBE_RADIUS = 256.0;

// returns an adjustment factor for uCommonUnitsPerMeter
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {

    // uCommonUnitsPerMeter in low-zoom Web Mercator is non-linear
    // Adjust by 1 / cos(latitude)
    // If geometry.position (vertex in common space) is populated, use it
    // Otherwise use geometry.worldPosition (anchor in world space)
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }

    // latitude from common y: 2.0 * (atan(exp(y / TILE_SIZE * 2.0 * PI - PI)) - PI / 4.0)
    // Taylor series of 1 / cos(latitude)
    // Max error < 0.003
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}

//
// Scaling offsets - scales meters to "world distance"
// Note the scalar version of project_size is for scaling the z component only
//
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}

// Get rotation matrix that aligns the z axis with the given up vector
// Find 3 unit vectors ux, uy, uz that are perpendicular to each other and uz == up
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  // Tangent on XY plane
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}

//
// Projecting normal - transform deltas from current coordinate system to
// normals in the worldspace
//
vec3 project_normal(vec3 vector) {
  // Apply model matrix
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

//
// Projecting positions - non-linear projection: lnglats => unit tile [0-1, 0-1]
//
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

//
// Projects positions (defined by project_uCoordinateSystem) to common space (defined by project_uProjectionMode)
//
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;

  // Work around for a Mac+NVIDIA bug https://github.com/visgl/deck.gl/issues/4145
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        // Too far from the projection center for offset mode to be accurate
        // Only use high parts
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    // Subtract high part of 64 bit value. Convert remainder to float32, preserving precision.
    position_world.xyz -= project_uCoordinateOrigin;
  }

  // Translation is already added to the high parts
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}

//
// Projects from common space coordinates to clip space.
// Uses project_uViewProjectionMatrix
//
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}

// Returns a clip space offset that corresponds to a given number of screen pixels
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  // UNIT_PIXELS
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function xL(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return!1}function $l(t){let e={},n;return i=>{for(const r in i)if(!xL(i[r],e[r])){n=t(i),e=i;break}return n}}const pm=[0,0,0,0],TL=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],H_=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],SL=[0,0,0],X_=[0,0,0],PL=$l(CL);function Y_(t,e,n=X_){n.length<3&&(n=[n[0],n[1],0]);let i=n,r,s=!0;switch(e===$.LNGLAT_OFFSETS||e===$.METER_OFFSETS?r=n:r=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case kt.WEB_MERCATOR:(e===$.LNGLAT||e===$.CARTESIAN)&&(r=[0,0,0],s=!1);break;case kt.WEB_MERCATOR_AUTO_OFFSET:e===$.LNGLAT?i=r:e===$.CARTESIAN&&(i=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],r=t.unprojectPosition(i),i[0]-=n[0],i[1]-=n[1],i[2]-=n[2]);break;case kt.IDENTITY:i=t.position.map(Math.fround),i[2]=i[2]||0;break;case kt.GLOBE:s=!1,r=null;break;default:s=!1}return{geospatialOrigin:r,shaderCoordinateOrigin:i,offsetMode:s}}function bL(t,e,n){const{viewMatrixUncentered:i,projectionMatrix:r}=t;let{viewMatrix:s,viewProjectionMatrix:o}=t,a=pm,l=pm,c=t.cameraPosition;const{geospatialOrigin:u,shaderCoordinateOrigin:f,offsetMode:h}=Y_(t,e,n);return h&&(l=t.projectPosition(u||f),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,a=Fr([],l,o),s=i||s,o=Ei([],r,s),o=Ei([],o,TL)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:a,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:f,geospatialOrigin:u}}function AL({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:i=$.DEFAULT,coordinateOrigin:r=X_,autoWrapLongitude:s=!1}){i===$.DEFAULT&&(i=t.isGeospatial?$.LNGLAT:$.CARTESIAN);const o=PL({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:r});return o.project_uWrapLongitude=s,o.project_uModelMatrix=n||H_,o}function CL({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i}){const{projectionCenter:r,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:l,geospatialOrigin:c}=bL(t,n,i),u=t.getDistanceScales(),f=[t.width*e,t.height*e],h=Fr([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,g={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:l,project_uCommonOrigin:o.slice(0,3),project_uCenter:r,project_uPseudoMeters:Boolean(t._pseudoMeters),project_uViewportSize:f,project_uDevicePixelRatio:e,project_uFocalDistance:h,project_uCommonUnitsPerMeter:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:SL,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:s,project_uModelMatrix:H_,project_uCameraPosition:a};if(c){const p=t.getDistanceScales(c);switch(n){case $.METER_OFFSETS:g.project_uCommonUnitsPerWorldUnit=p.unitsPerMeter,g.project_uCommonUnitsPerWorldUnit2=p.unitsPerMeter2;break;case $.LNGLAT:case $.LNGLAT_OFFSETS:t._pseudoMeters||(g.project_uCommonUnitsPerMeter=p.unitsPerMeter),g.project_uCommonUnitsPerWorldUnit=p.unitsPerDegree,g.project_uCommonUnitsPerWorldUnit2=p.unitsPerDegree2;break;case $.CARTESIAN:g.project_uCommonUnitsPerWorldUnit=[1,1,p.unitsPerMeter[2]],g.project_uCommonUnitsPerWorldUnit2=[0,0,p.unitsPerMeter2[2]];break}}return g}const LL={};function ML(t=LL){return"viewport"in t?AL(t):{}}var cd={name:"project",dependencies:[NC,vL],vs:EL,getUniforms:ML};const IL=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`;var tn={name:"project32",dependencies:[cd],vs:IL};function RL(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function dr(t,e){const n=Fr([],e,t);return z_(n,n,1/n[3]),n}function mm(t,e){const n=t%e;return n<0?e+n:n}function Of(t,e,n){return t<e?e:t>n?n:t}function OL(t){return Math.log(t)*Math.LOG2E}const ud=Math.log2||OL;function Tn(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Nt=Math.PI,Z_=Nt/4,Ut=Nt/180,kf=180/Nt,qs=512,Nf=4003e4,oa=85.051129,kL=1.5;function NL(t){return ud(t)}function Cr(t){const[e,n]=t;Tn(Number.isFinite(e)),Tn(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const i=e*Ut,r=n*Ut,s=qs*(i+Nt)/(2*Nt),o=qs*(Nt+Math.log(Math.tan(Z_+r*.5)))/(2*Nt);return[s,o]}function Lr(t){const[e,n]=t,i=e/qs*(2*Nt)-Nt,r=2*(Math.atan(Math.exp(n/qs*(2*Nt)-Nt))-Z_);return[i*kf,r*kf]}function $_(t){const{latitude:e}=t;Tn(Number.isFinite(e));const n=Math.cos(e*Ut);return NL(Nf*n)-9}function Ff(t){const{latitude:e,longitude:n,highPrecision:i=!1}=t;Tn(Number.isFinite(e)&&Number.isFinite(n));const r=qs,s=Math.cos(e*Ut),o=r/360,a=o/s,l=r/Nf/s,c={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[o,a,l],degreesPerUnit:[1/o,1/a,1/l]};if(i){const u=Ut*Math.tan(e*Ut)/s,f=o*u/2,h=r/Nf*u,g=h/a*l;c.unitsPerDegree2=[0,f,h],c.unitsPerMeter2=[g,0,g]}return c}function K_(t,e){const[n,i,r]=t,[s,o,a]=e,{unitsPerMeter:l,unitsPerMeter2:c}=Ff({longitude:n,latitude:i,highPrecision:!0}),u=Cr(t);u[0]+=s*(l[0]+c[0]*o),u[1]+=o*(l[1]+c[1]*o);const f=Lr(u),h=(r||0)+(a||0);return Number.isFinite(r)||Number.isFinite(a)?[f[0],f[1],h]:f}function FL(t){const{height:e,pitch:n,bearing:i,altitude:r,scale:s,center:o}=t,a=RL();vl(a,a,[0,0,-r]),F_(a,a,-n*Ut),D_(a,a,i*Ut);const l=s/e;return od(a,a,[l,l,l]),o&&vl(a,a,KC([],o)),a}function DL(t){const{width:e,height:n,altitude:i,pitch:r=0,offset:s,center:o,scale:a,nearZMultiplier:l=1,farZMultiplier:c=1}=t;let{fovy:u=_l(kL)}=t;i!==void 0&&(u=_l(i));const f=u*Ut,h=r*Ut,g=fd(u);let p=g;o&&(p+=o[2]*a/Math.cos(h)/n);const w=f*(.5+(s?s[1]:0)/n),x=Math.sin(w)*p/Math.sin(Of(Math.PI/2-h-w,.01,Math.PI-.01)),y=Math.sin(h)*x+p,m=p*10,_=Math.min(y*c,m);return{fov:f,aspect:e/n,focalDistance:g,near:l,far:_}}function _l(t){return 2*Math.atan(.5/t)*kf}function fd(t){return .5/Math.tan(.5*t*Ut)}function q_(t,e){const[n,i,r=0]=t;return Tn(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(r)),dr(e,[n,i,r,1])}function vo(t,e,n=0){const[i,r,s]=t;if(Tn(Number.isFinite(i)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(s))return dr(e,[i,r,s,1]);const o=dr(e,[i,r,0,1]),a=dr(e,[i,r,1,1]),l=o[2],c=a[2],u=l===c?0:((n||0)-l)/(c-l);return I_([],o,a,u)}function Q_(t){const{width:e,height:n,bounds:i,minExtent:r=0,maxZoom:s=24,offset:o=[0,0]}=t,[[a,l],[c,u]]=i,f=zL(t.padding),h=Cr([a,Of(u,-oa,oa)]),g=Cr([c,Of(l,-oa,oa)]),p=[Math.max(Math.abs(g[0]-h[0]),r),Math.max(Math.abs(g[1]-h[1]),r)],w=[e-f.left-f.right-Math.abs(o[0])*2,n-f.top-f.bottom-Math.abs(o[1])*2];Tn(w[0]>0&&w[1]>0);const x=w[0]/p[0],y=w[1]/p[1],m=(f.right-f.left)/2/x,_=(f.top-f.bottom)/2/y,T=[(g[0]+h[0])/2+m,(g[1]+h[1])/2+_],P=Lr(T),A=Math.min(s,ud(Math.abs(Math.min(x,y))));return Tn(Number.isFinite(A)),{longitude:P[0],latitude:P[1],zoom:A}}function zL(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Tn(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const vm=Math.PI/180;function UL(t,e=0){const{width:n,height:i,unproject:r}=t,s={targetZ:e},o=r([0,i],s),a=r([n,i],s);let l,c;const u=t.fovy?.5*t.fovy*vm:Math.atan(.5/t.altitude),f=(90-t.pitch)*vm;return u>f-.01?(l=ym(t,0,e),c=ym(t,n,e)):(l=r([0,0],s),c=r([n,0],s)),[o,a,c,l]}function ym(t,e,n){const{pixelUnprojectionMatrix:i}=t,r=dr(i,[e,0,1,1]),s=dr(i,[e,t.height,1,1]),a=(n*t.distanceScales.unitsPerMeter[2]-r[2])/(s[2]-r[2]),l=I_([],r,s,a),c=Lr(l);return c.push(n),c}const _m=512;function BL(t){const{width:e,height:n,pitch:i=0}=t;let{longitude:r,latitude:s,zoom:o,bearing:a=0}=t;(r<-180||r>180)&&(r=mm(r+180,360)-180),(a<-180||a>180)&&(a=mm(a+180,360)-180);const l=ud(n/_m);if(o<=l)o=l,s=0;else{const c=n/2/Math.pow(2,o),u=Lr([0,c])[1];if(s<u)s=u;else{const f=Lr([0,_m-c])[1];s>f&&(s=f)}}return{width:e,height:n,longitude:r,latitude:s,zoom:o,pitch:i,bearing:a}}const VL=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,jL=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,GL=$l(ZL),WL=$l($L),HL=[0,0,0,1],XL=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function YL(t,e){const[n,i,r]=t,s=vo([n,i,r],e);return Number.isFinite(r)?s:[s[0],s[1],0]}function ZL({viewport:t,center:e}){return new Ue(t.viewProjectionMatrix).invert().transform(e)}function $L({viewport:t,shadowMatrices:e}){const n=[],i=t.pixelUnprojectionMatrix,r=t.isGeospatial?void 0:1,s=[[0,0,r],[t.width,0,r],[0,t.height,r],[t.width,t.height,r],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>YL(o,i));for(const o of e){const a=o.clone().translate(new Pt(t.center).negate()),l=s.map(u=>a.transform(u)),c=new Ue().ortho({left:Math.min(...l.map(u=>u[0])),right:Math.max(...l.map(u=>u[0])),bottom:Math.min(...l.map(u=>u[1])),top:Math.max(...l.map(u=>u[1])),near:Math.min(...l.map(u=>-u[2])),far:Math.max(...l.map(u=>-u[2]))});n.push(c.multiplyRight(o))}return n}function KL(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const i={shadow_uDrawShadowMap:Boolean(t.drawToShadowMap),shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||HL,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},r=GL({viewport:t.viewport,center:e.project_uCenter}),s=[],o=WL({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let a=0;a<t.shadowMatrices.length;a++){const l=o[a],c=l.clone().translate(new Pt(t.viewport.center).negate());e.project_uCoordinateSystem===$.LNGLAT&&e.project_uProjectionMode===kt.WEB_MERCATOR?(o[a]=c,s[a]=r):(o[a]=l.clone().multiplyRight(XL),s[a]=c.transform(r))}for(let a=0;a<o.length;a++)i["shadow_uViewProjectionMatrices[".concat(a,"]")]=o[a],i["shadow_uProjectCenters[".concat(a,"]")]=s[a],t.shadowMaps&&t.shadowMaps.length>0?i["shadow_uShadowMap".concat(a)]=t.shadowMaps[a]:i["shadow_uShadowMap".concat(a)]=t.dummyShadowMap;return i}var fu={name:"shadow",dependencies:[cd],vs:VL,fs:jL,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?KL(t,e):{}},nn={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...N2};const qL=[cd],QL=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function JL(t){const e=po.getDefaultProgramManager(t);for(const n of qL)e.addDefaultModule(n);for(const n of QL)e.addShaderHook(n);return e}const e3=[255,255,255],t3=1;let n3=0;class i3{constructor(e={}){d(this,"id",void 0),d(this,"color",void 0),d(this,"intensity",void 0),d(this,"type","ambient");const{color:n=e3}=e,{intensity:i=t3}=e;this.id=e.id||"ambient-".concat(n3++),this.color=n,this.intensity=i}}const r3=[255,255,255],s3=1,o3=[0,0,-1];let a3=0;class wm{constructor(e={}){d(this,"id",void 0),d(this,"color",void 0),d(this,"intensity",void 0),d(this,"type","directional"),d(this,"direction",void 0),d(this,"shadow",void 0);const{color:n=r3}=e,{intensity:i=s3}=e,{direction:r=o3}=e,{_shadow:s=!1}=e;this.id=e.id||"directional-".concat(a3++),this.color=n,this.intensity=i,this.type="directional",this.direction=new Pt(r).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class l3{constructor(e,n={id:"pass"}){d(this,"id",void 0),d(this,"gl",void 0),d(this,"props",void 0);const{id:i}=n;this.id=i,this.gl=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Kl extends l3{constructor(...e){super(...e),d(this,"_lastRenderIndex",-1)}render(e){const n=this.gl;return xn(n,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:n,moduleParameters:i,viewports:r,views:s,onViewportActive:o,clearStack:a=!0,clearCanvas:l=!0}=e;e.pass=e.pass||"unknown";const c=this.gl;l&&u3(c),a&&(this._lastRenderIndex=-1);const u=[];for(const f of r){const h=s&&s[f.id];o(f);const g=this._getDrawLayerParams(f,e),p=f.subViewports||[f];for(const w of p){const x=this._drawLayersInViewport(c,{target:n,moduleParameters:i,viewport:w,view:h,pass:e.pass,layers:e.layers},g);u.push(x)}}return u}_getDrawLayerParams(e,{layers:n,pass:i,layerFilter:r,cullRect:s,effects:o,moduleParameters:a}){const l=[],c=J_(this._lastRenderIndex+1),u={layer:n[0],viewport:e,isPicking:i.startsWith("picking"),renderPass:i,cullRect:s},f={};for(let h=0;h<n.length;h++){const g=n[h],p=this._shouldDrawLayer(g,u,r,f),w={shouldDrawLayer:p};p&&(w.layerRenderIndex=c(g,p),w.moduleParameters=this._getModuleParameters(g,o,i,a),w.layerParameters=this.getLayerParameters(g,h,e)),l[h]=w}return l}_drawLayersInViewport(e,{layers:n,moduleParameters:i,pass:r,target:s,viewport:o,view:a},l){const c=c3(e,{moduleParameters:i,target:s,viewport:o});if(a&&a.props.clear){const f=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;xt(e,{scissorTest:!0,scissor:c},()=>ed(e,f))}const u={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};xn(e,{viewport:c});for(let f=0;f<n.length;f++){const h=n[f],{shouldDrawLayer:g,layerRenderIndex:p,moduleParameters:w,layerParameters:x}=l[f];if(g&&h.props.pickable&&u.pickableCount++,h.isComposite)u.compositeCount++;else if(g){u.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,p),w.viewport=o;try{h._drawLayer({moduleParameters:w,uniforms:{layerIndex:p},parameters:x})}catch(y){h.raiseError(y,"drawing ".concat(h," to ").concat(r))}}}return u}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,i){return e.props.parameters}_shouldDrawLayer(e,n,i,r){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(n))return!1;n.layer=o,o=o.parent}if(i){const a=n.layer.id;if(a in r||(r[a]=i(n)),!r[a])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,i,r){var s;const o=Object.assign(Object.create(((s=e.internalState)===null||s===void 0?void 0:s.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:Tr(this.gl)});if(n)for(const l of n){var a;Object.assign(o,(a=l.getModuleParameters)===null||a===void 0?void 0:a.call(l,e))}return Object.assign(o,this.getModuleParameters(e,n),r)}}function J_(t=0,e={}){const n={},i=(r,s)=>{const o=r.props._offset,a=r.id,l=r.parent&&r.parent.id;let c;if(l&&!(l in e)&&i(r.parent,!1),l in n){const u=n[l]=n[l]||J_(e[l],e);c=u(r,s),n[a]=u}else Number.isFinite(o)?(c=o+(e[l]||0),n[a]=null):c=t;return s&&c>=t&&(t=c+1),e[a]=c,c};return i}function c3(t,{moduleParameters:e,target:n,viewport:i}){const r=n&&n.id!=="default-framebuffer",s=e&&e.devicePixelRatio||Tr(t),o=r?n.height:t.drawingBufferHeight,a=i;return[a.x*s,o-(a.y+a.height)*s,a.width*s,a.height*s]}function u3(t){const e=t.drawingBufferWidth,n=t.drawingBufferHeight;xn(t,{viewport:[0,0,e,n]}),t.clear(16640)}class f3 extends Kl{constructor(e,n){super(e,n),d(this,"shadowMap",void 0),d(this,"depthBuffer",void 0),d(this,"fbo",void 0),this.shadowMap=new We(e,{width:1,height:1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.depthBuffer=new ir(e,{format:33189,width:1,height:1}),this.fbo=new _e(e,{id:"shadowmap",width:1,height:1,attachments:{[36064]:this.shadowMap,[36096]:this.depthBuffer}})}render(e){const n=this.fbo;xt(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const i=e.viewports[0],r=Tr(this.gl),s=i.width*r,o=i.height*r;(s!==n.width||o!==n.height)&&n.resize({width:s,height:o}),super.render({...e,target:n,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const h3={color:[255,255,255],intensity:1},Em=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],d3=[0,0,0,200/255];class e1{constructor(e={}){d(this,"id","lighting-effect"),d(this,"props",null),d(this,"shadowColor",d3),d(this,"shadow",void 0),d(this,"ambientLight",null),d(this,"directionalLights",[]),d(this,"pointLights",[]),d(this,"shadowPasses",[]),d(this,"shadowMaps",[]),d(this,"dummyShadowMap",null),d(this,"programManager",void 0),d(this,"shadowMatrices",void 0);for(const n in e){const i=e[n];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow)}preRender(e,{layers:n,layerFilter:i,viewports:r,onViewportActive:s,views:o}){if(!!this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=po.getDefaultProgramManager(e),fu&&this.programManager.addDefaultModule(fu)),this.dummyShadowMap||(this.dummyShadowMap=new We(e,{width:1,height:1}));for(let a=0;a<this.shadowPasses.length;a++)this.shadowPasses[a].render({layers:n,layerFilter:i,viewports:r,onViewportActive:s,views:o,moduleParameters:{shadowLightId:a,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(i=>i.getProjectedLight({layer:e})),pointLights:this.pointLights.map(i=>i.getProjectedLight({layer:e}))},n}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(fu),this.programManager=null)}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const i=new Ue().lookAt({eye:new Pt(n.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const i=new f3(e);this.shadowPasses[n]=i,this.shadowMaps[n]=i.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:i}=this;!e&&n.length===0&&i.length===0&&(this.ambientLight=new i3(h3),this.directionalLights.push(new wm(Em[0]),new wm(Em[1])))}}class g3{constructor(e={}){d(this,"_pool",[]),d(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:i=1,type:r,padding:s=0,copy:o=!1,initialize:a=!1,maxCount:l}){const c=r||e&&e.constructor||Float32Array,u=n*i+s;if(ArrayBuffer.isView(e)){if(u<=e.length)return e;if(u*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new c(e.buffer,0,u)}let f=1/0;l&&(f=l*i+s);const h=this._allocate(c,u,a,f);return e&&o?h.set(e):a||h.fill(0,0,4),this._release(e),h}release(e){this._release(e)}_allocate(e,n,i,r){let s=Math.max(Math.ceil(n*this.opts.overAlloc),1);s>r&&(s=r);const o=this._pool,a=e.BYTES_PER_ELEMENT*s,l=o.findIndex(c=>c.byteLength>=a);if(l>=0){const c=new e(o.splice(l,1)[0],0,s);return i&&c.fill(0),c}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:i}=e,{byteLength:r}=i,s=n.findIndex(o=>o.byteLength>=r);s<0?n.push(i):(s>0||n.length<this.opts.poolSize)&&n.splice(s,0,i),n.length>this.opts.poolSize&&n.shift()}}var Mr=new g3;function gs(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function wl(t,e){const n=t%e;return n<0?e+n:n}function p3(t){return[t[12],t[13],t[14]]}function m3(t){return{left:ji(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:ji(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:ji(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:ji(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:ji(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:ji(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const xm=new Pt;function ji(t,e,n,i){xm.set(t,e,n);const r=xm.len();return{distance:i/r,normal:new Pt(-t/r,-e/r,-n/r)}}function v3(t){return t-Math.fround(t)}let ss;function hu(t,e){const{size:n=1,startIndex:i=0}=e,r=e.endIndex!==void 0?e.endIndex:t.length,s=(r-i)/n;ss=Mr.allocate(ss,s,{type:Float32Array,size:n*2});let o=i,a=0;for(;o<r;){for(let l=0;l<n;l++){const c=t[o++];ss[a+l]=c,ss[a+l+n]=v3(c)}a+=n*2}return ss.subarray(0,s*n*2)}const y3=Math.PI/180,_3=gs(),Tm=[0,0,0],w3={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function E3({width:t,height:e,orthographic:n,fovyRadians:i,focalDistance:r,padding:s,near:o,far:a}){const l=t/e,c=n?new Ue().orthographic({fovy:i,aspect:l,focalDistance:r,near:o,far:a}):new Ue().perspective({fovy:i,aspect:l,near:o,far:a});if(s){const{left:u=0,right:f=0,top:h=0,bottom:g=0}=s,p=pe((u+t-f)/2,0,t)-t/2,w=pe((h+e-g)/2,0,e)-e/2;c[8]-=p*2/t,c[9]+=w*2/e}return c}class rn{constructor(e={}){d(this,"id",void 0),d(this,"x",void 0),d(this,"y",void 0),d(this,"width",void 0),d(this,"height",void 0),d(this,"padding",void 0),d(this,"isGeospatial",void 0),d(this,"zoom",void 0),d(this,"focalDistance",void 0),d(this,"position",void 0),d(this,"modelMatrix",void 0),d(this,"distanceScales",void 0),d(this,"scale",void 0),d(this,"center",void 0),d(this,"cameraPosition",void 0),d(this,"projectionMatrix",void 0),d(this,"viewMatrix",void 0),d(this,"viewMatrixUncentered",void 0),d(this,"viewMatrixInverse",void 0),d(this,"viewProjectionMatrix",void 0),d(this,"pixelProjectionMatrix",void 0),d(this,"pixelUnprojectionMatrix",void 0),d(this,"resolution",void 0),d(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||w3,this.focalDistance=e.focalDistance||1,this.position=e.position||Tm,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?kt.WEB_MERCATOR:kt.WEB_MERCATOR_AUTO_OFFSET:kt.IDENTITY}equals(e){return e instanceof rn?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&mn(e.projectionMatrix,this.projectionMatrix)&&mn(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const i=this.projectPosition(e),r=q_(i,this.pixelProjectionMatrix),[s,o]=r,a=n?o:this.height-o;return e.length===2?[s,a]:[s,a,r[2]]}unproject(e,{topLeft:n=!0,targetZ:i}={}){const[r,s,o]=e,a=n?s:this.height-s,l=i&&i*this.distanceScales.unitsPerMeter[2],c=vo([r,a,o],this.pixelUnprojectionMatrix,l),[u,f,h]=this.unprojectPosition(c);return Number.isFinite(o)?[u,f,h]:Number.isFinite(i)?[u,f,i]:[u,f]}projectPosition(e){const[n,i]=this.projectFlat(e),r=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,i,r]}unprojectPosition(e){const[n,i]=this.unprojectFlat(e),r=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,i,r]}projectFlat(e){if(this.isGeospatial){const n=Cr(e);return n[1]=pe(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?Lr(e):e}getBounds(e={}){const n={targetZ:e.z||0},i=this.unproject([0,0],n),r=this.unproject([this.width,0],n),s=this.unproject([0,this.height],n),o=this.unproject([this.width,this.height],n);return[Math.min(i[0],r[0],s[0],o[0]),Math.min(i[1],r[1],s[1],o[1]),Math.max(i[0],r[0],s[0],o[0]),Math.max(i[1],r[1],s[1],o[1])]}getDistanceScales(e){return e?Ff({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:i=1,height:r=1}){return e<this.x+this.width&&this.x<e+i&&n<this.y+this.height&&this.y<n+r}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,m3(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=$_({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Ff({latitude:i,longitude:n}));const r=Math.pow(2,this.zoom);this.scale=r;const{position:s,modelMatrix:o}=e;let a=Tm;if(s&&(a=o?new Ue(o).transformAsVector(s,[]):s),this.isGeospatial){const l=this.projectPosition([n,i,0]);this.center=new Pt(a).scale(this.distanceScales.unitsPerMeter).add(l)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:n=_3,projectionMatrix:i=null,orthographic:r=!1,fovyRadians:s,fovy:o=75,near:a=.1,far:l=1e3,padding:c=null,focalDistance:u=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new Ue().multiplyRight(n).translate(new Pt(this.center).negate()),this.projectionMatrix=i||E3({width:this.width,height:this.height,orthographic:r,fovyRadians:s||o*y3,focalDistance:u,padding:c,near:a,far:l});const f=gs();Ei(f,f,this.projectionMatrix),Ei(f,f,this.viewMatrix),this.viewProjectionMatrix=f,this.viewMatrixInverse=If([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=p3(this.viewMatrixInverse);const h=gs(),g=gs();od(h,h,[this.width/2,-this.height/2,1]),vl(h,h,[1,-1,0]),Ei(g,h,this.viewProjectionMatrix),this.pixelProjectionMatrix=g,this.pixelUnprojectionMatrix=If(gs(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||W.warn("Pixel project matrix not invertible")()}}d(rn,"displayName","Viewport");const x3=512,T3=4003e4,S3=Math.PI/180;function Sm(t){const e=Math.cos(t*S3);return x3/T3/e}class ei extends rn{constructor(e={}){const{latitude:n=0,longitude:i=0,zoom:r=0,pitch:s=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:l=1.01,orthographic:c=!1,projectionMatrix:u,repeat:f=!1,worldOffset:h=0,legacyMeterSizes:g=!1}=e;let{width:p,height:w,altitude:x=1.5}=e;const y=Math.pow(2,r);p=p||1,w=w||1;let m,_=null;u?(x=u[5]/2,m=_l(x)):(e.fovy?(m=e.fovy,x=fd(m)):m=_l(x),_=DL({width:p,height:w,pitch:s,fovy:m,nearZMultiplier:a,farZMultiplier:l}));let T=FL({height:w,pitch:s,bearing:o,scale:y,altitude:x});h&&(T=new Ue().translate([512*h,0,0]).multiplyLeft(T)),super({...e,width:p,height:w,viewMatrix:T,longitude:i,latitude:n,zoom:r,..._,fovy:m,focalDistance:x}),d(this,"longitude",void 0),d(this,"latitude",void 0),d(this,"pitch",void 0),d(this,"bearing",void 0),d(this,"altitude",void 0),d(this,"fovy",void 0),d(this,"orthographic",void 0),d(this,"_subViewports",void 0),d(this,"_pseudoMeters",void 0),this.latitude=n,this.longitude=i,this.zoom=r,this.pitch=s,this.bearing=o,this.altitude=x,this.fovy=m,this.orthographic=c,this._subViewports=f?[]:null,this._pseudoMeters=g,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let r=n;r<=i;r++){const s=r?new ei({...this,worldOffset:r}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,i]=this.projectFlat(e),r=(e[2]||0)*Sm(e[1]);return[n,i,r]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,i]=this.unprojectFlat(e),r=(e[2]||0)/Sm(i);return[n,i,r]}addMetersToLngLat(e,n){return K_(e,n)}panByPosition(e,n){const i=vo(n,this.pixelUnprojectionMatrix),r=this.projectFlat(e),s=ml([],r,M_([],i)),o=ml([],this.center,s),[a,l]=this.unprojectFlat(o);return{longitude:a,latitude:l}}getBounds(e={}){const n=UL(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:i,height:r}=this,{longitude:s,latitude:o,zoom:a}=Q_({width:i,height:r,bounds:e,...n});return new ei({width:i,height:r,longitude:s,latitude:o,zoom:a})}}d(ei,"displayName","WebMercatorViewport");function du(t,e,n=!1){const i=e.projectPosition(t);if(n&&e instanceof ei){const[r,s,o=0]=t,a=e.getDistanceScales([r,s]);i[2]=o*a.unitsPerMeter[2]}return i}function P3(t){const{viewport:e,modelMatrix:n,coordinateOrigin:i}=t;let{coordinateSystem:r,fromCoordinateSystem:s,fromCoordinateOrigin:o}=t;return r===$.DEFAULT&&(r=e.isGeospatial?$.LNGLAT:$.CARTESIAN),s===void 0&&(s=r),o===void 0&&(o=i),{viewport:e,coordinateSystem:r,coordinateOrigin:i,modelMatrix:n,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function t1(t,{viewport:e,modelMatrix:n,coordinateSystem:i,coordinateOrigin:r,offsetMode:s}){let[o,a,l=0]=t;switch(n&&([o,a,l]=Fr([],[o,a,l,1],n)),i){case $.LNGLAT:return du([o,a,l],e,s);case $.LNGLAT_OFFSETS:return du([o+r[0],a+r[1],l+(r[2]||0)],e,s);case $.METER_OFFSETS:return du(K_(r,[o,a,l]),e,s);case $.CARTESIAN:default:return e.isGeospatial?[o+r[0],a+r[1],l+r[2]]:e.projectPosition([o,a,l])}}function b3(t,e){const{viewport:n,coordinateSystem:i,coordinateOrigin:r,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:a}=P3(e),{geospatialOrigin:l,shaderCoordinateOrigin:c,offsetMode:u}=Y_(n,i,r),f=t1(t,{viewport:n,modelMatrix:s,coordinateSystem:o,coordinateOrigin:a,offsetMode:u});if(u){const h=n.projectPosition(l||c);N_(f,f,h)}return f}const Wi={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},El=Symbol.for("component"),gr=Symbol.for("asyncPropDefaults"),Ci=Symbol.for("asyncPropOriginal"),Vn=Symbol.for("asyncPropResolved");function hd(t,e=()=>!0){return Array.isArray(t)?n1(t,e,[]):e(t)?[t]:[]}function n1(t,e,n){let i=-1;for(;++i<t.length;){const r=t[i];Array.isArray(r)?n1(r,e,n):e(r)&&n.push(r)}return n}function A3({target:t,source:e,start:n=0,count:i=1}){const r=e.length,s=i*r;let o=0;for(let a=n;o<r;o++)t[a++]=e[o];for(;o<s;)o<s-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+s-o),o=s);return t}class C3{constructor(e,n,i){d(this,"id",void 0),d(this,"context",void 0),d(this,"isLoaded",void 0),d(this,"persistent",void 0),d(this,"_loadCount",0),d(this,"_subscribers",new Set),d(this,"_data",void 0),d(this,"_loader",void 0),d(this,"_error",void 0),d(this,"_content",void 0),this.id=e,this.context=i,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const i=++this._loadCount;let r=e;typeof e=="string"&&(r=dl(e)),r instanceof Promise?(this.isLoaded=!1,this._loader=r.then(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class L3{constructor({gl:e,protocol:n}){d(this,"protocol",void 0),d(this,"_context",void 0),d(this,"_resources",void 0),d(this,"_consumers",void 0),d(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:i=!1,persistent:r=!0}){let s=this._resources[e];s?s.setData(n,i):(s=new C3(e,n,this._context),this._resources[e]=s),s.persistent=r}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const i in n){const r=n[i],s=this._resources[r.resourceId];s&&s.unsubscribe(r)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:i,requestId:r="default"}){const{_resources:s,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=s[e];if(this._track(i,r,a,n),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,i,r){const s=this._consumers,o=s[e]=s[e]||{},a=o[n]||{},l=a.resourceId&&this._resources[a.resourceId];l&&(l.unsubscribe(a),this.prune()),i&&(o[n]=a,a.onChange=r,a.resourceId=i.id,i.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const M3="layerManager.setLayers",I3="layerManager.activateViewport";class R3{constructor(e,{deck:n,stats:i,viewport:r,timeline:s}={}){d(this,"layers",void 0),d(this,"context",void 0),d(this,"resourceManager",void 0),d(this,"_lastRenderedLayers",[]),d(this,"_needsRedraw",!1),d(this,"_needsUpdate",!1),d(this,"_nextLayers",null),d(this,"_debug",!1),d(this,"activateViewport",o=>{Ne(I3,this,o),o&&(this.context.viewport=o)}),this.layers=[],this.resourceManager=new L3({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:n,programManager:e&&JL(e),stats:i||new Hh({id:"deck.gl"}),viewport:r||new rn({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new G_,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const r=i.getNeedsRedraw(e);n=n||r}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(i=>n.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){Ne(M3,this,n,e),this._lastRenderedLayers=e;const i=hd(e,Boolean);for(const r of i)r.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,n,i){i.raiseError(n,"".concat(e," of ").concat(i))}_updateLayers(e,n){const i={};for(const o of e)i[o.id]?W.warn("Multiple old layers with same id ".concat(o.id))():i[o.id]=o;const r=[];this._updateSublayersRecursively(n,i,r),this._finalizeOldLayers(i);let s=!1;for(const o of r)if(o.hasUniformTransition()){s="Uniform transition in ".concat(o);break}this._needsUpdate=s,this.layers=r}_updateSublayersRecursively(e,n,i){for(const r of e){r.context=this.context;const s=n[r.id];s===null&&W.warn("Multiple new layers with same id ".concat(r.id))(),n[r.id]=null;let o=null;try{this._debug&&s!==r&&r.validateProps(),s?(this._transferLayerState(s,r),this._updateLayer(r)):this._initializeLayer(r),i.push(r),o=r.isComposite?r.getSubLayers():null}catch(a){this._handleError("matching",a,r)}o&&this._updateSublayersRecursively(o,n,i)}}_finalizeOldLayers(e){for(const n in e){const i=e[n];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Wi.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=Wi.MATCHED,n!==e&&(e.lifecycle=Wi.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=Wi.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Wi.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function Oi(t,e){if(t===e)return!0;if(!t||!e)return!1;for(const n in t){const i=t[n],r=e[n];if(!(i===r||Array.isArray(i)&&Array.isArray(r)&&Oi(i,r)))return!1}return!0}class O3{constructor(e){d(this,"width",void 0),d(this,"height",void 0),d(this,"views",void 0),d(this,"viewState",void 0),d(this,"controllers",void 0),d(this,"timeline",void 0),d(this,"_viewports",void 0),d(this,"_viewportMap",void 0),d(this,"_isUpdating",void 0),d(this,"_needsRedraw",void 0),d(this,"_needsUpdate",void 0),d(this,"_eventManager",void 0),d(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,i=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,n){const i=this.getViewports(),r={x:e[0],y:e[1]};for(let s=i.length-1;s>=0;--s){const o=i[s];if(o.containsPixel(r)){const a=e.slice();return a[0]-=o.x,a[1]-=o.y,o.unproject(a,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=hd(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Oi(e,this.viewState)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):W.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,n){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...n,viewId:e})}_createController(e,n){const i=n.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var o;return(o=this.getView(e.id))===null||o===void 0?void 0:o.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(e,n,i,r){const s=e.controller;if(s){const o={...n,...s,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return r||(r=this._createController(e,o)),r&&r.setProps(o),r}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let r=e.length;r--;){const s=e[r],o=this.getViewState(s),a=s.makeViewport({viewState:o,width:this.width,height:this.height});let l=n[s.id];const c=Boolean(s.controller);c&&!l&&(i=!0),(i||!c)&&l&&(l.finalize(),l=null),this.controllers[s.id]=this._updateController(s,o,a,l),this._viewports.unshift(a)}for(const r in n){const s=n[r];s&&!this.controllers[r]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((i,r)=>!e[r].equals(n[r]))}}const k3=/([0-9]+\.?[0-9]*)(%|px)/;function Rn(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=k3.exec(t);if(e&&e.length>=3){const n=e[2]==="%",i=parseFloat(e[1]);return{position:n?i/100:i,relative:n}}default:throw new Error("Could not parse position string ".concat(t))}}function On(t,e){return t.relative?Math.round(t.position*e):t.position}function Pe(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class yo{constructor(e){d(this,"id",void 0),d(this,"viewportInstance",void 0),d(this,"_x",void 0),d(this,"_y",void 0),d(this,"_width",void 0),d(this,"_height",void 0),d(this,"_padding",void 0),d(this,"props",void 0);const{id:n,x:i=0,y:r=0,width:s="100%",height:o="100%",padding:a=null,viewportInstance:l}=e||{};Pe(!l||l instanceof rn),this.viewportInstance=l,this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Rn(i),this._y=Rn(r),this._width=Rn(s),this._height=Rn(o),this._padding=a&&{left:Rn(a.left||0),right:Rn(a.right||0),top:Rn(a.top||0),bottom:Rn(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&Oi(this.props,e.props)}makeViewport({width:e,height:n,viewState:i}){if(this.viewportInstance)return this.viewportInstance;i=this.filterViewState(i);const r=this.getDimensions({width:e,height:n});return new this.ViewportType({...i,...this.props,...r})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const i in this.props.viewState)i!=="id"&&(n[i]=this.props.viewState[i]);return n}return e}getDimensions({width:e,height:n}){const i={x:On(this._x,e),y:On(this._y,n),width:On(this._width,e),height:On(this._height,n)};return this._padding&&(i.padding={left:On(this._padding.left,e),top:On(this._padding.top,n),right:On(this._padding.right,e),bottom:On(this._padding.bottom,n)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class _o{constructor(e){d(this,"_inProgress",void 0),d(this,"_handle",void 0),d(this,"_timeline",void 0),d(this,"time",void 0),d(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var n,i;this.cancel(),this.settings=e,this._inProgress=!0,(n=(i=this.settings).onStart)===null||n===void 0||n.call(i,this)}end(){if(this._inProgress){var e,n;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(n=this.settings).onEnd)===null||e===void 0||e.call(n,this)}}cancel(){if(this._inProgress){var e,n;(e=(n=this.settings).onInterrupt)===null||e===void 0||e.call(n,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:i,settings:r}=this;this._handle=i.addChannel({delay:i.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(n=this.settings).onUpdate)===null||e===void 0||e.call(n,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Pm=()=>{},Df={BREAK:1,SNAP_TO_END:2,IGNORE:3},N3=t=>t,F3=Df.BREAK;class D3{constructor(e){d(this,"getControllerState",void 0),d(this,"props",void 0),d(this,"propsInTransition",void 0),d(this,"transition",void 0),d(this,"onViewStateChange",void 0),d(this,"onStateChange",void 0),d(this,"_onTransitionUpdate",n=>{const{time:i,settings:{interpolator:r,startProps:s,endProps:o,duration:a,easing:l}}=n,c=l(i/a),u=r.interpolateProps(s,o,c);this.propsInTransition=this.getControllerState({...this.props,...u}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new _o(e.timeline),this.onViewStateChange=e.onViewStateChange||Pm,this.onStateChange=e.onStateChange||Pm}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let r=i;if(this.transition.inProgress){const{interruption:s,endProps:o}=this.transition.settings;r={...i,...s===Df.SNAP_TO_END?o:this.propsInTransition||i}}this._triggerTransition(r,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:i}=e;return(n>0||n==="auto")&&Boolean(i)}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===Df.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const i=this.getControllerState(e),r=this.getControllerState(n).shortestPathFrom(i),s=n.transitionInterpolator,o=s.getDuration?s.getDuration(e,n):n.transitionDuration;if(o===0)return;const a=s.initializeProps(e,r);this.propsInTransition={};const l={duration:o,easing:n.transitionEasing||N3,interpolator:s,interruption:n.transitionInterruption||F3,startProps:a.start,endProps:a.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(l),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}class z3{constructor(e){d(this,"_propsToCompare",void 0),d(this,"_propsToExtract",void 0),d(this,"_requiredProps",void 0);const{compare:n,extract:i,required:r}=e;this._propsToCompare=n,this._propsToExtract=i||n,this._requiredProps=r}arePropsEqual(e,n){for(const i of this._propsToCompare)if(!(i in e)||!(i in n)||!mn(e[i],n[i]))return!1;return!0}initializeProps(e,n){const i={},r={};for(const s of this._propsToExtract)(s in e||s in n)&&(i[s]=e[s],r[s]=n[s]);return this._checkRequiredProps(i),this._checkRequiredProps(r),{start:i,end:r}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){!this._requiredProps||this._requiredProps.forEach(n=>{const i=e[n];Pe(Number.isFinite(i)||Array.isArray(i),"".concat(n," is required for transition"))})}}const U3=["longitude","latitude","zoom","bearing","pitch"],B3=["longitude","latitude","zoom"];class Dr extends z3{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:U3,required:B3},super(i.transitionProps),d(this,"opts",void 0),this.opts=i}initializeProps(e,n){const i=super.initializeProps(e,n),{makeViewport:r,around:s}=this.opts;if(r&&s){const o=r(e),a=r(n),l=o.unproject(s);i.start.around=s,Object.assign(i.end,{around:a.project(l),aroundPosition:l,width:n.width,height:n.height})}return i}interpolateProps(e,n,i){const r={};for(const s of this._propsToExtract)r[s]=wi(e[s]||0,n[s]||0,i);if(n.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...n,...r});Object.assign(r,s.panByPosition(n.aroundPosition,wi(e.around,n.around,i)))}return r}}const kn={transitionDuration:0},V3=300,aa=t=>1-(1-t)*(1-t),Gi={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},ci={};class wo{constructor(e){d(this,"props",void 0),d(this,"state",{}),d(this,"transitionManager",void 0),d(this,"eventManager",void 0),d(this,"onViewStateChange",void 0),d(this,"onStateChange",void 0),d(this,"makeViewport",void 0),d(this,"_controllerState",void 0),d(this,"_events",{}),d(this,"_interactionState",{isDragging:!1}),d(this,"_customEvents",[]),d(this,"_eventStartBlocked",null),d(this,"_panMove",!1),d(this,"invertPan",!1),d(this,"dragMode","rotate"),d(this,"inertia",0),d(this,"scrollZoom",!0),d(this,"dragPan",!0),d(this,"dragRotate",!0),d(this,"doubleClickZoom",!0),d(this,"touchZoom",!0),d(this,"touchRotate",!1),d(this,"keyboard",!0),this.transitionManager=new D3({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const n in this._events)if(this._events[n]){var e;(e=this.eventManager)===null||e===void 0||e.off(n,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:i}=this.props,{offsetCenter:r}=e;return[r.x-n,r.y-i]}isPointInBounds(e,n){const{width:i,height:r}=this.props;if(n&&n.handled)return!1;const s=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=r;return s&&n&&n.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:n}=e;return Boolean(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?V3:0;const{scrollZoom:i=!0,dragPan:r=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:l=!1,keyboard:c=!0}=e,u=Boolean(this.onViewStateChange);this.toggleEvents(Gi.WHEEL,u&&i),this.toggleEvents(Gi.PAN,u&&(r||s)),this.toggleEvents(Gi.PINCH,u&&(a||l)),this.toggleEvents(Gi.TRIPLE_PAN,u&&l),this.toggleEvents(Gi.DOUBLE_TAP,u&&o),this.toggleEvents(Gi.KEYBOARD,u&&c),this.scrollZoom=i,this.dragPan=r,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=l,this.keyboard=c}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(i=>{this._events[i]!==n&&(this._events[i]=n,n?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,n=null,i={}){const r={...e.getViewportProps(),...n},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),s){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:r,interactionState:this._interactionState,oldViewState:o})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const r=this.controllerState[i?"panStart":"rotateStart"]({pos:n});return this._panMove=i,this.updateViewport(r,kn,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),i=this.controllerState.pan({pos:n});return this.updateViewport(i,kn,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const i=this.getCenter(e),r=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],s=this.controllerState.pan({pos:r}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:aa},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),i=this.controllerState.rotate({pos:n});return this.updateViewport(i,kn,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const i=this.getCenter(e),r=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],s=this.controllerState.rotate({pos:r}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:aa},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;e.srcEvent.preventDefault();const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const{speed:i=.01,smooth:r=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let o=2/(1+Math.exp(-Math.abs(s*i)));s<0&&o!==0&&(o=1/o);const a=this.controllerState.zoom({pos:n,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:n}),transitionDuration:r?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.rotateStart({pos:n});return this.updateViewport(i,kn,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const i=this.controllerState.rotate({pos:n});return this.updateViewport(i,kn,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const i=this.getCenter(e),r=[i[0],i[1]+=e.velocityY*n/2],s=this.controllerState.rotate({pos:r});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:aa},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return ci._startPinchRotation=e.rotation,ci._lastPinchEvent=e,this.updateViewport(i,kn,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:i}=e,r=this.getCenter(e);n=n.zoom({pos:r,scale:i})}if(this.touchRotate){const{rotation:i}=e;n=n.rotate({deltaAngleX:ci._startPinchRotation-i})}return this.updateViewport(n,kn,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),ci._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:i}=ci;if(this.touchZoom&&n&&i&&e.scale!==i.scale){const r=this.getCenter(e);let s=this.controllerState.rotateEnd();const o=Math.log2(e.scale),a=(o-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),l=Math.pow(2,o+a*n/2);s=s.zoom({pos:r,scale:l}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:r}),transitionDuration:n,transitionEasing:aa},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const r=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return ci._startPinchRotation=null,ci._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.isFunctionKeyPressed(e),r=this.controllerState.zoom({pos:n,scale:i?.5:2});return this.updateViewport(r,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:r,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let l;const c={};switch(e.srcEvent.code){case"Minus":l=n?a.zoomOut(i).zoomOut(i):a.zoomOut(i),c.isZooming=!0;break;case"Equal":l=n?a.zoomIn(i).zoomIn(i):a.zoomIn(i),c.isZooming=!0;break;case"ArrowLeft":n?(l=a.rotateLeft(s),c.isRotating=!0):(l=a.moveLeft(r),c.isPanning=!0);break;case"ArrowRight":n?(l=a.rotateRight(s),c.isRotating=!0):(l=a.moveRight(r),c.isPanning=!0);break;case"ArrowUp":n?(l=a.rotateUp(o),c.isRotating=!0):(l=a.moveUp(r),c.isPanning=!0);break;case"ArrowDown":n?(l=a.rotateDown(o),c.isRotating=!0):(l=a.moveDown(r),c.isPanning=!0);break;default:return!1}return this.updateViewport(l,this._getTransitionProps(),c),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?kn:e?{...n,transitionInterpolator:new Dr({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class dd{constructor(e,n){d(this,"_viewportProps",void 0),d(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const bm=5,j3=1.2;class i1 extends dd{constructor(e){const{width:n,height:i,latitude:r,longitude:s,zoom:o,bearing:a=0,pitch:l=0,altitude:c=1.5,position:u=[0,0,0],maxZoom:f=20,minZoom:h=0,maxPitch:g=60,minPitch:p=0,startPanLngLat:w,startZoomLngLat:x,startRotatePos:y,startBearing:m,startPitch:_,startZoom:T,normalize:P=!0}=e;Pe(Number.isFinite(s)),Pe(Number.isFinite(r)),Pe(Number.isFinite(o)),super({width:n,height:i,latitude:r,longitude:s,zoom:o,bearing:a,pitch:l,altitude:c,maxZoom:f,minZoom:h,maxPitch:g,minPitch:p,normalize:P,position:u},{startPanLngLat:w,startZoomLngLat:x,startRotatePos:y,startBearing:m,startPitch:_,startZoom:T}),d(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const i=this.getState().startPanLngLat||this._unproject(n);if(!i)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:i=0}){const{startRotatePos:r,startBearing:s,startPitch:o}=this.getState();if(!r||s===void 0||o===void 0)return this;let a;return e?a=this._getNewRotation(e,r,o,s):a={bearing:s+n,pitch:o+i},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:i}){let{startZoom:r,startZoomLngLat:s}=this.getState();if(s||(r=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const{maxZoom:o,minZoom:a}=this.getViewportProps();let l=r+Math.log2(i);l=pe(l,a,o);const c=this.makeViewport({...this.getViewportProps(),zoom:l});return this._getUpdatedState({zoom:l,...c.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),i={...this.getViewportProps()},{bearing:r,longitude:s}=i;return Math.abs(r-n.bearing)>180&&(i.bearing=r<0?r+360:r-360),Math.abs(s-n.longitude)>180&&(i.longitude=s<0?s+360:s-360),i}applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:r}=e;e.zoom=pe(r,i,n);const{maxPitch:s,minPitch:o,pitch:a}=e;e.pitch=pe(a,o,s);const{normalize:l=!0}=e;return l&&Object.assign(e,BL(e)),e}_zoomFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.zoom({pos:[n/2,i/2],scale:e})}_panFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.pan({startPos:[n/2,i/2],pos:[n/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,i,r){const s=e[0]-n[0],o=e[1]-n[1],a=e[1],l=n[1],{width:c,height:u}=this.getViewportProps(),f=s/c;let h=0;o>0?Math.abs(u-l)>bm&&(h=o/(l-u)*j3):o<0&&l>bm&&(h=1-a/l),h=pe(h,-1,1);const{minPitch:g,maxPitch:p}=this.getViewportProps(),w=r+180*f;let x=i;return h>0?x=i+h*(p-i):h<0&&(x=i-h*(g-i)),{pitch:x,bearing:w}}}class G3 extends wo{constructor(...e){super(...e),d(this,"ControllerState",i1),d(this,"transition",{transitionDuration:300,transitionInterpolator:new Dr({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),d(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class r1 extends yo{get ViewportType(){return ei}get ControllerType(){return G3}}d(r1,"displayName","MapView");class W3 extends Kl{constructor(e,n){super(e,n),d(this,"maskMap",void 0),d(this,"fbo",void 0);const{mapSize:i=2048}=n;this.maskMap=new We(e,{width:i,height:i,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.fbo=new _e(e,{id:"maskmap",width:i,height:i,attachments:{[36064]:this.maskMap}})}render(e){const n=this.gl,i=[!1,!1,!1,!1];return i[e.channel]=!0,xt(n,{clearColor:[255,255,255,255],blend:!0,blendFunc:[0,1],blendEquation:32778,colorMask:i,depthTest:!1},()=>super.render({...e,target:this.fbo,pass:"mask"}))}shouldDrawLayer(e){return e.props.operation===mo.MASK}delete(){this.fbo.delete(),this.maskMap.delete()}}const H3=new Ue().lookAt({eye:[0,0,1]});function X3({width:t,height:e,near:n,far:i,padding:r}){let s=-t/2,o=t/2,a=-e/2,l=e/2;if(r){const{left:c=0,right:u=0,top:f=0,bottom:h=0}=r,g=pe((c+t-u)/2,0,t)-t/2,p=pe((f+e-h)/2,0,e)-e/2;s-=g,o-=g,a+=p,l+=p}return new Ue().ortho({left:s,right:o,bottom:a,top:l,near:n,far:i})}class Y3 extends rn{constructor(e){const{width:n,height:i,near:r=.1,far:s=1e3,zoom:o=0,target:a=[0,0,0],padding:l=null,flipY:c=!0}=e,u=Array.isArray(o)?o[0]:o,f=Array.isArray(o)?o[1]:o,h=Math.min(u,f),g=Math.pow(2,h);let p;if(u!==f){const w=Math.pow(2,u),x=Math.pow(2,f);p={unitsPerMeter:[w/g,x/g,1],metersPerUnit:[g/w,g/x,1]}}super({...e,longitude:void 0,position:a,viewMatrix:H3.clone().scale([g,g*(c?-1:1),g]),projectionMatrix:X3({width:n||1,height:i||1,padding:l,near:r,far:s}),zoom:h,distanceScales:p})}projectFlat([e,n]){const{unitsPerMeter:i}=this.distanceScales;return[e*i[0],n*i[1]]}unprojectFlat([e,n]){const{metersPerUnit:i}=this.distanceScales;return[e*i[0],n*i[1]]}panByPosition(e,n){const i=vo(n,this.pixelUnprojectionMatrix),r=this.projectFlat(e),s=ml([],r,M_([],i)),o=ml([],this.center,s);return{target:this.unprojectFlat(o)}}}class s1 extends dd{constructor(e){const{width:n,height:i,rotationX:r=0,rotationOrbit:s=0,target:o=[0,0,0],zoom:a=0,minRotationX:l=-90,maxRotationX:c=90,minZoom:u=-1/0,maxZoom:f=1/0,startPanPosition:h,startRotatePos:g,startRotationX:p,startRotationOrbit:w,startZoomPosition:x,startZoom:y}=e;super({width:n,height:i,rotationX:r,rotationOrbit:s,target:o,zoom:a,minRotationX:l,maxRotationX:c,minZoom:u,maxZoom:f},{startPanPosition:h,startRotatePos:g,startRotationX:p,startRotationOrbit:w,startZoomPosition:x,startZoom:y}),d(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanPosition:this._unproject(e)})}pan({pos:e,startPosition:n}){const i=this.getState().startPanPosition||n;if(!i)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:i=0}){const{startRotatePos:r,startRotationX:s,startRotationOrbit:o}=this.getState(),{width:a,height:l}=this.getViewportProps();if(!r||s===void 0||o===void 0)return this;let c;if(e){let u=(e[0]-r[0])/a;const f=(e[1]-r[1])/l;(s<-90||s>90)&&(u*=-1),c={rotationX:s+f*180,rotationOrbit:o+u*180}}else c={rotationX:s+i,rotationOrbit:o+n};return this._getUpdatedState(c)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(e){const n=e.getViewportProps(),i={...this.getViewportProps()},{rotationOrbit:r}=i;return Math.abs(r-n.rotationOrbit)>180&&(i.rotationOrbit=r<0?r+360:r-360),i}zoomStart({pos:e}){return this._getUpdatedState({startZoomPosition:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:i}){let{startZoom:r,startZoomPosition:s}=this.getState();if(s||(r=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const o=this._calculateNewZoom({scale:i,startZoom:r}),a=this.makeViewport({...this.getViewportProps(),zoom:o});return this._getUpdatedState({zoom:o,...a.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:e})})}zoomOut(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/e})})}moveLeft(e=50){return this._panFromCenter([-e,0])}moveRight(e=50){return this._panFromCenter([e,0])}moveUp(e=50){return this._panFromCenter([0,-e])}moveDown(e=50){return this._panFromCenter([0,e])}rotateLeft(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-e})}rotateRight(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+e})}rotateUp(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-e})}rotateDown(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_calculateNewZoom({scale:e,startZoom:n}){const{maxZoom:i,minZoom:r}=this.getViewportProps();n===void 0&&(n=this.getViewportProps().zoom);const s=n+Math.log2(e);return pe(s,r,i)}_panFromCenter(e){const{width:n,height:i,target:r}=this.getViewportProps();return this.pan({startPosition:r,pos:[n/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:r,maxRotationX:s,minRotationX:o,rotationOrbit:a}=e;return e.zoom=Array.isArray(r)?[pe(r[0],i,n),pe(r[1],i,n)]:pe(r,i,n),e.rotationX=pe(e.rotationX,o,s),(a<-180||a>180)&&(e.rotationOrbit=wl(a+180,360)-180),e}}class Z3 extends wo{constructor(...e){super(...e),d(this,"ControllerState",s1),d(this,"transition",{transitionDuration:300,transitionInterpolator:new Dr({transitionProps:{compare:["target","zoom","rotationX","rotationOrbit"],required:["target","zoom"]}})})}}class $3 extends s1{constructor(e){super(e),d(this,"zoomAxis",void 0),this.zoomAxis=e.zoomAxis||"all"}_calculateNewZoom({scale:e,startZoom:n}){const{maxZoom:i,minZoom:r}=this.getViewportProps();n===void 0&&(n=this.getViewportProps().zoom);let s=Math.log2(e);if(Array.isArray(n)){let[o,a]=n;switch(this.zoomAxis){case"X":o=pe(o+s,r,i);break;case"Y":a=pe(a+s,r,i);break;default:let l=Math.min(o+s,a+s);l<r&&(s+=r-l),l=Math.max(o+s,a+s),l>i&&(s+=i-l),o+=s,a+=s}return[o,a]}return pe(n+s,r,i)}}class K3 extends wo{constructor(...e){super(...e),d(this,"ControllerState",$3),d(this,"transition",{transitionDuration:300,transitionInterpolator:new Dr(["target","zoom"])}),d(this,"dragMode","pan")}_onPanRotate(){return!1}}class o1 extends yo{get ViewportType(){return Y3}get ControllerType(){return K3}}d(o1,"displayName","OrthographicView");function q3({layers:t,viewport:e}){let n=null;for(const s of t){const o=s.getBounds();o&&(n?(n[0]=Math.min(n[0],o[0][0]),n[1]=Math.min(n[1],o[0][1]),n[2]=Math.max(n[2],o[1][0]),n[3]=Math.max(n[3],o[1][1])):n=[o[0][0],o[0][1],o[1][0],o[1][1]])}const i=e.getBounds();if(!n)return i;const r=J3(i);return n[2]-n[0]<r[2]-r[0]||n[3]-n[1]<r[3]-r[1]||(n[0]=Math.max(n[0],r[0]),n[1]=Math.max(n[1],r[1]),n[2]=Math.min(n[2],r[2]),n[3]=Math.min(n[3],r[3])),n}function Q3({bounds:t,viewport:e,width:n,height:i}){if(t[2]<=t[0]||t[3]<=t[1])return null;const r=1;if(n-=r*2,i-=r*2,e instanceof ei){const{longitude:a,latitude:l,zoom:c}=Q_({width:n,height:i,bounds:[[t[0],t[1]],[t[2],t[3]]],maxZoom:20});return new ei({longitude:a,latitude:l,zoom:c,x:r,y:r,width:n,height:i})}const s=[(t[0]+t[2])/2,(t[1]+t[3])/2,0],o=Math.min(20,n/(t[2]-t[0]),i/(t[3]-t[1]));return new o1({x:r,y:r}).makeViewport({width:n,height:i,viewState:{target:s,zoom:Math.log2(o)}})}function J3(t){const e={x:t[2]-t[0],y:t[3]-t[1]},n={x:t[0]+.5*e.x,y:t[1]+.5*e.y};return[n.x-e.x,n.y-e.y,n.x+e.x,n.y+e.y]}class eM{constructor(){d(this,"id","mask-effect"),d(this,"props",null),d(this,"useInPicking",!0),d(this,"dummyMaskMap",void 0),d(this,"channels",[]),d(this,"masks",null),d(this,"maskPass",void 0),d(this,"maskMap",void 0),d(this,"lastViewport",void 0)}preRender(e,{layers:n,layerFilter:i,viewports:r,onViewportActive:s,views:o}){this.dummyMaskMap||(this.dummyMaskMap=new We(e,{width:1,height:1}));const a=n.filter(f=>f.props.visible&&f.props.operation===mo.MASK);if(a.length===0){this.masks=null,this.channels.length=0;return}this.masks={},this.maskPass||(this.maskPass=new W3(e,{id:"default-mask"}),this.maskMap=this.maskPass.maskMap);const l=this._sortMaskChannels(a),c=r[0],u=!this.lastViewport||!this.lastViewport.equals(c);for(const f in l)this._renderChannel(l[f],{layerFilter:i,onViewportActive:s,views:o,viewport:c,viewportChanged:u})}_renderChannel(e,{layerFilter:n,onViewportActive:i,views:r,viewport:s,viewportChanged:o}){const a=this.channels[e.index];if(!a)return;const l=e===a||a.layers.length!==e.layers.length||e.layerBounds.some((c,u)=>c!==a.layerBounds[u]);if(e.bounds=a.bounds,e.maskBounds=a.maskBounds,this.channels[e.index]=e,(l||o)&&(this.lastViewport=s,e.bounds=q3({layers:e.layers,viewport:s}),l||!mn(e.bounds,a.bounds))){const{maskPass:c,maskMap:u}=this,f=Q3({bounds:e.bounds,viewport:s,width:u.width,height:u.height});e.maskBounds=f?f.getBounds():[0,0,1,1],c.render({pass:"mask",channel:e.index,layers:e.layers,layerFilter:n,viewports:f?[f]:[],onViewportActive:i,views:r,moduleParameters:{devicePixelRatio:1}})}this.masks[e.id]={index:e.index,bounds:e.maskBounds,coordinateOrigin:e.coordinateOrigin,coordinateSystem:e.coordinateSystem}}_sortMaskChannels(e){const n={};let i=0;for(const r of e){const{id:s}=r.root;let o=n[s];if(!o){if(++i>4){W.warn("Too many mask layers. The max supported is 4")();continue}o={id:s,index:this.channels.findIndex(a=>(a==null?void 0:a.id)===s),layers:[],layerBounds:[],coordinateOrigin:r.root.props.coordinateOrigin,coordinateSystem:r.root.props.coordinateSystem},n[s]=o}o.layers.push(r),o.layerBounds.push(r.getBounds())}for(let r=0;r<4;r++){const s=this.channels[r];(!s||!(s.id in n))&&(this.channels[r]=null)}for(const r in n){const s=n[r];s.index<0&&(s.index=this.channels.findIndex(o=>!o),this.channels[s.index]=s)}return n}getModuleParameters(){return{maskMap:this.masks?this.maskMap:this.dummyMaskMap,maskChannels:this.masks}}cleanup(){this.dummyMaskMap&&(this.dummyMaskMap.delete(),this.dummyMaskMap=void 0),this.maskPass&&(this.maskPass.delete(),this.maskPass=void 0,this.maskMap=void 0),this.lastViewport=void 0,this.masks=null,this.channels.length=0}}const tM=new e1;class nM{constructor(){d(this,"effects",void 0),d(this,"_internalEffects",void 0),d(this,"_needsRedraw",void 0),this.effects=[],this._internalEffects=[],this._needsRedraw="Initial render",this.setEffects()}setProps(e){"effects"in e&&(e.effects.length!==this.effects.length||!Oi(e.effects,this.effects))&&(this.setEffects(e.effects),this._needsRedraw="effects changed")}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._internalEffects}finalize(){this.cleanup()}setEffects(e=[]){this.cleanup(),this.effects=e,this._internalEffects=e.slice(),this._internalEffects.push(new eM),e.some(n=>n instanceof e1)||this._internalEffects.push(tM)}cleanup(){for(const e of this.effects)e.cleanup();for(const e of this._internalEffects)e.cleanup();this.effects.length=0,this._internalEffects.length=0}}class iM extends Kl{shouldDrawLayer(e){return e.props.operation===mo.DRAW}}const Am={blendFunc:[1,0,32771,0],blendEquation:32774};class a1 extends Kl{constructor(...e){super(...e),d(this,"pickZ",void 0),d(this,"_colors",null)}render(e){return e.pickingFBO?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:i,viewports:r,onViewportActive:s,pickingFBO:o,deviceRect:{x:a,y:l,width:c,height:u},cullRect:f,effects:h,pass:g="picking",pickZ:p}){const w=this.gl;this.pickZ=p;const x=p?null:{byLayer:new Map,byAlpha:[]};this._colors=x;const y=xt(w,{scissorTest:!0,scissor:[a,l,c,u],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...Am,blend:!p},()=>super.render({target:o,layers:e,layerFilter:n,views:i,viewports:r,onViewportActive:s,cullRect:f,effects:h==null?void 0:h.filter(_=>_.useInPicking),pass:g}));return this._colors=null,{decodePickingColor:x&&sM.bind(null,x),stats:y}}shouldDrawLayer(e){return e.props.pickable&&e.props.operation===mo.DRAW}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,n,i){const r={...e.props.parameters};return this._colors?(Object.assign(r,Am),r.blend=!0,r.blendColor=rM(this._colors,e,i)):r.blend=!1,r}}function rM(t,e,n){const{byLayer:i,byAlpha:r}=t;let s,o=i.get(e);return o?(o.viewports.push(n),s=o.a):(s=i.size+1,s<=255?(o={a:s,layer:e,viewports:[n]},i.set(e,o),r[s]=o):(W.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function sM(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const oM="deckRenderer.renderLayers";class aM{constructor(e){this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new iM(e),this.pickLayersPass=new a1(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){"layerFilter"in e&&this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),"drawPickingColors"in e&&this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass;e.layerFilter=e.layerFilter||this.layerFilter,e.effects=e.effects||[],e.target=e.target||_e.getDefaultFramebuffer(this.gl),this._preRender(e.effects,e);const i=this.lastPostProcessEffect?this.renderBuffers[0]:e.target,r=n.render({...e,target:i});this._postRender(e.effects,e),this.renderCount++,Ne(oM,this,r,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){let i=null;for(const r of e)r.preRender(this.gl,n),r.postRender&&(i=r);i&&this._resizeRenderBuffers(),this.lastPostProcessEffect=i}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new _e(this.gl),new _e(this.gl));for(const n of e)n.resize()}_postRender(e,n){const{renderBuffers:i}=this,r={inputBuffer:i[0],swapBuffer:i[1],target:null};for(const s of e)if(s.postRender){if(s===this.lastPostProcessEffect){r.target=n.target,s.postRender(this.gl,r);break}const o=s.postRender(this.gl,r);r.inputBuffer=o,r.swapBuffer=o===i[0]?i[1]:i[0]}}}const lM={pickedColor:null,pickedObjectIndex:-1};function cM({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:i,deviceRadius:r,deviceRect:s}){const{x:o,y:a,width:l,height:c}=s;let u=r*r,f=-1,h=0;for(let g=0;g<c;g++){const p=g+a-i,w=p*p;if(w>u)h+=4*l;else for(let x=0;x<l;x++){if(t[h+3]-1>=0){const m=x+o-n,_=m*m+w;_<=u&&(u=_,f=h)}h+=4}}if(f>=0){const g=t.slice(f,f+4),p=e(g);if(p){const w=Math.floor(f/4/l),x=f/4-w*l;return{...p,pickedColor:g,pickedX:o+x,pickedY:a+w}}W.error("Picked non-existent layer. Is picking buffer corrupt?")()}return lM}function uM({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let i=0;i<t.length;i+=4)if(t[i+3]-1>=0){const s=t.slice(i,i+4),o=s.join(",");if(!n.has(o)){const a=e(s);a?n.set(o,{...a,color:s}):W.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function l1({pickInfo:t,viewports:e,pixelRatio:n,x:i,y:r,z:s}){let o=e[0];e.length>1&&(o=hM((t==null?void 0:t.pickedViewports)||e,{x:i,y:r}));let a;if(o){const l=[i-o.x,r-o.y];s!==void 0&&(l[2]=s),a=o.unproject(l)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:i,y:r,pixel:[i,r],coordinate:a,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function fM(t){const{pickInfo:e,lastPickedInfo:n,mode:i,layers:r}=t,{pickedColor:s,pickedLayer:o,pickedObjectIndex:a}=e,l=o?[o]:[];if(i==="hover"){const f=n.index,h=n.layerId,g=o?o.props.id:null;if(g!==h||a!==f){if(g!==h){const p=r.find(w=>w.props.id===h);p&&l.unshift(p)}n.layerId=g,n.index=a,n.info=null}}const c=l1(t),u=new Map;return u.set(null,c),l.forEach(f=>{let h={...c};f===o&&(h.color=s,h.index=a,h.picked=!0),h=c1({layer:f,info:h,mode:i});const g=h.layer;f===o&&i==="hover"&&(n.info=h),u.set(g.id,h),i==="hover"&&g.updateAutoHighlight(h)}),u}function c1({layer:t,info:e,mode:n}){for(;t&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:i}),t=t.parent}return e}function hM(t,e){for(let n=t.length-1;n>=0;n--){const i=t[n];if(i.containsPixel(e))return i}return t[0]}class dM{constructor(e){d(this,"gl",void 0),d(this,"pickingFBO",void 0),d(this,"depthFBO",void 0),d(this,"pickLayersPass",void 0),d(this,"layerFilter",void 0),d(this,"lastPickedInfo",void 0),d(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new a1(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:i,viewports:r},s=this.lastPickedInfo.info){const o=s&&s.layer&&s.layer.id,a=s&&s.viewport&&s.viewport.id,l=o?i.find(h=>h.id===o):null,c=a&&r.find(h=>h.id===a)||r[0],u=c&&c.unproject([e-c.x,n-c.y]);return{...s,...{x:e,y:n,viewport:c,coordinate:u,layer:l}}}_resizeBuffer(){var e,n;const{gl:i}=this;if(!this.pickingFBO&&(this.pickingFBO=new _e(i),_e.isSupported(i,{colorBufferFloat:!0}))){const r=new _e(i);r.attach({[36064]:new We(i,{format:Y(i)?34836:6408,type:5126})}),this.depthFBO=r}(e=this.pickingFBO)===null||e===void 0||e.resize({width:i.canvas.width,height:i.canvas.height}),(n=this.depthFBO)===null||n===void 0||n.resize({width:i.canvas.width,height:i.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(i=>i.isPickable()&&!i.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:i,x:r,y:s,radius:o=0,depth:a=1,mode:l="query",unproject3D:c,onViewportActive:u,effects:f}){const h=this._getPickable(e),g=Tr(this.gl);if(!h)return{result:[],emptyInfo:l1({viewports:i,x:r,y:s,pixelRatio:g})};this._resizeBuffer();const p=Kc(this.gl,[r,s],!0),w=[p.x+Math.floor(p.width/2),p.y+Math.floor(p.height/2)],x=Math.round(o*g),{width:y,height:m}=this.pickingFBO,_=this._getPickingRect({deviceX:w[0],deviceY:w[1],deviceRadius:x,deviceWidth:y,deviceHeight:m}),T={x:r-o,y:s-o,width:o*2+1,height:o*2+1};let P;const A=[],C=new Set;for(let M=0;M<a;M++){let R;if(_){const z=this._drawAndSample({layers:h,views:n,viewports:i,onViewportActive:u,deviceRect:_,cullRect:T,effects:f,pass:"picking:".concat(l)});R=cM({...z,deviceX:w[0],deviceY:w[1],deviceRadius:x,deviceRect:_})}else R={pickedColor:null,pickedObjectIndex:-1};let O;R.pickedLayer&&c&&this.depthFBO&&(O=this._drawAndSample({layers:[R.pickedLayer],views:n,viewports:i,onViewportActive:u,deviceRect:{x:R.pickedX,y:R.pickedY,width:1,height:1},cullRect:T,effects:f,pass:"picking:".concat(l,":z")},!0).pickedColors[0]),R.pickedLayer&&M+1<a&&(C.add(R.pickedLayer),R.pickedLayer.disablePickingIndex(R.pickedObjectIndex)),P=fM({pickInfo:R,lastPickedInfo:this.lastPickedInfo,mode:l,layers:h,viewports:i,x:r,y:s,z:O,pixelRatio:g});for(const z of P.values())z.layer&&A.push(z);if(!R.pickedColor)break}for(const M of C)M.restorePickingColors();return{result:A,emptyInfo:P.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:i,x:r,y:s,width:o=1,height:a=1,mode:l="query",maxObjects:c=null,onViewportActive:u,effects:f}){const h=this._getPickable(e);if(!h)return[];this._resizeBuffer();const g=Tr(this.gl),p=Kc(this.gl,[r,s],!0),w=p.x,x=p.y+p.height,y=Kc(this.gl,[r+o,s+a],!0),m=y.x+y.width,_=y.y,T={x:w,y:_,width:m-w,height:x-_},P=this._drawAndSample({layers:h,views:n,viewports:i,onViewportActive:u,deviceRect:T,cullRect:{x:r,y:s,width:o,height:a},effects:f,pass:"picking:".concat(l)}),A=uM(P),C=new Map,M=Number.isFinite(c);for(let R=0;R<A.length&&!(M&&c&&C.size>=c);R++){const O=A[R];let z={color:O.pickedColor,layer:null,index:O.pickedObjectIndex,picked:!0,x:r,y:s,pixelRatio:g};z=c1({layer:O.pickedLayer,info:z,mode:l}),C.has(z.object)||C.set(z.object,z)}return Array.from(C.values())}_drawAndSample({layers:e,views:n,viewports:i,onViewportActive:r,deviceRect:s,cullRect:o,effects:a,pass:l},c=!1){const u=c?this.depthFBO:this.pickingFBO,{decodePickingColor:f}=this.pickLayersPass.render({layers:e,layerFilter:this.layerFilter,views:n,viewports:i,onViewportActive:r,pickingFBO:u,deviceRect:s,cullRect:o,effects:a,pass:l,pickZ:c}),{x:h,y:g,width:p,height:w}=s,x=new(c?Float32Array:Uint8Array)(p*w*4);return Yl(u,{sourceX:h,sourceY:g,sourceWidth:p,sourceHeight:w,target:x}),{pickedColors:x,decodePickingColor:f}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:i,deviceWidth:r,deviceHeight:s}){const o=Math.max(0,e-i),a=Math.max(0,n-i),l=Math.min(r,e+i+1)-o,c=Math.min(s,n+i+1)-a;return l<=0||c<=0?null:{x:o,y:a,width:l,height:c}}}const gM={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class pM{constructor(e){d(this,"el",null),d(this,"isVisible",!1);const n=e.parentElement;n&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,gM),n.appendChild(this.el))}setTooltip(e,n,i){const r=this.el;if(!!r){if(typeof e=="string")r.innerText=e;else if(e)e.text&&(r.innerText=e.text),e.html&&(r.innerHTML=e.html),e.className&&(r.className=e.className),Object.assign(r.style,e.style);else{this.isVisible=!1,r.style.display="none";return}this.isVisible=!0,r.style.display="block",r.style.transform="translate(".concat(n,"px, ").concat(i,"px)")}}remove(){this.el&&(this.el.remove(),this.el=null)}}var zr={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,i,r){var s=["","webkit","Moz","MS","ms","o"],o=n.createElement("div"),a="function",l=Math.round,c=Math.abs,u=Date.now;function f(v,E,S){return setTimeout(_(v,S),E)}function h(v,E,S){return Array.isArray(v)?(g(v,S[E],S),!0):!1}function g(v,E,S){var b;if(!!v)if(v.forEach)v.forEach(E,S);else if(v.length!==r)for(b=0;b<v.length;)E.call(S,v[b],b,v),b++;else for(b in v)v.hasOwnProperty(b)&&E.call(S,v[b],b,v)}function p(v,E,S){var b="DEPRECATED METHOD: "+E+`
`+S+` AT 
`;return function(){var L=new Error("get-stack-trace"),N=L&&L.stack?L.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",X=e.console&&(e.console.warn||e.console.log);return X&&X.call(e.console,b,N),v.apply(this,arguments)}}var w;typeof Object.assign!="function"?w=function(E){if(E===r||E===null)throw new TypeError("Cannot convert undefined or null to object");for(var S=Object(E),b=1;b<arguments.length;b++){var L=arguments[b];if(L!==r&&L!==null)for(var N in L)L.hasOwnProperty(N)&&(S[N]=L[N])}return S}:w=Object.assign;var x=p(function(E,S,b){for(var L=Object.keys(S),N=0;N<L.length;)(!b||b&&E[L[N]]===r)&&(E[L[N]]=S[L[N]]),N++;return E},"extend","Use `assign`."),y=p(function(E,S){return x(E,S,!0)},"merge","Use `assign`.");function m(v,E,S){var b=E.prototype,L;L=v.prototype=Object.create(b),L.constructor=v,L._super=b,S&&w(L,S)}function _(v,E){return function(){return v.apply(E,arguments)}}function T(v,E){return typeof v==a?v.apply(E&&E[0]||r,E):v}function P(v,E){return v===r?E:v}function A(v,E,S){g(O(E),function(b){v.addEventListener(b,S,!1)})}function C(v,E,S){g(O(E),function(b){v.removeEventListener(b,S,!1)})}function M(v,E){for(;v;){if(v==E)return!0;v=v.parentNode}return!1}function R(v,E){return v.indexOf(E)>-1}function O(v){return v.trim().split(/\s+/g)}function z(v,E,S){if(v.indexOf&&!S)return v.indexOf(E);for(var b=0;b<v.length;){if(S&&v[b][S]==E||!S&&v[b]===E)return b;b++}return-1}function j(v){return Array.prototype.slice.call(v,0)}function B(v,E,S){for(var b=[],L=[],N=0;N<v.length;){var X=E?v[N][E]:v[N];z(L,X)<0&&b.push(v[N]),L[N]=X,N++}return S&&(E?b=b.sort(function(Ae,Be){return Ae[E]>Be[E]}):b=b.sort()),b}function H(v,E){for(var S,b,L=E[0].toUpperCase()+E.slice(1),N=0;N<s.length;){if(S=s[N],b=S?S+L:E,b in v)return b;N++}return r}var Ye=1;function ri(){return Ye++}function An(v){var E=v.ownerDocument||v;return E.defaultView||E.parentWindow||e}var F=/mobile|tablet|ip(ad|hone|od)|android/i,V="ontouchstart"in e,G=H(e,"PointerEvent")!==r,ae=V&&F.test(navigator.userAgent),se="touch",ki="pen",At="mouse",Ur="kinect",sn=25,me=1,si=2,ve=4,Ze=8,To=1,Br=2,Vr=4,jr=8,Gr=16,jt=Br|Vr,oi=jr|Gr,Md=jt|oi,Id=["x","y"],So=["clientX","clientY"];function pt(v,E){var S=this;this.manager=v,this.callback=E,this.element=v.element,this.target=v.options.inputTarget,this.domHandler=function(b){T(v.options.enable,[v])&&S.handler(b)},this.init()}pt.prototype={handler:function(){},init:function(){this.evEl&&A(this.element,this.evEl,this.domHandler),this.evTarget&&A(this.target,this.evTarget,this.domHandler),this.evWin&&A(An(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&C(this.element,this.evEl,this.domHandler),this.evTarget&&C(this.target,this.evTarget,this.domHandler),this.evWin&&C(An(this.element),this.evWin,this.domHandler)}};function ew(v){var E,S=v.options.inputClass;return S?E=S:G?E=ac:ae?E=Ao:V?E=lc:E=bo,new E(v,tw)}function tw(v,E,S){var b=S.pointers.length,L=S.changedPointers.length,N=E&me&&b-L===0,X=E&(ve|Ze)&&b-L===0;S.isFirst=!!N,S.isFinal=!!X,N&&(v.session={}),S.eventType=E,nw(v,S),v.emit("hammer.input",S),v.recognize(S),v.session.prevInput=S}function nw(v,E){var S=v.session,b=E.pointers,L=b.length;S.firstInput||(S.firstInput=Rd(E)),L>1&&!S.firstMultiple?S.firstMultiple=Rd(E):L===1&&(S.firstMultiple=!1);var N=S.firstInput,X=S.firstMultiple,Te=X?X.center:N.center,Ae=E.center=Od(b);E.timeStamp=u(),E.deltaTime=E.timeStamp-N.timeStamp,E.angle=oc(Te,Ae),E.distance=Po(Te,Ae),iw(S,E),E.offsetDirection=Nd(E.deltaX,E.deltaY);var Be=kd(E.deltaTime,E.deltaX,E.deltaY);E.overallVelocityX=Be.x,E.overallVelocityY=Be.y,E.overallVelocity=c(Be.x)>c(Be.y)?Be.x:Be.y,E.scale=X?ow(X.pointers,b):1,E.rotation=X?sw(X.pointers,b):0,E.maxPointers=S.prevInput?E.pointers.length>S.prevInput.maxPointers?E.pointers.length:S.prevInput.maxPointers:E.pointers.length,rw(S,E);var Wt=v.element;M(E.srcEvent.target,Wt)&&(Wt=E.srcEvent.target),E.target=Wt}function iw(v,E){var S=E.center,b=v.offsetDelta||{},L=v.prevDelta||{},N=v.prevInput||{};(E.eventType===me||N.eventType===ve)&&(L=v.prevDelta={x:N.deltaX||0,y:N.deltaY||0},b=v.offsetDelta={x:S.x,y:S.y}),E.deltaX=L.x+(S.x-b.x),E.deltaY=L.y+(S.y-b.y)}function rw(v,E){var S=v.lastInterval||E,b=E.timeStamp-S.timeStamp,L,N,X,Te;if(E.eventType!=Ze&&(b>sn||S.velocity===r)){var Ae=E.deltaX-S.deltaX,Be=E.deltaY-S.deltaY,Wt=kd(b,Ae,Be);N=Wt.x,X=Wt.y,L=c(Wt.x)>c(Wt.y)?Wt.x:Wt.y,Te=Nd(Ae,Be),v.lastInterval=E}else L=S.velocity,N=S.velocityX,X=S.velocityY,Te=S.direction;E.velocity=L,E.velocityX=N,E.velocityY=X,E.direction=Te}function Rd(v){for(var E=[],S=0;S<v.pointers.length;)E[S]={clientX:l(v.pointers[S].clientX),clientY:l(v.pointers[S].clientY)},S++;return{timeStamp:u(),pointers:E,center:Od(E),deltaX:v.deltaX,deltaY:v.deltaY}}function Od(v){var E=v.length;if(E===1)return{x:l(v[0].clientX),y:l(v[0].clientY)};for(var S=0,b=0,L=0;L<E;)S+=v[L].clientX,b+=v[L].clientY,L++;return{x:l(S/E),y:l(b/E)}}function kd(v,E,S){return{x:E/v||0,y:S/v||0}}function Nd(v,E){return v===E?To:c(v)>=c(E)?v<0?Br:Vr:E<0?jr:Gr}function Po(v,E,S){S||(S=Id);var b=E[S[0]]-v[S[0]],L=E[S[1]]-v[S[1]];return Math.sqrt(b*b+L*L)}function oc(v,E,S){S||(S=Id);var b=E[S[0]]-v[S[0]],L=E[S[1]]-v[S[1]];return Math.atan2(L,b)*180/Math.PI}function sw(v,E){return oc(E[1],E[0],So)+oc(v[1],v[0],So)}function ow(v,E){return Po(E[0],E[1],So)/Po(v[0],v[1],So)}var aw={mousedown:me,mousemove:si,mouseup:ve},lw="mousedown",cw="mousemove mouseup";function bo(){this.evEl=lw,this.evWin=cw,this.pressed=!1,pt.apply(this,arguments)}m(bo,pt,{handler:function(E){var S=aw[E.type];S&me&&E.button===0&&(this.pressed=!0),S&si&&E.which!==1&&(S=ve),this.pressed&&(S&ve&&(this.pressed=!1),this.callback(this.manager,S,{pointers:[E],changedPointers:[E],pointerType:At,srcEvent:E}))}});var uw={pointerdown:me,pointermove:si,pointerup:ve,pointercancel:Ze,pointerout:Ze},fw={2:se,3:ki,4:At,5:Ur},Fd="pointerdown",Dd="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Fd="MSPointerDown",Dd="MSPointerMove MSPointerUp MSPointerCancel");function ac(){this.evEl=Fd,this.evWin=Dd,pt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}m(ac,pt,{handler:function(E){var S=this.store,b=!1,L=E.type.toLowerCase().replace("ms",""),N=uw[L],X=fw[E.pointerType]||E.pointerType,Te=X==se,Ae=z(S,E.pointerId,"pointerId");N&me&&(E.button===0||Te)?Ae<0&&(S.push(E),Ae=S.length-1):N&(ve|Ze)&&(b=!0),!(Ae<0)&&(S[Ae]=E,this.callback(this.manager,N,{pointers:S,changedPointers:[E],pointerType:X,srcEvent:E}),b&&S.splice(Ae,1))}});var hw={touchstart:me,touchmove:si,touchend:ve,touchcancel:Ze},dw="touchstart",gw="touchstart touchmove touchend touchcancel";function zd(){this.evTarget=dw,this.evWin=gw,this.started=!1,pt.apply(this,arguments)}m(zd,pt,{handler:function(E){var S=hw[E.type];if(S===me&&(this.started=!0),!!this.started){var b=pw.call(this,E,S);S&(ve|Ze)&&b[0].length-b[1].length===0&&(this.started=!1),this.callback(this.manager,S,{pointers:b[0],changedPointers:b[1],pointerType:se,srcEvent:E})}}});function pw(v,E){var S=j(v.touches),b=j(v.changedTouches);return E&(ve|Ze)&&(S=B(S.concat(b),"identifier",!0)),[S,b]}var mw={touchstart:me,touchmove:si,touchend:ve,touchcancel:Ze},vw="touchstart touchmove touchend touchcancel";function Ao(){this.evTarget=vw,this.targetIds={},pt.apply(this,arguments)}m(Ao,pt,{handler:function(E){var S=mw[E.type],b=yw.call(this,E,S);!b||this.callback(this.manager,S,{pointers:b[0],changedPointers:b[1],pointerType:se,srcEvent:E})}});function yw(v,E){var S=j(v.touches),b=this.targetIds;if(E&(me|si)&&S.length===1)return b[S[0].identifier]=!0,[S,S];var L,N,X=j(v.changedTouches),Te=[],Ae=this.target;if(N=S.filter(function(Be){return M(Be.target,Ae)}),E===me)for(L=0;L<N.length;)b[N[L].identifier]=!0,L++;for(L=0;L<X.length;)b[X[L].identifier]&&Te.push(X[L]),E&(ve|Ze)&&delete b[X[L].identifier],L++;if(!!Te.length)return[B(N.concat(Te),"identifier",!0),Te]}var _w=2500,Ud=25;function lc(){pt.apply(this,arguments);var v=_(this.handler,this);this.touch=new Ao(this.manager,v),this.mouse=new bo(this.manager,v),this.primaryTouch=null,this.lastTouches=[]}m(lc,pt,{handler:function(E,S,b){var L=b.pointerType==se,N=b.pointerType==At;if(!(N&&b.sourceCapabilities&&b.sourceCapabilities.firesTouchEvents)){if(L)ww.call(this,S,b);else if(N&&Ew.call(this,b))return;this.callback(E,S,b)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function ww(v,E){v&me?(this.primaryTouch=E.changedPointers[0].identifier,Bd.call(this,E)):v&(ve|Ze)&&Bd.call(this,E)}function Bd(v){var E=v.changedPointers[0];if(E.identifier===this.primaryTouch){var S={x:E.clientX,y:E.clientY};this.lastTouches.push(S);var b=this.lastTouches,L=function(){var N=b.indexOf(S);N>-1&&b.splice(N,1)};setTimeout(L,_w)}}function Ew(v){for(var E=v.srcEvent.clientX,S=v.srcEvent.clientY,b=0;b<this.lastTouches.length;b++){var L=this.lastTouches[b],N=Math.abs(E-L.x),X=Math.abs(S-L.y);if(N<=Ud&&X<=Ud)return!0}return!1}var Vd=H(o.style,"touchAction"),jd=Vd!==r,Gd="compute",Wd="auto",cc="manipulation",ai="none",Wr="pan-x",Hr="pan-y",Co=Tw();function uc(v,E){this.manager=v,this.set(E)}uc.prototype={set:function(v){v==Gd&&(v=this.compute()),jd&&this.manager.element.style&&Co[v]&&(this.manager.element.style[Vd]=v),this.actions=v.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var v=[];return g(this.manager.recognizers,function(E){T(E.options.enable,[E])&&(v=v.concat(E.getTouchAction()))}),xw(v.join(" "))},preventDefaults:function(v){var E=v.srcEvent,S=v.offsetDirection;if(this.manager.session.prevented){E.preventDefault();return}var b=this.actions,L=R(b,ai)&&!Co[ai],N=R(b,Hr)&&!Co[Hr],X=R(b,Wr)&&!Co[Wr];if(L){var Te=v.pointers.length===1,Ae=v.distance<2,Be=v.deltaTime<250;if(Te&&Ae&&Be)return}if(!(X&&N)&&(L||N&&S&jt||X&&S&oi))return this.preventSrc(E)},preventSrc:function(v){this.manager.session.prevented=!0,v.preventDefault()}};function xw(v){if(R(v,ai))return ai;var E=R(v,Wr),S=R(v,Hr);return E&&S?ai:E||S?E?Wr:Hr:R(v,cc)?cc:Wd}function Tw(){if(!jd)return!1;var v={},E=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(S){v[S]=E?e.CSS.supports("touch-action",S):!0}),v}var Lo=1,mt=2,Ni=4,Cn=8,on=Cn,Xr=16,Gt=32;function an(v){this.options=w({},this.defaults,v||{}),this.id=ri(),this.manager=null,this.options.enable=P(this.options.enable,!0),this.state=Lo,this.simultaneous={},this.requireFail=[]}an.prototype={defaults:{},set:function(v){return w(this.options,v),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(v){if(h(v,"recognizeWith",this))return this;var E=this.simultaneous;return v=Mo(v,this),E[v.id]||(E[v.id]=v,v.recognizeWith(this)),this},dropRecognizeWith:function(v){return h(v,"dropRecognizeWith",this)?this:(v=Mo(v,this),delete this.simultaneous[v.id],this)},requireFailure:function(v){if(h(v,"requireFailure",this))return this;var E=this.requireFail;return v=Mo(v,this),z(E,v)===-1&&(E.push(v),v.requireFailure(this)),this},dropRequireFailure:function(v){if(h(v,"dropRequireFailure",this))return this;v=Mo(v,this);var E=z(this.requireFail,v);return E>-1&&this.requireFail.splice(E,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(v){return!!this.simultaneous[v.id]},emit:function(v){var E=this,S=this.state;function b(L){E.manager.emit(L,v)}S<Cn&&b(E.options.event+Hd(S)),b(E.options.event),v.additionalEvent&&b(v.additionalEvent),S>=Cn&&b(E.options.event+Hd(S))},tryEmit:function(v){if(this.canEmit())return this.emit(v);this.state=Gt},canEmit:function(){for(var v=0;v<this.requireFail.length;){if(!(this.requireFail[v].state&(Gt|Lo)))return!1;v++}return!0},recognize:function(v){var E=w({},v);if(!T(this.options.enable,[this,E])){this.reset(),this.state=Gt;return}this.state&(on|Xr|Gt)&&(this.state=Lo),this.state=this.process(E),this.state&(mt|Ni|Cn|Xr)&&this.tryEmit(E)},process:function(v){},getTouchAction:function(){},reset:function(){}};function Hd(v){return v&Xr?"cancel":v&Cn?"end":v&Ni?"move":v&mt?"start":""}function Xd(v){return v==Gr?"down":v==jr?"up":v==Br?"left":v==Vr?"right":""}function Mo(v,E){var S=E.manager;return S?S.get(v):v}function Ct(){an.apply(this,arguments)}m(Ct,an,{defaults:{pointers:1},attrTest:function(v){var E=this.options.pointers;return E===0||v.pointers.length===E},process:function(v){var E=this.state,S=v.eventType,b=E&(mt|Ni),L=this.attrTest(v);return b&&(S&Ze||!L)?E|Xr:b||L?S&ve?E|Cn:E&mt?E|Ni:mt:Gt}});function Io(){Ct.apply(this,arguments),this.pX=null,this.pY=null}m(Io,Ct,{defaults:{event:"pan",threshold:10,pointers:1,direction:Md},getTouchAction:function(){var v=this.options.direction,E=[];return v&jt&&E.push(Hr),v&oi&&E.push(Wr),E},directionTest:function(v){var E=this.options,S=!0,b=v.distance,L=v.direction,N=v.deltaX,X=v.deltaY;return L&E.direction||(E.direction&jt?(L=N===0?To:N<0?Br:Vr,S=N!=this.pX,b=Math.abs(v.deltaX)):(L=X===0?To:X<0?jr:Gr,S=X!=this.pY,b=Math.abs(v.deltaY))),v.direction=L,S&&b>E.threshold&&L&E.direction},attrTest:function(v){return Ct.prototype.attrTest.call(this,v)&&(this.state&mt||!(this.state&mt)&&this.directionTest(v))},emit:function(v){this.pX=v.deltaX,this.pY=v.deltaY;var E=Xd(v.direction);E&&(v.additionalEvent=this.options.event+E),this._super.emit.call(this,v)}});function fc(){Ct.apply(this,arguments)}m(fc,Ct,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[ai]},attrTest:function(v){return this._super.attrTest.call(this,v)&&(Math.abs(v.scale-1)>this.options.threshold||this.state&mt)},emit:function(v){if(v.scale!==1){var E=v.scale<1?"in":"out";v.additionalEvent=this.options.event+E}this._super.emit.call(this,v)}});function hc(){an.apply(this,arguments),this._timer=null,this._input=null}m(hc,an,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Wd]},process:function(v){var E=this.options,S=v.pointers.length===E.pointers,b=v.distance<E.threshold,L=v.deltaTime>E.time;if(this._input=v,!b||!S||v.eventType&(ve|Ze)&&!L)this.reset();else if(v.eventType&me)this.reset(),this._timer=f(function(){this.state=on,this.tryEmit()},E.time,this);else if(v.eventType&ve)return on;return Gt},reset:function(){clearTimeout(this._timer)},emit:function(v){this.state===on&&(v&&v.eventType&ve?this.manager.emit(this.options.event+"up",v):(this._input.timeStamp=u(),this.manager.emit(this.options.event,this._input)))}});function dc(){Ct.apply(this,arguments)}m(dc,Ct,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[ai]},attrTest:function(v){return this._super.attrTest.call(this,v)&&(Math.abs(v.rotation)>this.options.threshold||this.state&mt)}});function gc(){Ct.apply(this,arguments)}m(gc,Ct,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:jt|oi,pointers:1},getTouchAction:function(){return Io.prototype.getTouchAction.call(this)},attrTest:function(v){var E=this.options.direction,S;return E&(jt|oi)?S=v.overallVelocity:E&jt?S=v.overallVelocityX:E&oi&&(S=v.overallVelocityY),this._super.attrTest.call(this,v)&&E&v.offsetDirection&&v.distance>this.options.threshold&&v.maxPointers==this.options.pointers&&c(S)>this.options.velocity&&v.eventType&ve},emit:function(v){var E=Xd(v.offsetDirection);E&&this.manager.emit(this.options.event+E,v),this.manager.emit(this.options.event,v)}});function Ro(){an.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}m(Ro,an,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[cc]},process:function(v){var E=this.options,S=v.pointers.length===E.pointers,b=v.distance<E.threshold,L=v.deltaTime<E.time;if(this.reset(),v.eventType&me&&this.count===0)return this.failTimeout();if(b&&L&&S){if(v.eventType!=ve)return this.failTimeout();var N=this.pTime?v.timeStamp-this.pTime<E.interval:!0,X=!this.pCenter||Po(this.pCenter,v.center)<E.posThreshold;this.pTime=v.timeStamp,this.pCenter=v.center,!X||!N?this.count=1:this.count+=1,this._input=v;var Te=this.count%E.taps;if(Te===0)return this.hasRequireFailures()?(this._timer=f(function(){this.state=on,this.tryEmit()},E.interval,this),mt):on}return Gt},failTimeout:function(){return this._timer=f(function(){this.state=Gt},this.options.interval,this),Gt},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==on&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function ln(v,E){return E=E||{},E.recognizers=P(E.recognizers,ln.defaults.preset),new pc(v,E)}ln.VERSION="2.0.7",ln.defaults={domEvents:!1,touchAction:Gd,enable:!0,inputTarget:null,inputClass:null,preset:[[dc,{enable:!1}],[fc,{enable:!1},["rotate"]],[gc,{direction:jt}],[Io,{direction:jt},["swipe"]],[Ro],[Ro,{event:"doubletap",taps:2},["tap"]],[hc]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Sw=1,Yd=2;function pc(v,E){this.options=w({},ln.defaults,E||{}),this.options.inputTarget=this.options.inputTarget||v,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=v,this.input=ew(this),this.touchAction=new uc(this,this.options.touchAction),Zd(this,!0),g(this.options.recognizers,function(S){var b=this.add(new S[0](S[1]));S[2]&&b.recognizeWith(S[2]),S[3]&&b.requireFailure(S[3])},this)}pc.prototype={set:function(v){return w(this.options,v),v.touchAction&&this.touchAction.update(),v.inputTarget&&(this.input.destroy(),this.input.target=v.inputTarget,this.input.init()),this},stop:function(v){this.session.stopped=v?Yd:Sw},recognize:function(v){var E=this.session;if(!E.stopped){this.touchAction.preventDefaults(v);var S,b=this.recognizers,L=E.curRecognizer;(!L||L&&L.state&on)&&(L=E.curRecognizer=null);for(var N=0;N<b.length;)S=b[N],E.stopped!==Yd&&(!L||S==L||S.canRecognizeWith(L))?S.recognize(v):S.reset(),!L&&S.state&(mt|Ni|Cn)&&(L=E.curRecognizer=S),N++}},get:function(v){if(v instanceof an)return v;for(var E=this.recognizers,S=0;S<E.length;S++)if(E[S].options.event==v)return E[S];return null},add:function(v){if(h(v,"add",this))return this;var E=this.get(v.options.event);return E&&this.remove(E),this.recognizers.push(v),v.manager=this,this.touchAction.update(),v},remove:function(v){if(h(v,"remove",this))return this;if(v=this.get(v),v){var E=this.recognizers,S=z(E,v);S!==-1&&(E.splice(S,1),this.touchAction.update())}return this},on:function(v,E){if(v!==r&&E!==r){var S=this.handlers;return g(O(v),function(b){S[b]=S[b]||[],S[b].push(E)}),this}},off:function(v,E){if(v!==r){var S=this.handlers;return g(O(v),function(b){E?S[b]&&S[b].splice(z(S[b],E),1):delete S[b]}),this}},emit:function(v,E){this.options.domEvents&&Pw(v,E);var S=this.handlers[v]&&this.handlers[v].slice();if(!(!S||!S.length)){E.type=v,E.preventDefault=function(){E.srcEvent.preventDefault()};for(var b=0;b<S.length;)S[b](E),b++}},destroy:function(){this.element&&Zd(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Zd(v,E){var S=v.element;if(!!S.style){var b;g(v.options.cssProps,function(L,N){b=H(S.style,N),E?(v.oldCssProps[b]=S.style[b],S.style[b]=L):S.style[b]=v.oldCssProps[b]||""}),E||(v.oldCssProps={})}}function Pw(v,E){var S=n.createEvent("Event");S.initEvent(v,!0,!0),S.gesture=E,E.target.dispatchEvent(S)}w(ln,{INPUT_START:me,INPUT_MOVE:si,INPUT_END:ve,INPUT_CANCEL:Ze,STATE_POSSIBLE:Lo,STATE_BEGAN:mt,STATE_CHANGED:Ni,STATE_ENDED:Cn,STATE_RECOGNIZED:on,STATE_CANCELLED:Xr,STATE_FAILED:Gt,DIRECTION_NONE:To,DIRECTION_LEFT:Br,DIRECTION_RIGHT:Vr,DIRECTION_UP:jr,DIRECTION_DOWN:Gr,DIRECTION_HORIZONTAL:jt,DIRECTION_VERTICAL:oi,DIRECTION_ALL:Md,Manager:pc,Input:pt,TouchAction:uc,TouchInput:Ao,MouseInput:bo,PointerEventInput:ac,TouchMouseInput:lc,SingleTouchInput:zd,Recognizer:an,AttrRecognizer:Ct,Tap:Ro,Pan:Io,Swipe:gc,Pinch:fc,Rotate:dc,Press:hc,on:A,off:C,each:g,merge:y,extend:x,assign:w,inherit:m,bindFn:_,prefixed:H});var bw=typeof e!="undefined"?e:typeof self!="undefined"?self:{};bw.Hammer=ln,typeof r=="function"&&r.amd?r(function(){return ln}):t.exports?t.exports=ln:e[i]=ln})(window,document,"Hammer")})(zr);var mM=zr.exports,Yt=Aw({__proto__:null,default:mM},[zr.exports]);const u1=1,f1=2,zf=4,vM={mousedown:u1,mousemove:f1,mouseup:zf};function yM(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function _M(t){const e=t.prototype.handler;t.prototype.handler=function(i){const r=this.store;i.button>0&&i.type==="pointerdown"&&(yM(r,s=>s.pointerId===i.pointerId)||r.push(i)),e.call(this,i)}}function wM(t){t.prototype.handler=function(n){let i=vM[n.type];i&u1&&n.button>=0&&(this.pressed=!0),i&f1&&n.which===0&&(i=zf),this.pressed&&(i&zf&&(this.pressed=!1),this.callback(this.manager,i,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}_M(zr.exports.PointerEventInput);wM(zr.exports.MouseInput);const EM=zr.exports.Manager;class ql{constructor(e,n,i){this.element=e,this.callback=n,this.options={enable:!0,...i}}}const xM=Yt?[[Yt.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Yt.Rotate,{enable:!1}],[Yt.Pinch,{enable:!1}],[Yt.Swipe,{enable:!1}],[Yt.Pan,{threshold:0,enable:!1}],[Yt.Press,{enable:!1}],[Yt.Tap,{event:"doubletap",taps:2,enable:!1}],[Yt.Tap,{event:"anytap",enable:!1}],[Yt.Tap,{enable:!1}]]:null,Cm={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},TM={doubletap:["tap"]},SM={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},gd={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},PM={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},Lm={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},bM=typeof navigator!="undefined"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",rr=typeof window!="undefined"?window:global;let Uf=!1;try{const t={get passive(){return Uf=!0,!0}};rr.addEventListener("test",null,t),rr.removeEventListener("test",null)}catch{Uf=!1}const AM=bM.indexOf("firefox")!==-1,{WHEEL_EVENTS:CM}=gd,Mm="wheel",Im=4.000244140625,LM=40,MM=.25;class IM extends ql{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{if(!this.options.enable)return;let s=r.deltaY;rr.WheelEvent&&(AM&&r.deltaMode===rr.WheelEvent.DOM_DELTA_PIXEL&&(s/=rr.devicePixelRatio),r.deltaMode===rr.WheelEvent.DOM_DELTA_LINE&&(s*=LM)),s!==0&&s%Im===0&&(s=Math.floor(s/Im)),r.shiftKey&&s&&(s=s*MM),this.callback({type:Mm,center:{x:r.clientX,y:r.clientY},delta:-s,srcEvent:r,pointerType:"mouse",target:r.target})},this.events=(this.options.events||[]).concat(CM),this.events.forEach(r=>e.addEventListener(r,this.handleEvent,Uf?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===Mm&&(this.options.enable=n)}}const{MOUSE_EVENTS:RM}=gd,Rm="pointermove",Om="pointerover",km="pointerout",Nm="pointerenter",Fm="pointerleave";class OM extends ql{constructor(e,n,i){super(e,n,i),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:r}=this.options;this.enableMoveEvent=r,this.enableLeaveEvent=r,this.enableEnterEvent=r,this.enableOutEvent=r,this.enableOverEvent=r,this.events=(this.options.events||[]).concat(RM),this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===Rm&&(this.enableMoveEvent=n),e===Om&&(this.enableOverEvent=n),e===km&&(this.enableOutEvent=n),e===Nm&&(this.enableEnterEvent=n),e===Fm&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(Om,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(km,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(Nm,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(Fm,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(Rm,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:kM}=gd,Dm="keydown",zm="keyup";class NM extends ql{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{const s=r.target||r.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&r.type==="keydown"&&this.callback({type:Dm,srcEvent:r,key:r.key,target:r.target}),this.enableUpEvent&&r.type==="keyup"&&this.callback({type:zm,srcEvent:r,key:r.key,target:r.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(kM),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(r=>e.addEventListener(r,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===Dm&&(this.enableDownEvent=n),e===zm&&(this.enableUpEvent=n)}}const Um="contextmenu";class FM extends ql{constructor(e,n,i){super(e,n,i),this.handleEvent=r=>{!this.options.enable||this.callback({type:Um,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===Um&&(this.options.enable=n)}}const Bf=1,xl=2,Vf=4,DM={pointerdown:Bf,pointermove:xl,pointerup:Vf,mousedown:Bf,mousemove:xl,mouseup:Vf},zM=1,UM=2,BM=3,VM=0,jM=1,GM=2,WM=1,HM=2,XM=4;function YM(t){const e=DM[t.srcEvent.type];if(!e)return null;const{buttons:n,button:i,which:r}=t.srcEvent;let s=!1,o=!1,a=!1;return e===Vf||e===xl&&!Number.isFinite(n)?(s=r===zM,o=r===UM,a=r===BM):e===xl?(s=Boolean(n&WM),o=Boolean(n&XM),a=Boolean(n&HM)):e===Bf&&(s=i===VM,o=i===jM,a=i===GM),{leftButton:s,middleButton:o,rightButton:a}}function ZM(t,e){const n=t.center;if(!n)return null;const i=e.getBoundingClientRect(),r=i.width/e.offsetWidth||1,s=i.height/e.offsetHeight||1,o={x:(n.x-i.left-e.clientLeft)/r,y:(n.y-i.top-e.clientTop)/s};return{center:n,offsetCenter:o}}const gu={srcElement:"root",priority:0};class $M{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const i=this._normalizeEvent(n);let r=n.srcEvent.target;for(;r&&r!==i.rootElement;){if(this._emit(i,r),i.handled)return;r=r.parentNode}this._emit(i,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,i,r=!1,s=!1){const{handlers:o,handlersByElement:a}=this;let l=gu;typeof i=="string"||i&&i.addEventListener?l={...gu,srcElement:i}:i&&(l={...gu,...i});let c=a.get(l.srcElement);c||(c=[],a.set(l.srcElement,c));const u={type:e,handler:n,srcElement:l.srcElement,priority:l.priority};r&&(u.once=!0),s&&(u.passive=!0),o.push(u),this._active=this._active||!u.passive;let f=c.length-1;for(;f>=0&&!(c[f].priority>=u.priority);)f--;c.splice(f+1,0,u)}remove(e,n){const{handlers:i,handlersByElement:r}=this;for(let s=i.length-1;s>=0;s--){const o=i[s];if(o.type===e&&o.handler===n){i.splice(s,1);const a=r.get(o.srcElement);a.splice(a.indexOf(o),1),a.length===0&&r.delete(o.srcElement)}}this._active=i.some(s=>!s.passive)}_emit(e,n){const i=this.handlersByElement.get(n);if(i){let r=!1;const s=()=>{e.handled=!0},o=()=>{e.handled=!0,r=!0},a=[];for(let l=0;l<i.length;l++){const{type:c,handler:u,once:f}=i[l];if(u({...e,type:c,stopPropagation:s,stopImmediatePropagation:o}),f&&a.push(i[l]),r)break}for(let l=0;l<a.length;l++){const{type:c,handler:u}=a[l];this.remove(c,u)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...YM(e),...ZM(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const KM={events:null,recognizers:null,recognizerOptions:{},Manager:EM,touchAction:"none",tabIndex:0};class qM{constructor(e=null,n){this._onBasicInput=r=>{const{srcEvent:s}=r,o=SM[s.type];o&&this.manager.emit(o,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={...KM,...n},this.events=new Map,this.setElement(e);const{events:i}=this.options;i&&this.on(i)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,i=n.Manager;this.manager=new i(e,{touchAction:n.touchAction,recognizers:n.recognizers||xM}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(Cm).forEach(r=>{const s=this.manager.get(r);s&&Cm[r].forEach(o=>{s.recognizeWith(o)})});for(const r in n.recognizerOptions){const s=this.manager.get(r);if(s){const o=n.recognizerOptions[r];delete o.enable,s.set(o)}}this.wheelInput=new IM(e,this._onOtherEvent,{enable:!1}),this.moveInput=new OM(e,this._onOtherEvent,{enable:!1}),this.keyInput=new NM(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new FM(e,this._onOtherEvent,{enable:!1});for(const[r,s]of this.events)s.isEmpty()||(this._toggleRecognizer(s.recognizerName,!0),this.manager.on(r,s.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,i){this._addEventHandler(e,n,i,!1)}once(e,n,i){this._addEventHandler(e,n,i,!0)}watch(e,n,i){this._addEventHandler(e,n,i,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:i}=this;if(!i)return;const r=i.get(e);if(r&&r.options.enable!==n){r.set({enable:n});const s=TM[e];s&&!this.options.recognizers&&s.forEach(o=>{const a=i.get(o);n?(a.requireFailure(e),r.dropRequireFailure(o)):a.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,i,r,s){if(typeof e!="string"){i=n;for(const u in e)this._addEventHandler(u,e[u],i,r,s);return}const{manager:o,events:a}=this,l=Lm[e]||e;let c=a.get(l);c||(c=new $M(this),a.set(l,c),c.recognizerName=PM[l]||l,o&&o.on(l,c.handleEvent)),c.add(e,n,i,r,s),c.isEmpty()||this._toggleRecognizer(c.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const o in e)this._removeEventHandler(o,e[o]);return}const{events:i}=this,r=Lm[e]||e,s=i.get(r);if(!!s&&(s.remove(e,n),s.isEmpty())){const{recognizerName:o}=s;let a=!1;for(const l of i.values())if(l.recognizerName===o&&!l.isEmpty()){a=!0;break}a||this._toggleRecognizer(o,!1)}}}function ui(){}const QM=({isDragging:t})=>t?"grabbing":"grab",h1={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:ui,onResize:ui,onViewStateChange:ui,onInteractionStateChange:ui,onBeforeRender:ui,onAfterRender:ui,onLoad:ui,onError:t=>W.error(t.message)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:QM,getTooltip:null,debug:!1,drawPickingColors:!1};class pd{constructor(e){d(this,"props",void 0),d(this,"width",0),d(this,"height",0),d(this,"userData",{}),d(this,"canvas",null),d(this,"viewManager",null),d(this,"layerManager",null),d(this,"effectManager",null),d(this,"deckRenderer",null),d(this,"deckPicker",null),d(this,"eventManager",null),d(this,"tooltip",null),d(this,"metrics",void 0),d(this,"animationLoop",void 0),d(this,"stats",void 0),d(this,"viewState",void 0),d(this,"cursorState",void 0),d(this,"_needsRedraw",void 0),d(this,"_pickRequest",void 0),d(this,"_lastPointerDownInfo",null),d(this,"_metricsCounter",void 0),d(this,"_onPointerMove",n=>{const{_pickRequest:i}=this;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;{const r=n.offsetCenter;if(!r)return;i.x=r.x,i.y=r.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n}),d(this,"_onEvent",n=>{const i=gm[n.type],r=n.offsetCenter;if(!i||!r||!this.layerManager)return;const s=this.layerManager.getLayers(),o=this.deckPicker.getLastPickedObject({x:r.x,y:r.y,layers:s,viewports:this.getViewports(r)},this._lastPointerDownInfo),{layer:a}=o,l=a&&(a[i.handler]||a.props[i.handler]),c=this.props[i.handler];let u=!1;l&&(u=l.call(a,o,n)),!u&&c&&c(o,n)}),d(this,"_onPointerDown",n=>{const i=n.offsetCenter,r=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=r.result[0]||r.emptyInfo}),this.props={...h1,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&W.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),zy()==="IE"&&W.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document!="undefined"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new Hh({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&Mr.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,i,r,s,o,a;if(this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(e=this.layerManager)===null||e===void 0||e.finalize(),this.layerManager=null,(n=this.viewManager)===null||n===void 0||n.finalize(),this.viewManager=null,(i=this.effectManager)===null||i===void 0||i.finalize(),this.effectManager=null,(r=this.deckRenderer)===null||r===void 0||r.finalize(),this.deckRenderer=null,(s=this.deckPicker)===null||s===void 0||s.finalize(),this.deckPicker=null,(o=this.eventManager)===null||o===void 0||o.destroy(),this.eventManager=null,(a=this.tooltip)===null||a===void 0||a.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var l;(l=this.canvas.parentElement)===null||l===void 0||l.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&W.removed("onLayerHover","onHover")(),"onLayerClick"in e&&W.removed("onLayerClick","onClick")(),e.initialViewState&&!Oi(this.props.initialViewState,e.initialViewState)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),r=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return n=n||i||r||s||o,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return Pe(this.viewManager),this.viewManager.views}getViewports(e){return Pe(this.viewManager),this.viewManager.getViewports(e)}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_pick(e,n,i){Pe(this.deckPicker);const{stats:r}=this;r.get("Pick Count").incrementCount(),r.get(n).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return r.get(n).timeEnd(),s}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),Pe(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){if(!this.canvas)return;const{width:n,height:i}=e;if(n||n===0){const s=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.width=s}if(i||i===0){var r;const s=Number.isFinite(i)?"".concat(i,"px"):i;this.canvas.style.position=((r=e.style)===null||r===void 0?void 0:r.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const n=e.clientWidth||e.width,i=e.clientHeight||e.height;if(n!==this.width||i!==this.height){var r;this.width=n,this.height=i,(r=this.viewManager)===null||r===void 0||r.setProps({width:n,height:i}),this.props.onResize({width:n,height:i})}}_createAnimationLoop(e){const{width:n,height:i,gl:r,glOptions:s,debug:o,onError:a,onBeforeRender:l,onAfterRender:c,useDevicePixels:u}=e;return new WA({width:n,height:i,useDevicePixels:u,autoResizeViewport:!1,gl:r,onCreateContext:f=>r_({...s,...f,canvas:this.canvas,debug:o,onContextLost:()=>this._onContextLost()}),onInitialize:f=>this._setGLContext(f.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:l,onAfterRender:c,onError:a})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new r1({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:i,emptyInfo:r}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=i.length>0;let s=r,o=!1;for(const a of i){var n;s=a,o=((n=a.layer)===null||n===void 0?void 0:n.onHover(a,e.event))||o}if(!o&&this.props.onHover&&this.props.onHover(s,e.event),this.props.getTooltip&&this.tooltip){const a=this.props.getTooltip(s);this.tooltip.setTooltip(a,s.x,s.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,Qh(e,{enable:!0,copyState:!0})),this.tooltip=new pM(this.canvas),xn(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const n=new G_;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new qM(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const r in gm)this.eventManager.on(r,this._onEvent);this.viewManager=new O3({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new R3(e,{deck:this,stats:this.stats,viewport:i,timeline:n}),this.effectManager=new nM,this.deckRenderer=new aM(e),this.deckPicker=new dM(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){const{gl:i}=this.layerManager.context;xn(i,this.props.parameters),this.props.onBeforeRender({gl:i}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",redrawReason:e,effects:this.effectManager.getEffects(),...n}),this.props.onAfterRender({gl:i})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),W.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const i=vi.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}d(pd,"defaultProps",h1);d(pd,"VERSION",KS.VERSION);class pu{constructor(e,n){d(this,"opts",void 0),d(this,"source",void 0),this.opts=n,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),n=this.getAccessor();if(e)return[e,n];const{value:i}=this.source,{size:r}=n;let s=i;if(i&&i.length!==r){s=new Float32Array(r);const o=n.elementOffset||0;for(let a=0;a<r;++a)s[a]=i[o+a]}return s}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function JM(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function Oa(t){return t.stride||t.size*t.bytesPerElement}function d1(t,e){e.offset&&W.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=Oa(t),i=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,r=e.elementOffset||0,s=i*n+r*t.bytesPerElement+(t.offset||0);return{...e,offset:s,stride:n}}function eI(t,e){const n=d1(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class tI{constructor(e,n,i){d(this,"gl",void 0),d(this,"id",void 0),d(this,"size",void 0),d(this,"settings",void 0),d(this,"value",void 0),d(this,"doublePrecision",void 0),d(this,"_buffer",void 0),d(this,"state",void 0),this.gl=e,this.id=n.id||"",this.size=n.size||1;const r=n.logicalType||n.type,s=r===5130;let{defaultValue:o}=n;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let a;s?a=5126:!r&&n.isIndexed?a=e&&d_(e,ee.ELEMENT_INDEX_UINT32)?5125:5123:a=r||5126;let l=JM(r||a||5126);this.doublePrecision=s,s&&n.fp64===!1&&(l=Float32Array),this.value=null,this.settings={...n,defaultType:l,defaultValue:o,logicalType:r,type:a,size:this.size,bytesPerElement:l.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:n}=this.settings;this._buffer=new Q(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:n}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Oa(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Mr.release(this.state.allocatedValue)}getShaderAttributes(e,n){if(this.doublePrecision){const i={},r=this.value instanceof Float64Array,s=eI(this.getAccessor(),n||{});return i[e]=new pu(this,s.high),i["".concat(e,"64Low")]=r?new pu(this,s.low):new Float32Array(this.size),i}if(n){const i=d1(this.getAccessor(),n);return{[e]:new pu(this,i)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:i,size:r}=this,s=i*r;if(n&&s&&n.length>=s){const o=new Array(r).fill(1/0),a=new Array(r).fill(-1/0);for(let l=0;l<s;)for(let c=0;c<r;c++){const u=n[l++];u<o[c]&&(o[c]=u),u>a[c]&&(a[c]=u)}e=[o,a]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof Q?i={buffer:e}:i=e;const r={...this.settings,...i};if(n.bufferAccessor=r,n.bounds=null,i.constant){let s=i.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!n.constant||!this._areValuesEqual(s,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=s}else if(i.buffer){const s=i.buffer;n.externalBuffer=s,n.constant=!1,this.value=i.value||null;const o=i.value instanceof Float64Array;r.type=i.type||s.accessor.type,r.bytesPerElement=s.accessor.BYTES_PER_ELEMENT*(o?2:1),r.stride=Oa(r)}else if(i.value){this._checkExternalBuffer(i);let s=i.value;n.externalBuffer=null,n.constant=!1,this.value=s,r.bytesPerElement=s.BYTES_PER_ELEMENT,r.stride=Oa(r);const{buffer:o,byteOffset:a}=this;this.doublePrecision&&s instanceof Float64Array&&(s=hu(s,r));const l=s.byteLength+a+r.stride*2;o.byteLength<l&&o.reallocate(l),o.setAccessor(null),o.subData({data:s,offset:a}),r.type=i.type||o.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:i=0,endOffset:r}=e;this.buffer.subData({data:this.doublePrecision&&n instanceof Float64Array?hu(n,{size:this.size,startIndex:i,endIndex:r}):n.subarray(i,r),offset:i*n.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e,n=!1){const{state:i}=this,r=i.allocatedValue,s=Mr.allocate(r,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=s;const{buffer:o,byteOffset:a}=this;return o.byteLength<s.byteLength+a&&(o.reallocate(s.byteLength+a),n&&r&&o.subData({data:r instanceof Float64Array?hu(r,this):r,offset:a})),i.allocatedValue=s,i.constant=!1,i.externalBuffer=null,i.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const i=this.settings.defaultType;let r=!1;if(this.doublePrecision&&(r=n.BYTES_PER_ELEMENT<4),r)throw new Error("Attribute ".concat(this.id," does not support ").concat(n.constructor.name));!(n instanceof i)&&this.settings.normalized&&!("normalized"in e)&&W.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(n=>(n+128)/255*2-1);case 5122:return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case 5121:return new Float32Array(e).map(n=>n/255);case 5123:return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,i){const{defaultValue:r,size:s}=this.settings;if(Number.isFinite(e))return n[i]=e,n;if(!e)return n[i]=r[0],n;switch(s){case 4:n[i+3]=Number.isFinite(e[3])?e[3]:r[3];case 3:n[i+2]=Number.isFinite(e[2])?e[2]:r[2];case 2:n[i+1]=Number.isFinite(e[1])?e[1]:r[1];case 1:n[i+0]=Number.isFinite(e[0])?e[0]:r[0];break;default:let o=s;for(;--o>=0;)n[i+o]=Number.isFinite(e[o])?e[o]:r[o]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:i}=this;for(let r=0;r<i;r++)if(e[r]!==n[r])return!1;return!0}}const Bm=[],Vm=[];function Eo(t,e=0,n=1/0){let i=Bm;const r={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?i=t:t.length>0&&(Vm.length=t.length,i=Vm):i=Bm,(e>0||Number.isFinite(n))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,n),r.index=e-1),{iterable:i,objectInfo:r}}function g1(t){return t&&t[Symbol.asyncIterator]}function p1(t,e){const{size:n,stride:i,offset:r,startIndices:s,nested:o}=e,a=t.BYTES_PER_ELEMENT,l=i?i/a:n,c=r?r/a:0,u=Math.floor((t.length-c)/l);return(f,{index:h,target:g})=>{if(!s){const y=h*l+c;for(let m=0;m<n;m++)g[m]=t[y+m];return g}const p=s[h],w=s[h+1]||u;let x;if(o){x=new Array(w-p);for(let y=p;y<w;y++){const m=y*l+c;g=new Array(n);for(let _=0;_<n;_++)g[_]=t[m+_];x[y-p]=g}}else if(l===n)x=t.subarray(p*n+c,w*n+c);else{x=new t.constructor((w-p)*n);let y=0;for(let m=p;m<w;m++){const _=m*l+c;for(let T=0;T<n;T++)x[y++]=t[_+T]}}return x}}const nI=[],ka=[[0,1/0]];function iI(t,e){if(t===ka||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],i=t.length;let r=0;for(let s=0;s<i;s++){const o=t[s];o[1]<e[0]?(n.push(o),r=s+1):o[0]>e[1]?n.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return n.splice(r,0,e),n}function mu(t){const{source:e,target:n,start:i=0,size:r,getData:s}=t,o=t.end||n.length,a=e.length,l=o-i;if(a>l){n.set(e.subarray(0,l),i);return}if(n.set(e,i),!s)return;let c=a;for(;c<l;){const u=s(c,e);for(let f=0;f<r;f++)n[i+c]=u[f]||0,c++}}function rI({source:t,target:e,size:n,getData:i,sourceStartIndices:r,targetStartIndices:s}){if(!Array.isArray(s))return mu({source:t,target:e,size:n,getData:i}),e;let o=0,a=0;const l=i&&((u,f)=>i(u+a,f)),c=Math.min(r.length,s.length);for(let u=1;u<c;u++){const f=r[u]*n,h=s[u]*n;mu({source:t.subarray(o,f),target:e,start:a,end:h,size:n,getData:l}),o=f,a=h}return a<e.length&&mu({source:[],target:e,start:a,size:n,getData:l}),e}const sI={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function m1(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...sI[n],...e,...t,type:n}}function v1(t,e){const n=e.getBuffer();return n?[n,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function y1(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function _1(t){t.push(t.shift())}function md(t,e){const{doublePrecision:n,settings:i,value:r,size:s}=t,o=n&&r instanceof Float64Array?2:1;return(i.noAlloc?r.length:e*s)*o}function w1({buffer:t,numInstances:e,attribute:n,fromLength:i,fromStartIndices:r,getData:s=o=>o}){const o=n.doublePrecision&&n.value instanceof Float64Array?2:1,a=n.size*o,l=n.byteOffset,c=n.startIndices,u=r&&c,f=md(n,e),h=n.isConstant;if(!u&&i>=f)return;const g=h?n.value:n.getBuffer().getData({srcByteOffset:l});if(n.settings.normalized&&!h){const y=s;s=(m,_)=>n.normalizeConstant(y(m,_))}const p=h?(y,m)=>s(g,m):(y,m)=>s(g.subarray(y,y+a),m),w=t.getData({length:i}),x=new Float32Array(f);rI({source:w,target:x,sourceStartIndices:r,targetStartIndices:c,size:a,getData:p}),t.byteLength<x.byteLength+l&&t.reallocate(x.byteLength+l),t.subData({data:x,offset:l})}class vd extends tI{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:ka}),d(this,"constant",!1),this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,i=this.settings.transition,r=Array.isArray(n)?e[n.find(s=>e[s])]:e[n];return m1(r,i)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:i=0,endRow:r=1/0}=n;this.state.updateRanges=iI(this.state.updateRanges,[i,r])}else this.state.updateRanges=ka}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=nI}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,n.updateRanges!==ka),!0):!1}updateBuffer({numInstances:e,data:n,props:i,context:r}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:a}}=this;let l=!0;if(o){for(const[c,u]of s)o.call(r,this,{data:n,startRow:c,endRow:u,props:i,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[c,u]of s){const f=Number.isFinite(c)?this.getVertexOffset(c):0,h=Number.isFinite(u)?this.getVertexOffset(u):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:f,endOffset:h})}this._checkAttributeArray()}else l=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),l}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:i,settings:r}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(r.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),r.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;Pe(ArrayBuffer.isView(o.value),"invalid ".concat(r.accessor));const a=Boolean(o.size)&&o.size!==this.size;return i.binaryAccessor=p1(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:n,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?n[e]:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},n={};for(const i in e)Object.assign(n,super.getShaderAttributes(i,e[i]));return n}_autoUpdater(e,{data:n,startRow:i,endRow:r,props:s,numInstances:o}){if(e.constant)return;const{settings:a,state:l,value:c,size:u,startIndices:f}=e,{accessor:h,transform:g}=a,p=l.binaryAccessor||(typeof h=="function"?h:s[h]);Pe(typeof p=="function",'accessor "'.concat(h,'" is not a function'));let w=e.getVertexOffset(i);const{iterable:x,objectInfo:y}=Eo(n,i,r);for(const m of x){y.index++;let _=p(m,y);if(g&&(_=g.call(this,_)),f){const T=(y.index<f.length-1?f[y.index+1]:o)-f[y.index];if(_&&Array.isArray(_[0])){let P=w;for(const A of _)e._normalizeValue(A,c,P),P+=u}else _&&_.length>u?c.set(_,w):(e._normalizeValue(_,y.target,0),A3({target:c,source:y.target,start:w,count:T}));w+=T*u}else e._normalizeValue(_,c,w),w+=u}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let i=!0;switch(n){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class oI{constructor({gl:e,attribute:n,timeline:i}){d(this,"gl",void 0),d(this,"type","interpolation"),d(this,"attributeInTransition",void 0),d(this,"settings",void 0),d(this,"attribute",void 0),d(this,"transition",void 0),d(this,"currentStartIndices",void 0),d(this,"currentLength",void 0),d(this,"transform",void 0),d(this,"buffers",void 0),this.gl=e,this.transition=new _o(i),this.attribute=n,this.attributeInTransition=new vd(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=lI(e,n);const r={byteLength:0,usage:35050};this.buffers=[new Q(e,r),new Q(e,r)]}get inProgress(){return this.transition.inProgress}start(e,n){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:i,buffers:r,attribute:s}=this;_1(r);const o={numInstances:n,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const a of r)w1({buffer:a,...o});this.currentStartIndices=s.startIndices,this.currentLength=md(s,n),this.attributeInTransition.setData({buffer:r[1],value:s.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aFrom:r[0],aTo:v1(i,s)},feedbackBuffers:{vCurrent:r[1]}})}update(){const e=this.transition.update();if(e){const{duration:n,easing:i}=this.settings,{time:r}=this.transition;let s=r/n;i&&(s=i(s)),this.transform.run({uniforms:{time:s}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const aI=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function lI(t,e){const n=y1(e.size);return new ld(t,{vs:aI,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}class cI{constructor({gl:e,attribute:n,timeline:i}){d(this,"gl",void 0),d(this,"type","spring"),d(this,"attributeInTransition",void 0),d(this,"settings",void 0),d(this,"attribute",void 0),d(this,"transition",void 0),d(this,"currentStartIndices",void 0),d(this,"currentLength",void 0),d(this,"texture",void 0),d(this,"framebuffer",void 0),d(this,"transform",void 0),d(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new _o(i),this.attribute=n,this.attributeInTransition=new vd(e,{...n.settings,normalized:!1}),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=fI(e),this.framebuffer=hI(e,this.texture),this.transform=uI(e,n,this.framebuffer);const r={byteLength:0,usage:35050};this.buffers=[new Q(e,r),new Q(e,r),new Q(e,r)]}get inProgress(){return this.transition.inProgress}start(e,n){const{gl:i,buffers:r,attribute:s}=this,o={numInstances:n,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const a of r)w1({buffer:a,...o});this.settings=e,this.currentStartIndices=s.startIndices,this.currentLength=md(s,n),this.attributeInTransition.setData({buffer:r[1],value:s.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aTo:v1(i,s)}})}update(){const{buffers:e,transform:n,framebuffer:i,transition:r}=this;if(!r.update())return!1;const o=this.settings;return n.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),n.run({framebuffer:i,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:o.stiffness,damping:o.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),_1(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),Yl(i)[0]>0||r.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function uI(t,e,n){const i=y1(e.size);return new ld(t,{framebuffer:n,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:i},varyings:["vNext"]})}function fI(t){return new We(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function hI(t,e){return new _e(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{[36064]:e}})}const dI={interpolation:oI,spring:cI};class gI{constructor(e,{id:n,timeline:i}){d(this,"id",void 0),d(this,"isSupported",void 0),d(this,"gl",void 0),d(this,"timeline",void 0),d(this,"transitions",void 0),d(this,"needsRedraw",void 0),d(this,"numInstances",void 0),this.id=n,this.gl=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=ld.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:i}){this.numInstances=i||1;for(const r in e){const s=e[r],o=s.getTransitionSetting(n);!o||this._updateAttribute(r,s,o)}for(const r in this.transitions){const s=e[r];(!s||!s.getTransitionSetting(n))&&this._removeTransition(r)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const i=this.transitions[n];i.inProgress&&(e[n]=i.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,n,i){const r=this.transitions[e];let s=!r||r.type!==i.type;if(s){if(!this.isSupported){W.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}r&&this._removeTransition(e);const o=dI[i.type];o?this.transitions[e]=new o({attribute:n,timeline:this.timeline,gl:this.gl}):(W.error("unsupported transition type '".concat(i.type,"'"))(),s=!1)}(s||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const jm="attributeManager.invalidate",pI="attributeManager.updateStart",mI="attributeManager.updateEnd",vI="attribute.updateStart",yI="attribute.allocate",_I="attribute.updateEnd";class wI{constructor(e,{id:n="attribute-manager",stats:i,timeline:r}={}){d(this,"id",void 0),d(this,"gl",void 0),d(this,"attributes",void 0),d(this,"updateTriggers",void 0),d(this,"needsRedraw",void 0),d(this,"userData",void 0),d(this,"stats",void 0),d(this,"attributeTransitionManager",void 0),this.id=n,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new gI(e,{id:"".concat(n,"-transitions"),timeline:r}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const i=this._invalidateTrigger(e,n);Ne(jm,this,e,i)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);Ne(jm,this,"all")}update({data:e,numInstances:n,startIndices:i=null,transitions:r,props:s={},buffers:o={},context:a={}}){let l=!1;Ne(pI,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const c in this.attributes){const u=this.attributes[c],f=u.settings.accessor;u.startIndices=i,u.numInstances=n,s[c]&&W.removed("props.".concat(c),"data.attributes.".concat(c))(),u.setExternalBuffer(o[c])||u.setBinaryValue(typeof f=="string"?o[f]:void 0,e.startIndices)||typeof f=="string"&&!o[f]&&u.setConstantValue(s[f])||u.needsUpdate()&&(l=!0,this._updateAttribute({attribute:u,numInstances:n,data:e,props:s,context:a})),this.needsRedraw=this.needsRedraw||u.needsRedraw()}l&&Ne(mI,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:r})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return this.attributes}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:i}=this,r={...i.getAttributes()};for(const s in n){const o=n[s];o.needsRedraw(e)&&!i.hasAttribute(s)&&(r[s]=o)}return r}getShaderAttributes(e,n={}){e||(e=this.getAttributes());const i={};for(const r in e)n[r]||Object.assign(i,e[r].getShaderAttributes());return i}_add(e,n={}){for(const i in e){const r=e[i];this.attributes[i]=this._createAttribute(i,r,n)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,n,i){const r={...n,id:e,size:n.isIndexed&&1||n.size||1,divisor:i.instanced?1:n.divisor||0};return new vd(this.gl,r)}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(r=>{e[r]||(e[r]=[]),e[r].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:i,updateTriggers:r}=this,s=r[e];return s&&s.forEach(o=>{const a=i[o];a&&a.setNeedsUpdate(a.id,n)}),s}_updateAttribute(e){const{attribute:n,numInstances:i}=e;if(Ne(vI,n),n.constant){n.setConstantValue(n.value);return}n.allocate(i)&&Ne(yI,n,i),n.updateBuffer(e)&&(this.needsRedraw=!0,Ne(_I,n,i))}}class EI extends _o{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:i,duration:r,easing:s}}=this,o=s(e/r);this._value=wi(n,i,o)}}const Gm=1e-5;function Wm(t,e,n,i,r){const s=e-t,a=(n-e)*r,l=-s*i;return a+l+s+e}function xI(t,e,n,i,r){if(Array.isArray(n)){const s=[];for(let o=0;o<n.length;o++)s[o]=Wm(t[o],e[o],n[o],i,r);return s}return Wm(t,e,n,i,r)}function Hm(t,e){if(Array.isArray(t)){let n=0;for(let i=0;i<t.length;i++){const r=t[i]-e[i];n+=r*r}return Math.sqrt(n)}return Math.abs(t-e)}class TI extends _o{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:i,stiffness:r}=this.settings,{_prevValue:s=e,_currValue:o=e}=this;let a=xI(s,o,n,i,r);const l=Hm(a,n),c=Hm(a,o);l<Gm&&c<Gm&&(a=n,this.end()),this._prevValue=o,this._currValue=a}}const SI={interpolation:EI,spring:TI};class PI{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,i,r){const{transitions:s}=this;if(s.has(e)){const l=s.get(e),{value:c=l.settings.fromValue}=l;n=c,this.remove(e)}if(r=m1(r),!r)return;const o=SI[r.type];if(!o){W.error("unsupported transition type '".concat(r.type,"'"))();return}const a=new o(this.timeline);a.start({...r,fromValue:n,toValue:i}),s.set(e,a)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,i]of this.transitions)i.update(),e[n]=i.value,i.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function bI(t){const e=yd(t);for(const n in e){const i=e[n],{validate:r}=i;if(r&&!r(t[n],i))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}function AI(t,e){const n=E1({newProps:t,oldProps:e,propTypes:yd(t),ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=LI(t,e);let r=!1;return i||(r=MI(t,e)),{dataChanged:i,propsChanged:n,updateTriggersChanged:r,extensionsChanged:II(t,e),transitionsChanged:CI(t,e)}}function CI(t,e){if(!t.transitions)return!1;const n={},i=yd(t);let r=!1;for(const s in t.transitions){const o=i[s],a=o&&o.type;(a==="number"||a==="color"||a==="array")&&jf(t[s],e[s],o)&&(n[s]=!0,r=!0)}return r?n:!1}function E1({newProps:t,oldProps:e,ignoreProps:n={},propTypes:i={},triggerName:r="props"}){if(e===t)return!1;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(r," changed shallowly");for(const s of Object.keys(t))if(!(s in n)){if(!(s in e))return"".concat(r,".").concat(s," added");const o=jf(t[s],e[s],i[s]);if(o)return"".concat(r,".").concat(s," ").concat(o)}for(const s of Object.keys(e))if(!(s in n)){if(!(s in t))return"".concat(r,".").concat(s," dropped");if(!Object.hasOwnProperty.call(t,s)){const o=jf(t[s],e[s],i[s]);if(o)return"".concat(r,".").concat(s," ").concat(o)}}return!1}function jf(t,e,n){let i=n&&n.equal;return i&&!i(t,e,n)||!i&&(i=t&&e&&t.equals,i&&!i.call(t,e))?"changed deeply":!i&&e!==t?"changed shallowly":null}function LI(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:i,_dataDiff:r}=t;return i?i(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&r&&(n=r(t.data,e.data)||n),n}function MI(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&Xm(t,e,"all"))return{all:!0};const n={};let i=!1;for(const r in t.updateTriggers)r!=="all"&&Xm(t,e,r)&&(n[r]=!0,i=!0);return i?n:!1}function II(t,e){if(e===null)return!0;const n=e.extensions,{extensions:i}=t;if(i===n)return!1;if(!n||!i||i.length!==n.length)return!0;for(let r=0;r<i.length;r++)if(!i[r].equals(n[r]))return!0;return!1}function Xm(t,e,n){let i=t.updateTriggers[n];i=i==null?{}:i;let r=e.updateTriggers[n];return r=r==null?{}:r,E1({oldProps:r,newProps:i,triggerName:n})}function yd(t){const e=t[El],n=e&&e.constructor;return n?n._propTypes:{}}const RI="count(): argument not an object",OI="count(): argument not a container";function kI(t){if(!FI(t))throw new Error(RI);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(NI(t))return Object.keys(t).length;throw new Error(OI)}function NI(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function FI(t){return t!==null&&typeof t=="object"}function DI(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=n.modules.findIndex(r=>r.name==="project32");i>=0&&n.modules.splice(i,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const i={...t.inject};for(const r in e.inject)i[r]=(i[r]||"")+e.inject[r];n.inject=i}return n}const zI={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071},Gf={};function UI(t,e){const n=t.context&&t.context.gl;if(!n||!e)return null;if(e instanceof We)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});let i=null;e.compressed&&(i={[10241]:e.data.length>1?9985:9729});const r=new We(n,{...e,parameters:{...zI,...i,...t.props.textureParameters}});return Gf[r.id]=!0,r}function BI(t){!t||!(t instanceof We)||Gf[t.id]&&(t.delete(),delete Gf[t.id])}const VI={boolean:{validate(t,e){return!0},equal(t,e,n){return Boolean(t)===Boolean(e)}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||Qs(t)&&(t.length===3||t.length===4)},equal(t,e,n){return vu(t,e)}},accessor:{validate(t,e){const n=Tl(t);return n==="function"||n===Tl(e.value)},equal(t,e,n){return typeof e=="function"?!0:vu(t,e)}},array:{validate(t,e){return e.optional&&!t||Qs(t)},equal(t,e,n){return n.compare?vu(t,e):t===e}},object:{equal(t,e,n){return n.compare?Oi(t,e):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare||t===e}},data:{transform:(t,e,n)=>{const{dataTransform:i}=n.props;return i&&t?i(t):t}},image:{transform:(t,e,n)=>UI(n,t),release:t=>{BI(t)}}};function vu(t,e){if(t===e)return!0;if(!Qs(t)||!Qs(e))return!1;const n=t.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}function jI(t){const e={},n={},i={};for(const[r,s]of Object.entries(t)){const o=s==null?void 0:s.deprecatedFor;if(o)i[r]=Array.isArray(o)?o:[o];else{const a=GI(r,s);e[r]=a,n[r]=a.value}}return{propTypes:e,defaultProps:n,deprecatedProps:i}}function GI(t,e){switch(Tl(e)){case"object":return os(t,e);case"array":return os(t,{type:"array",value:e,compare:!1});case"boolean":return os(t,{type:"boolean",value:e});case"number":return os(t,{type:"number",value:e});case"function":return os(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function os(t,e){return"type"in e?{name:t,...VI[e.type],...e}:"value"in e?{name:t,type:Tl(e.value),...e}:{name:t,type:"object",value:e}}function Qs(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Tl(t){return Qs(t)?"array":t===null?"null":typeof t}function WI(t,e){const n=x1(t.constructor),i=Object.create(n);i[El]=t,i[Ci]={},i[Vn]={};for(let r=0;r<e.length;++r){const s=e[r];for(const o in s)i[o]=s[o]}return Object.freeze(i),i}function x1(t){const e=Sl(t,"_mergedDefaultProps");return e||(HI(t),t._mergedDefaultProps)}function HI(t){if(!t.prototype)return;const n=Object.getPrototypeOf(t),i=x1(n),r=Sl(t,"defaultProps")||{},s=jI(r),o=XI(s.defaultProps,i,t),a={...n._propTypes,...s.propTypes};ZI(o,a);const l={...n._deprecatedProps,...s.deprecatedProps};YI(o,l),t._mergedDefaultProps=o,t._propTypes=a,t._deprecatedProps=l}function XI(t,e,n){const i=Object.create(null);Object.assign(i,e,t);const r=KI(n);return delete t.id,Object.defineProperties(i,{id:{writable:!0,value:r}}),i}function YI(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(i){const r="".concat(this.id,": ").concat(n);for(const s of e[n])T1(this,s)||(this[s]=i);W.deprecated(r,e[n].join("/"))()}})}function ZI(t,e){const n={},i={};for(const r in e){const s=e[r],{name:o,value:a}=s;s.async&&(n[o]=a,i[o]=$I(o))}t[gr]=n,t[Ci]={},Object.defineProperties(t,i)}function $I(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||g1(e)?this[Ci][t]=e:this[Vn][t]=e},get(){if(this[Vn]){if(t in this[Vn])return this[Vn][t]||this[gr][t];if(t in this[Ci]){const e=this[El]&&this[El].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[gr][t]}}return this[gr][t]}}}function T1(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Sl(t,e){return T1(t,e)&&t[e]}function KI(t){const e=Sl(t,"layerName")||Sl(t,"componentName");return e||W.once(0,"".concat(t.name,".componentName not specified"))(),e||t.name}let qI=0;class _d{constructor(...e){d(this,"id",void 0),d(this,"props",void 0),d(this,"count",void 0),this.props=WI(this,e),this.id=this.props.id,this.count=qI++}clone(e){const{props:n}=this,i={};for(const r in n[gr])r in n[Vn]?i[r]=n[Vn][r]:r in n[Ci]&&(i[r]=n[Ci][r]);return new this.constructor({...n,...i,...e})}}d(_d,"componentName","Component");d(_d,"defaultProps",{});const QI=Object.freeze({});class JI{constructor(e){d(this,"component",void 0),d(this,"onAsyncPropUpdated",void 0),d(this,"asyncProps",void 0),d(this,"oldProps",void 0),d(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}}getOldProps(){return this.oldAsyncProps||this.oldProps||QI}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component.props}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return Boolean(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){const n=e[Vn]||{},i=e[Ci]||e,r=e[gr]||{};for(const s in n){const o=n[s];this._createAsyncPropData(s,r[s]),this._updateAsyncProp(s,o),n[s]=this.getAsyncProp(s)}for(const s in i){const o=i[s];this._createAsyncPropData(s,r[s]),this._updateAsyncProp(s,o)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(!!this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(g1(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const i=this.asyncProps[e];return n===i.resolvedValue||n===i.lastValue?!1:(i.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(n=this._postProcessValue(i,n),i.resolvedValue=n,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,n,i){const r=this.asyncProps[e];r&&i>=r.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),r.resolvedValue=n,r.resolvedLoadCount=i,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const r=i.pendingLoadCount;n.then(s=>{s=this._postProcessValue(i,s),this._setAsyncPropValue(e,s,r),this._onResolve(e,s)}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const r=i.pendingLoadCount;let s=[],o=0;for await(const a of n){const{dataTransform:l}=this.component.props;l?s=l(a,s):s=s.concat(a),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(e,s,r)}this._onResolve(e,s)}_postProcessValue(e,n){const i=e.type;return i&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(n,i,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const r=this.component&&this.component.constructor._propTypes;this.asyncProps[e]={type:r&&r[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class eR extends JI{constructor({attributeManager:e,layer:n}){super(n),d(this,"attributeManager",void 0),d(this,"needsRedraw",void 0),d(this,"needsUpdate",void 0),d(this,"subLayers",void 0),d(this,"usesPickingColorCache",void 0),d(this,"changeFlags",void 0),d(this,"viewport",void 0),d(this,"uniformTransitions",void 0),d(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}set layer(e){this.component=e}_fetch(e,n){const i=this.component.props.fetch;return i?i(n,{propName:e,layer:this.layer}):super._fetch(e,n)}_onResolve(e,n){const i=this.component.props.onDataLoad;e==="data"&&i&&i(n,{propName:e,layer:this.layer})}_onError(e,n){this.layer.raiseError(n,"loading ".concat(e," of ").concat(this.layer))}}const tR="layer.changeFlag",nR="layer.initialize",iR="layer.update",rR="layer.finalize",sR="layer.matched",Ym=2**24-1,oR=Object.freeze([]),aR=$l(({oldViewport:t,viewport:e})=>t.equals(e));let Zt=new Uint8ClampedArray(0);const lR={data:{type:"data",value:oR,async:!0},dataComparator:{type:"function",value:null,compare:!1,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,compare:!1,optional:!0},dataTransform:{type:"function",value:null,compare:!1,optional:!0},onDataLoad:{type:"function",value:null,compare:!1,optional:!0},onError:{type:"function",value:null,compare:!1,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:i,loadOptions:r,signal:s})=>{const{resourceManager:o}=n.context;if(r=r||n.getLoadOptions(),i=i||n.props.loaders,s){var a;r={...r,fetch:{...(a=r)===null||a===void 0?void 0:a.fetch,signal:s}}}let l=o.contains(t);return!l&&!r&&(o.add({resourceId:t,data:dl(t,i),persistent:!1}),l=!0),l?o.subscribe({resourceId:t,onChange:c=>{var u;return(u=n.internalState)===null||u===void 0?void 0:u.reloadAsyncProp(e,c)},consumerId:n.id,requestId:e}):dl(t,i,r)},compare:!1},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:mo.DRAW,onHover:{type:"function",value:null,compare:!1,optional:!0},onClick:{type:"function",value:null,compare:!1,optional:!0},onDragStart:{type:"function",value:null,compare:!1,optional:!0},onDrag:{type:"function",value:null,compare:!1,optional:!0},onDragEnd:{type:"function",value:null,compare:!1,optional:!0},coordinateSystem:$.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,compare:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100],compare:!1},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class gt extends _d{constructor(...e){super(...e),d(this,"internalState",null),d(this,"lifecycle",Wi.NO_STATE),d(this,"context",void 0),d(this,"state",void 0),d(this,"parent",null)}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){Pe(this.internalState);const n=this.internalState.viewport||this.context.viewport,i=t1(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[r,s,o]=q_(i,n.pixelProjectionMatrix);return e.length===2?[r,s]:[r,s,o]}unproject(e){return Pe(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){Pe(this.internalState);const i=this.internalState.viewport||this.context.viewport;return b3(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===$.DEFAULT||e===$.LNGLAT||e===$.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){Pe(e instanceof Uint8Array);const[n,i,r]=e;return n+i*256+r*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:kI(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;const n=this.getAttributeManager();if(!n)return null;const{positions:i,instancePositions:r}=n.attributes;return(e=i||r)===null||e===void 0?void 0:e.getBounds()}getShaders(e){for(const n of this.props.extensions)e=DI(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&n)if(Array.isArray(i))for(const l of i)n.invalidateAll(l);else n.invalidateAll();const{props:r,oldProps:s}=e,o=Number.isInteger(s.highlightedObjectIndex)||s.pickable,a=Number.isInteger(r.highlightedObjectIndex)||r.pickable;if(o!==a&&n){const{pickingColors:l,instancePickingColors:c}=n.attributes,u=l||c;u&&(a&&u.constant&&(u.constant=!1,n.invalidate(u.id)),!u.value&&!a&&(u.constant=!0,u.value=[0,0,0]))}}finalizeState(e){for(const i of this.getModels())i.delete();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:i}){const{index:r}=e;return r>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[r]),e}raiseError(e,n){var i,r;if(n&&(e.message="".concat(n,": ").concat(e.message)),!((i=(r=this.props).onError)!==null&&i!==void 0&&i.call(r,e))){var s,o;(s=this.context)===null||s===void 0||(o=s.onError)===null||o===void 0||o.call(s,e,this)}}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!aR({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();!n||(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){for(const n of this.getModels())this._setModelAttributes(n,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,i=this.getNumInstances(),r=this.getStartIndices();e.update({data:n.data,numInstances:i,startIndices:r,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),i=Object.create(this.props);for(const r in n)Object.defineProperty(i,r,{value:n[r]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const i=Math.floor(Zt.length/3);if(this.internalState.usesPickingColorCache=!0,i<n){n>Ym&&W.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Zt=Mr.allocate(Zt,n,{size:3,copy:!0,maxCount:Math.max(n,Ym)});const r=Math.floor(Zt.length/3),s=[];for(let o=i;o<r;o++)this.encodePickingColor(o,s),Zt[o*3+0]=s[0],Zt[o*3+1]=s[1],Zt[o*3+2]=s[2]}e.value=Zt.subarray(0,n*3)}_setModelAttributes(e,n){const i=this.getAttributeManager(),r=e.userData.excludeAttributes||{},s=i.getShaderAttributes(n,r);e.setAttributes(s)}disablePickingIndex(e){this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,r=n||i;if(!r)return;const s=r.getVertexOffset(e),o=r.getVertexOffset(e+1);r.buffer.subData({data:new Uint8Array(o-s),offset:s})}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,i=e||n;!i||(this.internalState.usesPickingColorCache&&i.value.buffer!==Zt.buffer&&(i.value=Zt.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){Pe(!this.internalState),Pe(Number.isFinite(this.props.coordinateSystem)),Ne(nR,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new eR({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(W.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.layer=this,this.internalState.uniformTransitions=new PI(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Ne(sR,this,this===e);const{state:n,internalState:i}=e;this!==e&&(this.internalState=i,this.internalState.layer=this,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Ne(iR,this,e),!e)return;const n=this.props,i=this.context,r=this.internalState,s=i.viewport,o=this._updateUniformTransition();r.propsInTransition=o,i.viewport=r.viewport||s,this.props=o;try{const a=this._getUpdateParams(),l=this.getModels();if(i.gl)this.updateState(a);else try{this.updateState(a)}catch{}for(const u of this.props.extensions)u.updateState.call(this,a,u);const c=this.getModels()[0]!==l[0];this._postUpdate(a,c)}finally{i.viewport=s,this.props=n,this._clearChangeFlags(),r.needsUpdate=!1,r.resetOldProps()}}_finalize(){Ne(rR,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,e)}_drawLayer({moduleParameters:e=null,uniforms:n={},parameters:i={}}){this._updateAttributeTransition();const r=this.props,s=this.context;this.props=this.internalState.propsInTransition||r;const o=this.props.opacity;n.opacity=Math.pow(o,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:a}=this.props,l=a&&a(n)||[0,0];xn(s.gl,{polygonOffset:l}),xt(s.gl,i,()=>{const c={moduleParameters:e,uniforms:n,parameters:i,context:s};for(const u of this.props.extensions)u.draw.call(this,c,u);this.draw(c)})}finally{this.props=r}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const r in e)if(e[r]){let s=!1;switch(r){case"dataChanged":const o=e[r],a=n[r];o&&Array.isArray(a)&&(n.dataChanged=Array.isArray(o)?a.concat(o):o,s=!0);default:n[r]||(n[r]=e[r],s=!0)}s&&Ne(tR,this,r,e)}const i=Boolean(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=i,n.somethingChanged=i||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){const i=AI(e,n);if(i.updateTriggersChanged)for(const s in i.updateTriggersChanged)i.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(i.transitionsChanged)for(const s in i.transitionsChanged){var r;this.internalState.uniformTransitions.add(s,n[s],e[s],(r=e.transitions)===null||r===void 0?void 0:r[s])}return this.setChangeFlags(i)}validateProps(){bI(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={pickingSelectedColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(n.pickingHighlightColor=i(e)),this.setModuleParameters(n),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new wI(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:i,oldProps:r}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:s}=this.state;s==null||s.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:a,highlightColor:l}=i;if(n||r.autoHighlight!==o||r.highlightedObjectIndex!==a||r.highlightColor!==l){const c={};o||(c.pickingSelectedColor=null),Array.isArray(l)&&(c.pickingHighlightColor=l),Number.isInteger(a)&&(c.pickingSelectedColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setModuleParameters(c)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id,this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags;const i=this.getAttributeManager(),r=i?i.getNeedsRedraw(e):!1;return n=n||r,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}d(gt,"defaultProps",lR);d(gt,"layerName","Layer");const cR="compositeLayer.renderLayers";class Ql extends gt{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||n}getSubLayerRow(e,n,i){return e.__source={parent:this,object:n,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(i,r)=>i&&i.__source?(n.index=i.__source.index,e(i.__source.object,n)):e(i,r)}return e}getSubLayerProps(e={}){var n;const{opacity:i,pickable:r,visible:s,parameters:o,getPolygonOffset:a,highlightedObjectIndex:l,autoHighlight:c,highlightColor:u,coordinateSystem:f,coordinateOrigin:h,wrapLongitude:g,positionFormat:p,modelMatrix:w,extensions:x,fetch:y,operation:m,_subLayerProps:_}=this.props,T={id:"",updateTriggers:{},opacity:i,pickable:r,visible:s,parameters:o,getPolygonOffset:a,highlightedObjectIndex:l,autoHighlight:c,highlightColor:u,coordinateSystem:f,coordinateOrigin:h,wrapLongitude:g,positionFormat:p,modelMatrix:w,extensions:x,fetch:y,operation:m},P=_&&e.id&&_[e.id],A=P&&P.updateTriggers,C=e.id||"sublayer";if(P){const M=this.constructor._propTypes,R=e.type?e.type._propTypes:{};for(const O in P){const z=R[O]||M[O];z&&z.type==="accessor"&&(P[O]=this.getSubLayerAccessor(P[O]))}}Object.assign(T,e,P),T.id="".concat(this.props.id,"-").concat(C),T.updateTriggers={all:(n=this.props.updateTriggers)===null||n===void 0?void 0:n.all,...e.updateTriggers,...A};for(const M of x){const R=M.getSubLayerProps.call(this,M);R&&Object.assign(T,R,{updateTriggers:Object.assign(T.updateTriggers,R.updateTriggers)})}return T}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let i=this.internalState.subLayers;const r=!i||this.needsUpdate();if(r){const s=this.renderLayers();i=hd(s,Boolean),this.internalState.subLayers=i}Ne(cR,this,r,i);for(const s of i)s.parent=this}}d(Ql,"layerName","CompositeLayer");const la=Math.PI/180,Zm=180/Math.PI,Na=6370972,sr=256;function uR(){const t=sr/Na,e=Math.PI/180*sr;return{unitsPerMeter:[t,t,t],unitsPerMeter2:[0,0,0],metersPerUnit:[1/t,1/t,1/t],unitsPerDegree:[e,e,t],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/t]}}class fR extends rn{constructor(e={}){const{latitude:n=0,longitude:i=0,zoom:r=0,nearZMultiplier:s=.1,farZMultiplier:o=2,resolution:a=10}=e;let{height:l,altitude:c=1.5}=e;l=l||1,c=Math.max(.75,c);const u=new Ue().lookAt({eye:[0,-c,0],up:[0,0,1]}),f=Math.pow(2,r);u.rotateX(n*la),u.rotateZ(-i*la),u.scale(f/l);const h=Math.atan(.5/c),g=sr*2*f/l;super({...e,height:l,viewMatrix:u,longitude:i,latitude:n,zoom:r,distanceScales:uR(),fovyRadians:h*2,focalDistance:c,near:s,far:Math.min(2,1/g+1)*c*o}),d(this,"longitude",void 0),d(this,"latitude",void 0),d(this,"resolution",void 0),this.latitude=n,this.longitude=i,this.resolution=a}get projectionMode(){return kt.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const n={targetZ:e.z||0},i=this.unproject([0,this.height/2],n),r=this.unproject([this.width/2,0],n),s=this.unproject([this.width,this.height/2],n),o=this.unproject([this.width/2,this.height],n);return s[0]<this.longitude&&(s[0]+=360),i[0]>this.longitude&&(i[0]-=360),[Math.min(i[0],s[0],r[0],o[0]),Math.min(i[1],s[1],r[1],o[1]),Math.max(i[0],s[0],r[0],o[0]),Math.max(i[1],s[1],r[1],o[1])]}unproject(e,{topLeft:n=!0,targetZ:i}={}){const[r,s,o]=e,a=n?s:this.height-s,{pixelUnprojectionMatrix:l}=this;let c;if(Number.isFinite(o))c=yu(l,[r,a,o,1]);else{const g=yu(l,[r,a,-1,1]),p=yu(l,[r,a,1,1]),w=((i||0)/Na+1)*sr,x=ou(N_([],g,p)),y=ou(g),m=ou(p),_=(4*y*m-(x-y-m)**2)/16,T=4*_/x,P=Math.sqrt(y-T),A=Math.sqrt(Math.max(0,w*w-T)),C=(P-A)/Math.sqrt(x);c=JC([],g,p,C)}const[u,f,h]=this.unprojectPosition(c);return Number.isFinite(o)?[u,f,h]:Number.isFinite(i)?[u,f,i]:[u,f]}projectPosition(e){const[n,i,r=0]=e,s=n*la,o=i*la,a=Math.cos(o),l=(r/Na+1)*sr;return[Math.sin(s)*a*l,-Math.cos(s)*a*l,Math.sin(o)*l]}unprojectPosition(e){const[n,i,r]=e,s=o2(e),o=Math.asin(r/s),l=Math.atan2(n,-i)*Zm,c=o*Zm,u=(s/sr-1)*Na;return[l,c,u]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,n){const i=this.unproject(n);return{longitude:e[0]-i[0]+this.longitude,latitude:e[1]-i[1]+this.latitude}}}function yu(t,e){const n=Fr([],e,t);return z_(n,n,1/n[3]),n}const _u=Math.PI/180;function hR({height:t,focalDistance:e,orbitAxis:n,rotationX:i,rotationOrbit:r,zoom:s}){const o=n==="Z"?[0,0,1]:[0,1,0],a=n==="Z"?[0,-e,0]:[0,0,e],l=new Ue().lookAt({eye:a,up:o});l.rotateX(i*_u),n==="Z"?l.rotateZ(r*_u):l.rotateY(r*_u);const c=Math.pow(2,s)/t;return l.scale(c),l}class dR extends rn{constructor(e){const{height:n,projectionMatrix:i,fovy:r=50,orbitAxis:s="Z",target:o=[0,0,0],rotationX:a=0,rotationOrbit:l=0,zoom:c=0}=e,u=i?i[5]/2:fd(r);super({...e,longitude:void 0,viewMatrix:hR({height:n||1,focalDistance:u,orbitAxis:s,rotationX:a,rotationOrbit:l,zoom:c}),fovy:r,focalDistance:u,position:o,zoom:c}),d(this,"projectedCenter",void 0),this.projectedCenter=this.project(this.center)}unproject(e,{topLeft:n=!0}={}){const[i,r,s=this.projectedCenter[2]]=e,o=n?r:this.height-r,[a,l,c]=vo([i,o,s],this.pixelUnprojectionMatrix);return[a,l,c]}panByPosition(e,n){const i=this.project(e),r=[this.width/2+i[0]-n[0],this.height/2+i[1]-n[1],this.projectedCenter[2]];return{target:this.unproject(r)}}}class gR extends rn{constructor(e){const{longitude:n,latitude:i,modelMatrix:r,bearing:s=0,pitch:o=0,up:a=[0,0,1]}=e,c=new Zl({bearing:s,pitch:o===-90?1e-4:90+o}).toVector3().normalize(),u=r?new Ue(r).transformAsVector(c):c,f=Number.isFinite(i)?$_({latitude:i}):0,h=Math.pow(2,f),g=new Ue().lookAt({eye:[0,0,0],center:u,up:a}).scale(h);super({...e,zoom:f,viewMatrix:g}),d(this,"longitude",void 0),d(this,"latitude",void 0),this.latitude=i,this.longitude=n}}const as=20;class wd extends dd{constructor(e){const{width:n,height:i,position:r=[0,0,0],bearing:s=0,pitch:o=0,longitude:a=null,latitude:l=null,maxPitch:c=90,minPitch:u=-90,startRotatePos:f,startBearing:h,startPitch:g,startZoomPosition:p}=e;super({width:n,height:i,position:r,bearing:s,pitch:o,longitude:a,latitude:l,maxPitch:c,minPitch:u},{startRotatePos:f,startBearing:h,startPitch:g,startZoomPosition:p})}panStart(){return this}pan(){return this}panEnd(){return this}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:i=0}){const{startRotatePos:r,startBearing:s,startPitch:o}=this.getState(),{width:a,height:l}=this.getViewportProps();if(!r||s===void 0||o===void 0)return this;let c;if(e){const u=(e[0]-r[0])/a,f=(e[1]-r[1])/l;c={bearing:s-u*180,pitch:o-f*90}}else c={bearing:s-n,pitch:o-i};return this._getUpdatedState(c)}rotateEnd(){return this._getUpdatedState({startRotatePos:null,startBearing:null,startPitch:null})}zoomStart(){return this._getUpdatedState({startZoomPosition:this.getViewportProps().position})}zoom({scale:e}){let{startZoomPosition:n}=this.getState();n||(n=this.getViewportProps().position);const i=this.getDirection();return this._move(i,Math.log2(e)*as,n)}zoomEnd(){return this._getUpdatedState({startZoomPosition:null})}moveLeft(e=as){const n=this.getDirection(!0);return this._move(n.rotateZ({radians:Math.PI/2}),e)}moveRight(e=as){const n=this.getDirection(!0);return this._move(n.rotateZ({radians:-Math.PI/2}),e)}moveUp(e=as){const n=this.getDirection(!0);return this._move(n,e)}moveDown(e=as){const n=this.getDirection(!0);return this._move(n.negate(),e)}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}zoomIn(e=2){return this.zoom({scale:e})}zoomOut(e=2){return this.zoom({scale:1/e})}shortestPathFrom(e){const n=e.getViewportProps(),i={...this.getViewportProps()},{bearing:r,longitude:s}=i;return Math.abs(r-n.bearing)>180&&(i.bearing=r<0?r+360:r-360),s!==null&&n.longitude!==null&&Math.abs(s-n.longitude)>180&&(i.longitude=s<0?s+360:s-360),i}_move(e,n,i=this.getViewportProps().position){const r=e.scale(n);return this._getUpdatedState({position:new Pt(i).add(r)})}getDirection(e=!1){return new Zl({bearing:this.getViewportProps().bearing,pitch:e?90:90+this.getViewportProps().pitch}).toVector3().normalize()}_getUpdatedState(e){return new wd({...this.getViewportProps(),...this.getState(),...e})}applyConstraints(e){const{pitch:n,maxPitch:i,minPitch:r,longitude:s,bearing:o}=e;return e.pitch=pe(n,r,i),s!==null&&(s<-180||s>180)&&(e.longitude=wl(s+180,360)-180),(o<-180||o>180)&&(e.bearing=wl(o+180,360)-180),e}}class pR extends wo{constructor(...e){super(...e),d(this,"ControllerState",wd),d(this,"transition",{transitionDuration:300,transitionInterpolator:new Dr(["position","pitch","bearing"])})}}class mR extends yo{get ViewportType(){return gR}get ControllerType(){return pR}}d(mR,"displayName","FirstPersonView");class vR extends yo{constructor(e={}){super(e),this.props.orbitAxis=e.orbitAxis||"Z"}get ViewportType(){return dR}get ControllerType(){return Z3}}d(vR,"displayName","OrbitView");class yR extends i1{applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:r}=e;e.zoom=pe(r,i,n);const{longitude:s,latitude:o}=e;return(s<-180||s>180)&&(e.longitude=wl(s+180,360)-180),e.latitude=pe(o,-89,89),e}}class _R extends wo{constructor(...e){super(...e),d(this,"ControllerState",yR),d(this,"transition",{transitionDuration:300,transitionInterpolator:new Dr(["longitude","latitude","zoom"])}),d(this,"dragMode","pan")}setProps(e){super.setProps(e),this.dragRotate=!1,this.touchRotate=!1}}class wR extends yo{get ViewportType(){return fR}get ControllerType(){return _R}}d(wR,"displayName","GlobeView");class ER{constructor(e){d(this,"opts",void 0),e&&(this.opts=e)}equals(e){return this===e?!0:this.constructor===e.constructor&&Oi(this.opts,e.opts)}getShaders(e){return null}getSubLayerProps(e){const{defaultProps:n}=e.constructor,i={updateTriggers:{}};for(const r in n)if(r in this.props){const s=n[r],o=this.props[r];i[r]=o,s&&s.type==="accessor"&&(i.updateTriggers[r]=this.props.updateTriggers[r],typeof o=="function"&&(i[r]=this.getSubLayerAccessor(o)))}return i}initializeState(e,n){}updateState(e,n){}draw(e,n){}finalizeState(e,n){}}d(ER,"defaultProps",{});class S1{constructor(e){d(this,"opts",void 0),d(this,"typedArrayManager",void 0),d(this,"indexStarts",[0]),d(this,"vertexStarts",[0]),d(this,"vertexCount",0),d(this,"instanceCount",0),d(this,"attributes",void 0),d(this,"_attributeDefs",void 0),d(this,"data",void 0),d(this,"getGeometry",void 0),d(this,"geometryBuffer",void 0),d(this,"buffers",void 0),d(this,"positionSize",void 0),d(this,"normalize",void 0);const{attributes:n={}}=e;this.typedArrayManager=Mr,this.attributes={},this._attributeDefs=n,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:n,buffers:i={},getGeometry:r,geometryBuffer:s,positionFormat:o,dataChanged:a,normalize:l=!0}=this.opts;if(this.data=n,this.getGeometry=r,this.positionSize=s&&s.size||(o==="XY"?2:3),this.buffers=i,this.normalize=l,s&&(Pe(n.startIndices),this.getGeometry=this.getGeometryFromBuffer(s),l||(i.positions=s)),this.geometryBuffer=i.positions,Array.isArray(a))for(const c of a)this._rebuildGeometry(c);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:n}){this._rebuildGeometry({startRow:e,endRow:n})}getGeometryFromBuffer(e){const n=e.value||e;return ArrayBuffer.isView(n)?p1(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,n){const{attributes:i,buffers:r,_attributeDefs:s,typedArrayManager:o}=this;for(const a in s)if(a in r)o.release(i[a]),i[a]=null;else{const l=s[a];l.copy=n,i[a]=o.allocate(i[a],e,l)}}_forEachGeometry(e,n,i){const{data:r,getGeometry:s}=this,{iterable:o,objectInfo:a}=Eo(r,n,i);for(const l of o){a.index++;const c=s?s(l,a):null;e(c,a.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:n,vertexStarts:i,instanceCount:r}=this;const{data:s,geometryBuffer:o}=this,{startRow:a=0,endRow:l=1/0}=e||{},c={};if(e||(n=[0],i=[0]),this.normalize||!o)this._forEachGeometry((f,h)=>{const g=f&&this.normalizeGeometry(f);c[h]=g,i[h+1]=i[h]+(g?this.getGeometrySize(g):0)},a,l),r=i[i.length-1];else if(i=s.startIndices,r=i[s.length]||0,ArrayBuffer.isView(o))r=r||o.length/this.positionSize;else if(o instanceof Q){const f=o.accessor.stride||this.positionSize*4;r=r||o.byteLength/f}else if(o.buffer){const f=o.stride||this.positionSize*4;r=r||o.buffer.byteLength/f}else if(o.value){const f=o.value,h=o.stride/f.BYTES_PER_ELEMENT||this.positionSize;r=r||f.length/h}this._allocate(r,Boolean(e)),this.indexStarts=n,this.vertexStarts=i,this.instanceCount=r;const u={};this._forEachGeometry((f,h)=>{const g=c[h]||f;u.vertexStart=i[h],u.indexStart=n[h];const p=h<i.length-1?i[h+1]:r;u.geometrySize=p-i[h],u.geometryIndex=h,this.updateGeometryAttributes(g,u)},a,l),this.vertexCount=n[n.length-1]}}var xR=`#define SHADER_NAME arc-layer-vertex-shader

attribute vec3 positions;
attribute vec4 instanceSourceColors;
attribute vec4 instanceTargetColors;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceTargetPositions64Low;
attribute vec3 instancePickingColors;
attribute float instanceWidths;
attribute float instanceHeights;
attribute float instanceTilts;

uniform bool greatCircle;
uniform bool useShortestPath;
uniform float numSegments;
uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int widthUnits;

varying vec4 vColor;
varying vec2 uv;
varying float isValid;

float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {
  // d: distance on the xy plane
  // r: ratio of the current point
  // p: ratio of the peak of the arc
  // h: height multiplier
  // z = f(r) = sqrt(r * (p * 2 - r)) * d * h
  // f(0) = 0
  // f(1) = dz

  float deltaZ = targetZ - sourceZ;
  float dh = distance * instanceHeights;
  if (dh == 0.0) {
    return sourceZ + deltaZ * ratio;
  }
  float unitZ = deltaZ / dh;
  float p2 = unitZ * unitZ + 1.0;

  // sqrt does not deal with negative values, manually flip source and target if delta.z < 0
  float dir = step(deltaZ, 0.0);
  float z0 = mix(sourceZ, targetZ, dir);
  float r = mix(ratio, 1.0 - ratio, dir);
  return sqrt(r * (p2 - r)) * dh + z0;
}

// offset vector by strokeWidth pixels
// offset_direction is -1 (left) or 1 (right)
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));
}

vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
  float distance = length(source.xy - target.xy);
  float z = paraboloid(distance, source.z, target.z, segmentRatio);

  float tiltAngle = radians(instanceTilts);
  vec2 tiltDirection = normalize(target.xy - source.xy);
  vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);

  return vec3(
    mix(source.xy, target.xy, segmentRatio) + tilt,
    z * cos(tiltAngle)
  );
}

/* Great circle interpolation
 * http://www.movable-type.co.uk/scripts/latlong.html
 */
float getAngularDist (vec2 source, vec2 target) {
  vec2 sourceRadians = radians(source);
  vec2 targetRadians = radians(target);
  vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
  vec2 shd_sq = sin_half_delta * sin_half_delta;

  float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
  return 2.0 * asin(sqrt(a));
}

vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
  vec2 lngLat;

  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(abs(angularDist - PI) < 0.001) {
    lngLat = (1.0 - t) * source.xy + t * target.xy;
  } else {
    float a = sin((1.0 - t) * angularDist);
    float b = sin(t * angularDist);
    vec3 p = source3D.yxz * a + target3D.yxz * b;
    lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
  }

  float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);

  return vec3(lngLat, z);
}

/* END GREAT CIRCLE */

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  float segmentIndex = positions.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
  float nextSegmentRatio = getSegmentRatio(min(numSegments - 1.0, segmentIndex + 1.0));

  // if it's the first point, use next - current as direction
  // otherwise use current - prev
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  isValid = 1.0;

  uv = vec2(segmentRatio, positions.y);
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  vec4 curr;
  vec4 next;
  vec3 source;
  vec3 target;

  if ((greatCircle || project_uProjectionMode == PROJECTION_MODE_GLOBE) && project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
    target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
    float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);

    vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
    vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
    vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);

    if (abs(currPos.x - prevPos.x) > 180.0) {
      indexDir = -1.0;
      isValid = 0.0;
    } else if (abs(currPos.x - nextPos.x) > 180.0) {
      indexDir = 1.0;
      isValid = 0.0;
    }
    nextPos = indexDir < 0.0 ? prevPos : nextPos;
    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;

    if (isValid == 0.0) {
      // split at the 180th meridian
      nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
      float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
      currPos = mix(currPos, nextPos, t);
      segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
    }

    vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
    vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
  
    curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
    next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
  
  } else {
    vec3 source_world = instanceSourcePositions;
    vec3 target_world = instanceTargetPositions;
    if (useShortestPath) {
      source_world.x = mod(source_world.x + 180., 360.0) - 180.;
      target_world.x = mod(target_world.x + 180., 360.0) - 180.;

      float deltaLng = target_world.x - source_world.x;
      if (deltaLng > 180.) target_world.x -= 360.;
      if (deltaLng < -180.) source_world.x -= 360.;
    }
    source = project_position(source_world, instanceSourcePositions64Low);
    target = project_position(target_world, instanceTargetPositions64Low);

    // common x at longitude=-180
    float antiMeridianX = 0.0;

    if (useShortestPath) {
      if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
        antiMeridianX = -(project_uCoordinateOrigin.x + 180.) / 360. * TILE_SIZE;
      }
      float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);

      if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
        isValid = 0.0;
        indexDir = sign(segmentRatio - thresholdRatio);
        segmentRatio = thresholdRatio;
      }
    }

    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
    vec3 currPos = interpolateFlat(source, target, segmentRatio);
    vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);

    if (useShortestPath) {
      if (nextPos.x < antiMeridianX) {
        currPos.x += TILE_SIZE;
        nextPos.x += TILE_SIZE;
      }
    }

    curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
    next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
    geometry.position = vec4(currPos, 1.0);
  }

  // Multiply out width and clamp to limits
  // mercator pixels are interpreted as screen pixels
  float widthPixels = clamp(
    project_size_to_pixel(instanceWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels
  );

  // extrude
  vec3 offset = vec3(
    getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
  vColor = vec4(color.rgb, color.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,TR=`#define SHADER_NAME arc-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;
varying float isValid;

void main(void) {
  if (isValid == 0.0) {
    discard;
  }

  gl_FragColor = vColor;
  geometry.uv = uv;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;const Pl=[0,0,0,255],SR={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getSourceColor:{type:"accessor",value:Pl},getTargetColor:{type:"accessor",value:Pl},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class P1 extends gt{constructor(...e){super(...e),d(this,"state",void 0)}getShaders(){return super.getShaders({vs:xR,fs:TR,modules:[tn,nn]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getSourceColor",defaultValue:Pl},instanceTargetColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getTargetColor",defaultValue:Pl},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var n;const{gl:i}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(i),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{widthUnits:n,widthScale:i,widthMinPixels:r,widthMaxPixels:s,greatCircle:o,wrapLongitude:a}=this.props;this.state.model.setUniforms(e).setUniforms({greatCircle:o,widthUnits:ft[n],widthScale:i,widthMinPixels:r,widthMaxPixels:s,useShortestPath:a}).draw()}_getModel(e){let n=[];for(let s=0;s<50;s++)n=n.concat([s,1,0,s,-1,0]);const r=new bt(e,{...this.getShaders(),id:this.props.id,geometry:new Vt({drawMode:5,attributes:{positions:new Float32Array(n)}}),isInstanced:!0});return r.setUniforms({numSegments:50}),r}}d(P1,"layerName","ArcLayer");d(P1,"defaultProps",SR);const PR=new Uint16Array([0,2,1,0,3,2]),bR=new Float32Array([0,1,0,0,1,0,1,1]);function AR(t,e){if(!e)return CR(t);const n=Math.max(Math.abs(t[0][0]-t[3][0]),Math.abs(t[1][0]-t[2][0])),i=Math.max(Math.abs(t[1][1]-t[0][1]),Math.abs(t[2][1]-t[3][1])),r=Math.ceil(n/e)+1,s=Math.ceil(i/e)+1,o=(r-1)*(s-1)*6,a=new Uint32Array(o),l=new Float32Array(r*s*2),c=new Float64Array(r*s*3);let u=0,f=0;for(let h=0;h<r;h++){const g=h/(r-1);for(let p=0;p<s;p++){const w=p/(s-1),x=LR(t,g,w);c[u*3+0]=x[0],c[u*3+1]=x[1],c[u*3+2]=x[2]||0,l[u*2+0]=g,l[u*2+1]=1-w,h>0&&p>0&&(a[f++]=u-s,a[f++]=u-s-1,a[f++]=u-1,a[f++]=u-s,a[f++]=u-1,a[f++]=u),u++}}return{vertexCount:o,positions:c,indices:a,texCoords:l}}function CR(t){const e=new Float64Array(12);for(let n=0;n<t.length;n++)e[n*3+0]=t[n][0],e[n*3+1]=t[n][1],e[n*3+2]=t[n][2]||0;return{vertexCount:6,positions:e,indices:PR,texCoords:bR}}function LR(t,e,n){return wi(wi(t[0],t[1],n),wi(t[3],t[2],n),e)}var MR=`
#define SHADER_NAME bitmap-layer-vertex-shader

attribute vec2 texCoords;
attribute vec3 positions;
attribute vec3 positions64Low;

varying vec2 vTexCoord;
varying vec2 vTexPos;

uniform float coordinateConversion;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project_uCommonOrigin.xy;
  } else if (coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`;const IR=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`;var RR=`
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

varying vec2 vTexCoord;
varying vec2 vTexPos;

uniform float desaturate;
uniform vec4 transparentColor;
uniform vec3 tintColor;
uniform float opacity;

uniform float coordinateConversion;
uniform vec4 bounds;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  return mix(transparentColor, vec4(color, 1.0), alpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bounds[0]) / (bounds[2] - bounds[0]),
    (pos.y - bounds[3]) / (bounds[1] - bounds[3])
  );
}

`.concat(IR,`

void main(void) {
  vec2 uv = vTexCoord;
  if (coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture2D(bitmapTexture, uv);

  gl_FragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);

  if (picking_uActive) {
    // Since instance information is not used, we can use picking color for pixel index
    gl_FragColor.rgb = packUVsIntoRGB(uv);
  }
}
`);const OR={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:$.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]}};class b1 extends gt{constructor(...e){super(...e),d(this,"state",void 0)}getShaders(){return super.getShaders({vs:MR,fs:RR,modules:[tn,nn]})}initializeState(){const e=this.getAttributeManager();e.remove(["instancePickingColors"]);const n=!0;e.add({indices:{size:1,isIndexed:!0,update:i=>i.value=this.state.mesh.indices,noAlloc:n},positions:{size:3,type:5130,fp64:this.use64bitPositions(),update:i=>i.value=this.state.mesh.positions,noAlloc:n},texCoords:{size:2,update:i=>i.value=this.state.mesh.texCoords,noAlloc:n}})}updateState({props:e,oldProps:n,changeFlags:i}){const r=this.getAttributeManager();if(i.extensionsChanged){var s;const{gl:o}=this.context;(s=this.state.model)===null||s===void 0||s.delete(),this.state.model=this._getModel(o),r.invalidateAll()}if(e.bounds!==n.bounds){const o=this.state.mesh,a=this._createMesh();this.state.model.setVertexCount(a.vertexCount);for(const l in a)o&&o[l]!==a[l]&&r.invalidate(l);this.setState({mesh:a,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==n._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){const{image:n}=this.props,i=e.info;if(!i.color||!n)return i.bitmap=null,i;const{width:r,height:s}=n;i.index=0;const o=kR(i.color),a=[Math.floor(o[0]*r),Math.floor(o[1]*s)];return i.bitmap={size:{width:r,height:s},uv:o,pixel:a},i}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:e}=this.props;let n=e;return $m(e)&&(n=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),AR(n,this.context.viewport.resolution)}_getModel(e){return e?new bt(e,{...this.getShaders(),id:this.props.id,geometry:new Vt({drawMode:4,vertexCount:6}),isInstanced:!1}):null}draw(e){const{uniforms:n,moduleParameters:i}=e,{model:r,coordinateConversion:s,bounds:o,disablePicking:a}=this.state,{image:l,desaturate:c,transparentColor:u,tintColor:f}=this.props;i.pickingActive&&a||l&&r&&r.setUniforms(n).setUniforms({bitmapTexture:l,desaturate:c,transparentColor:u.map(h=>h/255),tintColor:f.slice(0,3).map(h=>h/255),coordinateConversion:s,bounds:o}).draw()}_getCoordinateUniforms(){const{LNGLAT:e,CARTESIAN:n,DEFAULT:i}=$;let{_imageCoordinateSystem:r}=this.props;if(r!==i){const{bounds:s}=this.props;if(!$m(s))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const o=this.context.viewport.resolution?e:n;if(r=r===e?e:n,r===e&&o===n)return{coordinateConversion:-1,bounds:s};if(r===n&&o===e){const a=Cr([s[0],s[1]]),l=Cr([s[2],s[3]]);return{coordinateConversion:1,bounds:[a[0],a[1],l[0],l[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}d(b1,"layerName","BitmapLayer");d(b1,"defaultProps",OR);function kR(t){const[e,n,i]=t,r=(i&240)/256,s=(i&15)/16;return[(e+s)/256,(n+r)/256]}function $m(t){return Number.isFinite(t[0])}var NR=`#define SHADER_NAME icon-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute vec4 instanceIconFrames;
attribute float instanceColorModes;
attribute vec2 instanceOffsets;
attribute vec2 instancePixelOffset;

uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = angle * PI / 180.0;
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;

  vec2 iconSize = instanceIconFrames.zw;
  // convert size in meters to pixels, then scaled and clamp
 
  // project meters to pixels and clamp to limits 
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), 
    sizeMinPixels, sizeMaxPixels
  );

  // scale icon height to match instanceSize
  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;

  // scale and rotate vertex in "pixel" value and convert back to fraction in clipspace
  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
  pixelOffset += instancePixelOffset;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);

  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); 
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTextureCoords = mix(
    instanceIconFrames.xy,
    instanceIconFrames.xy + iconSize,
    (positions.xy + 1.0) / 2.0
  ) / iconsTextureDim;

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);

  vColorMode = instanceColorModes;
}
`,FR=`#define SHADER_NAME icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  vec4 texColor = texture2D(iconsTexture, vTextureCoords);

  // if colorMode == 0, use pixel color from the texture
  // if colorMode == 1 or rendering picking buffer, use texture as transparency mask
  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
  // Take the global opacity and the alpha from vColor into account for the alpha component
  float a = texColor.a * opacity * vColor.a;

  if (a < alphaCutoff) {
    discard;
  }

  gl_FragColor = vec4(color, a);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;const DR=1024,zR=4,Km=()=>{},qm={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071};function UR(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function BR(t,e,n,i){return n===e.width&&i===e.height?e:(t.canvas.height=i,t.canvas.width=n,t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(e,0,0,e.width,e.height,0,0,n,i),t.canvas)}function Js(t){return t&&(t.id||t.url)}function VR(t,e,n,i){const r=t.width,s=t.height,o=new We(t.gl,{width:e,height:n,parameters:i});return vb(t,o,{targetY:0,width:r,height:s}),t.delete(),o}function Qm(t,e,n){for(let i=0;i<e.length;i++){const{icon:r,xOffset:s}=e[i],o=Js(r);t[o]={...r,x:s,y:n}}}function jR({icons:t,buffer:e,mapping:n={},xOffset:i=0,yOffset:r=0,rowHeight:s=0,canvasWidth:o}){let a=[];for(let l=0;l<t.length;l++){const c=t[l],u=Js(c);if(!n[u]){const{height:f,width:h}=c;i+h+e>o&&(Qm(n,a,r),i=0,r=s+r+e,s=0,a=[]),a.push({icon:c,xOffset:i}),i=i+h+e,s=Math.max(s,f)}}return a.length>0&&Qm(n,a,r),{mapping:n,rowHeight:s,xOffset:i,yOffset:r,canvasWidth:o,canvasHeight:UR(s+r+e)}}function GR(t,e,n){if(!t||!e)return null;n=n||{};const i={},{iterable:r,objectInfo:s}=Eo(t);for(const o of r){s.index++;const a=e(o,s),l=Js(a);if(!a)throw new Error("Icon is missing.");if(!a.url)throw new Error("Icon url is missing.");!i[l]&&(!n[l]||a.url!==n[l].url)&&(i[l]={...a,source:o,sourceIndex:s.index})}return i}class WR{constructor(e,{onUpdate:n=Km,onError:i=Km}){d(this,"gl",void 0),d(this,"onUpdate",void 0),d(this,"onError",void 0),d(this,"_loadOptions",null),d(this,"_texture",null),d(this,"_externalTexture",null),d(this,"_mapping",{}),d(this,"_textureParameters",null),d(this,"_pendingCount",0),d(this,"_autoPacking",!1),d(this,"_xOffset",0),d(this,"_yOffset",0),d(this,"_rowHeight",0),d(this,"_buffer",zR),d(this,"_canvasWidth",DR),d(this,"_canvasHeight",0),d(this,"_canvas",null),this.gl=e,this.onUpdate=n,this.onError=i}finalize(){var e;(e=this._texture)===null||e===void 0||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const n=this._autoPacking?Js(e):e;return this._mapping[n]||{}}setProps({loadOptions:e,autoPacking:n,iconAtlas:i,iconMapping:r,textureParameters:s}){if(e&&(this._loadOptions=e),n!==void 0&&(this._autoPacking=n),r&&(this._mapping=r),i){var o;(o=this._texture)===null||o===void 0||o.delete(),this._texture=null,this._externalTexture=i}s&&(this._textureParameters=s)}get isLoaded(){return this._pendingCount===0}packIcons(e,n){if(!this._autoPacking||typeof document=="undefined")return;const i=Object.values(GR(e,n,this._mapping)||{});if(i.length>0){const{mapping:r,xOffset:s,yOffset:o,rowHeight:a,canvasHeight:l}=jR({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=a,this._mapping=r,this._xOffset=s,this._yOffset=o,this._canvasHeight=l,this._texture||(this._texture=new We(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:this._textureParameters||qm})),this._texture.height!==this._canvasHeight&&(this._texture=VR(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||qm)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}_loadIcons(e){const n=this._canvas.getContext("2d");for(const i of e)this._pendingCount++,dl(i.url,Qy,this._loadOptions).then(r=>{const s=Js(i),{x:o,y:a,width:l,height:c}=this._mapping[s],u=BR(n,r,l,c);this._texture.setSubImageData({data:u,x:o,y:a,width:l,height:c}),this._texture.generateMipmap(),this.onUpdate()}).catch(r=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:r})}).finally(()=>{this._pendingCount--})}}const A1=[0,0,0,255],HR={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:A1},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,compare:!1,optional:!0}};class Jl extends gt{constructor(...e){super(...e),d(this,"state",void 0)}getShaders(){return super.getShaders({vs:NR,fs:FR,modules:[tn,nn]})}initializeState(){this.state={iconManager:new WR(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:A1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:n,oldProps:i,changeFlags:r}=e,s=this.getAttributeManager(),{iconAtlas:o,iconMapping:a,data:l,getIcon:c,textureParameters:u}=n,{iconManager:f}=this.state,h=o||this.internalState.isAsyncPropLoading("iconAtlas");if(f.setProps({loadOptions:n.loadOptions,autoPacking:!h,iconAtlas:o,iconMapping:h?a:null,textureParameters:u}),h?i.iconMapping!==n.iconMapping&&s.invalidate("getIcon"):(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getIcon))&&f.packIcons(l,c),r.extensionsChanged){var g;const{gl:p}=this.context;(g=this.state.model)===null||g===void 0||g.delete(),this.state.model=this._getModel(p),s.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:n,sizeMinPixels:i,sizeMaxPixels:r,sizeUnits:s,billboard:o,alphaCutoff:a}=this.props,{iconManager:l}=this.state,c=l.getTexture();c&&this.state.model.setUniforms(e).setUniforms({iconsTexture:c,iconsTextureDim:[c.width,c.height],sizeUnits:ft[s],sizeScale:n,sizeMinPixels:i,sizeMaxPixels:r,billboard:o,alphaCutoff:a}).draw()}_getModel(e){const n=[-1,-1,-1,1,1,1,1,-1];return new bt(e,{...this.getShaders(),id:this.props.id,geometry:new Vt({drawMode:6,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var n;const i=(n=this.getCurrentLayer())===null||n===void 0?void 0:n.props.onIconError;i?i(e):W.error(e.error.message)()}getInstanceOffset(e){const{width:n,height:i,anchorX:r=n/2,anchorY:s=i/2}=this.state.iconManager.getIconMapping(e);return[n/2-r,i/2-s]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:n,y:i,width:r,height:s}=this.state.iconManager.getIconMapping(e);return[n,i,r,s]}}d(Jl,"defaultProps",HR);d(Jl,"layerName","IconLayer");var XR=`#define SHADER_NAME line-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions64Low;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute float instanceWidths;

uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float useShortestPath;
uniform int widthUnits;

varying vec4 vColor;
varying vec2 uv;

// offset vector by strokeWidth pixels
// offset_direction is -1 (left) or 1 (right)
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

vec3 splitLine(vec3 a, vec3 b, float x) {
  float t = (x - a.x) / (b.x - a.x);
  return vec3(x, mix(a.yz, b.yz, t));
}

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  vec3 source_world = instanceSourcePositions;
  vec3 target_world = instanceTargetPositions;
  vec3 source_world_64low = instanceSourcePositions64Low;
  vec3 target_world_64low = instanceTargetPositions64Low;

  if (useShortestPath > 0.5 || useShortestPath < -0.5) {
    source_world.x = mod(source_world.x + 180., 360.0) - 180.;
    target_world.x = mod(target_world.x + 180., 360.0) - 180.;
    float deltaLng = target_world.x - source_world.x;

    if (deltaLng * useShortestPath > 180.) {
      source_world.x += 360. * useShortestPath;
      source_world = splitLine(source_world, target_world, 180. * useShortestPath);
      source_world_64low = vec3(0.0);
    } else if (deltaLng * useShortestPath < -180.) {
      target_world.x += 360. * useShortestPath;
      target_world = splitLine(source_world, target_world, 180. * useShortestPath);
      target_world_64low = vec3(0.0);
    } else if (useShortestPath < 0.) {
      // Line is not split, abort
      gl_Position = vec4(0.);
      return;
    }
  }

  // Position
  vec4 source_commonspace;
  vec4 target_commonspace;
  vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
  vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
  
  // linear interpolation of source & target to pick right coord
  float segmentIndex = positions.x;
  vec4 p = mix(source, target, segmentIndex);
  geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
  uv = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  // Multiply out width and clamp to limits
  float widthPixels = clamp(
    project_size_to_pixel(instanceWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels
  );

  // extrude
  vec3 offset = vec3(
    getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Color
  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,YR=`#define SHADER_NAME line-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;const ZR=[0,0,0,255],$R={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getColor:{type:"accessor",value:ZR},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class C1 extends gt{getShaders(){return super.getShaders({vs:XR,fs:YR,modules:[tn,nn]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var n;const{gl:i}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(i),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{widthUnits:n,widthScale:i,widthMinPixels:r,widthMaxPixels:s,wrapLongitude:o}=this.props;this.state.model.setUniforms(e).setUniforms({widthUnits:ft[n],widthScale:i,widthMinPixels:r,widthMaxPixels:s,useShortestPath:o?1:0}).draw(),o&&this.state.model.setUniforms({useShortestPath:-1}).draw()}_getModel(e){const n=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new bt(e,{...this.getShaders(),id:this.props.id,geometry:new Vt({drawMode:5,attributes:{positions:new Float32Array(n)}}),isInstanced:!0})}}d(C1,"layerName","LineLayer");d(C1,"defaultProps",$R);var KR=`#define SHADER_NAME point-cloud-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceNormals;
attribute vec4 instanceColors;
attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.normal = project_normal(instanceNormals);

  // position on the containing square in [-1, 1] space
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;

  // Find the center of the point and add the current vertex
  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);

  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Apply lighting
  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);

  // Apply opacity to instance color, or return instance picking color
  vColor = vec4(lightColor, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,qR=`#define SHADER_NAME point-cloud-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition);

  if (distToCenter > 1.0) {
    discard;
  }

  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;const L1=[0,0,0,255],M1=[0,0,1],QR={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:t=>t.position},getNormal:{type:"accessor",value:M1},getColor:{type:"accessor",value:L1},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function JR(t){const{header:e,attributes:n}=t;!e||!n||(t.length=e.vertexCount,n.POSITION&&(n.instancePositions=n.POSITION),n.NORMAL&&(n.instanceNormals=n.NORMAL),n.COLOR_0&&(n.instanceColors=n.COLOR_0))}class I1 extends gt{getShaders(){return super.getShaders({vs:KR,fs:qR,modules:[tn,ad,nn]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:M1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:L1}})}updateState(e){const{changeFlags:n,props:i}=e;if(super.updateState(e),n.extensionsChanged){var r;const{gl:s}=this.context;(r=this.state.model)===null||r===void 0||r.delete(),this.state.model=this._getModel(s),this.getAttributeManager().invalidateAll()}n.dataChanged&&JR(i.data)}draw({uniforms:e}){const{pointSize:n,sizeUnits:i}=this.props;this.state.model.setUniforms(e).setUniforms({sizeUnits:ft[i],radiusPixels:n}).draw()}_getModel(e){const n=[];for(let i=0;i<3;i++){const r=i/3*Math.PI*2;n.push(Math.cos(r)*2,Math.sin(r)*2,0)}return new bt(e,{...this.getShaders(),id:this.props.id,geometry:new Vt({drawMode:4,attributes:{positions:new Float32Array(n)}}),isInstanced:!0})}}d(I1,"layerName","PointCloudLayer");d(I1,"defaultProps",QR);var eO=`#define SHADER_NAME scatterplot-layer-vertex-shader

attribute vec3 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceRadius;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;


void main(void) {
  geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  outerRadiusPixels = clamp(
    project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
    radiusMinPixels, radiusMaxPixels
  );
  
  // Multiply out line width and clamp to limits
  float lineWidthPixels = clamp(
    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
    lineWidthMinPixels, lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  outerRadiusPixels += stroked * lineWidthPixels / 2.0;

  // Expand geometry to accomodate edge smoothing
  float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;

  // position on the containing square in [-1, 1] space
  unitPosition = edgePadding * positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;

  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
  
  if (billboard) {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    vec3 offset = edgePadding * positions * outerRadiusPixels;
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
  }

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Apply opacity to instance color, or return instance picking color
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,tO=`#define SHADER_NAME scatterplot-layer-fragment-shader

precision highp float;

uniform bool filled;
uniform float stroked;
uniform bool antialiasing;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition) * outerRadiusPixels;
  float inCircle = antialiasing ? 
    smoothedge(distToCenter, outerRadiusPixels) : 
    step(distToCenter, outerRadiusPixels);

  if (inCircle == 0.0) {
    discard;
  }

  if (stroked > 0.5) {
    float isLine = antialiasing ? 
      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
      step(innerUnitRadius * outerRadiusPixels, distToCenter);

    if (filled) {
      gl_FragColor = mix(vFillColor, vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
    }
  } else if (filled) {
    gl_FragColor = vFillColor;
  } else {
    discard;
  }

  gl_FragColor.a *= inCircle;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;const Jm=[0,0,0,255],nO={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:Jm},getLineColor:{type:"accessor",value:Jm},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class ec extends gt{getShaders(){return super.getShaders({vs:eO,fs:tO,modules:[tn,nn]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var n;const{gl:i}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(i),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{radiusUnits:n,radiusScale:i,radiusMinPixels:r,radiusMaxPixels:s,stroked:o,filled:a,billboard:l,antialiasing:c,lineWidthUnits:u,lineWidthScale:f,lineWidthMinPixels:h,lineWidthMaxPixels:g}=this.props;this.state.model.setUniforms(e).setUniforms({stroked:o?1:0,filled:a,billboard:l,antialiasing:c,radiusUnits:ft[n],radiusScale:i,radiusMinPixels:r,radiusMaxPixels:s,lineWidthUnits:ft[u],lineWidthScale:f,lineWidthMinPixels:h,lineWidthMaxPixels:g}).draw()}_getModel(e){const n=[-1,-1,0,1,-1,0,1,1,0,-1,1,0];return new bt(e,{...this.getShaders(),id:this.props.id,geometry:new Vt({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array(n)}}}),isInstanced:!0})}}d(ec,"defaultProps",nO);d(ec,"layerName","ScatterplotLayer");const Ed={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function xd(t,e,n={}){return iO(t,n)!==e?(sO(t,n),!0):!1}function iO(t,e={}){return Math.sign(rO(t,e))}function rO(t,e={}){const{start:n=0,end:i=t.length}=e,r=e.size||2;let s=0;for(let o=n,a=i-r;o<i;o+=r)s+=(t[o]-t[a])*(t[o+1]+t[a+1]),a=o;return s/2}function sO(t,e){const{start:n=0,end:i=t.length,size:r=2}=e,s=(i-n)/r,o=Math.floor(s/2);for(let a=0;a<o;++a){const l=n+a*r,c=n+(s-1-a)*r;for(let u=0;u<r;++u){const f=t[l+u];t[l+u]=t[c+u],t[c+u]=f}}}function Ft(t,e){const n=e.length,i=t.length;if(i>0){let r=!0;for(let s=0;s<n;s++)if(t[i-n+s]!==e[s]){r=!1;break}if(r)return!1}for(let r=0;r<n;r++)t[i+r]=e[r];return!0}function Wf(t,e){const n=e.length;for(let i=0;i<n;i++)t[i]=e[i]}function eo(t,e,n,i,r=[]){const s=i+e*n;for(let o=0;o<n;o++)r[o]=t[s+o];return r}function Hf(t,e,n,i,r=[]){let s,o;if(n&8)s=(i[3]-t[1])/(e[1]-t[1]),o=3;else if(n&4)s=(i[1]-t[1])/(e[1]-t[1]),o=1;else if(n&2)s=(i[2]-t[0])/(e[0]-t[0]),o=2;else if(n&1)s=(i[0]-t[0])/(e[0]-t[0]),o=0;else return null;for(let a=0;a<t.length;a++)r[a]=(o&1)===a?i[o]:s*(e[a]-t[a])+t[a];return r}function Fa(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function R1(t,e){const{size:n=2,broken:i=!1,gridResolution:r=10,gridOffset:s=[0,0],startIndex:o=0,endIndex:a=t.length}=e||{},l=(a-o)/n;let c=[];const u=[c],f=eo(t,0,n,o);let h,g;const p=k1(f,r,s,[]),w=[];Ft(c,f);for(let x=1;x<l;x++){for(h=eo(t,x,n,o,h),g=Fa(h,p);g;){Hf(f,h,g,p,w);const y=Fa(w,p);y&&(Hf(f,w,y,p,w),g=y),Ft(c,w),Wf(f,w),aO(p,r,g),i&&c.length>n&&(c=[],u.push(c),Ft(c,f)),g=Fa(h,p)}Ft(c,h),Wf(f,h)}return i?u:u[0]}const e0=0,oO=1;function ca(t,e){for(let n=0;n<e.length;n++)t.push(e[n]);return t}function O1(t,e=null,n){if(!t.length)return[];const{size:i=2,gridResolution:r=10,gridOffset:s=[0,0],edgeTypes:o=!1}=n||{},a=[],l=[{pos:t,types:o?new Array(t.length/i).fill(oO):null,holes:e||[]}],c=[[],[]];let u=[];for(;l.length;){const{pos:f,types:h,holes:g}=l.shift();lO(f,i,g[0]||f.length,c),u=k1(c[0],r,s,u);const p=Fa(c[1],u);if(p){let w=t0(f,h,i,0,g[0]||f.length,u,p);const x={pos:w[0].pos,types:w[0].types,holes:[]},y={pos:w[1].pos,types:w[1].types,holes:[]};l.push(x,y);for(let m=0;m<g.length;m++)w=t0(f,h,i,g[m],g[m+1]||f.length,u,p),w[0]&&(x.holes.push(x.pos.length),x.pos=ca(x.pos,w[0].pos),o&&(x.types=ca(x.types,w[0].types))),w[1]&&(y.holes.push(y.pos.length),y.pos=ca(y.pos,w[1].pos),o&&(y.types=ca(y.types,w[1].types)))}else{const w={positions:f};o&&(w.edgeTypes=h),g.length&&(w.holeIndices=g),a.push(w)}}return a}function t0(t,e,n,i,r,s,o){const a=(r-i)/n,l=[],c=[],u=[],f=[],h=[];let g,p,w;const x=eo(t,a-1,n,i);let y=Math.sign(o&8?x[1]-s[3]:x[0]-s[2]),m=e&&e[a-1],_=0,T=0;for(let P=0;P<a;P++)g=eo(t,P,n,i,g),p=Math.sign(o&8?g[1]-s[3]:g[0]-s[2]),w=e&&e[i/n+P],p&&y&&y!==p&&(Hf(x,g,o,s,h),Ft(l,h)&&u.push(m),Ft(c,h)&&f.push(m)),p<=0?(Ft(l,g)&&u.push(w),_-=p):u.length&&(u[u.length-1]=e0),p>=0?(Ft(c,g)&&f.push(w),T+=p):f.length&&(f[f.length-1]=e0),Wf(x,g),y=p,m=w;return[_?{pos:l,types:e&&u}:null,T?{pos:c,types:e&&f}:null]}function k1(t,e,n,i){const r=Math.floor((t[0]-n[0])/e)*e+n[0],s=Math.floor((t[1]-n[1])/e)*e+n[1];return i[0]=r,i[1]=s,i[2]=r+e,i[3]=s+e,i}function aO(t,e,n){n&8?(t[1]+=e,t[3]+=e):n&4?(t[1]-=e,t[3]-=e):n&2?(t[0]+=e,t[2]+=e):n&1&&(t[0]-=e,t[2]-=e)}function lO(t,e,n,i){let r=1/0,s=-1/0,o=1/0,a=-1/0;for(let l=0;l<n;l+=e){const c=t[l],u=t[l+1];r=c<r?c:r,s=c>s?c:s,o=u<o?u:o,a=u>a?u:a}return i[0][0]=r,i[0][1]=o,i[1][0]=s,i[1][1]=a,i}const cO=85.051129;function uO(t,e){const{size:n=2,startIndex:i=0,endIndex:r=t.length,normalize:s=!0}=e||{},o=t.slice(i,r);N1(o,n,0,r-i);const a=R1(o,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const l of a)F1(l,n);return a}function fO(t,e=null,n){const{size:i=2,normalize:r=!0,edgeTypes:s=!1}=n||{};e=e||[];const o=[],a=[];let l=0,c=0;for(let f=0;f<=e.length;f++){const h=e[f]||t.length,g=c,p=hO(t,i,l,h);for(let w=p;w<h;w++)o[c++]=t[w];for(let w=l;w<p;w++)o[c++]=t[w];N1(o,i,g,c),dO(o,i,g,c,n==null?void 0:n.maxLatitude),l=h,a[f]=c}a.pop();const u=O1(o,a,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(r)for(const f of u)F1(f.positions,i);return u}function hO(t,e,n,i){let r=-1,s=-1;for(let o=n+1;o<i;o+=e){const a=Math.abs(t[o]);a>r&&(r=a,s=o-1)}return s}function dO(t,e,n,i,r=cO){const s=t[n],o=t[i-e];if(Math.abs(s-o)>180){const a=eo(t,0,e,n);a[0]+=Math.round((o-s)/360)*360,Ft(t,a),a[1]=Math.sign(a[1])*r,Ft(t,a),a[0]=s,Ft(t,a)}}function N1(t,e,n,i){let r=t[0],s;for(let o=n;o<i;o+=e){s=t[o];const a=s-r;(a>180||a<-180)&&(s-=Math.round(a/360)*360),t[o]=r=s}}function F1(t,e){let n;const i=t.length/e;for(let s=0;s<i&&(n=t[s*e],(n+180)%360===0);s++);const r=-Math.round(n/360)*360;if(r!==0)for(let s=0;s<i;s++)t[s*e]+=r}class gO extends Vt{constructor(e){const{id:n=en("column-geometry")}=e,{indices:i,attributes:r}=pO(e);super({...e,id:n,indices:i,attributes:r})}}function pO(t){const{radius:e,height:n=1,nradial:i=10}=t;let{vertices:r}=t;r&&(W.assert(r.length>=i),r=r.flatMap(g=>[g[0],g[1]]),xd(r,Ed.COUNTER_CLOCKWISE));const s=n>0,o=i+1,a=s?o*3+1:i,l=Math.PI*2/i,c=new Uint16Array(s?i*3*2:0),u=new Float32Array(a*3),f=new Float32Array(a*3);let h=0;if(s){for(let g=0;g<o;g++){const p=g*l,w=g%i,x=Math.sin(p),y=Math.cos(p);for(let m=0;m<2;m++)u[h+0]=r?r[w*2]:y*e,u[h+1]=r?r[w*2+1]:x*e,u[h+2]=(1/2-m)*n,f[h+0]=r?r[w*2]:y,f[h+1]=r?r[w*2+1]:x,h+=3}u[h+0]=u[h-3],u[h+1]=u[h-2],u[h+2]=u[h-1],h+=3}for(let g=s?0:1;g<o;g++){const p=Math.floor(g/2)*Math.sign(.5-g%2),w=p*l,x=(p+i)%i,y=Math.sin(w),m=Math.cos(w);u[h+0]=r?r[x*2]:m*e,u[h+1]=r?r[x*2+1]:y*e,u[h+2]=n/2,f[h+2]=1,h+=3}if(s){let g=0;for(let p=0;p<i;p++)c[g++]=p*2+0,c[g++]=p*2+2,c[g++]=p*2+0,c[g++]=p*2+1,c[g++]=p*2+1,c[g++]=p*2+3}return{indices:c,attributes:{POSITION:{size:3,value:u},NORMAL:{size:3,value:f}}}}var mO=`#version 300 es

#define SHADER_NAME column-layer-vertex-shader

in vec3 positions;
in vec3 normals;

in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;

in vec3 instancePickingColors;

// Custom uniforms
uniform float opacity;
uniform float radius;
uniform float angle;
uniform vec2 offset;
uniform bool extruded;
uniform bool stroked;
uniform bool isStroke;
uniform float coverage;
uniform float elevationScale;
uniform float edgeDistance;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int radiusUnits;
uniform int widthUnits;

// Result
out vec4 vColor;
#ifdef FLAT_SHADING
out vec4 position_commonspace;
#endif

void main(void) {
  geometry.worldPosition = instancePositions;

  vec4 color = isStroke ? instanceLineColors : instanceFillColors;
  // rotate primitive position and normal
  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));

  // calculate elevation, if 3d not enabled set to 0
  // cylindar gemoetry height are between -1.0 to 1.0, transform it to between 0, 1
  float elevation = 0.0;
  // calculate stroke offset
  float strokeOffsetRatio = 1.0;

  if (extruded) {
    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;
  } else if (stroked) {
    float widthPixels = clamp(
      project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
      widthMinPixels, widthMaxPixels) / 2.0;
    float halfOffset = project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);
    if (isStroke) {
      strokeOffsetRatio -= sign(positions.z) * halfOffset;
    } else {
      strokeOffsetRatio -= halfOffset;
    }
  }

  // if alpha == 0.0 or z < 0.0, do not render element
  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
  float dotRadius = radius * coverage * shouldRender;

  geometry.pickingColor = instancePickingColors;

  // project center of column
  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
  vec3 centroidPosition64Low = instancePositions64Low;
  vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius;
  if (radiusUnits == UNIT_METERS) {
    offset = project_size(offset);
  }
  vec3 pos = vec3(offset, 0.);
  DECKGL_FILTER_SIZE(pos, geometry);

  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
  geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Light calculations
  if (extruded && !isStroke) {
#ifdef FLAT_SHADING
    position_commonspace = geometry.position;
    vColor = vec4(color.rgb, color.a * opacity);
#else
    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
    vColor = vec4(lightColor, color.a * opacity);
#endif
  } else {
    vColor = vec4(color.rgb, color.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,vO=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader

precision highp float;

uniform vec3 project_uCameraPosition;
uniform bool extruded;
uniform bool isStroke;

out vec4 fragColor;

in vec4 vColor;
#ifdef FLAT_SHADING
in vec4 position_commonspace;
#endif

void main(void) {
  fragColor = vColor;
#ifdef FLAT_SHADING
  if (extruded && !isStroke && !picking_uActive) {
    vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
    fragColor.rgb = lighting_getLightColor(vColor.rgb, project_uCameraPosition, position_commonspace.xyz, normal);
  }
#endif
  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;const bl=[0,0,0,255],yO={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:t=>t.position},getFillColor:{type:"accessor",value:bl},getLineColor:{type:"accessor",value:bl},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Td extends gt{getShaders(){const{gl:e}=this.context,n=!Y(e),i={},r=this.props.flatShading&&d_(e,ee.GLSL_DERIVATIVES);return r&&(i.FLAT_SHADING=1),super.getShaders({vs:mO,fs:vO,defines:i,transpileToGLSL100:n,modules:[tn,r?z2:ad,nn]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getFillColor",defaultValue:bl},instanceLineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getLineColor",defaultValue:bl},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){super.updateState(e);const{props:n,oldProps:i,changeFlags:r}=e,s=r.extensionsChanged||n.flatShading!==i.flatShading;if(s){var o;const{gl:a}=this.context;(o=this.state.model)===null||o===void 0||o.delete(),this.state.model=this._getModel(a),this.getAttributeManager().invalidateAll()}(s||n.diskResolution!==i.diskResolution||n.vertices!==i.vertices||(n.extruded||n.stroked)!==(i.extruded||i.stroked))&&this._updateGeometry(n)}getGeometry(e,n,i){const r=new gO({radius:1,height:i?2:0,vertices:n,nradial:e});let s=0;if(n)for(let o=0;o<e;o++){const a=n[o];s+=Math.sqrt(a[0]*a[0]+a[1]*a[1])/e}else s=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*s}),r}_getModel(e){return new bt(e,{...this.getShaders(),id:this.props.id,isInstanced:!0})}_updateGeometry({diskResolution:e,vertices:n,extruded:i,stroked:r}){const s=this.getGeometry(e,n,i||r);this.setState({fillVertexCount:s.attributes.POSITION.value.length/3,wireframeVertexCount:s.indices.value.length}),this.state.model.setProps({geometry:s})}draw({uniforms:e}){const{lineWidthUnits:n,lineWidthScale:i,lineWidthMinPixels:r,lineWidthMaxPixels:s,radiusUnits:o,elevationScale:a,extruded:l,filled:c,stroked:u,wireframe:f,offset:h,coverage:g,radius:p,angle:w}=this.props,{model:x,fillVertexCount:y,wireframeVertexCount:m,edgeDistance:_}=this.state;x.setUniforms(e).setUniforms({radius:p,angle:w/180*Math.PI,offset:h,extruded:l,stroked:u,coverage:g,elevationScale:a,edgeDistance:_,radiusUnits:ft[o],widthUnits:ft[n],widthScale:i,widthMinPixels:r,widthMaxPixels:s}),l&&f&&(x.setProps({isIndexed:!0}),x.setVertexCount(m).setDrawMode(1).setUniforms({isStroke:!0}).draw()),c&&(x.setProps({isIndexed:!1}),x.setVertexCount(y).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!l&&u&&(x.setProps({isIndexed:!1}),x.setVertexCount(y*2/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}}d(Td,"layerName","ColumnLayer");d(Td,"defaultProps",yO);const _O={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}};class D1 extends Td{getGeometry(e){return new hL}draw({uniforms:e}){const{elevationScale:n,extruded:i,offset:r,coverage:s,cellSize:o,angle:a,radiusUnits:l}=this.props;this.state.model.setUniforms(e).setUniforms({radius:o/2,radiusUnits:ft[l],angle:a,offset:r,extruded:i,coverage:s,elevationScale:n,edgeDistance:1,isWireframe:!1}).draw()}}d(D1,"layerName","GridCellLayer");d(D1,"defaultProps",_O);function wO(t,e,n,i){let r;if(Array.isArray(t[0])){const s=t.length*e;r=new Array(s);for(let o=0;o<t.length;o++)for(let a=0;a<e;a++)r[o*e+a]=t[o][a]||0}else r=t;return n?R1(r,{size:e,gridResolution:n}):i?uO(r,{size:e}):r}const EO=1,xO=2,wu=4;class TO extends S1{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?wO(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(n0(e)){let i=0;for(const r of e)i+=this.getGeometrySize(r);return i}const n=this.getPathLength(e);return n<2?0:this.isClosed(e)?n<3?0:n+2:n}updateGeometryAttributes(e,n){if(n.geometrySize!==0)if(e&&n0(e))for(const i of e){const r=this.getGeometrySize(i);n.geometrySize=r,this.updateGeometryAttributes(i,n),n.vertexStart+=r}else this._updateSegmentTypes(e,n),this._updatePositions(e,n)}_updateSegmentTypes(e,n){const i=this.attributes.segmentTypes,r=e?this.isClosed(e):!1,{vertexStart:s,geometrySize:o}=n;i.fill(0,s,s+o),r?(i[s]=wu,i[s+o-2]=wu):(i[s]+=EO,i[s+o-2]+=xO),i[s+o-1]=wu}_updatePositions(e,n){const{positions:i}=this.attributes;if(!i||!e)return;const{vertexStart:r,geometrySize:s}=n,o=new Array(3);for(let a=r,l=0;l<s;a++,l++)this.getPointOnPath(e,l,o),i[a*3]=o[0],i[a*3+1]=o[1],i[a*3+2]=o[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,n,i=[]){const{positionSize:r}=this;n*r>=e.length&&(n+=1-e.length/r);const s=n*r;return i[0]=e[s],i[1]=e[s+1],i[2]=r===3&&e[s+2]||0,i}isClosed(e){if(!this.normalize)return Boolean(this.opts.loop);const{positionSize:n}=this,i=e.length-n;return e[0]===e[i]&&e[1]===e[i+1]&&(n===2||e[2]===e[i+2])}}function n0(t){return Array.isArray(t[0])}var SO=`#define SHADER_NAME path-layer-vertex-shader

attribute vec2 positions;

attribute float instanceTypes;
attribute vec3 instanceStartPositions;
attribute vec3 instanceEndPositions;
attribute vec3 instanceLeftPositions;
attribute vec3 instanceRightPositions;
attribute vec3 instanceLeftPositions64Low;
attribute vec3 instanceStartPositions64Low;
attribute vec3 instanceEndPositions64Low;
attribute vec3 instanceRightPositions64Low;
attribute float instanceStrokeWidths;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;

uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;

uniform float opacity;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);

float flipIfTrue(bool flag) {
  return -(float(flag) * 2. - 1.);
}

// calculate line join positions
vec3 lineJoin(
  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
  vec2 width
) {
  bool isEnd = positions.x > 0.0;
  // side of the segment - -1: left, 0: center, 1: right
  float sideOfPath = positions.y;
  float isJoint = float(sideOfPath == 0.0);

  vec3 deltaA3 = (currPoint - prevPoint);
  vec3 deltaB3 = (nextPoint - currPoint);

  mat3 rotationMatrix;
  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
  if (needsRotation) {
    deltaA3 = deltaA3 * rotationMatrix;
    deltaB3 = deltaB3 * rotationMatrix;
  }
  vec2 deltaA = deltaA3.xy / width;
  vec2 deltaB = deltaB3.xy / width;

  float lenA = length(deltaA);
  float lenB = length(deltaB);

  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);

  vec2 perpA = vec2(-dirA.y, dirA.x);
  vec2 perpB = vec2(-dirB.y, dirB.x);

  // tangent of the corner
  vec2 tangent = dirA + dirB;
  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
  // direction of the corner
  vec2 miterVec = vec2(-tangent.y, tangent.x);
  // direction of the segment
  vec2 dir = isEnd ? dirA : dirB;
  // direction of the extrusion
  vec2 perp = isEnd ? perpA : perpB;
  // length of the segment
  float L = isEnd ? lenA : lenB;

  // A = angle of the corner
  float sinHalfA = abs(dot(miterVec, perp));
  float cosHalfA = abs(dot(dirA, miterVec));

  // -1: right, 1: left
  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);

  // relative position to the corner:
  // -1: inside (smaller side of the angle)
  // 0: center
  // 1: outside (bigger side of the angle)
  float cornerPosition = sideOfPath * turnDirection;

  float miterSize = 1.0 / max(sinHalfA, EPSILON);
  // trim if inside corner extends further than the line segment
  miterSize = mix(
    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
    miterSize,
    step(0.0, cornerPosition)
  );

  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
    * (sideOfPath + isJoint * turnDirection);

  // special treatment for start cap and end cap
  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
  bool isCap = isStartCap || isEndCap;

  // extend out a triangle to envelope the round cap
  if (isCap) {
    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
    vJointType = capType;
  } else {
    vJointType = jointType;
  }

  // Generate variables for fragment shader
  vPathLength = L;
  vCornerOffset = offsetVec;
  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
  vMiterLength = isCap ? isJoint : vMiterLength;

  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
  vPathPosition = vec2(
    dot(offsetFromStartOfPath, perp),
    dot(offsetFromStartOfPath, dir)
  );
  geometry.uv = vPathPosition;

  float isValid = step(instanceTypes, 3.5);
  vec3 offset = vec3(offsetVec * width * isValid, 0.0);

  if (needsRotation) {
    offset = rotationMatrix * offset;
  }
  return currPoint + offset;
}

// In clipspace extrusion, if a line extends behind the camera, clip it to avoid visual artifacts
void clipLine(inout vec4 position, vec4 refPosition) {
  if (position.w < EPSILON) {
    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
    position = refPosition + (position - refPosition) * r;
  }
}

void main() {
  geometry.pickingColor = instancePickingColors;

  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);

  float isEnd = positions.x;

  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);

  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);

  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);

  geometry.worldPosition = currPosition;
  vec2 widthPixels = vec2(clamp(
    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels) / 2.0);
  vec3 width;

  if (billboard) {
    // Extrude in clipspace
    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);

    clipLine(prevPositionScreen, currPositionScreen);
    clipLine(nextPositionScreen, currPositionScreen);
    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));

    width = vec3(widthPixels, 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 pos = lineJoin(
      prevPositionScreen.xyz / prevPositionScreen.w,
      currPositionScreen.xyz / currPositionScreen.w,
      nextPositionScreen.xyz / nextPositionScreen.w,
      project_pixel_size_to_clipspace(width.xy)
    );

    gl_Position = vec4(pos * currPositionScreen.w, currPositionScreen.w);
  } else {
    // Extrude in commonspace
    prevPosition = project_position(prevPosition, prevPosition64Low);
    currPosition = project_position(currPosition, currPosition64Low);
    nextPosition = project_position(nextPosition, nextPosition64Low);

    width = vec3(project_pixel_size(widthPixels), 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec4 pos = vec4(
      lineJoin(prevPosition, currPosition, nextPosition, width.xy),
      1.0);
    geometry.position = pos;
    gl_Position = project_common_position_to_clipspace(pos);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,PO=`#define SHADER_NAME path-layer-fragment-shader

precision highp float;

uniform float miterLimit;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
/*
 * vPathPosition represents the relative coordinates of the current fragment on the path segment.
 * vPathPosition.x - position along the width of the path, between [-1, 1]. 0 is the center line.
 * vPathPosition.y - position along the length of the path, between [0, L / width].
 */
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

void main(void) {
  geometry.uv = vPathPosition;

  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
    // if joint is rounded, test distance from the corner
    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
      discard;
    }
    // trim miter
    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
      discard;
    }
  }
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;const z1=[0,0,0,255],bO={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:z1},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},Eu={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class tc extends gt{constructor(...e){super(...e),d(this,"state",void 0)}getShaders(){return super.getShaders({vs:SO,fs:PO,modules:[tn,nn]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:Eu,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Eu,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:Eu,defaultValue:z1},instancePickingColors:{size:3,type:5121,accessor:(i,{index:r,target:s})=>this.encodePickingColor(i&&i.__source?i.__source.index:r,s)}}),this.setState({pathTesselator:new TO({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:n,changeFlags:i}=e,r=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){const{pathTesselator:a}=this.state,l=n.data.attributes||{};a.updateGeometry({data:n.data,geometryBuffer:l.getPath,buffers:l,normalize:!n._pathType,loop:n._pathType==="loop",getGeometry:n.getPath,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),i.dataChanged||r.invalidateAll()}if(i.extensionsChanged){var o;const{gl:a}=this.context;(o=this.state.model)===null||o===void 0||o.delete(),this.state.model=this._getModel(a),r.invalidateAll()}}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,{data:r}=this.props;return r[0]&&r[0].__source&&(n.object=r.find(s=>s.__source.index===i)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else this._disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:n,capRounded:i,billboard:r,miterLimit:s,widthUnits:o,widthScale:a,widthMinPixels:l,widthMaxPixels:c}=this.props;this.state.model.setUniforms(e).setUniforms({jointType:Number(n),capType:Number(i),billboard:r,widthUnits:ft[o],widthScale:a,miterLimit:s,widthMinPixels:l,widthMaxPixels:c}).draw()}_getModel(e){const n=[0,1,2,1,4,2,1,3,4,3,5,4],i=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new bt(e,{...this.getShaders(),id:this.props.id,geometry:new Vt({drawMode:4,attributes:{indices:new Uint16Array(n),positions:{value:new Float32Array(i),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateSegmentTypes(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("segmentTypes")}}d(tc,"defaultProps",bO);d(tc,"layerName","PathLayer");var Sd={exports:{}};Sd.exports=nc;Sd.exports.default=nc;function nc(t,e,n){n=n||2;var i=e&&e.length,r=i?e[0]*n:t.length,s=U1(t,0,r,n,!0),o=[];if(!s||s.next===s.prev)return o;var a,l,c,u,f,h,g;if(i&&(s=IO(t,e,s,n)),t.length>80*n){a=c=t[0],l=u=t[1];for(var p=n;p<r;p+=n)f=t[p],h=t[p+1],f<a&&(a=f),h<l&&(l=h),f>c&&(c=f),h>u&&(u=h);g=Math.max(c-a,u-l),g=g!==0?32767/g:0}return to(s,o,n,a,l,g,0),o}function U1(t,e,n,i,r){var s,o;if(r===Zf(t,e,n,i)>0)for(s=e;s<n;s+=i)o=i0(s,t[s],t[s+1],o);else for(s=n-i;s>=e;s-=i)o=i0(s,t[s],t[s+1],o);return o&&ic(o,o.next)&&(io(o),o=o.next),o}function Li(t,e){if(!t)return t;e||(e=t);var n=t,i;do if(i=!1,!n.steiner&&(ic(n,n.next)||ce(n.prev,n,n.next)===0)){if(io(n),n=e=n.prev,n===n.next)break;i=!0}else n=n.next;while(i||n!==e);return e}function to(t,e,n,i,r,s,o){if(!!t){!o&&s&&FO(t,i,r,s);for(var a=t,l,c;t.prev!==t.next;){if(l=t.prev,c=t.next,s?CO(t,i,r,s):AO(t)){e.push(l.i/n|0),e.push(t.i/n|0),e.push(c.i/n|0),io(t),t=c.next,a=c.next;continue}if(t=c,t===a){o?o===1?(t=LO(Li(t),e,n),to(t,e,n,i,r,s,2)):o===2&&MO(t,e,n,i,r,s):to(Li(t),e,n,i,r,s,1);break}}}}function AO(t){var e=t.prev,n=t,i=t.next;if(ce(e,n,i)>=0)return!1;for(var r=e.x,s=n.x,o=i.x,a=e.y,l=n.y,c=i.y,u=r<s?r<o?r:o:s<o?s:o,f=a<l?a<c?a:c:l<c?l:c,h=r>s?r>o?r:o:s>o?s:o,g=a>l?a>c?a:c:l>c?l:c,p=i.next;p!==e;){if(p.x>=u&&p.x<=h&&p.y>=f&&p.y<=g&&or(r,a,s,l,o,c,p.x,p.y)&&ce(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function CO(t,e,n,i){var r=t.prev,s=t,o=t.next;if(ce(r,s,o)>=0)return!1;for(var a=r.x,l=s.x,c=o.x,u=r.y,f=s.y,h=o.y,g=a<l?a<c?a:c:l<c?l:c,p=u<f?u<h?u:h:f<h?f:h,w=a>l?a>c?a:c:l>c?l:c,x=u>f?u>h?u:h:f>h?f:h,y=Xf(g,p,e,n,i),m=Xf(w,x,e,n,i),_=t.prevZ,T=t.nextZ;_&&_.z>=y&&T&&T.z<=m;){if(_.x>=g&&_.x<=w&&_.y>=p&&_.y<=x&&_!==r&&_!==o&&or(a,u,l,f,c,h,_.x,_.y)&&ce(_.prev,_,_.next)>=0||(_=_.prevZ,T.x>=g&&T.x<=w&&T.y>=p&&T.y<=x&&T!==r&&T!==o&&or(a,u,l,f,c,h,T.x,T.y)&&ce(T.prev,T,T.next)>=0))return!1;T=T.nextZ}for(;_&&_.z>=y;){if(_.x>=g&&_.x<=w&&_.y>=p&&_.y<=x&&_!==r&&_!==o&&or(a,u,l,f,c,h,_.x,_.y)&&ce(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;T&&T.z<=m;){if(T.x>=g&&T.x<=w&&T.y>=p&&T.y<=x&&T!==r&&T!==o&&or(a,u,l,f,c,h,T.x,T.y)&&ce(T.prev,T,T.next)>=0)return!1;T=T.nextZ}return!0}function LO(t,e,n){var i=t;do{var r=i.prev,s=i.next.next;!ic(r,s)&&B1(r,i,i.next,s)&&no(r,s)&&no(s,r)&&(e.push(r.i/n|0),e.push(i.i/n|0),e.push(s.i/n|0),io(i),io(i.next),i=t=s),i=i.next}while(i!==t);return Li(i)}function MO(t,e,n,i,r,s){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&UO(o,a)){var l=V1(o,a);o=Li(o,o.next),l=Li(l,l.next),to(o,e,n,i,r,s,0),to(l,e,n,i,r,s,0);return}a=a.next}o=o.next}while(o!==t)}function IO(t,e,n,i){var r=[],s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*i,l=s<o-1?e[s+1]*i:t.length,c=U1(t,a,l,i,!1),c===c.next&&(c.steiner=!0),r.push(zO(c));for(r.sort(RO),s=0;s<r.length;s++)n=OO(r[s],n);return n}function RO(t,e){return t.x-e.x}function OO(t,e){var n=kO(t,e);if(!n)return e;var i=V1(n,t);return Li(i,i.next),Li(n,n.next)}function kO(t,e){var n=e,i=t.x,r=t.y,s=-1/0,o;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){var a=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=i&&a>s&&(s=a,o=n.x<n.next.x?n:n.next,a===i))return o}n=n.next}while(n!==e);if(!o)return null;var l=o,c=o.x,u=o.y,f=1/0,h;n=o;do i>=n.x&&n.x>=c&&i!==n.x&&or(r<u?i:s,r,c,u,r<u?s:i,r,n.x,n.y)&&(h=Math.abs(r-n.y)/(i-n.x),no(n,t)&&(h<f||h===f&&(n.x>o.x||n.x===o.x&&NO(o,n)))&&(o=n,f=h)),n=n.next;while(n!==l);return o}function NO(t,e){return ce(t.prev,t,e.prev)<0&&ce(e.next,t,t.next)<0}function FO(t,e,n,i){var r=t;do r.z===0&&(r.z=Xf(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,DO(r)}function DO(t){var e,n,i,r,s,o,a,l,c=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,i=n,a=0,e=0;e<c&&(a++,i=i.nextZ,!!i);e++);for(l=c;a>0||l>0&&i;)a!==0&&(l===0||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;n=i}s.nextZ=null,c*=2}while(o>1);return t}function Xf(t,e,n,i,r){return t=(t-n)*r|0,e=(e-i)*r|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function zO(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function or(t,e,n,i,r,s,o,a){return(r-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(i-a)>=(n-o)*(e-a)&&(n-o)*(s-a)>=(r-o)*(i-a)}function UO(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!BO(t,e)&&(no(t,e)&&no(e,t)&&VO(t,e)&&(ce(t.prev,t,e.prev)||ce(t,e.prev,e))||ic(t,e)&&ce(t.prev,t,t.next)>0&&ce(e.prev,e,e.next)>0)}function ce(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function ic(t,e){return t.x===e.x&&t.y===e.y}function B1(t,e,n,i){var r=fa(ce(t,e,n)),s=fa(ce(t,e,i)),o=fa(ce(n,i,t)),a=fa(ce(n,i,e));return!!(r!==s&&o!==a||r===0&&ua(t,n,e)||s===0&&ua(t,i,e)||o===0&&ua(n,t,i)||a===0&&ua(n,e,i))}function ua(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function fa(t){return t>0?1:t<0?-1:0}function BO(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&B1(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function no(t,e){return ce(t.prev,t,t.next)<0?ce(t,e,t.next)>=0&&ce(t,t.prev,e)>=0:ce(t,e,t.prev)<0||ce(t,t.next,e)<0}function VO(t,e){var n=t,i=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;do n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next;while(n!==t);return i}function V1(t,e){var n=new Yf(t.i,t.x,t.y),i=new Yf(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function i0(t,e,n,i){var r=new Yf(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function io(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Yf(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}nc.deviation=function(t,e,n,i){var r=e&&e.length,s=r?e[0]*n:t.length,o=Math.abs(Zf(t,0,s,n));if(r)for(var a=0,l=e.length;a<l;a++){var c=e[a]*n,u=a<l-1?e[a+1]*n:t.length;o-=Math.abs(Zf(t,c,u,n))}var f=0;for(a=0;a<i.length;a+=3){var h=i[a]*n,g=i[a+1]*n,p=i[a+2]*n;f+=Math.abs((t[h]-t[p])*(t[g+1]-t[h+1])-(t[h]-t[g])*(t[p+1]-t[h+1]))}return o===0&&f===0?0:Math.abs((f-o)/o)};function Zf(t,e,n,i){for(var r=0,s=e,o=n-i;s<n;s+=i)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}nc.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,r=0;r<t.length;r++){for(var s=0;s<t[r].length;s++)for(var o=0;o<e;o++)n.vertices.push(t[r][s][o]);r>0&&(i+=t[r-1].length,n.holes.push(i))}return n};var jO=Sd.exports;const ha=Ed.CLOCKWISE,r0=Ed.COUNTER_CLOCKWISE,jn={isClosed:!0};function GO(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function ps(t){return"positions"in t?t.positions:t}function Da(t){return"holeIndices"in t?t.holeIndices:null}function WO(t){return Array.isArray(t[0])}function HO(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function XO(t){const e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function YO(t,e,n,i){for(let r=0;r<e;r++)if(t[n+r]!==t[i-e+r])return!1;return!0}function s0(t,e,n,i,r){let s=e;const o=n.length;for(let a=0;a<o;a++)for(let l=0;l<i;l++)t[s++]=n[a][l]||0;if(!XO(n))for(let a=0;a<i;a++)t[s++]=n[0][a]||0;return jn.start=e,jn.end=s,jn.size=i,xd(t,r,jn),s}function o0(t,e,n,i,r=0,s,o){s=s||n.length;const a=s-r;if(a<=0)return e;let l=e;for(let c=0;c<a;c++)t[l++]=n[r+c];if(!YO(n,i,r,s))for(let c=0;c<i;c++)t[l++]=n[r+c];return jn.start=e,jn.end=l,jn.size=i,xd(t,o,jn),l}function j1(t,e){GO(t);const n=[],i=[];if("positions"in t){const{positions:r,holeIndices:s}=t;if(s){let o=0;for(let a=0;a<=s.length;a++)o=o0(n,o,r,e,s[a-1],s[a],a===0?ha:r0),i.push(o);return i.pop(),{positions:n,holeIndices:i}}t=r}if(!WO(t))return o0(n,0,t,e,0,n.length,ha),n;if(!HO(t)){let r=0;for(const[s,o]of t.entries())r=s0(n,r,o,e,s===0?ha:r0),i.push(r);return i.pop(),{positions:n,holeIndices:i}}return s0(n,0,t,e,ha),n}function ZO(t,e,n){let i=Da(t);i&&(i=i.map(s=>s/e));let r=ps(t);if(n){const s=r.length;r=r.slice();const o=[];for(let a=0;a<s;a+=e){o[0]=r[a],o[1]=r[a+1];const l=n(o);r[a]=l[0],r[a+1]=l[1]}}return jO(r,i,e)}class $O extends S1{constructor(e){const{fp64:n,IndexType:i=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:n?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:i,size:1}}})}get(e){const{attributes:n}=this;return e==="indices"?n.indices&&n.indices.subarray(0,this.vertexCount):n[e]}updateGeometry(e){super.updateGeometry(e);const n=this.buffers.indices;if(n)this.vertexCount=(n.value||n).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const n=j1(e,this.positionSize);return this.opts.resolution?O1(ps(n),Da(n),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?fO(ps(n),Da(n),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):n}return e}getGeometrySize(e){if(a0(e)){let n=0;for(const i of e)n+=this.getGeometrySize(i);return n}return ps(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,n){if(e&&a0(e))for(const i of e){const r=this.getGeometrySize(i);n.geometrySize=r,this.updateGeometryAttributes(i,n),n.vertexStart+=r,n.indexStart=this.indexStarts[n.geometryIndex+1]}else this._updateIndices(e,n),this._updatePositions(e,n),this._updateVertexValid(e,n)}_updateIndices(e,{geometryIndex:n,vertexStart:i,indexStart:r}){const{attributes:s,indexStarts:o,typedArrayManager:a}=this;let l=s.indices;if(!l||!e)return;let c=r;const u=ZO(e,this.positionSize,this.opts.preproject);l=a.allocate(l,r+u.length,{copy:!0});for(let f=0;f<u.length;f++)l[c++]=u[f]+i;o[n+1]=r+u.length,s.indices=l}_updatePositions(e,{vertexStart:n,geometrySize:i}){const{attributes:{positions:r},positionSize:s}=this;if(!r||!e)return;const o=ps(e);for(let a=n,l=0;l<i;a++,l++){const c=o[l*s],u=o[l*s+1],f=s>2?o[l*s+2]:0;r[a*3]=c,r[a*3+1]=u,r[a*3+2]=f}}_updateVertexValid(e,{vertexStart:n,geometrySize:i}){const{positionSize:r}=this,s=this.attributes.vertexValid,o=e&&Da(e);if(e&&e.edgeTypes?s.set(e.edgeTypes,n):s.fill(1,n,n+i),o)for(let a=0;a<o.length;a++)s[n+o[a]/r-1]=0;s[n+i-1]=0}}function a0(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}var G1=`
attribute vec2 vertexPositions;
attribute float vertexValid;

uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;

varying vec4 vColor;

struct PolygonProps {
  vec4 fillColors;
  vec4 lineColors;
  vec3 positions;
  vec3 nextPositions;
  vec3 pickingColors;
  vec3 positions64Low;
  vec3 nextPositions64Low;
  float elevations;
};

vec3 project_offset_normal(vec3 vector) {
  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * project_uCommonUnitsPerWorldUnit);
  }
  return project_normal(vector);
}

void calculatePosition(PolygonProps props) {
#ifdef IS_SIDE_VERTEX
  if(vertexValid < 0.5){
    gl_Position = vec4(0.);
    return;
  }
#endif

  vec3 pos;
  vec3 pos64Low;
  vec3 normal;
  vec4 colors = isWireframe ? props.lineColors : props.fillColors;

  geometry.worldPosition = props.positions;
  geometry.worldPositionAlt = props.nextPositions;
  geometry.pickingColor = props.pickingColors;

#ifdef IS_SIDE_VERTEX
  pos = mix(props.positions, props.nextPositions, vertexPositions.x);
  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);
#else
  pos = props.positions;
  pos64Low = props.positions64Low;
#endif

  if (extruded) {
    pos.z += props.elevations * vertexPositions.y * elevationScale;
  }
  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  if (extruded) {
  #ifdef IS_SIDE_VERTEX
    normal = vec3(
      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),
      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),
      0.0);
    normal = project_offset_normal(normal);
  #else
    normal = project_normal(vec3(0.0, 0.0, 1.0));
  #endif
    geometry.normal = normal;
    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);
    vColor = vec4(lightColor, colors.a * opacity);
  } else {
    vColor = vec4(colors.rgb, colors.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,KO=`#define SHADER_NAME solid-polygon-layer-vertex-shader

attribute vec3 positions;
attribute vec3 positions64Low;
attribute float elevations;
attribute vec4 fillColors;
attribute vec4 lineColors;
attribute vec3 pickingColors;

`.concat(G1,`

void main(void) {
  PolygonProps props;

  props.positions = positions;
  props.positions64Low = positions64Low;
  props.elevations = elevations;
  props.fillColors = fillColors;
  props.lineColors = lineColors;
  props.pickingColors = pickingColors;

  calculatePosition(props);
}
`),qO=`#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX


attribute vec3 instancePositions;
attribute vec3 nextPositions;
attribute vec3 instancePositions64Low;
attribute vec3 nextPositions64Low;
attribute float instanceElevations;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

`.concat(G1,`

void main(void) {
  PolygonProps props;

  #if RING_WINDING_ORDER_CW == 1
    props.positions = instancePositions;
    props.positions64Low = instancePositions64Low;
    props.nextPositions = nextPositions;
    props.nextPositions64Low = nextPositions64Low;
  #else
    props.positions = nextPositions;
    props.positions64Low = nextPositions64Low;
    props.nextPositions = instancePositions;
    props.nextPositions64Low = instancePositions64Low;
  #endif
  props.elevations = instanceElevations;
  props.fillColors = instanceFillColors;
  props.lineColors = instanceLineColors;
  props.pickingColors = instancePickingColors;

  calculatePosition(props);
}
`),QO=`#define SHADER_NAME solid-polygon-layer-fragment-shader

precision highp float;

varying vec4 vColor;

void main(void) {
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;const Al=[0,0,0,255],JO={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Al},getLineColor:{type:"accessor",value:Al},material:!0},da={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class rc extends gt{constructor(...e){super(...e),d(this,"state",void 0)}getShaders(e){return super.getShaders({vs:e==="top"?KO:qO,fs:QO,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[tn,ad,nn]})}get wrapLongitude(){return!1}initializeState(){const{gl:e,viewport:n}=this.context;let{coordinateSystem:i}=this.props;n.isGeospatial&&i===$.DEFAULT&&(i=$.LNGLAT),this.setState({numInstances:0,polygonTesselator:new $O({preproject:i===$.LNGLAT&&n.projectFlat.bind(n),fp64:this.use64bitPositions(),IndexType:!e||td(e,ee.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});const r=this.getAttributeManager(),s=!0;r.remove(["instancePickingColors"]),r.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:s},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:da,accessor:"getPolygon",update:this.calculatePositions,noAlloc:s,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:s},elevations:{size:1,transition:da,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:da,accessor:"getFillColor",defaultValue:Al,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:da,accessor:"getLineColor",defaultValue:Al,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:(o,{index:a,target:l})=>this.encodePickingColor(o&&o.__source?o.__source.index:a,l),shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i}=n,{data:r}=this.props;return r[0]&&r[0].__source&&(n.object=r.find(s=>s.__source.index===i)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let i=0;i<n.length;i++)n[i].__source.index===e&&this._disablePickingIndex(i);else this._disablePickingIndex(e)}draw({uniforms:e}){const{extruded:n,filled:i,wireframe:r,elevationScale:s}=this.props,{topModel:o,sideModel:a,polygonTesselator:l}=this.state,c={...e,extruded:Boolean(n),elevationScale:s};a&&(a.setInstanceCount(l.instanceCount-1),a.setUniforms(c),r&&(a.setDrawMode(3),a.setUniforms({isWireframe:!0}).draw()),i&&(a.setDrawMode(6),a.setUniforms({isWireframe:!1}).draw())),o&&(o.setVertexCount(l.vertexCount),o.setUniforms(c).draw())}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:n,oldProps:i,changeFlags:r}=e,s=this.getAttributeManager();if(r.extensionsChanged||n.filled!==i.filled||n.extruded!==i.extruded){var a;(a=this.state.models)===null||a===void 0||a.forEach(l=>l.delete()),this.setState(this._getModels(this.context.gl)),s.invalidateAll()}}updateGeometry({props:e,oldProps:n,changeFlags:i}){if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){const{polygonTesselator:s}=this.state,o=e.data.attributes||{};s.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:o.getPolygon,buffers:o,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:i.dataChanged}),this.setState({numInstances:s.instanceCount,startIndices:s.vertexStarts}),i.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(e){const{id:n,filled:i,extruded:r}=this.props;let s,o;if(i){const a=this.getShaders("top");a.defines.NON_INSTANCED_MODEL=1,s=new bt(e,{...a,id:"".concat(n,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0})}return r&&(o=new bt(e,{...this.getShaders("side"),id:"".concat(n,"-side"),geometry:new Vt({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1}),o.userData.excludeAttributes={indices:!0}),{models:[o,s].filter(Boolean),topModel:s,sideModel:o}}calculateIndices(e){const{polygonTesselator:n}=this.state;e.startIndices=n.indexStarts,e.value=n.get("indices")}calculatePositions(e){const{polygonTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}d(rc,"defaultProps",JO);d(rc,"layerName","SolidPolygonLayer");function W1({data:t,getIndex:e,dataRange:n,replace:i}){const{startRow:r=0,endRow:s=1/0}=n,o=t.length;let a=o,l=o;for(let h=0;h<o;h++){const g=e(t[h]);if(a>h&&g>=r&&(a=h),g>=s){l=h;break}}let c=a;const f=l-a!==i.length?t.slice(l):void 0;for(let h=0;h<i.length;h++)t[c++]=i[h];if(f){for(let h=0;h<f.length;h++)t[c++]=f[h];t.length=c}return{startRow:a,endRow:a+i.length}}const H1=[0,0,0,255],ek=[0,0,0,255],tk={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:t=>t.polygon},getFillColor:{type:"accessor",value:ek},getLineColor:{type:"accessor",value:H1},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class X1 extends Ql{initializeState(){this.state={paths:[]},this.props.getLineDashArray&&W.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){const n=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(n&&Array.isArray(e.dataChanged)){const i=this.state.paths.slice(),r=e.dataChanged.map(s=>W1({data:i,getIndex:o=>o.__source.index,dataRange:s,replace:this._getPaths(s)}));this.setState({paths:i,pathsDiff:r})}else n&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:n,getPolygon:i,positionFormat:r,_normalize:s}=this.props,o=[],a=r==="XY"?2:3,{startRow:l,endRow:c}=e,{iterable:u,objectInfo:f}=Eo(n,l,c);for(const h of u){f.index++;let g=i(h,f);s&&(g=j1(g,a));const{holeIndices:p}=g,w=g.positions||g;if(p)for(let x=0;x<=p.length;x++){const y=w.slice(p[x-1]||0,p[x]||w.length);o.push(this.getSubLayerRow({path:y},h,f.index))}else o.push(this.getSubLayerRow({path:w},h,f.index))}return o}renderLayers(){const{data:e,_dataDiff:n,stroked:i,filled:r,extruded:s,wireframe:o,_normalize:a,_windingOrder:l,elevationScale:c,transitions:u,positionFormat:f}=this.props,{lineWidthUnits:h,lineWidthScale:g,lineWidthMinPixels:p,lineWidthMaxPixels:w,lineJointRounded:x,lineMiterLimit:y,lineDashJustified:m}=this.props,{getFillColor:_,getLineColor:T,getLineWidth:P,getLineDashArray:A,getElevation:C,getPolygon:M,updateTriggers:R,material:O}=this.props,{paths:z,pathsDiff:j}=this.state,B=this.getSubLayerClass("fill",rc),H=this.getSubLayerClass("stroke",tc),Ye=this.shouldRenderSubLayer("fill",z)&&new B({_dataDiff:n,extruded:s,elevationScale:c,filled:r,wireframe:o,_normalize:a,_windingOrder:l,getElevation:C,getFillColor:_,getLineColor:s&&o?T:H1,material:O,transitions:u},this.getSubLayerProps({id:"fill",updateTriggers:R&&{getPolygon:R.getPolygon,getElevation:R.getElevation,getFillColor:R.getFillColor,lineColors:s&&o,getLineColor:R.getLineColor}}),{data:e,positionFormat:f,getPolygon:M}),ri=!s&&i&&this.shouldRenderSubLayer("stroke",z)&&new H({_dataDiff:j&&(()=>j),widthUnits:h,widthScale:g,widthMinPixels:p,widthMaxPixels:w,jointRounded:x,miterLimit:y,dashJustified:m,_pathType:"loop",transitions:u&&{getWidth:u.getLineWidth,getColor:u.getLineColor,getPath:u.getPolygon},getColor:this.getSubLayerAccessor(T),getWidth:this.getSubLayerAccessor(P),getDashArray:this.getSubLayerAccessor(A)},this.getSubLayerProps({id:"stroke",updateTriggers:R&&{getWidth:R.getLineWidth,getColor:R.getLineColor,getDashArray:R.getLineDashArray}}),{data:z,positionFormat:f,getPath:An=>An.path});return[!s&&Ye,ri,s&&Ye]}}d(X1,"layerName","PolygonLayer");d(X1,"defaultProps",tk);function nk(t,e){if(!t)return null;const n="startIndices"in t?t.startIndices[e]:e,i=t.featureIds.value[n];return n!==-1?ik(t,i,n):null}function ik(t,e,n){const i={properties:{...t.properties[e]}};for(const r in t.numericProps)i.properties[r]=t.numericProps[r].value[n];return i}function rk(t,e){const n={points:null,lines:null,polygons:null};for(const i in n){const r=t[i].globalFeatureIds.value;n[i]=new Uint8ClampedArray(r.length*3);const s=[];for(let o=0;o<r.length;o++)e(r[o],s),n[i][o*3+0]=s[0],n[i][o*3+1]=s[1],n[i][o*3+2]=s[2]}return n}var sk=`#define SHADER_NAME multi-icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float buffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;

varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  if (!picking_uActive) {
    float alpha = texture2D(iconsTexture, vTextureCoords).a;
    vec4 color = vColor;

    // if enable sdf (signed distance fields)
    if (sdf) {
      float distance = alpha;
      alpha = smoothstep(buffer - gamma, buffer + gamma, distance);

      if (outlineBuffer > 0.0) {
        float inFill = alpha;
        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
        color = mix(outlineColor, vColor, inFill);
        alpha = inBorder;
      }
    }

    // Take the global opacity and the alpha from color into account for the alpha component
    float a = alpha * color.a;
    
    if (a < alphaCutoff) {
      discard;
    }

    gl_FragColor = vec4(color.rgb, a * opacity);
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;const l0=192/256,c0=[],ok={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class Pd extends Jl{constructor(...e){super(...e),d(this,"state",void 0)}getShaders(){return{...super.getShaders(),fs:sk}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:(n,{index:i,target:r})=>this.encodePickingColor(i,r)}})}updateState(e){super.updateState(e);const{props:n,oldProps:i}=e;let{outlineColor:r}=n;r!==i.outlineColor&&(r=r.map(s=>s/255),r[3]=Number.isFinite(r[3])?r[3]:1,this.setState({outlineColor:r})),!n.sdf&&n.outlineWidth&&W.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}draw(e){const{sdf:n,smoothing:i,outlineWidth:r}=this.props,{outlineColor:s}=this.state;e.uniforms={...e.uniforms,buffer:l0,outlineBuffer:r?Math.max(i,l0*(1-r)):-1,gamma:i,sdf:Boolean(n),outlineColor:s},super.draw(e)}getInstanceOffset(e){return e?Array.from(e).flatMap(n=>super.getInstanceOffset(n)):c0}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(n=>super.getInstanceIconFrame(n)):c0}}d(Pd,"defaultProps",ok);d(Pd,"layerName","MultiIconLayer");var bd={exports:{}};bd.exports=xo;bd.exports.default=xo;var pr=1e20;function xo(t,e,n,i,r,s){this.fontSize=t||24,this.buffer=e===void 0?3:e,this.cutoff=i||.25,this.fontFamily=r||"sans-serif",this.fontWeight=s||"normal",this.radius=n||8;var o=this.size=this.fontSize+this.buffer*2,a=o+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=o,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(o/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function ak(t,e,n,i,r,s,o){s.fill(pr,0,e*n),o.fill(0,0,e*n);for(var a=(e-i)/2,l=0;l<r;l++)for(var c=0;c<i;c++){var u=(l+a)*e+c+a,f=t.data[4*(l*i+c)+3]/255;if(f===1)s[u]=0,o[u]=pr;else if(f===0)s[u]=pr,o[u]=0;else{var h=Math.max(0,.5-f),g=Math.max(0,f-.5);s[u]=h*h,o[u]=g*g}}}function lk(t,e,n,i,r,s,o){for(var a=0;a<e*n;a++){var l=Math.sqrt(i[a])-Math.sqrt(r[a]);t[a]=Math.round(255-255*(l/s+o))}}xo.prototype._draw=function(t,e){var n=this.ctx.measureText(t),i=n.width,r=2*this.buffer,s,o,a,l,c,u,f,h;e&&this.useMetrics?(c=Math.floor(n.actualBoundingBoxAscent),h=this.buffer+Math.ceil(n.actualBoundingBoxAscent),u=this.buffer,f=this.buffer,o=Math.min(this.size,Math.ceil(n.actualBoundingBoxRight-n.actualBoundingBoxLeft)),l=Math.min(this.size-u,Math.ceil(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)),s=o+r,a=l+r,this.ctx.textBaseline="alphabetic"):(s=o=this.size,a=l=this.size,c=19*this.fontSize/24,u=f=0,h=this.middle,this.ctx.textBaseline="middle");var g;o&&l&&(this.ctx.clearRect(f,u,o,l),this.ctx.fillText(t,this.buffer,h),g=this.ctx.getImageData(f,u,o,l));var p=new Uint8ClampedArray(s*a);return ak(g,s,a,o,l,this.gridOuter,this.gridInner),u0(this.gridOuter,s,a,this.f,this.v,this.z),u0(this.gridInner,s,a,this.f,this.v,this.z),lk(p,s,a,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:p,metrics:{width:o,height:l,sdfWidth:s,sdfHeight:a,top:c,left:0,advance:i}}};xo.prototype.draw=function(t){return this._draw(t,!1).data};xo.prototype.drawWithMetrics=function(t){return this._draw(t,!0)};function u0(t,e,n,i,r,s){for(var o=0;o<e;o++)f0(t,o,e,n,i,r,s);for(var a=0;a<n;a++)f0(t,a*e,1,e,i,r,s)}function f0(t,e,n,i,r,s,o){var a,l,c,u;for(s[0]=0,o[0]=-pr,o[1]=pr,a=0;a<i;a++)r[a]=t[e+a*n];for(a=1,l=0,c=0;a<i;a++){do u=s[l],c=(r[a]-r[u]+a*a-u*u)/(a-u)/2;while(c<=o[l]&&--l>-1);l++,s[l]=a,o[l]=c,o[l+1]=pr}for(a=0,l=0;a<i;a++){for(;o[l+1]<a;)l++;u=s[l],t[e+a*n]=r[u]+(a-u)*(a-u)}}var ck=bd.exports;const uk=32,fk=[];function hk(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function dk({characterSet:t,getFontWidth:e,fontHeight:n,buffer:i,maxCanvasWidth:r,mapping:s={},xOffset:o=0,yOffset:a=0}){let l=0,c=o;for(const f of t)if(!s[f]){const h=e(f);c+h+i*2>r&&(c=0,l++),s[f]={x:c+i,y:a+l*(n+i*2)+i,width:h,height:n},c+=h+i*2}const u=n+i*2;return{mapping:s,xOffset:c,yOffset:a+l*u,canvasHeight:hk(a+(l+1)*u)}}function Y1(t,e,n,i){let r=0;for(let o=e;o<n;o++){var s;const a=t[o];r+=((s=i[a])===null||s===void 0?void 0:s.width)||0}return r}function Z1(t,e,n,i,r,s){let o=e,a=0;for(let l=e;l<n;l++){const c=Y1(t,l,l+1,r);a+c>i&&(o<l&&s.push(l),o=l,a=0),a+=c}return a}function gk(t,e,n,i,r,s){let o=e,a=e,l=e,c=0;for(let u=e;u<n;u++)if((t[u]===" "||t[u+1]===" "||u+1===n)&&(l=u+1),l>a){let f=Y1(t,a,l,r);c+f>i&&(o<a&&(s.push(a),o=a,c=0),f>i&&(f=Z1(t,a,l,i,r,s),o=s[s.length-1])),a=l,c+=f}return c}function pk(t,e,n,i,r=0,s){s===void 0&&(s=t.length);const o=[];return e==="break-all"?Z1(t,r,s,n,i,o):gk(t,r,s,n,i,o),o}function mk(t,e,n,i,r,s){let o=0,a=0;for(let l=e;l<n;l++){const c=t[l],u=i[c];u?(a||(a=u.height),r[l]=o+u.width/2,o+=u.width):(W.warn("Missing character: ".concat(c," (").concat(c.codePointAt(0),")"))(),r[l]=o,o+=uk)}s[0]=o,s[1]=a}function h0(t,e,n,i,r){const s=Array.from(t),o=s.length,a=new Array(o),l=new Array(o),c=new Array(o),u=(n==="break-word"||n==="break-all")&&isFinite(i)&&i>0,f=[0,0],h=[0,0];let g=0,p=0,w=0;for(let x=0;x<=o;x++){const y=s[x];if((y===`
`||x===o)&&(w=x),w>p){const m=u?pk(s,n,i,r,p,w):fk;for(let _=0;_<=m.length;_++){const T=_===0?p:m[_-1],P=_<m.length?m[_]:w;mk(s,T,P,r,a,h);for(let A=T;A<P;A++)l[A]=g+h[1]/2,c[A]=h[0];g=g+h[1]*e,f[0]=Math.max(f[0],h[0])}p=w}y===`
`&&(a[p]=0,l[p]=0,c[p]=0,p++)}return f[1]=g,{x:a,y:l,rowWidth:c,size:f}}function vk({value:t,length:e,stride:n,offset:i,startIndices:r,characterSet:s}){const o=t.BYTES_PER_ELEMENT,a=n?n/o:1,l=i?i/o:0,c=r[e]||Math.ceil((t.length-l)/a),u=s&&new Set,f=new Array(e);let h=t;if(a>1||l>0){const g=t.constructor;h=new g(c);for(let p=0;p<c;p++)h[p]=t[p*a+l]}for(let g=0;g<e;g++){const p=r[g],w=r[g+1]||c,x=h.subarray(p,w);f[g]=String.fromCodePoint.apply(null,x),u&&x.forEach(u.add,u)}if(u)for(const g of u)s.add(String.fromCodePoint(g));return{texts:f,characterCount:c}}class $1{constructor(e=5){d(this,"limit",void 0),d(this,"_cache",{}),d(this,"_order",[]),this.limit=e}get(e){const n=this._cache[e];return n&&(this._deleteOrder(e),this._appendOrder(e)),n}set(e,n){this._cache[e]?(this.delete(e),this._cache[e]=n,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=n,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const n=this._order.indexOf(e);n>=0&&this._order.splice(n,1)}_appendOrder(e){this._order.push(e)}}function yk(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const Ls={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:yk(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},d0=1024,_k=.9,g0=1.2,K1=3;let Cl=new $1(K1);function wk(t,e){let n;typeof e=="string"?n=new Set(Array.from(e)):n=new Set(e);const i=Cl.get(t);if(!i)return n;for(const r in i.mapping)n.has(r)&&n.delete(r);return n}function Ek(t,e){for(let n=0;n<t.length;n++)e.data[4*n+3]=t[n]}function p0(t,e,n,i){t.font="".concat(i," ").concat(n,"px ").concat(e),t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function xk(t){W.assert(Number.isFinite(t)&&t>=K1,"Invalid cache limit"),Cl=new $1(t)}class Tk{constructor(){d(this,"props",{...Ls}),d(this,"_key",void 0),d(this,"_atlas",void 0)}get texture(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){return g0}setProps(e={}){Object.assign(this.props,e);const n=this._key;this._key=this._getKey();const i=wk(this._key,this.props.characterSet),r=Cl.get(this._key);if(r&&i.size===0){this._key!==n&&(this._atlas=r);return}const s=this._generateFontAtlas(this._key,i,r);this._atlas=s,Cl.set(this._key,s)}_generateFontAtlas(e,n,i){const{fontFamily:r,fontWeight:s,fontSize:o,buffer:a,sdf:l,radius:c,cutoff:u}=this.props;let f=i&&i.data;f||(f=document.createElement("canvas"),f.width=d0);const h=f.getContext("2d");p0(h,r,o,s);const{mapping:g,canvasHeight:p,xOffset:w,yOffset:x}=dk({getFontWidth:y=>h.measureText(y).width,fontHeight:o*g0,buffer:a,characterSet:n,maxCanvasWidth:d0,...i&&{mapping:i.mapping,xOffset:i.xOffset,yOffset:i.yOffset}});if(f.height!==p){const y=h.getImageData(0,0,f.width,f.height);f.height=p,h.putImageData(y,0,0)}if(p0(h,r,o,s),l){const y=new ck(o,a,c,u,r,s),m=h.getImageData(0,0,y.size,y.size);for(const _ of n)Ek(y.draw(_),m),h.putImageData(m,g[_].x-a,g[_].y+a)}else for(const y of n)h.fillText(y,g[y].x,g[y].y+o*_k);return{xOffset:w,yOffset:x,mapping:g,data:f,width:f.width,height:f.height}}_getKey(){const{fontFamily:e,fontWeight:n,fontSize:i,buffer:r,sdf:s,radius:o,cutoff:a}=this.props;return s?"".concat(e," ").concat(n," ").concat(i," ").concat(r," ").concat(o," ").concat(a):"".concat(e," ").concat(n," ").concat(i," ").concat(r)}}var Sk=`#define SHADER_NAME text-background-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec4 instanceRects;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec2 instancePixelOffsets;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = radians(angle);
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;
  vLineWidth = instanceLineWidths;

  // convert size in meters to pixels, then scaled and clamp

  // project meters to pixels and clamp to limits
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
    sizeMinPixels, sizeMaxPixels
  );

  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;

  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
  pixelOffset += instancePixelOffsets;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  // Apply opacity to instance color, or return instance picking color
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Pk=`#define SHADER_NAME text-background-layer-fragment-shader

precision highp float;

uniform bool stroked;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

void main(void) {
  geometry.uv = uv;

  vec2 pixelPosition = uv * dimensions;
  if (stroked) {
    float distToEdge = min(
      min(pixelPosition.x, dimensions.x - pixelPosition.x),
      min(pixelPosition.y, dimensions.y - pixelPosition.y)
    );
    float isBorder = smoothedge(distToEdge, vLineWidth);
    gl_FragColor = mix(vFillColor, vLineColor, isBorder);
  } else {
    gl_FragColor = vFillColor;
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;const bk={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class Ad extends gt{constructor(...e){super(...e),d(this,"state",void 0)}getShaders(){return super.getShaders({vs:Sk,fs:Pk,modules:[tn,nn]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:n}=e;if(n.extensionsChanged){var i;const{gl:r}=this.context;(i=this.state.model)===null||i===void 0||i.delete(),this.state.model=this._getModel(r),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{billboard:n,sizeScale:i,sizeUnits:r,sizeMinPixels:s,sizeMaxPixels:o,getLineWidth:a}=this.props;let{padding:l}=this.props;l.length<4&&(l=[l[0],l[1],l[0],l[1]]),this.state.model.setUniforms(e).setUniforms({billboard:n,stroked:Boolean(a),padding:l,sizeUnits:ft[r],sizeScale:i,sizeMinPixels:s,sizeMaxPixels:o}).draw()}_getModel(e){const n=[0,0,1,0,1,1,0,1];return new bt(e,{...this.getShaders(),id:this.props.id,geometry:new Vt({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}}d(Ad,"defaultProps",bk);d(Ad,"layerName","TextBackgroundLayer");const m0={start:1,middle:0,end:-1},v0={top:1,center:0,bottom:-1},xu=[0,0,0,255],Ak=1,Ck={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:xu},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Ls.characterSet},fontFamily:Ls.fontFamily,fontWeight:Ls.fontWeight,lineHeight:Ak,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:xu},fontSettings:{},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:xu},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class Cd extends Ql{constructor(...e){super(...e),d(this,"state",void 0),d(this,"getBoundingRect",(n,i)=>{const r=this.state.fontAtlasManager.mapping,s=this.state.getText,{wordBreak:o,maxWidth:a,lineHeight:l,getTextAnchor:c,getAlignmentBaseline:u}=this.props,f=s(n,i)||"",{size:[h,g]}=h0(f,l,o,a,r),p=m0[typeof c=="function"?c(n,i):c],w=v0[typeof u=="function"?u(n,i):u];return[(p-1)*h/2,(w-1)*g/2,h,g]}),d(this,"getIconOffsets",(n,i)=>{const r=this.state.fontAtlasManager.mapping,s=this.state.getText,{wordBreak:o,maxWidth:a,lineHeight:l,getTextAnchor:c,getAlignmentBaseline:u}=this.props,f=s(n,i)||"",{x:h,y:g,rowWidth:p,size:[w,x]}=h0(f,l,o,a,r),y=m0[typeof c=="function"?c(n,i):c],m=v0[typeof u=="function"?u(n,i):u],_=h.length,T=new Array(_*2);let P=0;for(let A=0;A<_;A++){const C=(1-y)*(w-p[A])/2;T[P++]=(y-1)*w/2+C+h[A],T[P++]=(m-1)*x/2+g[A]}return T})}initializeState(){this.state={styleVersion:0,fontAtlasManager:new Tk}}updateState(e){const{props:n,oldProps:i,changeFlags:r}=e;(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||n.lineHeight!==i.lineHeight||n.wordBreak!==i.wordBreak||n.maxWidth!==i.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:n,fontWeight:i}=this.props,{fontAtlasManager:r,characterSet:s}=this.state,o={...e,characterSet:s,fontFamily:n,fontWeight:i};if(!r.mapping)return r.setProps(o),!0;for(const a in o)if(o[a]!==r.props[a])return r.setProps(o),!0;return!1}_updateText(){var e;const{data:n,characterSet:i}=this.props,r=(e=n.attributes)===null||e===void 0?void 0:e.getText;let{getText:s}=this.props,o=n.startIndices,a;const l=i==="auto"&&new Set;if(r&&o){const{texts:c,characterCount:u}=vk({...ArrayBuffer.isView(r)?{value:r}:r,length:n.length,startIndices:o,characterSet:l});a=u,s=(f,{index:h})=>c[h]}else{const{iterable:c,objectInfo:u}=Eo(n);o=[0],a=0;for(const f of c){u.index++;const h=Array.from(s(f,u)||"");l&&h.forEach(l.add,l),a+=h.length,o.push(a)}}this.setState({getText:s,startIndices:o,numInstances:a,characterSet:l||i})}renderLayers(){const{startIndices:e,numInstances:n,getText:i,fontAtlasManager:{scale:r,texture:s,mapping:o},styleVersion:a}=this.state,{data:l,_dataDiff:c,getPosition:u,getColor:f,getSize:h,getAngle:g,getPixelOffset:p,getBackgroundColor:w,getBorderColor:x,getBorderWidth:y,backgroundPadding:m,background:_,billboard:T,fontSettings:P,outlineWidth:A,outlineColor:C,sizeScale:M,sizeUnits:R,sizeMinPixels:O,sizeMaxPixels:z,transitions:j,updateTriggers:B}=this.props,H=this.getSubLayerClass("characters",Pd),Ye=this.getSubLayerClass("background",Ad);return[_&&new Ye({getFillColor:w,getLineColor:x,getLineWidth:y,padding:m,getPosition:u,getSize:h,getAngle:g,getPixelOffset:p,billboard:T,sizeScale:M/this.state.fontAtlasManager.props.fontSize,sizeUnits:R,sizeMinPixels:O,sizeMaxPixels:z,transitions:j&&{getPosition:j.getPosition,getAngle:j.getAngle,getSize:j.getSize,getFillColor:j.getBackgroundColor,getLineColor:j.getBorderColor,getLineWidth:j.getBorderWidth,getPixelOffset:j.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:B.getPosition,getAngle:B.getAngle,getSize:B.getSize,getFillColor:B.getBackgroundColor,getLineColor:B.getBorderColor,getLineWidth:B.getBorderWidth,getPixelOffset:B.getPixelOffset,getBoundingRect:{getText:B.getText,getTextAnchor:B.getTextAnchor,getAlignmentBaseline:B.getAlignmentBaseline,styleVersion:a}}}),{data:l.attributes&&l.attributes.background?{length:l.length,attributes:l.attributes.background}:l,_dataDiff:c,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new H({sdf:P.sdf,smoothing:Number.isFinite(P.smoothing)?P.smoothing:Ls.smoothing,outlineWidth:A,outlineColor:C,iconAtlas:s,iconMapping:o,getPosition:u,getColor:f,getSize:h,getAngle:g,getPixelOffset:p,billboard:T,sizeScale:M*r,sizeUnits:R,sizeMinPixels:O*r,sizeMaxPixels:z*r,transitions:j&&{getPosition:j.getPosition,getAngle:j.getAngle,getColor:j.getColor,getSize:j.getSize,getPixelOffset:j.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{getIcon:B.getText,getPosition:B.getPosition,getAngle:B.getAngle,getColor:B.getColor,getSize:B.getSize,getPixelOffset:B.getPixelOffset,getIconOffsets:{getText:B.getText,getTextAnchor:B.getTextAnchor,getAlignmentBaseline:B.getAlignmentBaseline,styleVersion:a}}}),{data:l,_dataDiff:c,startIndices:e,numInstances:n,getIconOffsets:this.getIconOffsets,getIcon:i})]}static set fontAtlasCacheLimit(e){xk(e)}}d(Cd,"defaultProps",Ck);d(Cd,"layerName","TextLayer");const za={circle:{type:ec,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:Jl,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:Cd,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Ua={type:tc,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},$f={type:rc,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function ls({type:t,props:e}){const n={};for(const i in e)n[i]=t.defaultProps[e[i]];return n}function Tu(t,e){const{transitions:n,updateTriggers:i}=t.props,r={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(const s in e){const o=e[s];let a=t.props[s];s.startsWith("get")&&(a=t.getSubLayerAccessor(a),r.updateTriggers[o]=i[s],n&&(r.transitions[o]=n[s])),r[o]=a}return r}function Lk(t){if(Array.isArray(t))return t;switch(W.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return W.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function y0(t,e,n={}){const i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:r=0,endRow:s=t.length}=n;for(let o=r;o<s;o++){const a=t[o],{geometry:l}=a;if(!!l)if(l.type==="GeometryCollection"){W.assert(Array.isArray(l.geometries),"GeoJSON does not have geometries array");const{geometries:c}=l;for(let u=0;u<c.length;u++){const f=c[u];_0(f,i,e,a,o)}}else _0(l,i,e,a,o)}return i}function _0(t,e,n,i,r){const{type:s,coordinates:o}=t,{pointFeatures:a,lineFeatures:l,polygonFeatures:c,polygonOutlineFeatures:u}=e;if(!Ik(s,o)){W.warn("".concat(s," coordinates are malformed"))();return}switch(s){case"Point":a.push(n({geometry:t},i,r));break;case"MultiPoint":o.forEach(f=>{a.push(n({geometry:{type:"Point",coordinates:f}},i,r))});break;case"LineString":l.push(n({geometry:t},i,r));break;case"MultiLineString":o.forEach(f=>{l.push(n({geometry:{type:"LineString",coordinates:f}},i,r))});break;case"Polygon":c.push(n({geometry:t},i,r)),o.forEach(f=>{u.push(n({geometry:{type:"LineString",coordinates:f}},i,r))});break;case"MultiPolygon":o.forEach(f=>{c.push(n({geometry:{type:"Polygon",coordinates:f}},i,r)),f.forEach(h=>{u.push(n({geometry:{type:"LineString",coordinates:h}},i,r))})});break}}const Mk={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function Ik(t,e){let n=Mk[t];for(W.assert(n,"Unknown GeoJSON type ".concat(t));e&&--n>0;)e=e[0];return e&&Number.isFinite(e[0])}function q1(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function ga(t){return t.geometry.coordinates}function Rk(t,e){const n=q1(),{pointFeatures:i,lineFeatures:r,polygonFeatures:s,polygonOutlineFeatures:o}=t;return n.points.data=i,n.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),n.points.getPosition=ga,n.lines.data=r,n.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),n.lines.getPath=ga,n.polygons.data=s,n.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),n.polygons.getPolygon=ga,n.polygonsOutline.data=o,n.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),n.polygonsOutline.getPath=ga,n}function Ok(t,e){const n=q1(),{points:i,lines:r,polygons:s}=t,o=rk(t,e);return n.points.data={length:i.positions.value.length/i.positions.size,attributes:{...i.attributes,getPosition:i.positions,instancePickingColors:{size:3,value:o.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},n.lines.data={length:r.pathIndices.value.length-1,startIndices:r.pathIndices.value,attributes:{...r.attributes,getPath:r.positions,instancePickingColors:{size:3,value:o.lines}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},n.lines._pathType="open",n.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:{...s.attributes,getPolygon:s.positions,pickingColors:{size:3,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygons._normalize=!1,s.triangles&&(n.polygons.data.attributes.indices=s.triangles.value),n.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:3,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygonsOutline._pathType="open",n}const kk=["points","linestrings","polygons"],Nk={...ls(za.circle),...ls(za.icon),...ls(za.text),...ls(Ua),...ls($f),stroked:!0,filled:!0,extruded:!1,wireframe:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class Q1 extends Ql{initializeState(){this.state={layerProps:{},features:{}}}updateState({props:e,changeFlags:n}){if(!n.dataChanged)return;const{data:i}=this.props,r=i&&"points"in i&&"polygons"in i&&"lines"in i;this.setState({binary:r}),r?this._updateStateBinary({props:e,changeFlags:n}):this._updateStateJSON({props:e,changeFlags:n})}_updateStateBinary({props:e,changeFlags:n}){const i=Ok(e.data,this.encodePickingColor);this.setState({layerProps:i})}_updateStateJSON({props:e,changeFlags:n}){const i=Lk(e.data),r=this.getSubLayerRow.bind(this);let s={};const o={};if(Array.isArray(n.dataChanged)){const l=this.state.features;for(const c in l)s[c]=l[c].slice(),o[c]=[];for(const c of n.dataChanged){const u=y0(i,r,c);for(const f in l)o[f].push(W1({data:s[f],getIndex:h=>h.__source.index,dataRange:c,replace:u[f]}))}}else s=y0(i,r);const a=Rk(s,o);this.setState({features:s,featuresDiff:o,layerProps:a})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:i,sourceLayer:r}=n;return n.featureType=kk.find(s=>r.id.startsWith("".concat(this.id,"-").concat(s,"-"))),i>=0&&r.id.startsWith("".concat(this.id,"-points-text"))&&this.state.binary&&(n.index=this.props.data.points.globalFeatureIds.value[i]),n}_updateAutoHighlight(e){const n="".concat(this.id,"-points-"),i=e.featureType==="points";for(const r of this.getSubLayers())r.id.startsWith(n)===i&&r.updateAutoHighlight(e)}_renderPolygonLayer(){const{extruded:e,wireframe:n}=this.props,{layerProps:i}=this.state,r="polygons-fill",s=this.shouldRenderSubLayer(r,i.polygons.data)&&this.getSubLayerClass(r,$f.type);if(s){const o=Tu(this,$f.props),a=e&&n;return a||delete o.getLineColor,o.updateTriggers.lineColors=a,new s(o,this.getSubLayerProps({id:r,updateTriggers:o.updateTriggers}),i.polygons)}return null}_renderLineLayers(){const{extruded:e,stroked:n}=this.props,{layerProps:i}=this.state,r="polygons-stroke",s="linestrings",o=!e&&n&&this.shouldRenderSubLayer(r,i.polygonsOutline.data)&&this.getSubLayerClass(r,Ua.type),a=this.shouldRenderSubLayer(s,i.lines.data)&&this.getSubLayerClass(s,Ua.type);if(o||a){const l=Tu(this,Ua.props);return[o&&new o(l,this.getSubLayerProps({id:r,updateTriggers:l.updateTriggers}),i.polygonsOutline),a&&new a(l,this.getSubLayerProps({id:s,updateTriggers:l.updateTriggers}),i.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:n,binary:i}=this.state;let{highlightedObjectIndex:r}=this.props;!i&&Number.isFinite(r)&&(r=n.points.data.findIndex(a=>a.__source.index===r));const s=new Set(e.split("+")),o=[];for(const a of s){const l="points-".concat(a),c=za[a],u=c&&this.shouldRenderSubLayer(l,n.points.data)&&this.getSubLayerClass(l,c.type);if(u){const f=Tu(this,c.props);let h=n.points;if(a==="text"&&i){const{instancePickingColors:g,...p}=h.data.attributes;h={...h,data:{...h.data,attributes:p}}}o.push(new u(f,this.getSubLayerProps({id:l,updateTriggers:f.updateTriggers,highlightedObjectIndex:r}),h))}}return o}renderLayers(){const{extruded:e}=this.props,n=this._renderPolygonLayer(),i=this._renderLineLayers(),r=this._renderPointLayers();return[!e&&n,i,r,e&&n]}getSubLayerAccessor(e){const{binary:n}=this.state;return!n||typeof e!="function"?super.getSubLayerAccessor(e):(i,r)=>{const{data:s,index:o}=r,a=nk(s,o);return e(a,r)}}}d(Q1,"layerName","GeoJsonLayer");d(Q1,"defaultProps",Nk);var Ld={exports:{}},sc={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fk=It.exports,Dk=Symbol.for("react.element"),zk=Symbol.for("react.fragment"),Uk=Object.prototype.hasOwnProperty,Bk=Fk.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Vk={key:!0,ref:!0,__self:!0,__source:!0};function J1(t,e,n){var i,r={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)Uk.call(e,i)&&!Vk.hasOwnProperty(i)&&(r[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:Dk,type:t,key:s,ref:o,props:r,_owner:Bk.current}}sc.Fragment=zk;sc.jsx=J1;sc.jsxs=J1;Ld.exports=sc;const Ms=Ld.exports.jsx,jk=Ld.exports.jsxs;function Gk(){const[t]=It.exports.useState({lat:37.74,lng:-122.4,zoom:12}),e=It.exports.useRef(),n=It.exports.useRef(null),i=It.exports.useRef(null),r=It.exports.useRef(void 0);return It.exports.useEffect(()=>{r.current=new pd({initialViewState:{latitude:t.lat,longitude:t.lng,zoom:t.zoom-1},parent:n.current,canvas:i.current,getCursor:s=>s.isHovering?"pointer":"grab",layers:[new ec({id:"scatterplot-layer",data:"https://raw.githubusercontent.com/visgl/deck.gl-data/master/website/bart-stations.json",pickable:!0,opacity:.8,stroked:!0,filled:!0,radiusScale:6,radiusMinPixels:1,radiusMaxPixels:100,lineWidthMinPixels:1,getPosition:s=>s.coordinates,getRadius:s=>Math.sqrt(s.exits),getFillColor:s=>[255,140,0],getLineColor:s=>[0,0,0],autoHighlight:!0,highlightColor:[255,0,0,100]})]}),ymaps.ready().then(()=>{e.current=new ymaps.Map("map",{center:[t.lat,t.lng],zoom:t.zoom,controls:["zoomControl"]},{maxAnimationZoomDifference:0});const s=e.current.options.get("projection");e.current.cursors.push("inherit"),e.current.events.add("actiontick",o=>{var l,c;console.log("actiontick");const a=s.fromGlobalPixels(o.originalEvent.tick.globalPixelCenter,o.originalEvent.tick.zoom);(l=r.current)==null||l.setProps({viewState:{latitude:a[0],longitude:a[1],zoom:o.originalEvent.tick.zoom-1}}),(c=r.current)==null||c.redraw("false")})})},[]),It.exports.useEffect(()=>()=>{var s;(s=r.current)==null||s.finalize(),r.current=void 0},[]),Ms("div",{className:"App",children:jk("div",{ref:n,style:{height:"100%",position:"relative"},children:[Ms("div",{id:"map",className:"Map"}),Ms("canvas",{ref:i,style:{position:"absolute",pointerEvents:"none",inset:0}})]})})}Su.createRoot(document.getElementById("root")).render(Ms(Ww.StrictMode,{children:Ms(Gk,{})}));
